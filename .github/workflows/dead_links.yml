name: Find dead links
on:
  pull_request:
    branches: [main, develop, dependency_updates]
    paths-ignore:
      - "apps/api/**"
  schedule:
    - cron: "0 3 * * *"

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  find_dead_links:
    name: Find dead links
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4.1.1
      - name: Enable Corepack before setting up Node
        run: corepack enable
      - name: Set up Node.js
        uses: actions/setup-node@v4.0.2
        with:
          node-version: "20.x"
          cache: "yarn"
      - run: corepack enable && yarn install
      - name: Build page
        env:
          NEXT_PUBLIC_API_HOST: https://prod-mong-api.skde.org
        run: |
          yarn run export
      - name: Find dead links
        run: scripts/atlas/checklinks.py apps/skde/out/helseatlas/v2/kronikere apps/skde/out/ https://www.skde.no/
