var builder=function(n,f){function z(i,b){l=b;h.css("display","inline");var a=l.container;a.position();var d=a.position().left,c=a.position().top,e=a.outerWidth(),a=a.outerHeight(),f=l.zIndex();f==void 0&&(f=l.container.css("z-index"));h.css({left:d,top:c,width:e,height:a,"z-index":f,display:"inline"})}function E(){a&&a.onMouseUp&&a.onMouseUp.call(null,c.id);m=!1;f(document).off(".docEvents");p.css("display","none")}function F(){f(document).off(".docEvents");d=="move"?(f(document).on("mousemove.docEvents",
G),f(document).on("mouseup.docEvents",H)):d=="n-resize"||d=="ne-resize"||d=="e-resize"||d=="se-resize"||d=="s-resize"||d=="sw-resize"||d=="w-resize"||d=="nw-resize"?(o.css("display","none"),f(document).on("mousemove.docEvents",I),f(document).on("mouseup.docEvents",J)):m=!1}function G(i){ia.showCursor(d);if(q){var b=u+(i.pageX-v),i=w+(i.pageY-x);if(A)var a=r/100*j.width(),f=r/100*j.height(),b=Math.ceil(b/a)*a,i=Math.ceil(i/f)*f;h.css({left:b,top:i});a=c.xAnchor();if(a=="end"||a=="right")b+=s;else if(a==
"middle"||a=="center")b+=s/2;b=b/j.width()*100;i=i/j.height()*100;c.setPosition(b,i)}}function H(){m=!1;f(document).off(".docEvents");p.css("display","none");if(a&&a.onDragEnd){var i=c.container.position(),b=i.left/j.width()*100,i=i.top/j.height()*100;a.onDragEnd.call(null,c.id,b,i)}a&&a.onMouseUp&&a.onMouseUp.call(null,c.id)}function I(a){ia.showCursor(d);if(q){var b=a.pageX-v,c=a.pageY-x,a=u,f=w,e=s,k=B;d=="nw-resize"?(a+=b,e-=b,f+=c,k-=c):d=="n-resize"?(f+=c,k-=c):d=="ne-resize"?(e+=b,f+=c,k-=
c):d=="e-resize"?e+=b:d=="se-resize"?(e+=b,k+=c):d=="s-resize"?k+=c:d=="sw-resize"?(a+=b,e-=b,k+=c):d=="w-resize"&&(a+=b,e-=b);if(A){b=r/100*j.width();c=r/100*j.height();if(d=="nw-resize"||d=="w-resize"||d=="sw-resize"){var g=Math.ceil(a/b)*b;e-=g-a;a=g}if(d=="nw-resize"||d=="n-resize"||d=="ne-resize")g=Math.ceil(f/c)*c,k-=g-f,f=g;if(d=="ne-resize"||d=="e-resize"||d=="se-resize")e=Math.ceil(e/b)*b;if(d=="se-resize"||d=="s-resize"||d=="sw-resize")k=Math.ceil(k/c)*c}e=Math.max(e,C);k=Math.max(k,C);
h.css({left:a,top:f,width:e,height:k})}}function J(){m=!1;f(document).off(".docEvents");var i=h.position().left,b=h.position().top,d=h.outerWidth(),e=h.outerHeight(),g=c.xAnchor();if(g=="end"||g=="right")i+=d;else if(g=="middle"||g=="center")i+=d/2;var i=i/j.width()*100,b=b/j.height()*100,g=d/j.width()*100,k=e/j.height()*100;c.height()==void 0&&(k=void 0);c.rescale?c.setDimensions(i,b,g,k):c.setDimensions(i,b,d,e);p.css("display","none");a&&a.onResizeEnd&&a.onResizeEnd.call(null,c.id,i,b,g,k);a&&
a.onMouseUp&&a.onMouseUp.call(null,c.id)}function D(a){var b=a.pageX-h.offset().left,a=a.pageY-h.offset().top,c=h.outerWidth(!0),f=h.outerHeight(!0);d=l.height()==void 0?b>c-e?"e-resize":"move":b>e&&b<c-e&&a<e?"n-resize":b>c-e&&a<e?"ne-resize":b>c-e&&a>e&&a<f-e?"e-resize":b>c-e&&a>f-e?"se-resize":b>e&&b<c-e&&a>f-e?"s-resize":b<e&&a>f-e?"sw-resize":b<e&&a>e&&a<f-e?"w-resize":b<e&&a<e?"nw-resize":"move";ia.showCursor(d)}var g=n.canvas=n.canvas||{},l=void 0,c=void 0;g.isActive=!0;var d="",C=30,e=15,
A=!0,r=0.75,m=!1,q=!0,y=!1,u=0,w=0,s=0,B=0,v=0,x=0,j,p=f('<div class="ia-event-blocker">'),o=f('<div class="ia-active-panel">'),h=f('<div class="ia-drag-panel">').append(f('<div class="ia-drag-panel-fill">')),t=f('<div class="ia-drag-panel-btn-bar">'),K=f('<div class="ia-drag-panel-title-bar">'),a;g.init=function(e){if(a=e)j=n.report.container,p.appendTo(j),h.appendTo(j),t.appendTo(h),K.appendTo(h),f('<div class="ia-drag-panel-btn ia-drag-panel-btn-front"></div>').mousedown(function(b){b.stopPropagation();
a&&a.onBringToFrontBtnClick&&a.onBringToFrontBtnClick.call(null,l.id);z(b,l)}).appendTo(t),f('<div class="ia-drag-panel-btn ia-drag-panel-btn-back"></div>').mousedown(function(b){b.stopPropagation();a&&a.onSendToBackBtnClick&&a.onSendToBackBtnClick.call(null,l.id)}).appendTo(t),f('<div class="ia-drag-panel-btn ia-drag-panel-btn-remove"></div>').mousedown(function(b){b.stopPropagation();a&&a.onRemoveBtnClick&&a.onRemoveBtnClick.call(null,l.id);g.clearSelection()}).appendTo(t),f(".ia-drag-panel-btn").mouseenter(function(){y=
!0}).mouseleave(function(){y=!1}),g.on(),j.mouseenter(function(){q=!0}).mouseleave(function(){q=!1}).mousedown(function(){g.isActive==!0&&(o.css("display","none"),c&&(a&&a.onUnselect&&a.onUnselect.call(null,c.id),c=void 0),a&&a.onClearSelection&&a.onClearSelection.call(null))}),h.mouseenter(function(a){m||D(a)}).mousemove(function(a){m||D(a)}).mousedown(function(b){if(!y){var d=!0;c&&c.id==l.id&&(d=!1);c&&a&&a.onUnselect&&d&&a.onUnselect.call(null,c.id);m=!0;p.css({display:"inline"});b.stopPropagation();
c=l;var e=h.position();u=e.left;w=e.top;s=h.outerWidth();B=h.outerHeight();v=b.pageX;x=b.pageY;a&&a.onMouseDown&&a.onMouseDown.call(null,c.id);a&&a.onSelect&&d&&a.onSelect.call(null,c.id);f(document).on("mouseup.docEvents",E);f(document).on("mousemove.docEvents",F)}}).mouseleave(function(){m||(d="",h.css("display","none"),ia.showDefaultCursor())})};g.select=function(d){d=n.report.getWidget(d);if(d!=void 0){var b=!0;c&&c.id==d.id&&(b=!1);c&&a&&a.onUnselect&&b&&a.onUnselect.call(null,c.id);c=d;a&&a.onSelect&&
b&&a.onSelect.call(null,c.id)}else g.clearSelection()};g.clearSelection=function(){c&&a&&a.onUnselect&&a.onUnselect.call(null,c.id);a&&a.onClearSelection&&a.onClearSelection.call(null);o.css("display","none");c=void 0;h.css("display","none");l=void 0};g.update=function(){o.css("display","none");h.css("display","none");p.appendTo(j);o.appendTo(j);h.appendTo(j);if(g.isActive)g.on()};g.on=function(){g.isActive=!0;c!=void 0&&o.css("display","inline");for(var a=n.report.getWidgets(),b=0;b<a.length;b++)(function(){var c=
a[b];c.container.on("mouseenter.widgetEvents",function(a){z(a,c)})})()};g.off=function(){g.isActive=!1;o.css("display","none");h.css("display","none");for(var a=n.report.getWidgets(),b=0;b<a.length;b++)a[b].container.off("mouseenter.widgetEvents")};return n}(builder||{},window.jQuery);
