(function(a,b,c){function d(){g=b[h](function(){e.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,k);if(c!==e.w||d!==e.h)b.trigger(i,[e.w=c,e.h=d])});d()},f[j])}var e=a([]),f=a.resize=a.extend(a.resize,{}),g,h="setTimeout",i="resize",k=i+"-special-event",j="delay";f[j]=250;f.throttleWindow=!0;a.event.special[i]={setup:function(){if(!f.throttleWindow&&this[h])return!1;var b=a(this);e=e.add(b);a.data(this,k,{w:b.width(),h:b.height()});e.length===1&&d()},teardown:function(){if(!f.throttleWindow&&
this[h])return!1;var b=a(this);e=e.not(b);b.removeData(k);e.length||clearTimeout(g)},add:function(b){function d(b,f,g){var h=a(this),j=a.data(this,k);j.w=f!==c?f:h.width();j.h=g!==c?g:h.height();e.apply(this,arguments)}if(!f.throttleWindow&&this[h])return!1;var e;if(a.isFunction(b))return e=b,d;else e=b.handler,b.handler=d}}})(jQuery,this);
(function(){var a,b=function(){this.form=this.digits=0;this.lostDigits=!1;this.roundingMode=0;var a=this.DEFAULT_FORM,c=this.DEFAULT_LOSTDIGITS,d=this.DEFAULT_ROUNDINGMODE;if(4==b.arguments.length)a=b.arguments[1],c=b.arguments[2],d=b.arguments[3];else if(3==b.arguments.length)a=b.arguments[1],c=b.arguments[2];else if(2==b.arguments.length)a=b.arguments[1];else if(1!=b.arguments.length)throw"MathContext(): "+b.arguments.length+" arguments given; expected 1 to 4";var e=b.arguments[0];if(e!=this.DEFAULT_DIGITS){if(e<
this.MIN_DIGITS)throw"MathContext(): Digits too small: "+e;if(e>this.MAX_DIGITS)throw"MathContext(): Digits too large: "+e;}if(a!=this.SCIENTIFIC&&a!=this.ENGINEERING&&a!=this.PLAIN)throw"MathContext() Bad form value: "+a;if(!this.isValidRound(d))throw"MathContext(): Bad roundingMode value: "+d;this.digits=e;this.form=a;this.lostDigits=c;this.roundingMode=d};b.prototype.getDigits=function(){return this.digits};b.prototype.getForm=function(){return this.form};b.prototype.getLostDigits=function(){return this.lostDigits};
b.prototype.getRoundingMode=function(){return this.roundingMode};b.prototype.toString=function(){var a=null,b=0,c=null,a=this.form==this.SCIENTIFIC?"SCIENTIFIC":this.form==this.ENGINEERING?"ENGINEERING":"PLAIN",d=this.ROUNDS.length,b=0;a:for(;0<d;d--,b++)if(this.roundingMode==this.ROUNDS[b]){c=this.ROUNDWORDS[b];break a}return"digits="+this.digits+" form="+a+" lostDigits="+(this.lostDigits?"1":"0")+" roundingMode="+c};b.prototype.isValidRound=function(a){for(var b=0,c=this.ROUNDS.length,b=0;0<c;c--,
b++)if(a==this.ROUNDS[b])return!0;return!1};b.PLAIN=b.prototype.PLAIN=0;b.SCIENTIFIC=b.prototype.SCIENTIFIC=1;b.ENGINEERING=b.prototype.ENGINEERING=2;b.ROUND_CEILING=b.prototype.ROUND_CEILING=2;b.ROUND_DOWN=b.prototype.ROUND_DOWN=1;b.ROUND_FLOOR=b.prototype.ROUND_FLOOR=3;b.ROUND_HALF_DOWN=b.prototype.ROUND_HALF_DOWN=5;b.ROUND_HALF_EVEN=b.prototype.ROUND_HALF_EVEN=6;b.ROUND_HALF_UP=b.prototype.ROUND_HALF_UP=4;b.ROUND_UNNECESSARY=b.prototype.ROUND_UNNECESSARY=7;b.ROUND_UP=b.prototype.ROUND_UP=0;b.prototype.DEFAULT_FORM=
b.prototype.SCIENTIFIC;b.prototype.DEFAULT_DIGITS=9;b.prototype.DEFAULT_LOSTDIGITS=!1;b.prototype.DEFAULT_ROUNDINGMODE=b.prototype.ROUND_HALF_UP;b.prototype.MIN_DIGITS=0;b.prototype.MAX_DIGITS=999999999;b.prototype.ROUNDS=[b.prototype.ROUND_HALF_UP,b.prototype.ROUND_UNNECESSARY,b.prototype.ROUND_CEILING,b.prototype.ROUND_DOWN,b.prototype.ROUND_FLOOR,b.prototype.ROUND_HALF_DOWN,b.prototype.ROUND_HALF_EVEN,b.prototype.ROUND_UP];b.prototype.ROUNDWORDS="ROUND_HALF_UP ROUND_UNNECESSARY ROUND_CEILING ROUND_DOWN ROUND_FLOOR ROUND_HALF_DOWN ROUND_HALF_EVEN ROUND_UP".split(" ");
b.prototype.DEFAULT=new b(b.prototype.DEFAULT_DIGITS,b.prototype.DEFAULT_FORM,b.prototype.DEFAULT_LOSTDIGITS,b.prototype.DEFAULT_ROUNDINGMODE);a=b;var c,d=function(a,b){return(a-a%b)/b},e=function(a){var b=Array(a),c;for(c=0;c<a;++c)b[c]=0;return b},f=function(){this.ind=0;this.form=a.prototype.PLAIN;this.mant=null;this.exp=0;if(0!=f.arguments.length){var b,c,d;1==f.arguments.length?(b=f.arguments[0],c=0,d=b.length):(b=f.arguments[0],c=f.arguments[1],d=f.arguments[2]);"string"==typeof b&&(b=b.split(""));
var e,g,h,j,k,l=0,i=0,m=i=i=0,n=0;0>=d&&this.bad("BigDecimal(): ",b);this.ind=this.ispos;"-"==b[0]?(d--,0==d&&this.bad("BigDecimal(): ",b),this.ind=this.isneg,c++):"+"==b[0]&&(d--,0==d&&this.bad("BigDecimal(): ",b),c++);g=e=!1;h=0;k=j=-1;m=d;l=c;a:for(;0<m;m--,l++){i=b[l];if("0"<=i&&"9">=i){k=l;h++;continue a}if("."==i){0<=j&&this.bad("BigDecimal(): ",b);j=l-c;continue a}if("e"!=i&&"E"!=i){("0">i||"9"<i)&&this.bad("BigDecimal(): ",b);e=!0;k=l;h++;continue a}l-c>d-2&&this.bad("BigDecimal(): ",b);g=
!1;"-"==b[l+1]?(g=!0,l+=2):l="+"==b[l+1]?l+2:l+1;i=d-(l-c);(0==i||9<i)&&this.bad("BigDecimal(): ",b);d=i;for(i=l;0<d;d--,i++)m=b[i],"0">m&&this.bad("BigDecimal(): ",b),"9"<m?this.bad("BigDecimal(): ",b):n=m-0,this.exp=10*this.exp+n;g&&(this.exp=-this.exp);g=!0;break a}0==h&&this.bad("BigDecimal(): ",b);0<=j&&(this.exp=this.exp+j-h);n=k-1;l=c;a:for(;l<=n;l++)if(i=b[l],"0"==i)c++,j--,h--;else if("."==i)c++,j--;else break a;this.mant=Array(h);i=c;if(e){c=h;for(l=0;0<c;c--,l++)l==j&&i++,m=b[i],"9">=m?
this.mant[l]=m-0:this.bad("BigDecimal(): ",b),i++}else{c=h;for(l=0;0<c;c--,l++)l==j&&i++,this.mant[l]=b[i]-0,i++}0==this.mant[0]?(this.ind=this.iszero,0<this.exp&&(this.exp=0),g&&(this.mant=this.ZERO.mant,this.exp=0)):g&&(this.form=a.prototype.SCIENTIFIC,j=this.exp+this.mant.length-1,(j<this.MinExp||j>this.MaxExp)&&this.bad("BigDecimal(): ",b))}},g=function(){var a;if(1==g.arguments.length)a=g.arguments[0];else if(0==g.arguments.length)a=this.plainMC;else throw"abs(): "+g.arguments.length+" arguments given; expected 0 or 1";
return this.ind==this.isneg?this.negate(a):this.plus(a)},h=function(){var b;if(2==h.arguments.length)b=h.arguments[1];else if(1==h.arguments.length)b=this.plainMC;else throw"add(): "+h.arguments.length+" arguments given; expected 1 or 2";var c=h.arguments[0],d,e,g,j,k,l,i,m=0,n=0,o=0,q=0,s=0,p=0;b.lostDigits&&this.checkdigits(c,b.digits);d=this;if(0==d.ind&&b.form!=a.prototype.PLAIN)return c.plus(b);if(0==c.ind&&b.form!=a.prototype.PLAIN)return d.plus(b);e=b.digits;0<e&&(d.mant.length>e&&(d=this.clone(d).round(b)),
c.mant.length>e&&(c=this.clone(c).round(b)));g=new f;j=d.mant;k=d.mant.length;l=c.mant;i=c.mant.length;if(d.exp==c.exp)g.exp=d.exp;else if(d.exp>c.exp){m=k+d.exp-c.exp;if(m>=i+e+1&&0<e)return g.mant=j,g.exp=d.exp,g.ind=d.ind,k<e&&(g.mant=this.extend(d.mant,e),g.exp-=e-k),g.finish(b,!1);g.exp=c.exp;m>e+1&&0<e&&(m=m-e-1,i-=m,g.exp+=m,m=e+1);m>k&&(k=m)}else{m=i+c.exp-d.exp;if(m>=k+e+1&&0<e)return g.mant=l,g.exp=c.exp,g.ind=c.ind,i<e&&(g.mant=this.extend(c.mant,e),g.exp-=e-i),g.finish(b,!1);g.exp=d.exp;
m>e+1&&0<e&&(m=m-e-1,k-=m,g.exp+=m,m=e+1);m>i&&(i=m)}g.ind=d.ind==this.iszero?this.ispos:d.ind;if((d.ind==this.isneg?1:0)==(c.ind==this.isneg?1:0))e=1;else{do{e=-1;do if(c.ind!=this.iszero)if(k<i||d.ind==this.iszero)m=j,j=l,l=m,m=k,k=i,i=m,g.ind=-g.ind;else if(!(k>i)){n=m=0;o=j.length-1;q=l.length-1;a:for(;;){if(m<=o)s=j[m];else{if(n>q){if(b.form!=a.prototype.PLAIN)return this.ZERO;break a}s=0}p=n<=q?l[n]:0;if(s!=p){s<p&&(m=j,j=l,l=m,m=k,k=i,i=m,g.ind=-g.ind);break a}m++;n++}}while(0)}while(0)}g.mant=
this.byteaddsub(j,k,l,i,e,!1);return g.finish(b,!1)},i=function(){var a;if(2==i.arguments.length)a=i.arguments[1];else if(1==i.arguments.length)a=this.plainMC;else throw"compareTo(): "+i.arguments.length+" arguments given; expected 1 or 2";var b=i.arguments[0],c=0;a.lostDigits&&this.checkdigits(b,a.digits);if(this.ind==b.ind&&this.exp==b.exp){c=this.mant.length;if(c<b.mant.length)return-this.ind;if(c>b.mant.length)return this.ind;if(c<=a.digits||0==a.digits){a=c;for(c=0;0<a;a--,c++){if(this.mant[c]<
b.mant[c])return-this.ind;if(this.mant[c]>b.mant[c])return this.ind}return 0}}else{if(this.ind<b.ind)return-1;if(this.ind>b.ind)return 1}b=this.clone(b);b.ind=-b.ind;return this.add(b,a).ind},k=function(){var b,c=-1;if(2==k.arguments.length)b="number"==typeof k.arguments[1]?new a(0,a.prototype.PLAIN,!1,k.arguments[1]):k.arguments[1];else if(3==k.arguments.length){c=k.arguments[1];if(0>c)throw"divide(): Negative scale: "+c;b=new a(0,a.prototype.PLAIN,!1,k.arguments[2])}else if(1==k.arguments.length)b=
this.plainMC;else throw"divide(): "+k.arguments.length+" arguments given; expected between 1 and 3";return this.dodivide("D",k.arguments[0],b,c)},j=function(){var a;if(2==j.arguments.length)a=j.arguments[1];else if(1==j.arguments.length)a=this.plainMC;else throw"divideInteger(): "+j.arguments.length+" arguments given; expected 1 or 2";return this.dodivide("I",j.arguments[0],a,0)},m=function(){var a;if(2==m.arguments.length)a=m.arguments[1];else if(1==m.arguments.length)a=this.plainMC;else throw"max(): "+
m.arguments.length+" arguments given; expected 1 or 2";var b=m.arguments[0];return 0<=this.compareTo(b,a)?this.plus(a):b.plus(a)},n=function(){var a;if(2==n.arguments.length)a=n.arguments[1];else if(1==n.arguments.length)a=this.plainMC;else throw"min(): "+n.arguments.length+" arguments given; expected 1 or 2";var b=n.arguments[0];return 0>=this.compareTo(b,a)?this.plus(a):b.plus(a)},l=function(){var a;if(2==l.arguments.length)a=l.arguments[1];else if(1==l.arguments.length)a=this.plainMC;else throw"multiply(): "+
l.arguments.length+" arguments given; expected 1 or 2";var b=l.arguments[0],c,d,e,g=null,h,j=0,k,i=0,m=0;a.lostDigits&&this.checkdigits(b,a.digits);c=this;d=0;e=a.digits;0<e?(c.mant.length>e&&(c=this.clone(c).round(a)),b.mant.length>e&&(b=this.clone(b).round(a))):(0<c.exp&&(d+=c.exp),0<b.exp&&(d+=b.exp));c.mant.length<b.mant.length?(e=c.mant,g=b.mant):(e=b.mant,g=c.mant);h=e.length+g.length-1;j=9<e[0]*g[0]?h+1:h;k=new f;for(var j=this.createArrayWithZeros(j),n=e.length,i=0;0<n;n--,i++)m=e[i],0!=m&&
(j=this.byteaddsub(j,j.length,g,h,m,!0)),h--;k.ind=c.ind*b.ind;k.exp=c.exp+b.exp-d;k.mant=0==d?j:this.extend(j,j.length+d);return k.finish(a,!1)},o=function(){var a;if(1==o.arguments.length)a=o.arguments[0];else if(0==o.arguments.length)a=this.plainMC;else throw"negate(): "+o.arguments.length+" arguments given; expected 0 or 1";var b;a.lostDigits&&this.checkdigits(null,a.digits);b=this.clone(this);b.ind=-b.ind;return b.finish(a,!1)},q=function(){var b;if(1==q.arguments.length)b=q.arguments[0];else if(0==
q.arguments.length)b=this.plainMC;else throw"plus(): "+q.arguments.length+" arguments given; expected 0 or 1";b.lostDigits&&this.checkdigits(null,b.digits);return b.form==a.prototype.PLAIN&&this.form==a.prototype.PLAIN&&(this.mant.length<=b.digits||0==b.digits)?this:this.clone(this).finish(b,!1)},p=function(){var b;if(2==p.arguments.length)b=p.arguments[1];else if(1==p.arguments.length)b=this.plainMC;else throw"pow(): "+p.arguments.length+" arguments given; expected 1 or 2";var c=p.arguments[0],d,
e,f,g=0,h,j=0;b.lostDigits&&this.checkdigits(c,b.digits);d=c.intcheck(this.MinArg,this.MaxArg);e=this;f=b.digits;if(0==f){if(c.ind==this.isneg)throw"pow(): Negative power: "+c.toString();f=0}else{if(c.mant.length+c.exp>f)throw"pow(): Too many digits: "+c.toString();e.mant.length>f&&(e=this.clone(e).round(b));g=c.mant.length+c.exp;f=f+g+1}f=new a(f,b.form,!1,b.roundingMode);g=this.ONE;if(0==d)return g;0>d&&(d=-d);h=!1;j=1;a:for(;;j++){d<<=1;0>d&&(h=!0,g=g.multiply(e,f));if(31==j)break a;if(!h)continue a;
g=g.multiply(g,f)}0>c.ind&&(g=this.ONE.divide(g,f));return g.finish(b,!0)},r=function(){var a;if(2==r.arguments.length)a=r.arguments[1];else if(1==r.arguments.length)a=this.plainMC;else throw"remainder(): "+r.arguments.length+" arguments given; expected 1 or 2";return this.dodivide("R",r.arguments[0],a,-1)},t=function(){var a;if(2==t.arguments.length)a=t.arguments[1];else if(1==t.arguments.length)a=this.plainMC;else throw"subtract(): "+t.arguments.length+" arguments given; expected 1 or 2";var b=
t.arguments[0];a.lostDigits&&this.checkdigits(b,a.digits);b=this.clone(b);b.ind=-b.ind;return this.add(b,a)},s=function(){var b,c,d,e;if(6==s.arguments.length)b=s.arguments[2],c=s.arguments[3],d=s.arguments[4],e=s.arguments[5];else if(2==s.arguments.length)c=b=-1,d=a.prototype.SCIENTIFIC,e=this.ROUND_HALF_UP;else throw"format(): "+s.arguments.length+" arguments given; expected 2 or 6";var f=s.arguments[0],g=s.arguments[1],h,j=0,k=null,i=0,j=null,i=0;(-1>f||0==f)&&this.badarg("format",1,f);-1>g&&this.badarg("format",
2,g);(-1>b||0==b)&&this.badarg("format",3,b);-1>c&&this.badarg("format",4,c);d!=a.prototype.SCIENTIFIC&&d!=a.prototype.ENGINEERING&&(-1==d?d=a.prototype.SCIENTIFIC:this.badarg("format",5,d));if(e!=this.ROUND_HALF_UP)try{-1==e?e=this.ROUND_HALF_UP:new a(9,a.prototype.SCIENTIFIC,!1,e)}catch(l){this.badarg("format",6,e)}h=this.clone(this);-1==c?h.form=a.prototype.PLAIN:h.ind==this.iszero?h.form=a.prototype.PLAIN:(j=h.exp+h.mant.length,h.form=j>c?d:-5>j?d:a.prototype.PLAIN);if(0<=g)a:for(;;){h.form==
a.prototype.PLAIN?j=-h.exp:h.form==a.prototype.SCIENTIFIC?j=h.mant.length-1:(j=(h.exp+h.mant.length-1)%3,0>j&&(j=3+j),j++,j=j>=h.mant.length?0:h.mant.length-j);if(j==g)break a;if(j<g){k=this.extend(h.mant,h.mant.length+g-j);h.mant=k;h.exp-=g-j;if(h.exp<this.MinExp)throw"format(): Exponent Overflow: "+h.exp;break a}j-=g;if(j>h.mant.length){h.mant=this.ZERO.mant;h.ind=this.iszero;h.exp=0;continue a}k=h.mant.length-j;i=h.exp;h.round(k,e);if(h.exp-i==j)break a}c=h.layout();if(0<f){d=c.length;h=0;a:for(;0<
d;d--,h++){if("."==c[h])break a;if("E"==c[h])break a}h>f&&this.badarg("format",1,f);if(h<f){j=Array(c.length+f-h);f-=h;for(k=0;0<f;f--,k++)j[k]=" ";this.arraycopy(c,0,j,k,c.length);c=j}}if(0<b){f=c.length-1;h=c.length-1;a:for(;0<f;f--,h--)if("E"==c[h])break a;if(0==h){j=Array(c.length+b+2);this.arraycopy(c,0,j,0,c.length);b+=2;for(k=c.length;0<b;b--,k++)j[k]=" ";c=j}else if(i=c.length-h-2,i>b&&this.badarg("format",3,b),i<b){j=Array(c.length+b-i);this.arraycopy(c,0,j,0,h+2);b-=i;for(k=h+2;0<b;b--,
k++)j[k]="0";this.arraycopy(c,h+2,j,k,i);c=j}}return c.join("")},u=function(){var b;if(2==u.arguments.length)b=u.arguments[1];else if(1==u.arguments.length)b=this.ROUND_UNNECESSARY;else throw"setScale(): "+u.arguments.length+" given; expected 1 or 2";var c=u.arguments[0],d,e;d=this.scale();if(d==c&&this.form==a.prototype.PLAIN)return this;e=this.clone(this);if(d<=c)d=0==d?e.exp+c:c-d,e.mant=this.extend(e.mant,e.mant.length+d),e.exp=-c;else{if(0>c)throw"setScale(): Negative scale: "+c;d=e.mant.length-
(d-c);e=e.round(d,b);e.exp!=-c&&(e.mant=this.extend(e.mant,e.mant.length+1),e.exp-=1)}e.form=a.prototype.PLAIN;return e};c=function(){var a,b=0,c=0;a=Array(190);b=0;a:for(;189>=b;b++){c=b-90;if(0<=c){a[b]=c%10;f.prototype.bytecar[b]=d(c,10);continue a}c+=100;a[b]=c%10;f.prototype.bytecar[b]=d(c,10)-10}return a};var v=function(){var a,b;if(2==v.arguments.length)a=v.arguments[0],b=v.arguments[1];else if(1==v.arguments.length)b=v.arguments[0],a=b.digits,b=b.roundingMode;else throw"round(): "+v.arguments.length+
" arguments given; expected 1 or 2";var c,d,e=!1,f=0,g;c=this.mant.length-a;if(0>=c)return this;this.exp+=c;c=this.ind;d=this.mant;0<a?(this.mant=Array(a),this.arraycopy(d,0,this.mant,0,a),e=!0,f=d[a]):(this.mant=this.ZERO.mant,this.ind=this.iszero,e=!1,f=0==a?d[0]:0);g=0;if(b==this.ROUND_HALF_UP)5<=f&&(g=c);else if(b==this.ROUND_UNNECESSARY){if(!this.allzero(d,a))throw"round(): Rounding necessary";}else if(b==this.ROUND_HALF_DOWN)5<f?g=c:5==f&&(this.allzero(d,a+1)||(g=c));else if(b==this.ROUND_HALF_EVEN)5<
f?g=c:5==f&&(this.allzero(d,a+1)?1==this.mant[this.mant.length-1]%2&&(g=c):g=c);else if(b!=this.ROUND_DOWN)if(b==this.ROUND_UP)this.allzero(d,a)||(g=c);else if(b==this.ROUND_CEILING)0<c&&(this.allzero(d,a)||(g=c));else if(b==this.ROUND_FLOOR)0>c&&(this.allzero(d,a)||(g=c));else throw"round(): Bad round value: "+b;0!=g&&(this.ind==this.iszero?(this.mant=this.ONE.mant,this.ind=g):(this.ind==this.isneg&&(g=-g),c=this.byteaddsub(this.mant,this.mant.length,this.ONE.mant,1,g,e),c.length>this.mant.length?
(this.exp++,this.arraycopy(c,0,this.mant,0,this.mant.length)):this.mant=c));if(this.exp>this.MaxExp)throw"round(): Exponent Overflow: "+this.exp;return this};f.prototype.div=d;f.prototype.arraycopy=function(a,b,c,d,e){var f;if(d>b)for(f=e-1;0<=f;--f)c[f+d]=a[f+b];else for(f=0;f<e;++f)c[f+d]=a[f+b]};f.prototype.createArrayWithZeros=e;f.prototype.abs=g;f.prototype.add=h;f.prototype.compareTo=i;f.prototype.divide=k;f.prototype.divideInteger=j;f.prototype.max=m;f.prototype.min=n;f.prototype.multiply=
l;f.prototype.negate=o;f.prototype.plus=q;f.prototype.pow=p;f.prototype.remainder=r;f.prototype.subtract=t;f.prototype.equals=function(a){var b=0,c=null,d=null;if(null==a||!(a instanceof f)||this.ind!=a.ind)return!1;if(this.mant.length==a.mant.length&&this.exp==a.exp&&this.form==a.form){c=this.mant.length;for(b=0;0<c;c--,b++)if(this.mant[b]!=a.mant[b])return!1}else{c=this.layout();d=a.layout();if(c.length!=d.length)return!1;a=c.length;for(b=0;0<a;a--,b++)if(c[b]!=d[b])return!1}return!0};f.prototype.format=
s;f.prototype.intValueExact=function(){var a,b=0,c,e=0;if(this.ind==this.iszero)return 0;a=this.mant.length-1;if(0>this.exp){a+=this.exp;if(!this.allzero(this.mant,a+1))throw"intValueExact(): Decimal part non-zero: "+this.toString();if(0>a)return 0;b=0}else{if(9<this.exp+a)throw"intValueExact(): Conversion overflow: "+this.toString();b=this.exp}c=0;for(var f=a+b,e=0;e<=f;e++)c*=10,e<=a&&(c+=this.mant[e]);if(9==a+b&&(a=d(c,1E9),a!=this.mant[0])){if(-2147483648==c&&this.ind==this.isneg&&2==this.mant[0])return c;
throw"intValueExact(): Conversion overflow: "+this.toString();}return this.ind==this.ispos?c:-c};f.prototype.movePointLeft=function(a){var b;b=this.clone(this);b.exp-=a;return b.finish(this.plainMC,!1)};f.prototype.movePointRight=function(a){var b;b=this.clone(this);b.exp+=a;return b.finish(this.plainMC,!1)};f.prototype.scale=function(){return 0<=this.exp?0:-this.exp};f.prototype.setScale=u;f.prototype.signum=function(){return this.ind};f.prototype.toString=function(){return this.layout().join("")};
f.prototype.layout=function(){var b,c=0,d=0,e=0,e=null,f;b=Array(this.mant.length);d=this.mant.length;for(c=0;0<d;d--,c++)b[c]=this.mant[c]+"";if(this.form!=a.prototype.PLAIN){c="";this.ind==this.isneg&&(c+="-");d=this.exp+b.length-1;if(this.form==a.prototype.SCIENTIFIC)c+=b[0],1<b.length&&(c+="."),c+=b.slice(1).join("");else if(e=d%3,0>e&&(e=3+e),d-=e,e++,e>=b.length){c+=b.join("");for(b=e-b.length;0<b;b--)c+="0"}else c+=b.slice(0,e).join(""),c=c+"."+b.slice(e).join("");0!=d&&(0>d?(b="-",d=-d):b=
"+",c+="E",c+=b,c+=d);return c.split("")}if(0==this.exp){if(0<=this.ind)return b;e=Array(b.length+1);e[0]="-";this.arraycopy(b,0,e,1,b.length);return e}d=this.ind==this.isneg?1:0;f=this.exp+b.length;if(1>f){c=d+2-this.exp;e=Array(c);0!=d&&(e[0]="-");e[d]="0";e[d+1]=".";for(var g=-f,c=d+2;0<g;g--,c++)e[c]="0";this.arraycopy(b,0,e,d+2-f,b.length);return e}if(f>b.length){e=Array(d+f);0!=d&&(e[0]="-");this.arraycopy(b,0,e,d,b.length);f-=b.length;for(c=d+b.length;0<f;f--,c++)e[c]="0";return e}c=d+1+b.length;
e=Array(c);0!=d&&(e[0]="-");this.arraycopy(b,0,e,d,f);e[d+f]=".";this.arraycopy(b,f,e,d+f+1,b.length-f);return e};f.prototype.intcheck=function(a,b){var c;c=this.intValueExact();if(c<a||c>b)throw"intcheck(): Conversion overflow: "+c;return c};f.prototype.dodivide=function(b,c,e,g){var h,j,k,i,l,m,n,o,q,s=0,p=0,v=0;e.lostDigits&&this.checkdigits(c,e.digits);h=this;if(0==c.ind)throw"dodivide(): Divide by 0";if(0==h.ind)return e.form!=a.prototype.PLAIN?this.ZERO:-1==g?h:h.setScale(g);j=e.digits;0<j?
(h.mant.length>j&&(h=this.clone(h).round(e)),c.mant.length>j&&(c=this.clone(c).round(e))):(-1==g&&(g=h.scale()),j=h.mant.length,g!=-h.exp&&(j=j+g+h.exp),j=j-(c.mant.length-1)-c.exp,j<h.mant.length&&(j=h.mant.length),j<c.mant.length&&(j=c.mant.length));k=h.exp-c.exp+h.mant.length-c.mant.length;if(0>k&&"D"!=b)return"I"==b?this.ZERO:this.clone(h).finish(e,!1);i=new f;i.ind=h.ind*c.ind;i.exp=k;i.mant=this.createArrayWithZeros(j+1);l=j+j+1;k=this.extend(h.mant,l);m=l;n=c.mant;o=l;q=10*n[0]+1;1<n.length&&
(q+=n[1]);l=0;a:for(;;){s=0;b:for(;;){if(m<o)break b;if(m==o){c:do{for(var u=m,p=0;0<u;u--,p++){v=p<n.length?n[p]:0;if(k[p]<v)break b;if(k[p]>v)break c}s++;i.mant[l]=s;l++;k[0]=0;break a}while(0);p=k[0]}else p=10*k[0],1<m&&(p+=k[1]);p=d(10*p,q);0==p&&(p=1);s+=p;k=this.byteaddsub(k,m,n,o,-p,!0);if(0!=k[0])continue b;v=m-2;p=0;c:for(;p<=v;p++){if(0!=k[p])break c;m--}if(0==p)continue b;this.arraycopy(k,p,k,0,m)}if(0!=l||0!=s){i.mant[l]=s;l++;if(l==j+1)break a;if(0==k[0])break a}if(0<=g&&-i.exp>g)break a;
if("D"!=b&&0>=i.exp)break a;i.exp-=1;o--}0==l&&(l=1);if("I"==b||"R"==b){if(l+i.exp>j)throw"dodivide(): Integer overflow";if("R"==b){do{if(0==i.mant[0])return this.clone(h).finish(e,!1);if(0==k[0])return this.ZERO;i.ind=h.ind;j=j+j+1-h.mant.length;i.exp=i.exp-j+h.exp;j=m;p=j-1;a:for(;1<=p&&i.exp<h.exp&&i.exp<c.exp;p--){if(0!=k[p])break a;j--;i.exp+=1}j<k.length&&(h=Array(j),this.arraycopy(k,0,h,0,j),k=h);i.mant=k;return i.finish(e,!1)}while(0)}}else 0!=k[0]&&(h=i.mant[l-1],0==h%5&&(i.mant[l-1]=h+1));
if(0<=g)return l!=i.mant.length&&(i.exp-=i.mant.length-l),h=i.mant.length-(-i.exp-g),i.round(h,e.roundingMode),i.exp!=-g&&(i.mant=this.extend(i.mant,i.mant.length+1),i.exp-=1),i.finish(e,!0);if(l==i.mant.length)i.round(e);else{if(0==i.mant[0])return this.ZERO;h=Array(l);this.arraycopy(i.mant,0,h,0,l);i.mant=h}return i.finish(e,!0)};f.prototype.bad=function(a,b){throw a+"Not a number: "+b;};f.prototype.badarg=function(a,b,c){throw"Bad argument "+b+" to "+a+": "+c;};f.prototype.extend=function(a,b){var c;
if(a.length==b)return a;c=e(b);this.arraycopy(a,0,c,0,a.length);return c};f.prototype.byteaddsub=function(a,b,c,d,e,f){var g,h,j,k,i,l,m=0;g=a.length;h=c.length;b-=1;k=j=d-1;k<b&&(k=b);d=null;f&&k+1==g&&(d=a);null==d&&(d=this.createArrayWithZeros(k+1));i=!1;1==e?i=!0:-1==e&&(i=!0);l=0;m=k;a:for(;0<=m;m--){0<=b&&(b<g&&(l+=a[b]),b--);0<=j&&(j<h&&(l=i?0<e?l+c[j]:l-c[j]:l+c[j]*e),j--);if(10>l&&0<=l){do{d[m]=l;l=0;continue a}while(0)}l+=90;d[m]=this.bytedig[l];l=this.bytecar[l]}if(0==l)return d;c=null;
f&&k+2==a.length&&(c=a);null==c&&(c=Array(k+2));c[0]=l;a=k+1;for(g=0;0<a;a--,g++)c[g+1]=d[g];return c};f.prototype.diginit=c;f.prototype.clone=function(a){var b;b=new f;b.ind=a.ind;b.exp=a.exp;b.form=a.form;b.mant=a.mant;return b};f.prototype.checkdigits=function(a,b){if(0!=b){if(this.mant.length>b&&!this.allzero(this.mant,b))throw"Too many digits: "+this.toString();if(null!=a&&a.mant.length>b&&!this.allzero(a.mant,b))throw"Too many digits: "+a.toString();}};f.prototype.round=v;f.prototype.allzero=
function(a,b){var c=0;0>b&&(b=0);for(var d=a.length-1,c=b;c<=d;c++)if(0!=a[c])return!1;return!0};f.prototype.finish=function(b,c){var d=0,e=0,f=null;0!=b.digits&&this.mant.length>b.digits&&this.round(b);if(c&&b.form!=a.prototype.PLAIN){d=this.mant.length;e=d-1;a:for(;1<=e;e--){if(0!=this.mant[e])break a;d--;this.exp++}d<this.mant.length&&(f=Array(d),this.arraycopy(this.mant,0,f,0,d),this.mant=f)}this.form=a.prototype.PLAIN;d=this.mant.length;for(e=0;0<d;d--,e++)if(0!=this.mant[e]){0<e&&(f=Array(this.mant.length-
e),this.arraycopy(this.mant,e,f,0,this.mant.length-e),this.mant=f);e=this.exp+this.mant.length;if(0<e){if(e>b.digits&&0!=b.digits&&(this.form=b.form),e-1<=this.MaxExp)return this}else-5>e&&(this.form=b.form);e--;if(e<this.MinExp||e>this.MaxExp){a:do{if(this.form==a.prototype.ENGINEERING&&(d=e%3,0>d&&(d=3+d),e-=d,e>=this.MinExp&&e<=this.MaxExp))break a;throw"finish(): Exponent Overflow: "+e;}while(0)}return this}this.ind=this.iszero;if(b.form!=a.prototype.PLAIN)this.exp=0;else if(0<this.exp)this.exp=
0;else if(this.exp<this.MinExp)throw"finish(): Exponent Overflow: "+this.exp;this.mant=this.ZERO.mant;return this};f.prototype.isGreaterThan=function(a){return 0<this.compareTo(a)};f.prototype.isLessThan=function(a){return 0>this.compareTo(a)};f.prototype.isGreaterThanOrEqualTo=function(a){return 0<=this.compareTo(a)};f.prototype.isLessThanOrEqualTo=function(a){return 0>=this.compareTo(a)};f.prototype.isPositive=function(){return 0<this.compareTo(f.prototype.ZERO)};f.prototype.isNegative=function(){return 0>
this.compareTo(f.prototype.ZERO)};f.prototype.isZero=function(){return this.equals(f.prototype.ZERO)};f.ROUND_CEILING=f.prototype.ROUND_CEILING=a.prototype.ROUND_CEILING;f.ROUND_DOWN=f.prototype.ROUND_DOWN=a.prototype.ROUND_DOWN;f.ROUND_FLOOR=f.prototype.ROUND_FLOOR=a.prototype.ROUND_FLOOR;f.ROUND_HALF_DOWN=f.prototype.ROUND_HALF_DOWN=a.prototype.ROUND_HALF_DOWN;f.ROUND_HALF_EVEN=f.prototype.ROUND_HALF_EVEN=a.prototype.ROUND_HALF_EVEN;f.ROUND_HALF_UP=f.prototype.ROUND_HALF_UP=a.prototype.ROUND_HALF_UP;
f.ROUND_UNNECESSARY=f.prototype.ROUND_UNNECESSARY=a.prototype.ROUND_UNNECESSARY;f.ROUND_UP=f.prototype.ROUND_UP=a.prototype.ROUND_UP;f.prototype.ispos=1;f.prototype.iszero=0;f.prototype.isneg=-1;f.prototype.MinExp=-999999999;f.prototype.MaxExp=999999999;f.prototype.MinArg=-999999999;f.prototype.MaxArg=999999999;f.prototype.plainMC=new a(0,a.prototype.PLAIN);f.prototype.bytecar=Array(190);f.prototype.bytedig=c();f.ZERO=f.prototype.ZERO=new f("0");f.ONE=f.prototype.ONE=new f("1");f.TEN=f.prototype.TEN=
new f("10");c=f;"function"===typeof define&&null!=define.amd?define({BigDecimal:c,MathContext:a}):"object"===typeof this&&(this.BigDecimal=c,this.MathContext=a)}).call(this);
(function(){var a=Math,b=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",c="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,d="ontouchstart"in window,e=b+"Transform"in document.documentElement.style,f=/android/gi.test(navigator.appVersion),g=/iphone|ipad/gi.test(navigator.appVersion),h=/playbook/gi.test(navigator.appVersion),i=g||h,k=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),j=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,m="onorientationchange"in window?"orientationchange":"resize",n=d?"touchstart":"mousedown",l=d?"touchmove":"mousemove",o=d?"touchend":"mouseup",q=d?"touchcancel":"mouseup",p=b=="Moz"?"DOMMouseScroll":
"mousewheel",r="translate"+(c?"3d(":"("),t=c?",0)":")",h=function(a,h){var j=this,k;j.wrapper=typeof a=="object"?a:document.getElementById(a);j.wrapper.style.overflow="hidden";j.scroller=j.wrapper.children[0];j.options={hScroll:!0,vScroll:!0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,roundPosition:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:f,hideScrollbar:g,fadeScrollbar:g&&c,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,
doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(k in h)j.options[k]=h[k];j.options.useTransform=e?j.options.useTransform:!1;j.options.hScrollbar=j.options.hScroll&&j.options.hScrollbar;j.options.vScrollbar=j.options.vScroll&&j.options.vScrollbar;
j.options.zoom=j.options.useTransform&&j.options.zoom;j.options.useTransition=i&&j.options.useTransition;j.scroller.style[b+"TransitionProperty"]=j.options.useTransform?"-"+b.toLowerCase()+"-transform":"top left";j.scroller.style[b+"TransitionDuration"]="0";j.scroller.style[b+"TransformOrigin"]="0 0";j.options.useTransition&&(j.scroller.style[b+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)");j.options.useTransform?j.scroller.style[b+"Transform"]=r+"0,0"+t:j.scroller.style.cssText+=";position:absolute;top:0;left:0";
if(j.options.useTransition)j.options.fixedScrollbar=!0;j.refresh();j._bind(m,window);j._bind(n);d||(j._bind("mouseout",j.wrapper),j._bind(p));if(j.options.checkDOMChanges)j.checkDOMTime=setInterval(function(){j._checkDOMChanges()},500)};h.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case n:if(!d&&a.button!==0)break;this._start(a);break;case l:this._move(a);break;case o:case q:this._end(a);
break;case m:this._resize();break;case p:this._wheel(a);break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(c){var d=document,f;if(this[c+"Scrollbar"]){if(!this[c+"ScrollbarWrapper"]){f=d.createElement("div");this.options.scrollbarClass?
f.className=this.options.scrollbarClass+c.toUpperCase():f.style.cssText="position:absolute;z-index:100;"+(c=="h"?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");f.style.cssText+=";pointer-events:none;-"+b+"-transition-property:opacity;-"+b+"-transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(f);this[c+"ScrollbarWrapper"]=
f;f=d.createElement("div");if(!this.options.scrollbarClass)f.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+b+"-background-clip:padding-box;-"+b+"-box-sizing:border-box;"+(c=="h"?"height:100%":"width:100%")+";-"+b+"-border-radius:3px;border-radius:3px";f.style.cssText+=";pointer-events:none;-"+b+"-transition-property:-"+b+"-transform;-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+b+"-transition-duration:0;-"+b+
"-transform:"+r+"0,0"+t;this.options.useTransition&&(f.style.cssText+=";-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[c+"ScrollbarWrapper"].appendChild(f);this[c+"ScrollbarIndicator"]=f}c=="h"?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=a.max(a.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,
this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=a.max(a.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(c,!0)}else this[c+"ScrollbarWrapper"]&&(e&&(this[c+"ScrollbarIndicator"].style[b+
"Transform"]=""),this[c+"ScrollbarWrapper"].parentNode.removeChild(this[c+"ScrollbarWrapper"]),this[c+"ScrollbarWrapper"]=null,this[c+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},f?200:0)},_pos:function(c,d){c=this.hScroll?c:0;d=this.vScroll?d:0;if(this.options.roundPosition||!this.options.useTransform)c=a.round(c),d=a.round(d);this.options.useTransform?this.scroller.style[b+"Transform"]=r+c+"px,"+d+"px"+t+" scale("+this.scale+")":(this.scroller.style.left=
c+"px",this.scroller.style.top=d+"px");this.x=c;this.y=d;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(c,d){var e=c=="h"?this.x:this.y;if(this[c+"Scrollbar"])e*=this[c+"ScrollbarProp"],e<0?(this.options.fixedScrollbar||(e=this[c+"ScrollbarIndicatorSize"]+a.round(e*3),e<8&&(e=8),this[c+"ScrollbarIndicator"].style[c=="h"?"width":"height"]=e+"px"),e=0):e>this[c+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?e=this[c+"ScrollbarMaxScroll"]:(e=this[c+"ScrollbarIndicatorSize"]-
a.round((e-this[c+"ScrollbarMaxScroll"])*3),e<8&&(e=8),this[c+"ScrollbarIndicator"].style[c=="h"?"width":"height"]=e+"px",e=this[c+"ScrollbarMaxScroll"]+(this[c+"ScrollbarIndicatorSize"]-e))),this[c+"ScrollbarWrapper"].style[b+"TransitionDelay"]="0",this[c+"ScrollbarWrapper"].style.opacity=d&&this.options.hideScrollbar?"0":"1",this[c+"ScrollbarIndicator"].style[b+"Transform"]=r+(c=="h"?e+"px,0":"0,"+e+"px")+t},_start:function(c){var e=d?c.touches[0]:c,f,g;if(this.enabled){this.options.onBeforeScrollStart&&
this.options.onBeforeScrollStart.call(this,c);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&d&&c.touches.length>1)g=a.abs(c.touches[0].pageX-c.touches[1].pageX),f=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDistStart=a.sqrt(g*g+f*f),this.originX=a.abs(c.touches[0].pageX+c.touches[1].pageX-this.wrapperOffsetLeft*2)/2-this.x,this.originY=
a.abs(c.touches[0].pageY+c.touches[1].pageY-this.wrapperOffsetTop*2)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,c);if(this.options.momentum&&(this.options.useTransform?(f=getComputedStyle(this.scroller,null)[b+"Transform"].replace(/[^0-9-.,]/g,"").split(","),g=f[4]*1,f=f[5]*1):(g=getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,"")*1,f=getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")*1),g!=this.x||f!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):
j(this.aniTime),this.steps=[],this._pos(g,f);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=e.pageX;this.pointY=e.pageY;this.startTime=c.timeStamp||(new Date).getTime();this.options.onScrollStart&&this.options.onScrollStart.call(this,c);this._bind(l);this._bind(o);this._bind(q)}},_move:function(c){var e=d?c.touches[0]:c,f=e.pageX-this.pointX,g=e.pageY-this.pointY,h=this.x+f,j=this.y+g,k=c.timeStamp||(new Date).getTime();this.options.onBeforeScrollMove&&
this.options.onBeforeScrollMove.call(this,c);if(this.options.zoom&&d&&c.touches.length>1)h=a.abs(c.touches[0].pageX-c.touches[1].pageX),j=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDist=a.sqrt(h*h+j*j),this.zoomed=!0,e=1/this.touchesDistStart*this.touchesDist*this.scale,e<this.options.zoomMin?e=0.5*this.options.zoomMin*Math.pow(2,e/this.options.zoomMin):e>this.options.zoomMax&&(e=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/e)),this.lastScale=e/this.scale,h=this.originX-
this.originX*this.lastScale+this.x,j=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[b+"Transform"]=r+h+"px,"+j+"px"+t+" scale("+e+")",this.options.onZoom&&this.options.onZoom.call(this,c);else{this.pointX=e.pageX;this.pointY=e.pageY;if(h>0||h<this.maxScrollX)h=this.options.bounce?this.x+f/2:h>=0||this.maxScrollX>=0?0:this.maxScrollX;if(j>this.minScrollY||j<this.maxScrollY)j=this.options.bounce?this.y+g/2:j>=this.minScrollY||this.maxScrollY>=0?this.minScrollY:this.maxScrollY;if(this.absDistX<
6&&this.absDistY<6)this.distX+=f,this.distY+=g,this.absDistX=a.abs(this.distX),this.absDistY=a.abs(this.distY);else{if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)j=this.y,g=0;else if(this.absDistY>this.absDistX+5)h=this.x,f=0;this.moved=!0;this._pos(h,j);this.dirX=f>0?-1:f<0?1:0;this.dirY=g>0?-1:g<0?1:0;if(k-this.startTime>300)this.startTime=k,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,c)}}},_end:function(c){if(!(d&&c.touches.length!=
0)){var e=this,f=d?c.changedTouches[0]:c,g,h,j={dist:0,time:0},k={dist:0,time:0},i=(c.timeStamp||(new Date).getTime())-e.startTime,m=e.x,n=e.y;e._unbind(l);e._unbind(o);e._unbind(q);e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,c);if(e.zoomed)m=e.scale*e.lastScale,m=Math.max(e.options.zoomMin,m),m=Math.min(e.options.zoomMax,m),e.lastScale=m/e.scale,e.scale=m,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[b+"TransitionDuration"]="200ms",
e.scroller.style[b+"Transform"]=r+e.x+"px,"+e.y+"px"+t+" scale("+e.scale+")",e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,c);else{if(e.moved){if(i<300&&e.options.momentum){j=m?e._momentum(m-e.startX,i,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?e.wrapperW:0):j;k=n?e._momentum(n-e.startY,i,-e.y,e.maxScrollY<0?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):k;m=e.x+j.dist;n=e.y+k.dist;if(e.x>0&&m>0||e.x<e.maxScrollX&&m<e.maxScrollX)j={dist:0,
time:0};if(e.y>e.minScrollY&&n>e.minScrollY||e.y<e.maxScrollY&&n<e.maxScrollY)k={dist:0,time:0}}if(j.dist||k.dist){j=a.max(a.max(j.time,k.time),10);if(e.options.snap)k=m-e.absStartX,i=n-e.absStartY,a.abs(k)<e.options.snapThreshold&&a.abs(i)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(k=e._snap(m,n),m=k.x,n=k.y,j=a.max(k.time,j));e.scrollTo(m,n,j)}else e.options.snap?(k=m-e.absStartX,i=n-e.absStartY,a.abs(k)<e.options.snapThreshold&&a.abs(i)<e.options.snapThreshold?e.scrollTo(e.absStartX,
e.absStartY,200):(k=e._snap(e.x,e.y),(k.x!=e.x||k.y!=e.y)&&e.scrollTo(k.x,k.y,k.time))):e._resetPos(200)}else{if(d)e.doubleTapTimer&&e.options.zoom?(clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,c),e.zoom(e.pointX,e.pointY,e.scale==1?e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,c)},200)):e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null;for(g=f.target;g.nodeType!=1;)g=g.parentNode;
if(g.tagName!="SELECT"&&g.tagName!="INPUT"&&g.tagName!="TEXTAREA")h=document.createEvent("MouseEvents"),h.initMouseEvent("click",!0,!0,c.view,1,f.screenX,f.screenY,f.clientX,f.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null),h._fake=!0,g.dispatchEvent(h)},e.options.zoom?250:0);e._resetPos(200)}e.options.onTouchEnd&&e.options.onTouchEnd.call(e,c)}}},_resetPos:function(a){var c=this.x>=0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||this.maxScrollY>0?this.minScrollY:
this.y<this.maxScrollY?this.maxScrollY:this.y;if(c==this.x&&d==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.hScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)b=="webkit"&&(this.vScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(c,
d,a||0)},_wheel:function(a){var b=this,c,d;"wheelDeltaX"in a?(c=a.wheelDeltaX/12,d=a.wheelDeltaY/12):c="detail"in a?d=-a.detail*3:d=-a.wheelDelta;if(b.options.wheelAction=="zoom"){d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0));if(d<b.options.zoomMin)d=b.options.zoomMin;if(d>b.options.zoomMax)d=b.options.zoomMax;d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&
b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{c=b.x+c;d=b.y+d;if(c>0)c=0;else if(c<b.maxScrollX)c=b.maxScrollX;if(d>b.minScrollY)d=b.minScrollY;else if(d<b.maxScrollY)d=b.maxScrollY;b.scrollTo(c,d,0)}},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var b=this,c=b.x,d=b.y,e=(new Date).getTime(),
f,g;if(!b.animating)if(b.steps.length){f=b.steps.shift();if(f.x==c&&f.y==d)f.time=0;b.animating=!0;b.moved=!0;b.options.useTransition?(b._transitionTime(f.time),b._pos(f.x,f.y),b.animating=!1,f.time?b._bind("webkitTransitionEnd"):b._resetPos(0)):function C(){var h=(new Date).getTime();if(h>=e+f.time)b._pos(f.x,f.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();else if(h=(h-e)/f.time-1,g=a.sqrt(1-h*h),h=(f.x-c)*g+c,b._pos(h,(f.y-d)*g+d),b.animating)b.aniTime=
k(C)}()}else b._resetPos(400)},_transitionTime:function(a){a+="ms";this.scroller.style[b+"TransitionDuration"]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[b+"TransitionDuration"]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[b+"TransitionDuration"]=a)},_momentum:function(b,c,d,e,f){var c=a.abs(b)/c,g=c*c/0.0012,h=0,h=0;b>0&&g>d?(d+=f/(6/(g/c*6.0E-4)),c=c*d/g,g=d):b<0&&g>e&&(e+=f/(6/(g/c*6.0E-4)),c=c*e/g,g=e);g*=b<0?-1:1;return{dist:g,time:a.round(c/6.0E-4)}},_offset:function(a){for(var b=
-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(b,c){var d,e,f;f=this.pagesX.length-1;d=0;for(e=this.pagesX.length;d<e;d++)if(b>=this.pagesX[d]){f=d;break}f==this.currPageX&&f>0&&this.dirX<0&&f--;b=this.pagesX[f];e=(e=a.abs(b-this.pagesX[this.currPageX]))?a.abs(this.x-b)/e*500:0;this.currPageX=f;f=this.pagesY.length-1;for(d=0;d<f;d++)if(c>=this.pagesY[d]){f=d;break}f==this.currPageY&&
f>0&&this.dirY<0&&f--;c=this.pagesY[f];d=(d=a.abs(c-this.pagesY[this.currPageY]))?a.abs(this.y-c)/d*500:0;this.currPageY=f;f=a.round(a.max(e,d))||200;return{x:b,y:c,time:f}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){this.scroller.style[b+"Transform"]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(m,window);this._unbind(n);this._unbind(l);
this._unbind(o);this._unbind(q);this.options.hasTouch&&(this._unbind("mouseout",this.wrapper),this._unbind(p));this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var c,d,e,f=0;d=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=
-this.options.topOffset||0;this.scrollerW=a.round(this.scroller.offsetWidth*this.scale);this.scrollerH=a.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&this.maxScrollX<0;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);
this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;c=this._offset(this.wrapper);this.wrapperOffsetLeft=-c.left;this.wrapperOffsetTop=-c.top;if(typeof this.options.snap=="string"){this.pagesX=[];this.pagesY=[];e=this.scroller.querySelectorAll(this.options.snap);c=0;for(d=e.length;c<d;c++)f=this._offset(e[c]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[c]=f.left<this.maxScrollX?this.maxScrollX:
f.left*this.scale,this.pagesY[c]=f.top<this.maxScrollY?this.maxScrollY:f.top*this.scale}else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[d]=f,f-=this.wrapperW,d++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);d=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[d]=f,f-=this.wrapperH,d++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-
this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[b+"TransitionDuration"]="0",this._resetPos(200))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);a=0;for(b=e.length;a<b;a++){if(e[a].relative)e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y;this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0})}this._startAni()},scrollToElement:function(b,c){var d;if(b=b.nodeType?b:this.scroller.querySelector(b))d=
this._offset(b),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=d.left>0?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:d.top,c=c===void 0?a.max(a.abs(d.left)*2,a.abs(d.top)*2):c,this.scrollTo(d.left,d.top,c)},scrollToPage:function(a,b,c){if(this.options.snap)a=a=="next"?this.currPageX+1:a=="prev"?this.currPageX-1:a,b=b=="next"?this.currPageY+1:b=="prev"?this.currPageY-1:b,a=a<0?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=b<0?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c||400)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(l);this._unbind(o);this._unbind(q)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):
j(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,c,d,e){var f=d/this.scale;if(this.options.useTransform)this.zoomed=!0,e=e===void 0?200:e,a=a-this.wrapperOffsetLeft-this.x,c=c-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=c-c*f+this.y,this.scale=d,this.refresh(),this.x=this.x>0?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[b+"TransitionDuration"]=e+
"ms",this.scroller.style[b+"Transform"]=r+this.x+"px,"+this.y+"px"+t+" scale("+d+")",this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};typeof exports!=="undefined"?exports.iScroll=h:window.iScroll=h})();
(function(a,b,c){function d(a,b,c){var d=a.runtimeStyle&&a.runtimeStyle[b],e,f=a.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(c)&&/^-?\d/.test(c)){e=f.left;if(d)a.runtimeStyle.left=a.currentStyle.left;f.left=b==="fontSize"?"1em":c||0;c=f.pixelLeft+"px";f.left=e;if(d)a.runtimeStyle.left=d}return!/^(thin|medium|thick)$/i.test(c)?Math.round(parseFloat(c))+"px":c}function e(a){return parseInt(a,10)}function f(a,b,c,d,e,f){var b=h.Util.getCSS(b,a,e),g;b.length===1&&(e=b[0],b=[],b[0]=e,b[1]=e);b[0].toString().indexOf("%")!==
-1?(g=parseFloat(b[0])/100,e=c.width*g,a!=="backgroundSize"&&(e-=(f||d).width*g)):e=a==="backgroundSize"?b[0]==="auto"?d.width:/contain|cover/.test(b[0])?h.Util.resizeBounds(d.width,d.height,c.width,c.height,b[0]).width:parseInt(b[0],10):parseInt(b[0],10);b[1]==="auto"?c=e/d.width*d.height:b[1].toString().indexOf("%")!==-1?(g=parseFloat(b[1])/100,c=c.height*g,a!=="backgroundSize"&&(c-=(f||d).height*g)):c=parseInt(b[1],10);return[e,c]}function g(a,b){var c=[];return{storage:c,width:a,height:b,clip:function(){c.push({type:"function",
name:"clip",arguments:arguments})},translate:function(){c.push({type:"function",name:"translate",arguments:arguments})},fill:function(){c.push({type:"function",name:"fill",arguments:arguments})},save:function(){c.push({type:"function",name:"save",arguments:arguments})},restore:function(){c.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){c.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){c.push({type:"function",name:"createPattern",
arguments:arguments})},drawShape:function(){var a=[];c.push({type:"function",name:"drawShape",arguments:a});return{moveTo:function(){a.push({name:"moveTo",arguments:arguments})},lineTo:function(){a.push({name:"lineTo",arguments:arguments})},arcTo:function(){a.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){a.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){a.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){c.push({type:"function",
name:"drawImage",arguments:arguments})},fillText:function(){c.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(a,b){c.push({type:"variable",name:a,arguments:b});return b}}}var h={},i;h.Util={};h.Util.log=function(){};h.Util.trimText=function(a){return function(b){return a?a.apply(b):((b||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim);h.Util.asFloat=function(a){return parseFloat(a)};(function(){var a=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,b=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;
h.Util.parseTextShadows=function(c){if(!c||c==="none")return[];for(var c=c.match(a),d=[],e=0;c&&e<c.length;e++){var f=c[e].match(b);d.push({color:f[0],offsetX:f[1]?f[1].replace("px",""):0,offsetY:f[2]?f[2].replace("px",""):0,blur:f[3]?f[3].replace("px",""):0})}return d}})();h.Util.parseBackgroundImage=function(a){var b,c,d,e,f,g=[],h,i=0,t=0,s,u,v=function(){if(b){c.substr(0,1)==='"'&&(c=c.substr(1,c.length-2));c&&u.push(c);if(b.substr(0,1)==="-"&&(e=b.indexOf("-",1)+1)>0)d=b.substr(0,e),b=b.substr(e);
g.push({prefix:d,method:b.toLowerCase(),value:f,args:u})}u=[];b=d=c=f=""};v();for(var w=0,x=a.length;w<x;w++)if(h=a[w],!(i===0&&" \r\n\t".indexOf(h)>-1)){switch(h){case '"':s?s===h&&(s=null):s=h;break;case "(":if(s)break;else if(i===0){i=1;f+=h;continue}else t++;break;case ")":if(s)break;else if(i===1)if(t===0){i=0;f+=h;v();continue}else t--;break;case ",":if(!s)if(i===0){v();continue}else if(i===1&&t===0&&!b.match(/^url$/i)){u.push(c);c="";f+=h;continue}}f+=h;i===0?b+=h:c+=h}v();return g};h.Util.Bounds=
function(a){var b,c={};if(a.getBoundingClientRect)b=a.getBoundingClientRect(),c.top=b.top,c.bottom=b.bottom||b.top+b.height,c.left=b.left,c.width=a.offsetWidth,c.height=a.offsetHeight;return c};h.Util.OffsetBounds=function(a){var b=a.offsetParent?h.Util.OffsetBounds(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}};h.Util.getCSS=function(a,f,g){void 0!==a&&(i=b.defaultView.getComputedStyle(a,
null));var n=i[f];if(/^background(Size|Position)$/.test(f)){a:{n=(n||"").split(",");n=n[g||0]||n[0]||"auto";n=h.Util.trimText(n).split(" ");if(!(f==="backgroundSize"&&(!n[0]||n[0].match(/cover|contain|auto/)))){n[0]=n[0].indexOf("%")===-1?d(a,f+"X",n[0]):n[0];if(n[1]===c)if(f==="backgroundSize"){n[1]="auto";a=n;break a}else n[1]=n[0];n[1]=n[1].indexOf("%")===-1?d(a,f+"Y",n[1]):n[1]}a=n}return a}else if(/border(Top|Bottom)(Left|Right)Radius/.test(f))return a=n.split(" "),a.length<=1&&(a[1]=a[0]),a.map(e);
return n};h.Util.resizeBounds=function(a,b,c,d,e){a/=b;!e||e==="auto"?(e=c,c=d):c/d<a^e==="contain"?(c=d,e=d*a):(e=c,c/=a);return{width:e,height:c}};h.Util.BackgroundPosition=function(a,b,c,d,e){a=f("backgroundPosition",a,b,c,d,e);return{left:a[0],top:a[1]}};h.Util.BackgroundSize=function(a,b,c,d){a=f("backgroundSize",a,b,c,d);return{width:a[0],height:a[1]}};h.Util.Extend=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};h.Util.Children=function(a){var b;try{b=a.nodeName&&a.nodeName.toUpperCase()===
"IFRAME"?a.contentDocument||a.contentWindow.document:function(a){var b=[];a!==null&&function(a,b){var d=a.length,e=0;if(typeof b.length==="number")for(var f=b.length;e<f;e++)a[d++]=b[e];else for(;b[e]!==c;)a[d++]=b[e++];a.length=d;return a}(b,a);return b}(a.childNodes)}catch(d){h.Util.log("html2canvas.Util.Children failed with exception: "+d.message),b=[]}return b};h.Util.isTransparent=function(a){return a==="transparent"||a==="rgba(0, 0, 0, 0)"};h.Util.Font=function(){var a={};return function(b,
d,e){if(a[b+"-"+d]!==c)return a[b+"-"+d];var f=e.createElement("div"),g=e.createElement("img"),h=e.createElement("span"),i;f.style.visibility="hidden";f.style.fontFamily=b;f.style.fontSize=d;f.style.margin=0;f.style.padding=0;e.body.appendChild(f);g.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";g.width=1;g.height=1;g.style.margin=0;g.style.padding=0;g.style.verticalAlign="baseline";h.style.fontFamily=b;h.style.fontSize=d;h.style.margin=0;h.style.padding=0;h.appendChild(e.createTextNode("Hidden Text"));
f.appendChild(h);f.appendChild(g);i=g.offsetTop-h.offsetTop+1;f.removeChild(h);f.appendChild(e.createTextNode("Hidden Text"));f.style.lineHeight="normal";g.style.verticalAlign="super";g={baseline:i,lineWidth:1,middle:g.offsetTop-f.offsetTop+1};a[b+"-"+d]=g;e.body.removeChild(f);return g}}();(function(){function a(b){return function(a){try{b.addColorStop(a.stop,a.color)}catch(d){c.log(["failed to add color stop: ",d,"; tried to add: ",a])}}}var c=h.Util,d={};h.Generate=d;var e=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,
/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];
d.parseGradient=function(a,b){var c,d,f=e.length,g,h,j,i;for(d=0;d<f;d+=1)if(g=a.match(e[d]))break;if(g)switch(g[1]){case "-webkit-linear-gradient":case "-o-linear-gradient":c={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};if(f=g[2].match(/\w+/g)){h=f.length;for(d=0;d<h;d+=1)switch(f[d]){case "top":c.y0=0;c.y1=b.height;break;case "right":c.x0=b.width;c.x1=0;break;case "bottom":c.y0=b.height;c.y1=0;break;case "left":c.x0=0,c.x1=b.width}}if(c.x0===null&&c.x1===null)c.x0=c.x1=b.width/
2;if(c.y0===null&&c.y1===null)c.y0=c.y1=b.height/2;if(f=g[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)){h=f.length;j=1/Math.max(h-1,1);for(d=0;d<h;d+=1)i=f[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),i[2]?(g=parseFloat(i[2]),g/=i[3]==="%"?100:b.width):g=d*j,c.colorStops.push({color:i[1],stop:g})}break;case "-webkit-gradient":c={type:g[2]==="radial"?"circle":g[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};
if(f=g[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))c.x0=f[1]*b.width/100,c.y0=f[2]*b.height/100,c.x1=f[3]*b.width/100,c.y1=f[4]*b.height/100;if(f=g[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g)){h=f.length;for(d=0;d<h;d+=1)i=f[d].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),g=parseFloat(i[2]),i[1]==="from"&&(g=0),i[1]==="to"&&(g=1),c.colorStops.push({color:i[3],
stop:g})}break;case "-moz-linear-gradient":c={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};if(f=g[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))c.x0=f[1]*b.width/100,c.y0=f[2]*b.height/100,c.x1=b.width-c.x0,c.y1=b.height-c.y0;if(f=g[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g)){h=f.length;j=1/Math.max(h-1,1);for(d=0;d<h;d+=1)i=f[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),i[2]?(g=parseFloat(i[2]),i[3]&&(g/=100)):
g=d*j,c.colorStops.push({color:i[1],stop:g})}break;case "-webkit-radial-gradient":case "-moz-radial-gradient":case "-o-radial-gradient":c={type:"circle",x0:0,y0:0,x1:b.width,y1:b.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};if(f=g[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))c.cx=f[1]*b.width/100,c.cy=f[2]*b.height/100;f=g[3].match(/\w+/);i=g[4].match(/[a-z\-]*/);if(f&&i)switch(i[0]){case "farthest-corner":case "cover":case "":d=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2));f=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-
c.cy,2));h=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2));i=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2));c.rx=c.ry=Math.max(d,f,h,i);break;case "closest-corner":d=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2));f=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-c.cy,2));h=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2));i=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2));c.rx=c.ry=Math.min(d,f,h,i);break;case "farthest-side":f[0]==="circle"?c.rx=c.ry=Math.max(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):
(c.type=f[0],c.rx=Math.max(c.cx,c.x1-c.cx),c.ry=Math.max(c.cy,c.y1-c.cy));break;case "closest-side":case "contain":f[0]==="circle"?c.rx=c.ry=Math.min(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):(c.type=f[0],c.rx=Math.min(c.cx,c.x1-c.cx),c.ry=Math.min(c.cy,c.y1-c.cy))}if(f=g[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)){h=f.length;j=1/Math.max(h-1,1);for(d=0;d<h;d+=1)i=f[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),
i[2]?(g=parseFloat(i[2]),g/=i[3]==="%"?100:b.width):g=d*j,c.colorStops.push({color:i[1],stop:g})}}return c};d.Gradient=function(c,d){if(!(d.width===0||d.height===0)){var e=b.createElement("canvas"),f=e.getContext("2d"),g,j;e.width=d.width;e.height=d.height;if(g=h.Generate.parseGradient(c,d))switch(g.type){case "linear":j=f.createLinearGradient(g.x0,g.y0,g.x1,g.y1);g.colorStops.forEach(a(j));f.fillStyle=j;f.fillRect(0,0,d.width,d.height);break;case "circle":j=f.createRadialGradient(g.cx,g.cy,0,g.cx,
g.cy,g.rx);g.colorStops.forEach(a(j));f.fillStyle=j;f.fillRect(0,0,d.width,d.height);break;case "ellipse":var i=b.createElement("canvas"),m=i.getContext("2d");j=Math.max(g.rx,g.ry);var n=j*2;i.width=i.height=n;j=m.createRadialGradient(g.rx,g.ry,0,g.rx,g.ry,j);g.colorStops.forEach(a(j));m.fillStyle=j;m.fillRect(0,0,n,n);f.fillStyle=g.colorStops[g.colorStops.length-1].color;f.fillRect(0,0,e.width,e.height);f.drawImage(i,g.cx-g.rx,g.cy-g.ry,2*g.rx,2*g.ry)}return e}};d.ListAlpha=function(a){var b="",
c;do c=a%26,b=String.fromCharCode(c+64)+b,a/=26;while(a*26>26);return b};d.ListRoman=function(a){var b=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],c=[1E3,900,500,400,100,90,50,40,10,9,5,4,1],d="",e,f=b.length;if(a<=0||a>=4E3)return a;for(e=0;e<f;e+=1)for(;a>=c[e];)a-=c[e],d+=b[e];return d}})();h.Parse=function(d,e){function f(a,b){var c=parseInt(z(a,b),10);return isNaN(c)?0:c}function i(a,b,c,d,e,f){f!=="transparent"&&(a.setVariable("fillStyle",f),a.fillRect(b,c,d,e),K+=1)}function l(a,
b,c){if(a.length>0)return b+c.toUpperCase()}function o(a,b){switch(b){case "lowercase":return a.toLowerCase();case "capitalize":return a.replace(/(^|\s|:|-|\(|\))([a-z])/g,l);case "uppercase":return a.toUpperCase();default:return a}}function q(a){return/^(normal|none|0px)$/.test(a)}function p(a,b,c,d){var e=z(b,"fontWeight"),f=z(b,"fontFamily"),g=z(b,"fontSize"),h=E.parseTextShadows(z(b,"textShadow"));switch(parseInt(e,10)){case 401:e="bold";break;case 400:e="normal"}a.setVariable("fillStyle",d);
a.setVariable("font",[z(b,"fontStyle"),z(b,"fontVariant"),e,g,f].join(" "));a.setVariable("textAlign","left");h.length&&(a.setVariable("shadowColor",h[0].color),a.setVariable("shadowOffsetX",h[0].offsetX),a.setVariable("shadowOffsetY",h[0].offsetY),a.setVariable("shadowBlur",h[0].blur));if(c!=="none")return E.Font(f,g,F)}function r(a,b,c){var d=c.ctx,f=z(a,"color"),g=z(a,"textDecoration"),h=z(a,"textAlign"),k,l,m={node:b,textOffset:0};if(E.trimText(b.nodeValue).length>0)b.nodeValue=o(b.nodeValue,
z(a,"textTransform")),h=h.replace(["-webkit-auto"],["auto"]),l=!e.letterRendering&&/^(left|right|justify|auto)$/.test(h)&&q(z(a,"letterSpacing"))?b.nodeValue.split(/(\b| )/):b.nodeValue.split(""),k=p(d,a,g,f),e.chinese&&l.forEach(function(a,b){/.*[\u4E00-\u9FA5].*$/.test(a)&&(a=a.split(""),a.unshift(b,1),l.splice.apply(l,a))}),l.forEach(function(a,b){var e,h=b<l.length-1;e=c.transform.matrix;var j;if($.rangeBounds&&!e){if(g!=="none"||E.trimText(a).length!==0)e=m.node,h=m.textOffset,j=F.createRange(),
j.setStart(e,h),j.setEnd(e,h+a.length),j=j.getBoundingClientRect();m.textOffset+=a.length}else if(m.node&&typeof m.node.nodeValue==="string"){var h=h?m.node.splitText(a.length):null,o=m.node;j=o.parentNode;var p=F.createElement("wrapper"),q=o.cloneNode(!0);p.appendChild(o.cloneNode(!0));j.replaceChild(p,o);e=e?E.OffsetBounds(p):E.Bounds(p);j.replaceChild(q,p);j=e;m.node=h}if(e=j)switch(h=e.left,j=e.bottom,a!==null&&E.trimText(a).length>0&&(d.fillText(a,h,j),K+=1),g){case "underline":i(d,e.left,Math.round(e.top+
k.baseline+k.lineWidth),e.width,1,f);break;case "overline":i(d,e.left,Math.round(e.top),e.width,1,f);break;case "line-through":i(d,e.left,Math.ceil(e.top+k.middle+k.lineWidth),e.width,1,f)}})}function t(a,b,c){var d,b=b.ctx,e=z(a,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(e)){var f;f=-1;var g=1,j=a.parentNode.childNodes;if(a.parentNode){for(;j[++f]!==a;)j[f].nodeType===1&&g++;f=g}else f=-1;switch(e){case "decimal":d=
f;break;case "decimal-leading-zero":d=f.toString().length===1?"0"+f.toString():f.toString();break;case "upper-roman":d=h.Generate.ListRoman(f);break;case "lower-roman":d=h.Generate.ListRoman(f).toLowerCase();break;case "lower-alpha":d=h.Generate.ListAlpha(f).toLowerCase();break;case "upper-alpha":d=h.Generate.ListAlpha(f)}d+=". ";f=F.createElement("boundelement");f.style.display="inline";g=a.style.listStyleType;a.style.listStyleType="none";f.appendChild(F.createTextNode(d));a.insertBefore(f,a.firstChild);
e=E.Bounds(f);a.removeChild(f);a.style.listStyleType=g;p(b,a,"none",z(a,"color"));if(z(a,"listStylePosition")==="inside")b.setVariable("textAlign","left"),a=c.left,c=e.bottom,d!==null&&E.trimText(d).length>0&&(b.fillText(d,a,c),K+=1)}}function s(a){return(a=d[a])&&a.succeeded===!0?a.img:!1}function u(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top);return{left:c,top:d,width:Math.min(a.left+a.width,b.left+b.width)-c,height:Math.min(a.top+a.height,b.top+b.height)-d}}function v(a,b,c,d,e){var g=
f(b,"paddingLeft"),h=f(b,"paddingTop"),j=f(b,"paddingRight"),b=f(b,"paddingBottom");J(a,c,0,0,c.width,c.height,d.left+g+e[3].width,d.top+h+e[0].width,d.width-(e[1].width+e[3].width+g+j),d.height-(e[0].width+e[2].width+h+b))}function w(a){return["Top","Right","Bottom","Left"].map(function(b){return{width:f(a,"border"+b+"Width"),color:z(a,"border"+b+"Color")}})}function x(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){return z(a,"border"+b+"Radius")})}function y(a,b,c,d){var e=
function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),j=e(c,d,f),i=e(g,h,f),h=e(h,j,f),f=e(i,h,f);return[y(a,g,i,f),y(f,h,j,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function B(a,b,c,d,e,f,g){b[0]>0||b[1]>0?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",
f,g]);(c[0]>0||c[1]>0)&&a.push(["line",e[0].start.x,e[0].start.y])}function C(a,b,c,d,e,f,g){var h=[];b[0]>0||b[1]>0?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);c[0]>0||c[1]>0?(h.push(["line",f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));b[0]>0||b[1]>0?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",
a.c4[0],a.c4[1]]);return h}function A(a,b,c){var d=b.left,e=b.top,f=b.width,g=b.height,h,j,i,k,l=x(a),m;m=b.left;h=b.top;j=b.width;i=b.height;var n=l[0][0],o=l[0][1],p=l[1][0],q=l[1][1],r=l[2][0],s=l[2][1],v=l[3][0],t=l[3][1],A=j-p,G=i-s,w=j-r,y=i-t;m={topLeftOuter:H(m,h,n,o).topLeft.subdivide(0.5),topLeftInner:H(m+c[3].width,h+c[0].width,Math.max(0,n-c[3].width),Math.max(0,o-c[0].width)).topLeft.subdivide(0.5),topRightOuter:H(m+A,h,p,q).topRight.subdivide(0.5),topRightInner:H(m+Math.min(A,j+c[3].width),
h+c[0].width,A>j+c[3].width?0:p-c[3].width,q-c[0].width).topRight.subdivide(0.5),bottomRightOuter:H(m+w,h+G,r,s).bottomRight.subdivide(0.5),bottomRightInner:H(m+Math.min(w,j+c[3].width),h+Math.min(G,i+c[0].width),Math.max(0,r-c[1].width),Math.max(0,s-c[2].width)).bottomRight.subdivide(0.5),bottomLeftOuter:H(m,h+y,v,t).bottomLeft.subdivide(0.5),bottomLeftInner:H(m+c[3].width,h+y,Math.max(0,v-c[3].width),Math.max(0,t-c[2].width)).bottomLeft.subdivide(0.5)};h=[];switch(z(a,"backgroundClip")){case "content-box":case "padding-box":B(h,
l[0],l[1],m.topLeftInner,m.topRightInner,b.left+c[3].width,b.top+c[0].width);B(h,l[1],l[2],m.topRightInner,m.bottomRightInner,b.left+b.width-c[1].width,b.top+c[0].width);B(h,l[2],l[3],m.bottomRightInner,m.bottomLeftInner,b.left+b.width-c[1].width,b.top+b.height-c[2].width);B(h,l[3],l[0],m.bottomLeftInner,m.topLeftInner,b.left+c[3].width,b.top+b.height-c[2].width);break;default:B(h,l[0],l[1],m.topLeftOuter,m.topRightOuter,b.left,b.top),B(h,l[1],l[2],m.topRightOuter,m.bottomRightOuter,b.left+b.width,
b.top),B(h,l[2],l[3],m.bottomRightOuter,m.bottomLeftOuter,b.left+b.width,b.top+b.height),B(h,l[3],l[0],m.bottomLeftOuter,m.topLeftOuter,b.left,b.top+b.height)}n={clip:h,borders:[]};for(a=0;a<4;a++)if(c[a].width>0){b=d;h=e;j=f;i=g-c[2].width;switch(a){case 0:i=c[0].width;k=C({c1:[b,h],c2:[b+j,h],c3:[b+j-c[1].width,h+i],c4:[b+c[3].width,h+i]},l[0],l[1],m.topLeftOuter,m.topLeftInner,m.topRightOuter,m.topRightInner);break;case 1:b=d+f-c[1].width;j=c[1].width;k=C({c1:[b+j,h],c2:[b+j,h+i+c[2].width],c3:[b,
h+i],c4:[b,h+c[0].width]},l[1],l[2],m.topRightOuter,m.topRightInner,m.bottomRightOuter,m.bottomRightInner);break;case 2:h=h+g-c[2].width;i=c[2].width;k=C({c1:[b+j,h+i],c2:[b,h+i],c3:[b+c[3].width,h],c4:[b+j-c[3].width,h]},l[2],l[3],m.bottomRightOuter,m.bottomRightInner,m.bottomLeftOuter,m.bottomLeftInner);break;case 3:j=c[3].width,k=C({c1:[b,h+i+c[2].width],c2:[b,h],c3:[b+j,h+c[0].width],c4:[b+j,h+i]},l[3],l[0],m.bottomLeftOuter,m.bottomLeftInner,m.topLeftOuter,m.topLeftInner)}n.borders.push({args:k,
color:c[a].color})}return n}function D(a,b){var c=a.drawShape();b.forEach(function(a,b){c[b===0?"moveTo":a[0]+"To"].apply(null,a.slice(1))});return c}function G(a,b,c){var d=F.createElement("valuewrap");["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(b){try{d.style[b]=z(a,b)}catch(c){E.log("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});d.style.borderColor=
"black";d.style.borderStyle="solid";d.style.display="block";d.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(a.type)||a.nodeName==="SELECT")d.style.lineHeight=z(a,"height");d.style.top=b.top+"px";d.style.left=b.left+"px";b=a.nodeName==="SELECT"?(a.options[a.selectedIndex]||0).text:a.value;if(!b)b=a.placeholder;b=F.createTextNode(b);d.appendChild(b);L.appendChild(d);r(a,b,c);L.removeChild(d)}function J(a){a.drawImage.apply(a,Array.prototype.slice.call(arguments,1));K+=1}
function Q(c,d){var e=a.getComputedStyle(c,d);if(e&&e.content&&!(e.content==="none"||e.content==="-moz-alt-content"||e.display==="none")){var f=e.content+"",g=f.substr(0,1);g===f.substr(f.length-1)&&g.match(/'|"/)&&(f=f.substr(1,f.length-2));var g=f.substr(0,3)==="url",h=b.createElement(g?"img":"span");h.className=I+"-before "+I+"-after";Object.keys(e).filter(V).forEach(function(a){try{h.style[a]=e[a]}catch(b){E.log(["Tried to assign readonly property ",a,"Error:",b])}});g?h.src=E.parseBackgroundImage(f)[0].args[0]:
h.innerHTML=f;return h}}function V(b){return isNaN(a.parseInt(b,10))}function W(a,b){var c=Q(a,":before"),d=Q(a,":after");if(c||d){if(c)a.className+=" "+I+"-before",a.parentNode.insertBefore(c,a),O(c,b,!0),a.parentNode.removeChild(c),a.className=a.className.replace(I+"-before","").trim();if(d)a.className+=" "+I+"-after",a.appendChild(d),O(d,b,!0),a.removeChild(d),a.className=a.className.replace(I+"-after","").trim()}}function R(a,b,c,d){var e=Math.round(d.left+c.left),c=Math.round(d.top+c.top);a.createPattern(b);
a.translate(e,c);a.fill();a.translate(-e,-c)}function N(a,b,c,d,e,f,g,h){var j=[];j.push(["line",Math.round(e),Math.round(f)]);j.push(["line",Math.round(e+g),Math.round(f)]);j.push(["line",Math.round(e+g),Math.round(h+f)]);j.push(["line",Math.round(e),Math.round(h+f)]);D(a,j);a.save();a.clip();R(a,b,c,d);a.restore()}function X(a,b,c){for(var d=z(a,"backgroundImage"),e=E.parseBackgroundImage(d),f,g=e.length;g--;)if(d=e[g],d.args&&d.args.length!==0)if(f=s(d.method==="url"?d.args[0]:d.value)){var h=
a,d=b,j=c,i=f;f=g;var l=E.BackgroundSize(h,d,i,f),k=E.BackgroundPosition(h,d,i,f,l),h=z(h,"backgroundRepeat").split(",").map(E.trimText);if(!(i.width===l.width&&i.height===l.height)){var m=void 0,n=F.createElement("canvas");n.width=l.width;n.height=l.height;m=n.getContext("2d");J(m,i,0,0,i.width,i.height,0,0,l.width,l.height);i=n}h=h[f]||h[0];switch(h){case "repeat-x":N(j,i,k,d,d.left,d.top+k.top,99999,i.height);break;case "repeat-y":N(j,i,k,d,d.left+k.left,d.top,i.width,99999);break;case "no-repeat":N(j,
i,k,d,d.left+k.left,d.top+k.top,i.width,i.height);break;default:R(j,i,k,{top:d.top,left:d.left,width:i.width,height:i.height})}}else E.log("html2canvas: Error loading background:",d)}function Y(a){return a.replace("px","")}function Z(a){var b=z(a,"transform")||z(a,"-webkit-transform")||z(a,"-moz-transform")||z(a,"-ms-transform")||z(a,"-o-transform"),a=z(a,"transform-origin")||z(a,"-webkit-transform-origin")||z(a,"-moz-transform-origin")||z(a,"-ms-transform-origin")||z(a,"-o-transform-origin")||"0px 0px",
a=a.split(" ").map(Y).map(E.asFloat),c;if(b&&b!=="none"&&(b=b.match(aa)))switch(b[1]){case "matrix":c=b[2].split(",").map(E.trimText).map(E.asFloat)}return{origin:a,matrix:c}}function ba(a,b,c,d){var f=g(!b?Math.max(Math.max(F.body.scrollWidth,F.documentElement.scrollWidth),Math.max(F.body.offsetWidth,F.documentElement.offsetWidth),Math.max(F.body.clientWidth,F.documentElement.clientWidth)):c.width,!b?Math.max(Math.max(F.body.scrollHeight,F.documentElement.scrollHeight),Math.max(F.body.offsetHeight,
F.documentElement.offsetHeight),Math.max(F.body.clientHeight,F.documentElement.clientHeight)):c.height),d={ctx:f,opacity:f.setVariable("globalAlpha",z(a,"opacity")*(b?b.opacity:1)),cssPosition:z(a,"position"),borders:w(a),transform:d,clip:b&&b.clip?E.Extend({},b.clip):null},h=d.cssPosition!=="static",i=h?z(a,"zIndex"):"auto",l=z(a,"opacity"),k=z(a,"cssFloat")!=="none";d.zIndex=f={zindex:i,children:[]};f.isPositioned=h;f.isFloated=k;f.opacity=l;f.ownStacking=i!=="auto"||l<1;b&&b.zIndex.children.push(d);
if(e.useOverflow===!0&&/(hidden|scroll|auto)/.test(z(a,"overflow"))===!0&&/(BODY)/i.test(a.nodeName)===!1)d.clip=d.clip?u(d.clip,c):c;return d}function ca(a,b,c){a={left:b.left+a[3].width,top:b.top+a[0].width,width:b.width-(a[1].width+a[3].width),height:b.height-(a[0].width+a[2].width)};c&&(a=u(a,c));return a}function da(a,b){var c=b.matrix?E.OffsetBounds(a):E.Bounds(a);b.origin[0]+=c.left;b.origin[1]+=c.top;return c}function S(a,b,c,d){var e=Z(a,b),f=da(a,e),g,b=ba(a,b,f,e),e=b.borders,h=b.ctx,j=
ca(e,f,b.clip),l=A(a,f,e),k=T.test(a.nodeName)?"#efefef":z(a,"backgroundColor");D(h,l.clip);h.save();h.clip();if(j.height>0&&j.width>0&&!d)i(h,f.left,f.top,f.width,f.height,k),X(a,j,h);else if(d)b.backgroundColor=k;h.restore();l.borders.forEach(function(a){var b=a.args,a=a.color;a!=="transparent"&&(h.setVariable("fillStyle",a),D(h,b),h.fill(),K+=1)});c||W(a,b);switch(a.nodeName){case "IMG":(g=s(a.getAttribute("src")))?v(h,a,g,f,e):E.log("html2canvas: Error loading <img>:"+a.getAttribute("src"));break;
case "INPUT":/^(text|url|email|submit|button|reset)$/.test(a.type)&&(a.value||a.placeholder||"").length>0&&G(a,f,b);break;case "TEXTAREA":(a.value||a.placeholder||"").length>0&&G(a,f,b);break;case "SELECT":(a.options||a.placeholder||"").length>0&&G(a,f,b);break;case "LI":t(a,b,j);break;case "CANVAS":v(h,a,a,f,e)}return b}function O(a,b,c){z(a,"display")!=="none"&&z(a,"visibility")!=="hidden"&&!a.hasAttribute("data-html2canvas-ignore")&&(b=S(a,b,c,!1)||b,T.test(a.nodeName)||U(a,b,c))}function U(a,
b,c){E.Children(a).forEach(function(d){d.nodeType===d.ELEMENT_NODE?O(d,b,c):d.nodeType===d.TEXT_NODE&&r(a,d,b)})}a.scroll(0,0);var M=e.elements===c?b.body:e.elements[0],K=0,F=M.ownerDocument,E=h.Util,$=E.Support(e,F),T=RegExp("("+e.ignoreElements+")"),L=F.body,z=E.getCSS,I="___html2canvas___pseudoelement",P=F.createElement("style");P.innerHTML="."+I+'-before:before { content: "" !important; display: none !important; }.'+I+'-after:after { content: "" !important; display: none !important; }';L.appendChild(P);
var d=d||{},H=function(a){return function(b,c,d,e){var f=d*a,g=e*a,d=b+d,e=c+e;return{topLeft:y({x:b,y:e},{x:b,y:e-g},{x:d-f,y:c},{x:d,y:c}),topRight:y({x:b,y:c},{x:b+f,y:c},{x:d,y:e-g},{x:d,y:e}),bottomRight:y({x:d,y:c},{x:d,y:c+g},{x:b+f,y:e},{x:b,y:e}),bottomLeft:y({x:d,y:e},{x:d-f,y:e},{x:b,y:c+g},{x:b,y:c})}}}(4*((Math.sqrt(2)-1)/3)),aa=/(matrix)\((.+)\)/;return function(){var a=z(b.documentElement,"backgroundColor"),c=E.isTransparent(a)&&M===b.body,d=S(M,null,!1,c);U(M,d);if(c)a=d.backgroundColor;
L.removeChild(P);return{backgroundColor:a,stack:d}}()};h.Preload=function(d){function e(){s.log("html2canvas: start: images: "+r.numLoaded+" / "+r.numTotal+" (failed: "+r.numFailed+")");!r.firstRun&&r.numLoaded>=r.numTotal&&(s.log("Finished loading images: # "+r.numTotal+" (failed: "+r.numFailed+")"),typeof d.complete==="function"&&d.complete(r))}function f(b,g,h){var i,l=d.proxy,m;C.href=b;b=C.href;i="html2canvas_"+w++;h.callbackname=i;l+=l.indexOf("?")>-1?"&":"?";l+="url="+encodeURIComponent(b)+
"&callback="+i;m=x.createElement("script");a[i]=function(b){b.substring(0,6)==="error:"?(h.succeeded=!1,r.numLoaded++,r.numFailed++,e()):(p(g,h),g.src=b);a[i]=c;try{delete a[i]}catch(d){}m.parentNode.removeChild(m);m=null;delete h.script;delete h.callbackname};m.setAttribute("type","text/javascript");m.setAttribute("src",l);h.script=m;a.document.body.appendChild(m)}function g(b,c){var d=a.getComputedStyle(b,c),e=d.content;e.substr(0,3)==="url"&&u.loadImage(h.Util.parseBackgroundImage(e)[0].args[0]);
o(d.backgroundImage,b)}function i(a){return a&&a.method&&a.args&&a.args.length>0}function o(a,b){var d;h.Util.parseBackgroundImage(a).filter(i).forEach(function(a){if(a.method==="url")u.loadImage(a.args[0]);else if(a.method.match(/\-?gradient$/)){d===c&&(d=h.Util.Bounds(b));var a=a.value,f=h.Generate.Gradient(a,d);f!==c&&(r[a]={img:f,succeeded:!0},r.numTotal++,r.numLoaded++,e())}})}function q(a){var b=!1;try{s.Children(a).forEach(q)}catch(d){}try{b=a.nodeType}catch(e){b=!1,s.log("html2canvas: failed to access some element's nodeType - Exception: "+
e.message)}if(b===1||b===c){g(a,":before");g(a,":after");try{o(s.getCSS(a,"backgroundImage"),a)}catch(f){s.log("html2canvas: failed to get background-image - Exception: "+f.message)}o(a)}}function p(b,g){b.onload=function(){g.timer!==c&&a.clearTimeout(g.timer);r.numLoaded++;g.succeeded=!0;b.onerror=b.onload=null;e()};b.onerror=function(){if(b.crossOrigin==="anonymous"&&(a.clearTimeout(g.timer),d.proxy)){var c=b.src;b=new Image;g.img=b;b.src=c;f(b.src,b,g);return}r.numLoaded++;r.numFailed++;g.succeeded=
!1;b.onerror=b.onload=null;e()}}var r={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},t,s=h.Util,u,v,w=0;v=d.elements[0]||b.body;var x=v.ownerDocument,y=v.getElementsByTagName("img"),B=y.length,C=x.createElement("a"),A=function(a){return a.crossOrigin!==c}(new Image),D;C.href=a.location.href;t=C.protocol+C.host;u={loadImage:function(a){var b,e;if(a&&r[a]===c)b=new Image,a.match(/data:image\/.*;base64,/i)?(b.src=a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),e=r[a]={img:b},r.numTotal++,p(b,e)):(C.href=
a,C.href=C.href,C.protocol+C.host===t||d.allowTaint===!0?(e=r[a]={img:b},r.numTotal++,p(b,e),b.src=a):A&&!d.allowTaint&&d.useCORS?(b.crossOrigin="anonymous",e=r[a]={img:b},r.numTotal++,p(b,e),b.src=a):d.proxy&&(e=r[a]={img:b},r.numTotal++,f(a,b,e)))},cleanupDOM:function(f){var g,h;if(!r.cleanupDone){f&&typeof f==="string"?s.log("html2canvas: Cleanup because: "+f):s.log("html2canvas: Cleanup after timeout: "+d.timeout+" ms.");for(h in r)if(r.hasOwnProperty(h)&&(g=r[h],typeof g==="object"&&g.callbackname&&
g.succeeded===c)){a[g.callbackname]=c;try{delete a[g.callbackname]}catch(i){}g.script&&g.script.parentNode&&(g.script.setAttribute("src","about:blank"),g.script.parentNode.removeChild(g.script));r.numLoaded++;r.numFailed++;s.log("html2canvas: Cleaned up failed img: '"+h+"' Steps: "+r.numLoaded+" / "+r.numTotal)}a.stop!==c?a.stop():b.execCommand!==c&&b.execCommand("Stop",!1);b.close!==c&&b.close();r.cleanupDone=!0;f&&typeof f==="string"||e()}},renderingDone:function(){D&&a.clearTimeout(D)}};d.timeout>
0&&(D=a.setTimeout(u.cleanupDOM,d.timeout));s.log("html2canvas: Preload starts: finding background-images");r.firstRun=!0;q(v);s.log("html2canvas: Preload: Finding images");for(v=0;v<B;v+=1)u.loadImage(y[v].getAttribute("src"));r.firstRun=!1;s.log("html2canvas: Preload: Done.");r.numTotal===r.numLoaded&&e();return u};h.Renderer=function(a,d){return function(a){if(typeof d.renderer==="string"&&h.Renderer[a]!==c)a=h.Renderer[a](d);else if(typeof a==="function")a=a(d);else throw Error("Unknown renderer");
if(typeof a!=="function")throw Error("Invalid renderer defined");return a}(d.renderer)(a,d,b,function(a){function b(a){Object.keys(a).sort().forEach(function(c){var e=[],f=[],g=[],h=[];a[c].forEach(function(a){a.node.zIndex.isPositioned||a.node.zIndex.opacity<1?g.push(a):a.node.zIndex.isFloated?f.push(a):e.push(a)});(function v(a){a.forEach(function(a){h.push(a);a.children&&v(a.children)})})(e.concat(f,g));h.forEach(function(a){a.context?b(a.context):d.push(a.node)})})}var d=[],a=function(a){function b(a,
d,e){var f=d.zIndex.zindex==="auto"?0:Number(d.zIndex.zindex),g=a,h=d.zIndex.isPositioned,j=d.zIndex.isFloated,i={node:d},l=e;if(d.zIndex.ownStacking)g=i.context={"!":[{node:d,children:[]}]},l=c;else if(h||j)l=i.children=[];f===0&&e?e.push(i):(a[f]||(a[f]=[]),a[f].push(i));d.zIndex.children.forEach(function(a){b(g,a,l)})}var d={};b(d,a);return d}(a);b(a);return d}(a.stack),h)};h.Util.Support=function(a,b){function d(){var a=new Image,e=b.createElement("canvas"),f=e.getContext===c?!1:e.getContext("2d");
if(f===!1)return!1;e.width=e.height=10;a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'><foreignObject width='10' height='10'><div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>sup</div></foreignObject></svg>";try{f.drawImage(a,0,0),e.toDataURL()}catch(g){return!1}h.Util.log("html2canvas: Parse: SVG powered rendering available");return!0}return{rangeBounds:function(){var a,c,d=!1;if(b.createRange&&(a=b.createRange(),a.getBoundingClientRect))c=
b.createElement("boundtest"),c.style.height="123px",c.style.display="block",b.body.appendChild(c),a.selectNode(c),a=a.getBoundingClientRect(),a=a.height,a===123&&(d=!0),b.body.removeChild(c);return d}(),svgRendering:a.svgRendering&&d()}};a.html2canvas=function(b,c){var b=b.length?b:[b],d,e,f={logging:!1,elements:b,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,
taintTest:!0,renderer:"Canvas"},f=h.Util.Extend(c,f);h.logging=f.logging;f.complete=function(a){if(!(typeof f.onpreloaded==="function"&&f.onpreloaded(a)===!1)&&(d=h.Parse(a,f),!(typeof f.onparsed==="function"&&f.onparsed(d)===!1)&&(e=h.Renderer(d,f),typeof f.onrendered==="function")))f.onrendered(e)};a.setTimeout(function(){h.Preload(f)},0);return{render:function(a,b){return h.Renderer(a,h.Util.Extend(b,f))},parse:function(a,b){return h.Parse(a,h.Util.Extend(b,f))},preload:function(a){return h.Preload(h.Util.Extend(a,
f))},log:h.Util.log}};a.html2canvas.log=h.Util.log;a.html2canvas.Renderer={Canvas:c};h.Renderer.Canvas=function(a){function d(a,b){a.beginPath();b.forEach(function(b){a[b.name].apply(a,b.arguments)});a.closePath()}var a=a||{},e=b,f=[],g=b.createElement("canvas"),i=g.getContext("2d"),q=h.Util,p=a.canvas||e.createElement("canvas");return function(b,h,s,u,v){var w=p.getContext("2d"),x,y=b.stack;p.width=p.style.width=h.width||y.ctx.width;p.height=p.style.height=h.height||y.ctx.height;x=w.fillStyle;w.fillStyle=
q.isTransparent(y.backgroundColor)&&h.background!==c?h.background:b.backgroundColor;w.fillRect(0,0,p.width,p.height);w.fillStyle=x;u.forEach(function(b){w.textBaseline="bottom";w.save();b.transform.matrix&&(w.translate(b.transform.origin[0],b.transform.origin[1]),w.transform.apply(w,b.transform.matrix),w.translate(-b.transform.origin[0],-b.transform.origin[1]));b.clip&&(w.beginPath(),w.rect(b.clip.left,b.clip.top,b.clip.width,b.clip.height),w.clip());b.ctx.storage&&b.ctx.storage.forEach(function(b){var c=
w;switch(b.type){case "variable":c[b.name]=b.arguments;break;case "function":switch(b.name){case "createPattern":if(b.arguments[0].width>0&&b.arguments[0].height>0)try{c.fillStyle=c.createPattern(b.arguments[0],"repeat")}catch(h){q.log("html2canvas: Renderer: Error creating pattern",h.message)}break;case "drawShape":d(c,b.arguments);break;case "drawImage":if(b.arguments[8]>0&&b.arguments[7]>0){var p;if(!(p=!a.taintTest))if(p=a.taintTest)a:{if(f.indexOf(b.arguments[0].src)===-1){i.drawImage(b.arguments[0],
0,0);try{i.getImageData(0,0,1,1)}catch(s){g=e.createElement("canvas");i=g.getContext("2d");p=!1;break a}f.push(b.arguments[0].src)}p=!0}p&&c.drawImage.apply(c,b.arguments)}break;default:c[b.name].apply(c,b.arguments)}}});w.restore()});q.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj");if(h.elements.length===1&&typeof h.elements[0]==="object"&&h.elements[0].nodeName!=="BODY"){b=v.Util.Bounds(h.elements[0]);s=s.createElement("canvas");s.width=Math.ceil(b.width);s.height=Math.ceil(b.height);
w=s.getContext("2d");try{w.drawImage(p,b.left,b.top,b.width,b.height,0,0,b.width,b.height)}catch(B){}p=null;return s}return p}}})(window,document);
(function(a){var b={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{"0.25":"rgb(0,0,255)","0.55":"rgb(0,255,0)","0.85":"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:0.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},c=function(){var a=function(a){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1;this._xField=a.xField||a.defaultXField;this._yField=a.yField||a.defaultYField;this._valueField=a.valueField||
a.defaultValueField;if(a.radius)this._cfgRadius=a.radius},c=b.defaultRadius;a.prototype={_organiseData:function(a,b){var d=a[this._xField],e=a[this._yField],f=this._radi,g=this._data,h=this._max,p=this._min,r=a[this._valueField]||1,t=a.radius||this._cfgRadius||c;g[d]||(g[d]=[],f[d]=[]);g[d][e]?g[d][e]+=r:(g[d][e]=r,f[d][e]=t);return g[d][e]>h?(b?this.setDataMax(g[d][e]):this._max=g[d][e],!1):{x:d,y:e,value:r,radius:t,min:p,max:h}},_unOrganizeData:function(){var a=[],b=this._data,c=this._radi,d;for(d in b)for(var e in b[d])a.push({x:d,
y:e,radius:c[d][e],value:b[d][e]});return{min:this._min,max:this._max,data:a}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(a){if(a.length>0)for(var b=a.length;b--;)this.addData.call(this,a[b]);else(a=this._organiseData(a,!0))&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[a]});return this},setData:function(a){var b=a.data,c=b.length;this._max=a.max;this._min=a.min||0;this._data=[];this._radi=[];for(a=
0;a<c;a++)this._organiseData(b[a],!1);this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},removeData:function(){},setDataMax:function(a){this._max=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setDataMin:function(a){this._min=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(a){this._coordinator=a},_getInternalData:function(){return{max:this._max,
min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}};return a}(),d=function(){function a(c){var d=this.shadowCanvas=document.createElement("canvas"),e=this.canvas=c.canvas||document.createElement("canvas");this._renderBoundaries=[1E4,1E4,0,0];this._width=d.width=e.width;this._height=d.height=e.height;this.shadowCtx=d.getContext("2d");this.ctx=e.getContext("2d");this._palette=b(c);this._templates={};this._setStyles(c)}var b=function(a){var a=a.gradient||
a.defaultGradient,b=document.createElement("canvas"),c=b.getContext("2d");b.width=256;b.height=1;var b=c.createLinearGradient(0,0,256,1),d;for(d in a)b.addColorStop(d,a[d]);c.fillStyle=b;c.fillRect(0,0,256,1);return c.getImageData(0,0,256,1).data},c=function(a){for(var b=[],c=a.min,d=a.max,e=a.radi,a=a.data,f=Object.keys(a),g=f.length;g--;)for(var h=f[g],i=Object.keys(a[h]),k=i.length;k--;){var u=i[k];b.push({x:h,y:u,value:a[h][u],radius:e[h][u]})}return{min:c,max:d,data:b}};a.prototype={renderPartial:function(a){this._drawAlpha(a);
this._colorize()},renderAll:function(a){this._clear();this._drawAlpha(c(a));this._colorize()},_updateGradient:function(a){this._palette=b(a)},updateConfig:function(a){a.gradient&&this._updateGradient(a);this._setStyles(a)},setDimensions:function(a,b){this._width=a;this._height=b;this.shadowCanvas.width=this._width;this.shadowCanvas.height=this._height},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height);this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(a){this._blur=
a.blur==0?0:a.blur||a.defaultBlur;if(a.backgroundColor)this.canvas.style.backgroundColor=a.backgroundColor;this._opacity=(a.opacity||0)*255;this._maxOpacity=(a.maxOpacity||a.defaultMaxOpacity)*255;this._minOpacity=(a.minOpacity||a.defaultMinOpacity)*255},_drawAlpha:function(a){for(var b=this._min=a.min,c=this._max=a.max,a=a.data||[],d=a.length,e=1-this._blur;d--;){var f=a[d],g=f.radius,h=f.value,i=f.x-g,f=f.y-g,k=this.shadowCtx,u;if(this._templates[g])u=this._templates[g];else{u=this._templates;var v=
g,w=g,x=e,y=document.createElement("canvas"),B=y.getContext("2d");y.width=y.height=w*2;x==1?(B.beginPath(),B.arc(w,w,w,0,2*Math.PI,!1),B.fillStyle="rgba(0,0,0,1)",B.fill()):(x=B.createRadialGradient(w,w,w*x,w,w,w),x.addColorStop(0,"rgba(0,0,0,1)"),x.addColorStop(1,"rgba(0,0,0,0)"),B.fillStyle=x,B.fillRect(0,0,2*w,2*w));u[v]=u=y}k.globalAlpha=(h-b)/Math.abs(c-b);k.drawImage(u,i,f);i<this._renderBoundaries[0]&&(this._renderBoundaries[0]=i);f<this._renderBoundaries[1]&&(this._renderBoundaries[1]=f);
i+2*g>this._renderBoundaries[2]&&(this._renderBoundaries[2]=i+2*g);f+2*g>this._renderBoundaries[3]&&(this._renderBoundaries[3]=f+2*g)}},_colorize:function(){var a=this._renderBoundaries[0],b=this._renderBoundaries[1],c=this._renderBoundaries[2]-a,d=this._renderBoundaries[3]-b,e=this._width,f=this._height,g=this._opacity,h=this._maxOpacity,i=this._minOpacity;a<0&&(a=0);b<0&&(b=0);a+c>e&&(c=e-a);b+d>f&&(d=f-b);for(var c=this.shadowCtx.getImageData(a,b,c,d),d=c.data,e=d.length,f=this._palette,k=3;k<
e;k+=4){var u=d[k],v=u*4;v&&(u=g>0?g:u<h?u<i?i:u:h,d[k-3]=f[v],d[k-2]=f[v+1],d[k-1]=f[v+2],d[k]=u)}c.data=d;this.ctx.putImageData(c,a,b);this._renderBoundaries=[1E3,1E3,0,0]},getValueAt:function(a){a=this.shadowCtx.getImageData(a.x,a.y,1,1).data[3];return Math.abs(this._max-this._min)*(a/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}};return a}(),e=function(){var a=!1;b.defaultRenderer==="canvas2d"&&(a=d);return a}(),f={merge:function(){for(var a={},b=arguments.length,c=0;c<b;c++){var d=
arguments[c],e;for(e in d)a[e]=d[e]}return a}},g=function(){function a(h){h=this._config=f.merge(b,h||{});this._coordinator=new d;if(h.plugin)if(h=h.plugin,b.plugins[h])h=b.plugins[h],this._renderer=h.renderer,this._store=h.store;else throw Error("Plugin '"+h+"' not found. Maybe it was not registered.");else this._renderer=new e(h),this._store=new c(h);g(this)}var d=function(){function a(){this.cStore={}}a.prototype={on:function(a,b,c){var d=this.cStore;d[a]||(d[a]=[]);d[a].push(function(a){return b.call(c,
a)})},emit:function(a,b){var c=this.cStore;if(c[a])for(var d=c[a].length,e=0;e<d;e++)(0,c[a][e])(b)}};return a}(),g=function(a){var b=a._renderer,c=a._coordinator,d=a._store;c.on("renderpartial",b.renderPartial,b);c.on("renderall",b.renderAll,b);c.on("extremachange",function(b){a._config.onExtremaChange&&a._config.onExtremaChange({min:b.min,max:b.max,gradient:a._config.gradient||a._config.defaultGradient})});d.setCoordinator(c)};a.prototype={addData:function(){this._store.addData.apply(this._store,
arguments);return this},removeData:function(){this._store.removeData&&this._store.removeData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store,arguments);return this},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(a){this._config=f.merge(this._config,a);this._renderer.updateConfig(this._config);this._coordinator.emit("renderall",
this._store._getInternalData());return this},repaint:function(){this._coordinator.emit("renderall",this._store._getInternalData());return this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(a){return this._store.getValueAt?this._store.getValueAt(a):this._renderer.getValueAt?this._renderer.getValueAt(a):null}};return a}();a.h337={create:function(a){return new g(a)},register:function(a,c){b.plugins[a]=c}}})(this||window);
var ia=ia||{isUndefined:function(a){return a=="null"||a==null||a=="NaN"||a==""||a==void 0?!0:!1},log:function(a){window.console&&window.console.log&&ia.isTouchDevice()&&$j("#ia-debug-container").append("<span style='color:green'><br/>&gt; "+a+"</span>")},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)!==-1},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},parseInt:function(a,b){return parseInt(a,b||10)},extend:function(a,b){function c(){}c.prototype=a.prototype;b.prototype=
new c;b.prototype.constructor=b;b.baseConstructor=a;b.superClass=a.prototype},Quicksort:function(a,b,c,d){var e,f,g,h;if(d-c==1)a[c][b]>a[d][b]&&(h=a[c],a[c]=a[d],a[d]=h);else{e=a[ia.parseInt((c+d)/2)];a[ia.parseInt((c+d)/2)]=a[c];a[c]=e;f=c+1;g=d;do{for(;f<=g&&a[f][b]<=e[b];)f++;for(;a[g][b]>e[b];)g--;f<g&&(h=a[f],a[f]=a[g],a[g]=h)}while(f<g);a[c]=a[g];a[g]=e;c<g-1&&ia.Quicksort(a,b,c,g-1);g+1<d&&ia.Quicksort(a,b,g+1,d)}},proxyMapStem:"../",proxyMaps:void 0,useProxy:!1,accessToken:"",addProxy:function(a,
b){if(ia.proxyMaps==void 0)ia.proxyMaps={};ia.proxyMaps[a]=b},getDomainSafeUrl:function(a){var b=a;if(ia.useProxy){var c=a.indexOf("://")+3,c=a.substring(0,a.indexOf("/",c)+1);ia.proxyMaps&&ia.proxyMaps[c]&&(b=a.replace(c,ia.proxyMapStem+ia.proxyMaps[c]))}return b},regAppId:"83wV2txRMBrDpKjq",redirectToArcGisOnlineAuth:function(){var a="https://www.arcgis.com/sharing/oauth2/authorize?client_id="+ia.regAppId+"&response_type=token&redirect_uri="+encodeURI(window.location.href);window.location.href=
a},getNiceNum:function(a,b){var c=Math.floor(ia.log10(a)),d=a/Math.pow(10,c);return(b?d<1.5?1:d<3?2:d<7?5:10:d<=1?1:d<=2?2:d<=5?5:10)*Math.pow(10,c)},log10:function(a){return Math.log(a)/Math.LN10},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},disableTextSelection:function(a){a=a.get(0);typeof a.onselectstart!="undefined"?a.onselectstart=function(){return!1}:typeof a.style.MozUserSelect!="undefined"?a.style.MozUserSelect="none":a.onmousedown=function(){return!1}},enableTextSelection:function(a){a=
a.get(0);typeof a.onselectstart!="undefined"?a.onselectstart=function(){return!0}:typeof a.style.MozUserSelect!="undefined"?a.style.MozUserSelect="text":a.onmousedown=function(){return!0}},loadCssfile:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";c.appendChild(d);ia.File.load({url:a,onSuccess:function(a){d.appendChild(document.createTextNode(a));b!=void 0&&b.call(null)}})},appendCss:function(a,b){var c=document.getElementsByTagName("head")[0],
d=document.createElement("style");d.type="text/css";c.appendChild(d);d.appendChild(document.createTextNode(a));b!=void 0&&b.call(null)},getPrecision:function(a){for(var b=0,c=a.length-1,d=0;d<c;d++){var e,f=a[d],g=a[d+1];ia.isNumber(f)&&ia.isNumber(g)&&(e=Math.abs(g-f),f!=Infinity&&f!=-Infinity&&g!=Infinity&&g!=-Infinity&&(f=new BigDecimal(""+f),g=new BigDecimal(""+g),e=Math.abs(g.subtract(f))),e>0&&e<1?(f=String(e).indexOf("e"),f!=-1?(e=new BigDecimal(""+e),e=Math.abs(e.exp)):(e=String(e).split(".")[1],
f=e.indexOf("e"),f!=-1?(f=e.indexOf("+")!=-1?f+2:f+1,e=e.substr(f)):(f=String(ia.parseInt(e)),e=e.length-f.length+1)),e>b&&(b=e)):String(f).indexOf(".")>-1&&(e=1,e>b&&(b=e)))}return b},callFunction:function(a,b,c){var d="none";a.indexOf("script")==0||a.indexOf("javascript")==0?(d=a.split(":")[0],a=a.substring(a.indexOf(":")+1).split(";")):a=a.split(";");for(var e=0;e<a.length;e++)a[e]&&ia.processFunction(a[e],d,b,c)},processFunction:function(a,b,c,d){var e=[];if(b=="script"||b=="javascript"){if(a.indexOf("(")!=
-1){if(b=jQuery.trim(a.substring(0,a.indexOf("("))),a=a.substring(a.indexOf("(")+1,a.indexOf(")")),a!=""){e=a.split(",");for(a=0;a<e.length;a++)c=jQuery.trim(e[a]),c.indexOf("'")==0&&c.lastIndexOf("'")==c.length-1?c=c.substr(1,c.length-2):c.indexOf('"')==0&&c.lastIndexOf('"')==c.length-1&&(c=c.substr(1,c.length-2)),ia.isNumber(c)&&(c=parseFloat(c)),e[a]=c}}else b=jQuery.trim(a);d&&(e[e.length]=d);window[b].apply(null,e)}else c==void 0&&(c="_blank"),window.open(a,c)},supportsCanvas:function(){return!!document.createElement("canvas").getContext},
isTouchDevice:function(){return"ontouchstart"in window},disableDefaultTouch:function(){if(ia.isTouchDevice())document.body.addEventListener("touchstart touchend touchmove",function(a){a.preventDefault()},!1),document.ontouchmove=function(a){a.preventDefault()}},showWaitCursor:function(){$j("body").css("cursor","wait")},showDefaultCursor:function(){document.onselectstart=function(){return ia.useTextSelection};$j("body").css("cursor","default")},showCursor:function(a){document.onselectstart=function(){return!1};
$j("body").css("cursor",a)},showMoveCursor:function(){document.onselectstart=function(){return!1};$j("body").css("cursor","move")},showPointerCursor:function(){$j("body").css("cursor","pointer")},getDataUrl:function(a,b){html2canvas(a.get(0),{onrendered:function(a){try{b.call(null,a.toDataURL("image/png"))}catch(d){b.call(null)}}})},useTextSelection:document.onselectstart,IAS_PATH:"",IS_TOUCH_DEVICE:!1,IS_IE_TEN:!1,SINGLE_MAP_REPORT:"timeseries_advanced_sm::flash::html",PYRAMID_REPORT:"timeseries_advanced_sm::flash::pyramid::html",
SPINE_REPORT:"areaprofiler::flash::html",ELECTION_REPORT:"areaprofiler::flash::election::html",DOUBLE_GEOG_REPORT:"double_timeseries_advanced_dm::flash::html",DOUBLE_BASELAYER_REPORT:"double_timeseries_advanced_dm::flash::double_base::html",DOUBLE_BASELAYER_REPORT_NEW:"double_timeseries_advanced_dm::flash::double_base_new::html",DOUBLE_PLOT_REPORT:"timeseries_advanced_dm::flash::html",BUBBLE_PLOT_REPORT:"bubbleplot::flash::html",BUBBLE_PLOT_REPORT_SINGLE:"bubbleplot::flash::html::single"};
iaAddGlobalFunctions=function(a){iaToggle=function(b){a.closePopups(b);var c=a.getWidget(b);c!=void 0?c.toggle():(c=a.getWidget(b),c!=void 0&&c.toggle())};iaShow=function(b){var c=b+"-panel";a.closePopups(c);c=a.getWidget(c);c!=void 0?c.show():(c=a.getWidget(b),c!=void 0&&c.show())};iaHide=function(b){var c=b+"-panel";a.closePopups(c);c=a.getWidget(c);c!=void 0?c.hide():(c=a.getWidget(b),c!=void 0&&c.hide())};iaResize=function(b,c,f){var g=b+"-panel";a.closePopups(g);g=a.getWidget(g);g!=void 0?g.setSize(c,
f):(g=a.getWidget(b),g!=void 0&&g.setSize(c,f))};iaTogglePopup=function(b){b.indexOf("http")==-1&&(b=ia.IAS_PATH+b);ia.IS_TOUCH_DEVICE?window.open(b,"_blank"):(iaToggle("popup"),a.getComponent("popup").setHtml(b))};iaToggleCallout=function(b,c){var f=a.getCallout(b);if(f!=void 0){if(c.originalEvent.touches){var g=c.originalEvent.changedTouches[0];f.position(g.pageX,g.pageY)}else f.position(c.pageX,c.pageY);f.toggle()}};iaToggleLegendEditor=function(a){iaToggleCallout("legend-callout",a)};iaToggleHelp=
function(){iaTogglePopup("./help.htm")};iaToggleShare=function(b){a.blockInteraction("iaShare",!0,function(){var c=ia.getUrl();$j("#ia-share-callout").val(c);c="<iframe src='"+decodeURIComponent(window.location.href)+"' style='width:800px;height:600px;border-width:0px'></iframe>";$j("#ia-embed-callout").val(c);ia.getDataUrl(a.container,function(c){c!=void 0&&(c='<div class="ia-share-text">'+a.config.getProperty("saveImageText")+'</div><a href="'+c+'" download="dashboard.png"><img class="ia-export-thumbnail" src="'+
c+'"/></a>',$j("#ia-thumbnail-callout").html(c));c=a.getCallout("shareCallout");if(b.originalEvent.changedTouches){var e=b.originalEvent.changedTouches[0];c.position(e.pageX,e.pageY)}else c.position(b.pageX,b.pageY);c.show();a.allowInteraction("iaShare")})})};var b=new ia.CalloutBox("exportCallout","top-bottom");b.popup(!0);a.addCallout(b);var c=$j("<div>");b.append(c);iaExportDataUrl=function(d,e){var f='<div class="ia-share-text">'+a.config.getProperty("saveImageText")+'</div><a href="'+d+'" download="chart.png"><img class="ia-export-thumbnail" src="'+
d+'"/></a>';c.html(f);e.originalEvent.changedTouches?(f=e.originalEvent.changedTouches[0],b.position(f.pageX,f.pageY)):b.position(e.pageX,e.pageY);b.show()};iaExportPanelWithChart=function(a,b,c,g){a.header.text().trim().length?ia.getDataUrl(a.header,function(a){var d=document.createElement("img");d.addEventListener("load",function(){var a=b.exportData(c),h=document.createElement("img");h.addEventListener("load",function(){var a=document.createElement("canvas");a.width=b.canvas.width;a.height=d.height+
b.canvas.height;a.getContext("2d").drawImage(d,0,0);a.getContext("2d").drawImage(h,0,d.height);a=a.toDataURL("image/png");iaExportDataUrl(a,g)});h.src=a});d.src=a}):(a=b.exportData(c),iaExportDataUrl(a,g))};iaExportPanel=function(a,b){a.header.text().trim().length?ia.getDataUrl(a.header,function(c){var g=document.createElement("img");g.addEventListener("load",function(){ia.getDataUrl(a.content,function(a){var c=document.createElement("img");c.addEventListener("load",function(){var a=document.createElement("canvas");
a.width=c.width;a.height=g.height+c.height;a.getContext("2d").drawImage(g,0,0);a.getContext("2d").drawImage(c,0,g.height);a=a.toDataURL("image/png");iaExportDataUrl(a,b)});c.src=a})});g.src=c}):ia.getDataUrl(a.content,function(a){iaExportDataUrl(a,b)})};iaExportCSV=function(a,e){c.html('<textarea rows="15" cols="40">'+a+"</textarea>");if(e.originalEvent.changedTouches){var f=e.originalEvent.changedTouches[0];b.position(f.pageX,f.pageY)}else b.position(e.pageX,e.pageY);b.show()};iaToggleProfileTree=
function(){a.getComponent("spineChart").toggleTree()};iaOpenPrintPreview=function(){var a=ia.getUrl();a+="&printmode=true";window.open(a,"_blank")};iacPopMetadata=function(a,b){alert(a+" "+b)}};
CanvasRenderingContext2D.prototype.dashedLine=function(a,b,c,d,e,f){e==void 0&&(e=2);f==void 0&&(f=e);this.moveTo(a,b);var g=c-a,h=d-b,i=Math.floor(Math.sqrt(g*g+h*h)/(e+f));i*=2;var e=Math.floor(Math.sqrt(g*g+h*h)/e),k=Math.floor(Math.sqrt(g*g+h*h)/f),f=g/e,e=h/e;g/=k;h/=k;for(k=0;k++<i;)k%2==0?(a+=g,b+=h,this.moveTo(a,b)):(a+=f,b+=e,this.lineTo(a,b));k%2==0?this.moveTo(c,d):this.lineTo(c,d)};
(function(){function a(a,b){return this.slice(a,b)}function b(a,b){arguments.length<2&&(b=0);for(var c=0,d=a.length;c<d;++c,++b)this[b]=a[c]&255}function c(c){var d;if(typeof c==="number"){d=Array(c);for(var g=0;g<c;++g)d[g]=0}else d=c.slice(0);d.subarray=a;d.buffer=d;d.byteLength=d.length;d.set=b;if(typeof c==="object"&&c.buffer)d.buffer=c.buffer;return d}try{new Uint8Array(1);return}catch(d){}window.Uint8Array=c;window.Uint32Array=c;window.Int32Array=c})();
(function(){"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||Object.defineProperty(XMLHttpRequest.prototype,"response",{get:function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}})})();
(function(){if(!("btoa"in window))window.btoa=function(a){var b="",c,d;c=0;for(d=a.length;c<d;c+=3){var e=a.charCodeAt(c)&255,f=a.charCodeAt(c+1)&255,g=a.charCodeAt(c+2)&255,h=(e&3)<<4|f>>4,f=c+1<d?(f&15)<<2|g>>6:64,g=c+2<d?g&63:64;b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)}return b}})();
(function(){function a(){n();j();m();iaAddGlobalFunctions(l);if(l.url.params.select!=void 0){var a=l.url.params.select.toString().split(",");l.getComponent("interactionGroup")&&l.getComponent("interactionGroup").setSelection(a)}l.url.params.select2!=void 0&&(a=l.url.params.select2.toString().split(","),l.getComponent("interactionGroup2")&&l.getComponent("interactionGroup2").setSelection(a));l.url.params.comparisonSelect!=void 0&&(a=l.url.params.comparisonSelect.toString().split(","),l.getComponent("comparisonInteractionGroup")&&
l.getComponent("comparisonInteractionGroup").setSelection(a));l.url.params.comparisonSelect2!=void 0&&(a=l.url.params.comparisonSelect2.toString().split(","),l.getComponent("comparisonInteractionGroup2")&&l.getComponent("comparisonInteractionGroup2").setSelection(a));if(l.url.params.filter!=void 0||l.url.params.filteredFeatures!=void 0)(a=l.getComponent("activeMap"))&&a.zoomToFeatures(p[0].getFilteredFeatures(),[r[0].baseLayer]);if(l.url.params.filter2!=void 0||l.url.params.filteredFeatures2!=void 0){a=
l.getComponent("activeMap2");if(l.config.template==ia.DOUBLE_BASELAYER_REPORT||l.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)a=l.getComponent("activeMap");a&&a.zoomToFeatures(p[1].getFilteredFeatures(),[r[1].baseLayer])}l.url.params.printmode&&C.loadDragScript();l.url.params.custom&&(o=onIAReportComplete);o&&o.call(null,l);l.endProgress("init")}function b(){if(l.config.getProperty("isResponsive")!=void 0){var a=l.config.getProperty("isResponsive"),b=l.config.getProperty("flowLayoutMaxWidth"),
c=l.config.getProperty("flowLayoutIncludeImages");l.setResponsive(a,b,c)}}function c(a,b){if(a.onSuccess)o=a.onSuccess;if(a.onFail)ia.File.errorHandler=a.onFail;i(a.params);if(a.data){var c=a.data.config;if(c)if(c.source)t=c.source;else if(c.xml)s=c.xml;if(c=a.data.attribute)if(c.source)u=c.source;else if(c.json)v=c.json;if(c=a.data.model)l.data.model=c;if(c=a.data.map)if(c.source)w=c.source;else if(c.json)x=c.json;if(c=a.data.style)if(c.source)y=c.source;else if(c.text)B=c.text}l.url.params.dataPath!=
void 0&&(u!=void 0&&(u=l.url.params.dataPath+u),w!=void 0&&(w=l.url.params.dataPath+w));l.url.params.config!=void 0&&(t=l.url.params.config+".xml");l.url.params.data!=void 0&&(u=l.url.params.dataPath+l.url.params.data+".js");l.url.params.map!=void 0&&(w=l.url.params.dataPath+l.url.params.map+".js");ia.log("-----------------------------------");ia.log("CONFIG SOURCE : "+t);ia.log("  DATA SOURCE : "+u);ia.log("   MAP SOURCE : "+w);ia.log("-----------------------------------");ia.log("   CONFIG XML : "+
s);ia.log("    DATA JSON : "+v);ia.log("    MAP JSON  : "+x);ia.log("-----------------------------------");y?ia.loadCssfile(y,function(){b.call(null)}):B?ia.appendCss(B,function(){b.call(null)}):b.call(null)}function d(a){v?l.data.parseData(v,a):u?l.data.loadSource(u,a):a.call(null)}function e(a,b){x?a.parseData(x,b):w?a.loadSource(w,b):b.call(null)}function f(a){function b(){l.url.params.loadAllData=l.config.getComponent("featureCard")!=void 0||l.config.getComponent("pyramidChart")!=void 0||l.config.getComponent("spineChart")!=
void 0||l.config.getComponent("radarChart")!=void 0||l.config.getComponent("featureCard2")!=void 0||l.config.getComponent("pyramidChart2")!=void 0||l.config.getComponent("spineChart2")!=void 0||l.config.getComponent("radarChart2")!=void 0?!0:!1;if(l.data.model!=void 0){if(l.data.loadByIndicator=!0,l.config.getComponent("areaBreakdownBarChart")!=void 0||l.config.getComponent("areaBreakdownPieChart")!=void 0||l.config.getComponent("areaBreakdownBarChart2")!=void 0||l.config.getComponent("areaBreakdownPieChart2")!=
void 0)l.data.loadByIndicator=!1}else l.data.loadByIndicator=!1;l.locale=new ia.Locale(l.config.getProperty("locale"));l.locale.formatter.noDataValue=l.config.getProperty("noDataValue");l.data.formatter=l.locale.formatter;var c=l.config.getProperty("ndecimal");l.data.precision=c>-1?c:void 0;l.data.setProperty(l.config.getProperty("customBreaksKey"),l.config.getProperty("legendBreaks"));l.data.setProperty(l.config.getProperty("customLabelsKey"),l.config.getProperty("legendLabels"));l.data.setProperty(l.config.getProperty("customBreaksKey2"),
l.config.getProperty("legendBreaks2"));l.data.setProperty(l.config.getProperty("customLabelsKey2"),l.config.getProperty("legendLabels2"));a.call(null)}s?l.config.parseXML(s,b):t?l.config.loadSource(t,b):a.call(null)}function g(a){p=[];r=[];var b=l.config.getProperty("selectionMode"),c,d=new ia.MapData(l);r[r.length]=d;var f=l.config.getComponent("map");if(f!=void 0)d.tilePath=f.getProperty("backgroundMappingPath");e(d,function(){var f=new ia.InteractionGroup;if(b)f.selectionMode=b;var g=new ia.InteractionGroup,
h=new ia.DataGroup(l,"");h.mapData=d;p[p.length]=h;l.addComponent("dataGroup",h);l.template=d.template;l.version=d.version;l.evaluation=d.baseLayers[0].eval;l.uid=d.baseLayers[0].uid;h.build(function(){if(l.config.template==ia.SINGLE_MAP_REPORT||l.config.template==ia.PYRAMID_REPORT||l.config.template==ia.SPINE_REPORT||l.config.template==ia.ELECTION_REPORT){var i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g}];c=new ia.ComponentFactory(l.config,l,i);l.addComponent("factory",c);c.buildComponents(function(){a!=
void 0&&a.call(null)})}else if(l.config.template==ia.BUBBLE_PLOT_REPORT_SINGLE)i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(l.config,l,i),l.addComponent("factory",c),c.buildComponents(function(){a!=void 0&&a.call(null)});else{var j=new ia.MapData(l);r[r.length]=j;i=l.config.getComponent("map2");
if(i!=void 0)j.tilePath=i.getProperty("backgroundMappingPath");e(j,function(){var e=new ia.DataGroup(l,"2");e.mapData=j;p[p.length]=e;l.addComponent("dataGroup2",e);e.build(function(){if(l.config.template==ia.DOUBLE_GEOG_REPORT){var i=new ia.InteractionGroup;if(b)i.selectionMode=b;var j=new ia.InteractionGroup,m=l.config.getComponent("dataExplorer2");m==void 0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){if(e.geography.getIndicator(h.indicator.id)==void 0){var a=e.geography.getIndicatorByName(h.indicator.name,
h.indicator.date);a!=void 0&&e.setData(e.geography.id,a.id,a.date)}else e.setData(e.geography.id,h.indicator.id,h.indicator.date)});m=l.config.getComponent("filterExplorer2");m==void 0&&h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){a.filterId!=""?e.setFilter(a.filterId,a.filterValue):e.clearFilter()});i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:e,interactionGroup:i,comparisonInteractionGroup:j}];c=new ia.ComponentFactory(l.config,l,i);l.addComponent("factory",
c);c.buildComponents(function(){var b=l.config.getComponent("map");b&&b.getProperty("syncMaps")&&k();a!=void 0&&a.call(null)})}else if(l.config.template==ia.DOUBLE_PLOT_REPORT)h.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){e.setData(a.geography.id,e.indicator.id,e.indicator.date)}),h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){e.setFilteredFeatures(a.filterFeatures)}),(i=l.config.getComponent("dataExplorer"))&&i.getProperty("syncDates")==!0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,
function(a){e.setData(a.geography.id,e.indicator.id,h.indicator.date)}),i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:e,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(l.config,l,i),l.addComponent("factory",c),c.buildComponents(function(){var b=l.config.getComponent("map");b&&b.getProperty("syncMaps")&&k();a!=void 0&&a.call(null)});else if(l.config.template==ia.BUBBLE_PLOT_REPORT){var n=new ia.DataGroup(l,"3");n.mapData=d;p[p.length]=n;l.addComponent("dataGroup3",
n);n.build(function(){var b=new ia.DataGroup(l,"4");b.mapData=d;p[p.length]=b;l.addComponent("dataGroup4",b);b.build(function(){h.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){var c=a.geography.id;e.setData(c,e.indicator.id,e.indicator.date,function(){n.setData(c,n.indicator.id,n.indicator.date,function(){b.setData(c,b.indicator.id,b.indicator.date,function(){})})})});h.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){e.setFilteredFeatures(a.filterFeatures);n.setFilteredFeatures(a.filterFeatures);
b.setFilteredFeatures(a.filterFeatures)});var d=l.config.getComponent("dataExplorer");d&&d.getProperty("syncDates")==!0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(a){e.setData(a.geography.id,e.indicator.id,h.indicator.date);n.setData(a.geography.id,n.indicator.id,h.indicator.date);b.setData(a.geography.id,b.indicator.id,h.indicator.date)});c=new ia.ComponentFactory(l.config,l,[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:e,interactionGroup:f,comparisonInteractionGroup:g},
{dataGroup:n,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:b,interactionGroup:f,comparisonInteractionGroup:g}]);l.addComponent("factory",c);c.buildComponents(function(){a!=void 0&&a.call(null)})})})}else if(l.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){e.setData(e.geography.id,h.indicator.id,h.indicator.date)}),e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){var a=l.getComponent("map");a&&a.render()}),h.addEventListener(ia.FilterEvent.FILTER_CHANGED,
function(a){e.setFilteredFeatures(a.filterFeatures)}),i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:e,interactionGroup:f,comparisonInteractionGroup:g}],c=new ia.ComponentFactory(l.config,l,i),l.addComponent("factory",c),c.buildComponents(function(){var b=l.getComponent("map");b&&b.render();a!=void 0&&a.call(null)});else if(l.config.template==ia.DOUBLE_BASELAYER_REPORT){i=new ia.InteractionGroup;if(b)i.selectionMode=b;j=new ia.InteractionGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,
function(){var a=l.getComponent("map");a&&a.render()});m=l.config.getComponent("dataExplorer2");m==void 0&&h.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(){if(e.geography.getIndicator(h.indicator.id)==void 0){var a=e.geography.getIndicatorByName(h.indicator.name,h.indicator.date);a!=void 0&&e.setData(e.geography.id,a.id,a.date)}else e.setData(e.geography.id,h.indicator.id,h.indicator.date)});m=l.config.getComponent("filterExplorer2");m==void 0&&h.addEventListener(ia.FilterEvent.FILTER_CHANGED,
function(a){a.filterId!=""?e.setFilter(a.filterId,a.filterValue):e.clearFilter()});i=[{dataGroup:h,interactionGroup:f,comparisonInteractionGroup:g},{dataGroup:e,interactionGroup:i,comparisonInteractionGroup:j}];c=new ia.ComponentFactory(l.config,l,i);l.addComponent("factory",c);c.buildComponents(function(){var b=l.getComponent("map");b&&b.render();a!=void 0&&a.call(null)})}})})}})})}function h(a){function b(){if(c==p.length)a!=void 0&&a.call(null);else{var d=p[c];c++;d.update(b)}}var c=0;b()}function i(a){l.url=
new ia.UrlParams(window.location.href);if(a){for(var b in a)!l.url.params[b]&&b!="errorHandler"&&b!="style"&&b!="printmode"&&(l.url.params[b]=a[b]);if(l.url.params.config)ia.IAS_PATH=ia.File.getFileDirectory(l.url.params.config)}l.url.params.dataPath=l.url.params.dataPath||"";l.url.params.style&&ia.loadCssfile(l.url.params.style+".css");l.url.params.custom=l.url.params.custom||"";if(l.url.params.custom)a=document.createElement("script"),a.type="text/javascript",a.src=l.url.params.custom+".js",document.body.appendChild(a);
l.url.params.printmode&&(l.container.addClass("ia-report-printmode"),C=new ia.PrintBar(l),C.render(),$j("body").prepend(C.container))}function k(){var a=l.getComponent("gMap"),b=l.getComponent("gMap2");if(a&&b){var c=!1,d=!1;google.maps.event.addListener(a.gMap,"bounds_changed",function(){d==!1&&(c=!0,b.gMap.setZoom(a.gMap.getZoom()),b.gMap.setCenter(a.gMap.getCenter()))});google.maps.event.addListener(a.gMap,"idle",function(){c=!1});google.maps.event.addListener(b.gMap,"bounds_changed",function(){c==
!1&&(d=!0,a.gMap.setZoom(b.gMap.getZoom()),a.gMap.setCenter(b.gMap.getCenter()))});google.maps.event.addListener(b.gMap,"idle",function(){d=!1})}else if(a=l.getComponent("map"),b=l.getComponent("map2"),a&&b){var e=!1,f=function(a){e==!1&&(e=!0,b.controller.zoomToBBox(a.bBox),e=!1)};a.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,f);a.addEventListener(ia.BBoxEvent.BBOX_SCALE,f);f=function(b){e==!1&&(e=!0,a.controller.zoomToBBox(b.bBox),e=!1)};b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,f);b.addEventListener(ia.BBoxEvent.BBOX_SCALE,
f)}}function j(){var a=new ia.CalloutBox("shareCallout","top-bottom");a.popup(!0);l.addCallout(a);var b=$j("<div></div>");a.container.append(b);a=$j('<div id="ia-thumbnail-callout"></div>');b.append(a);a=$j('<div class="ia-share-text"></div>').html(l.config.getProperty("emailReportText"));b.append(a);a=$j('<input id="ia-share-callout" type="text" style="width:100%" class="ia-input" value="'+document.URL+'"/>');b.append(a);a.bind("click",function(a){a.stopPropagation();this.select()});a=$j('<div class="ia-share-text"></div>').html(l.config.getProperty("embedReportText"));
b.append(a);a=$j('<input id="ia-embed-callout" type="text" style="width:100%" class="ia-input" value="'+("<iframe src='"+document.URL+"' style='width:800px;height:600px;border-width:0px'></iframe>")+'"/>');b.append(a);a.bind("click",function(a){a.stopPropagation();this.select()})}function m(){var a=new ia.Panel("popup");a.setDimensions(15,15,70,70);a.closeable(!0);a.popup(!0);a.resizeable(!0);a.zIndex(300);l.addPanel(a);var b=new ia.HTMLContainer("popup");a.append(b.container);l.addComponent("popup",
b)}function n(){$j("body").keydown(function(a){a.which==73&&a.ctrlKey==!0&&(a="About This InstantAtlas Report",a+="\n___________________________________________________________\n",a+="\nTemplate",a+="\n",a+="\nName: "+l.template,a+="\nVersion: "+l.version,a+="\nEvaluation: "+l.evaluation,a+="\nUID: "+l.uid,a+="\n___________________________________________________________\n",a+="\nConfig",a+="\n",a+="\nName: "+l.config.name,a+="\nVersion: "+l.config.version,a+="\nId: "+l.config.template,alert(a))})}
var l,o,q,p=[],r=[],t,s,u,v,w,x,y,B,C;ia.init=function(e,h,i){if(h!=void 0&&(e={container:e,onSuccess:h,data:{config:{source:"./config.xml"},attribute:{source:"./data.js"},map:{source:"./map.js"}}},i!=void 0))e.params=i;l=new ia.Report($j("#"+e.container));l.startProgress("init",function(){l.data=new ia.ReportData;q=new ia.TextSubstitution;if(BrowserDetect.browser=="Explorer"&&BrowserDetect.version=="10")ia.IS_IE_TEN=!0;if(ia.isTouchDevice())ia.IS_TOUCH_DEVICE=!0;$j.support.cors=!0;c(e,function(){f(function(){for(var c in l.url.params){if(c.indexOf("prop_")==
0){var f=c.split("_")[1],h=l.url.params[c];l.config.setProperty(f,h,!0)}if(c.indexOf("comp_")==0){var i=c.split("_")[1],f=c.split("_")[2],h=l.url.params[c],i=l.config.getComponent(i);i!=void 0&&(i.setProperty(f,h,!0),i[f]=h)}c.indexOf("pal_")==0&&(i=l.config.getMapPalette(),f=c.split("_")[1],h=l.url.params[c],i[f]=h)}e.data.attribute==void 0?l.build(function(){a()}):d(function(){l.build(function(){g(function(){b();a()})})})})})})};ia.loadStyle=function(a,b){l.startProgress("loadStyle",function(){l.url.params.style=
a.substring(0,a.lastIndexOf("."));ia.loadCssfile(a,function(){l.endProgress("loadStyle");b!=void 0&&b.call(null)})})};ia.loadConfig=function(a,c){l.startProgress("loadConfig",function(){l.url.params={};l.url.params.config=a.substring(0,a.lastIndexOf("."));t=a;s=void 0;f(function(){l.data.refresh(function(){l.build(function(){g(function(){b();j();m();l.endProgress("loadConfig");c!=void 0&&c.call(null)})})})})})};ia.parseConfig=function(a,c){l.startProgress("parseConfig",function(){l.url.params={};
t=void 0;s=a;f(function(){l.data.refresh(function(){l.build(function(){g(function(){b();j();m();l.endProgress("parseConfig");c!=void 0&&c.call(null)})})})})})};ia.loadData=function(a,b){l.startProgress("loadData",function(){l.url.params.data=a.substring(0,a.lastIndexOf("."));u=a;v=void 0;d(function(){h(function(){l.endProgress("loadData");b!=void 0&&b.call(null)})})})};ia.parseData=function(a,b){l.startProgress("parseData",function(){u=void 0;v=a;d(function(){h(function(){l.endProgress("parseData");
b!=void 0&&b.call(null)})})})};ia.loadMap=function(a,b){l.startProgress("loadMap",function(){function c(){if(d==r.length)h(function(){l.endProgress("loadMap");b!=void 0&&b.call(null)});else{var a=r[d];d++;e(a,c)}}l.url.params.map=a.substring(0,a.lastIndexOf("."));w=a;x=void 0;var d=0;c()})};ia.parseMap=function(a,b){l.startProgress("parseMap",function(){function c(){if(d==r.length)h(function(){l.endProgress("parseMap");b!=void 0&&b.call(null)});else{var a=r[d];d++;e(a,c)}}w=void 0;x=a;var d=0;c()})};
ia.update=function(a,e){l.startProgress("update",function(){c(a,function(){f(function(){d(function(){l.build(function(){g(function(){b();j();m();l.endProgress("update");e!=void 0&&e.call(null)})})})})})})};ia.load=function(a,b,c){l.startProgress("load",function(){l.url.params.data=a.substring(0,a.lastIndexOf("."));l.data.loadSource(a,function(){ia.loadMap(b,function(){l.endProgress("load");c!=void 0&&c.call(null)})})})};ia.parse=function(a,b,c){l.startProgress("parse",function(){l.data.parseData(a,
function(){ia.parseMap(b,function(){l.endProgress("parse");c!=void 0&&c.call(null)})})})};ia.tipFunction=function(a,b,c){q.clearVariables();var d=l.config.getComponent(b).getProperty("tip");c&&(d=l.config.getComponent(b).getProperty("tip"+c));for(var b=a.name,c="",e=0;e<p.length;e++){var f=p[e],g=f.indicator,h=f.theme;e!=0&&(c=e+1);q.setVariable("featureName"+c,b);if(f=f.geography.getFeature(a.id)){q.setVariable("feature-id",f.id);q.setVariable("feature-name",f.name);q.setVariable("feature-href",
f.href);var f=f.getProperties(),i;for(i in f)q.setVariable(i+c,f[i]),q.setVariable(i+"-value",f[i])}q.setVariable("theme-name"+c,h.name);q.setVariable("themeName"+c,h.name);h=g.getFormattedValue(a.id);q.setVariable("indicatorValue"+c,h);q.setVariable("indicator-id"+c,g.id);q.setVariable("indicator-name"+c,g.name);q.setVariable("indicatorName"+c,g.name);q.setVariable("indicator-type"+c,g.type);q.setVariable("indicator-href"+c,g.href);q.setVariable("indicator-value"+c,g.getValue(a.id));q.setVariable("indicator-formatted-value"+
c,h);q.setVariable("indicator-date"+c,g.date);q.setVariable("date"+c,g.date);f=g.getProperties();for(i in f)q.setVariable(i+c,f[i]),q.setVariable(i+"-value"+c,f[i]);for(var h=g.getAssociates(),f=h.length,j=0;j<f;j++){var k=h[j];q.setVariable(k.name+""+c,k.getFormattedValue(a.id));q.setVariable(k.name+"-value"+c,k.getValue(a.id));q.setVariable(k.name+"-formatted-value"+c,k.getFormattedValue(a.id));q.setVariable(k.name+"-type"+c,k.type)}h=g.getLowerLimits();g=g.getUpperLimits();h&&g?(q.setVariable("lowerLimit"+
c,h.getFormattedValue(a.id)),q.setVariable("upperLimit"+c,g.getFormattedValue(a.id))):(q.setVariable("lowerLimit"+c,""),q.setVariable("upperLimit"+c,""))}return q.formatMessage(d)};ia.initGoogleMaps=function(){ia.googleMapsLoaded=!0;r[0].loadVisibleLayers()};ia.googleMapsLoaded=!1;ia.getUrl=function(){return l.url.getReportUrl()};ia.toggleCallout=function(a,b){var c=l.getCallout(a);if(c!=void 0){if(b.originalEvent.touches){var d=b.originalEvent.changedTouches[0];c.position(d.pageX,d.pageY)}else c.position(b.pageX,
b.pageY);c.toggle()}}})();ia.EventDispatcher=function(){this._objs=[];this._eventListeners=[];this._eventTypes=[]};ia.EventDispatcher.prototype.addEventListener=function(a,b,c){this._objs.push(c);this._eventTypes.push(a);this._eventListeners.push(b)};ia.EventDispatcher.prototype.removeListener=function(a){for(var b=this._objs.length;b--;)this._objs[b]==a&&(this._objs.splice(b,1),this._eventTypes.splice(b,1),this._eventListeners.splice(b,1))};
ia.EventDispatcher.prototype.dispatchEvent=function(a){for(var b=this._eventListeners.concat(),c=this._eventTypes.concat(),d=0;d<b.length;d++)c[d]==a.type&&b[d].call(null,a)};ia.Event=function(a,b){this.type=a;this.object=b};ia.Event.MAP_READY="mapReady";ia.Event.MAP_RESIZE="mapResize";ia.Event.LAYER_READY="layerReady";ia.Event.LAYER_VISIBLE_CHANGED="layerVisibleChanged";ia.Event.THEME_CHANGED="themeChanged";ia.Event.THEMATIC_CHANGED="thematicChanged";ia.Event.CLEAR_SELECTION="clearSelection";
ia.MouseEvent=function(a,b,c,d,e){ia.MouseEvent.baseConstructor.call(this,b,e);this.x=c;this.y=d;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey;this.mouseEvent=a;a=window.event||a;this.delta=a.detail?a.detail*-120:a.wheelDelta};ia.extend(ia.Event,ia.MouseEvent);
ia.Report=function(a){ia.Report.baseConstructor.call(this);this._widgetArray=[];this._widgetHash={};this._panelArray=[];this._panelHash={};this._buttonArray=[];this._buttonHash={};this._textArray=[];this._textHash={};this._imageArray=[];this._imageHash={};this._calloutArray=[];this._calloutHash={};this._componentArray=[];this._componentHash={};this._isFlowLayout=!1;this.selectionColor="#ff0000";this.highlightColor="#00ff00";this.highlightOpacity=this.selectionOpacity=0.3;this.uid="";this.evaluation=
!0;this.config=new ia.ReportConfig;this.textSubstitution=new ia.TextSubstitution;this.container=$j('<div id="ia-report" class="ia-report">');a.append(this.container);this.$busyContainer=$j('<div class="ia-report-busy">');this.$busyContainer.bind("click",function(){event.stopPropagation()});this.$busyContainer.bind("touchstart touchmove touchend mousemove mouseup mouseenter mouseleave mousedown click",function(a){a.stopPropagation()});a.append(this.$busyContainer);$j("#ia-report-progress").length?
this.$progressContainer=$j("#ia-report-progress"):(this.$progressContainer=$j('<div class="ia-report-loading">'),a.append(this.$progressContainer));this.$progressContainer.bind("click",function(){event.stopPropagation()});this.$progressContainer.bind("touchstart touchmove touchend mousemove mouseup mouseenter mouseleave mousedown click",function(a){a.stopPropagation()});this._responsiveMenu=new ia.ResponsiveMenu};ia.extend(ia.EventDispatcher,ia.Report);this.evaluation=!0;
ia.Report.prototype.addComponent=function(a,b){this._componentHash[a]=b;this._componentArray[this._componentArray.length]=b};ia.Report.prototype.getComponents=function(){return this._componentArray};ia.Report.prototype.getComponent=function(a){return this._componentHash[a]};ia.Report.prototype.addCallout=function(a){this._calloutArray[this._calloutArray.length]=a;this._calloutHash[a.id]=a;this.container.append(a.container)};ia.Report.prototype.getCallouts=function(){return this._calloutArray};
ia.Report.prototype.getCallout=function(a){return this._calloutHash[a]};ia.Report.prototype.addWidget=function(a,b){this._widgetArray[this._widgetArray.length]=a;this._widgetHash[a.id]=a;this.container.append(a.container);b!=void 0&&(b.id.indexOf("filterButton")!=-1||b.id.indexOf("geographyButton")!=-1?a.container.css("visibility","hidden"):a.visible(b.visible),a.update(b))};
ia.Report.prototype.removeWidget=function(a){var b=this.getWidget(a);if(b!=void 0){b.container.remove();delete this._widgetHash[a];delete this._panelHash[a];delete this._textHash[a];delete this._buttonHash[a];delete this._imageHash[a];delete this._componentHash[a];for(var c=0;c<this._widgetArray.length;c++)if(b=this._widgetArray[c],b.id==a){this._widgetArray.splice(c,1);break}for(c=0;c<this._panelArray.length;c++)if(b=this._panelArray[c],b.id==a){this._panelArray.splice(c,1);break}for(c=0;c<this._textArray.length;c++)if(b=
this._textArray[c],b.id==a){this._textArray.splice(c,1);break}for(c=0;c<this._buttonArray.length;c++)if(b=this._buttonArray[c],b.id==a){this._buttonArray.splice(c,1);break}for(c=0;c<this._imageArray.length;c++)if(b=this._imageArray[c],b.id==a){this._imageArray.splice(c,1);break}for(c=0;c<this._componentArray.length;c++)if(b=this._componentArray[c],b.id==a){this._componentArray.splice(c,1);break}}};ia.Report.prototype.getWidgets=function(){return this._widgetArray};
ia.Report.prototype.getWidget=function(a){a=a.replace("-panel","");return this._widgetHash[a]};ia.Report.prototype.removeWidgets=function(){for(var a=0;a<this._widgetArray.length;a++)this._widgetArray[a].container.remove();this._panelArray=[];this._panelHash={};this._textArray=[];this._textHash={};this._imageArray=[];this._imageHash={};this._buttonArray=[];this._buttonHash={};this._widgetArray=[];this._widgetHash={};this._componentArray=[];this._componentHash={}};
ia.Report.prototype.addPanel=function(a,b){this._panelArray[this._panelArray.length]=a;this._panelHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getPanels=function(){return this._panelArray};ia.Report.prototype.getPanel=function(a){a=a.replace("-panel","");return this._panelHash[a]};ia.Report.prototype.addButton=function(a,b){this._buttonArray[this._buttonArray.length]=a;this._buttonHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getButtons=function(){return this._buttonArray};
ia.Report.prototype.getButton=function(a){return this._buttonHash[a]};ia.Report.prototype.addText=function(a,b){this._textArray[this._textArray.length]=a;this._textHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getTexts=function(){return this._textArray};ia.Report.prototype.getText=function(a){return this._textHash[a]};ia.Report.prototype.addImage=function(a,b){this._imageArray[this._imageArray.length]=a;this._imageHash[a.id]=a;this.addWidget(a,b)};ia.Report.prototype.getImages=function(){return this._imageArray};
ia.Report.prototype.getImage=function(a){return this._imageHash[a]};ia.Report.prototype.reset=function(){for(var a=0;a<this._widgetArray.length;a++){var b=this._widgetArray[a],c=this.config.getWidget(b.id);c!=void 0&&b.update(c)}this.updateDynamicText(this.textSubstitution)};
ia.Report.prototype.build=function(a){this.removeWidgets();var b=$j('<div class="ia-highlight-color ia-map-highlight-opacity">');this.container.append(b);var c=$j('<div class="ia-selection-color ia-map-selection-opacity">');this.container.append(c);this.highlightColor=ia.Color.toHex(b.css("color"));this.selectionColor=ia.Color.toHex(c.css("color"));this.highlightOpacity=b.css("opacity");this.selectionOpacity=c.css("opacity");b.remove();c.remove();b=this.config.getWidgets();c=$j('<div class="ia-panel">');
this.container.append(c);for(var d=0;d<b.length;d++){var e=b[d],f;if(e.type=="component"||e.type=="table")f=new ia.Panel(e.id),this.addPanel(f,e);else if(e.type=="button")f=new ia.Button(e.id),this.addButton(f,e);else if(e.type=="text")f=new ia.Text(e.id),this.addText(f,e);else if(e.type=="image"||e.type=="img")f=new ia.Image(e.id,e.src),this.addImage(f,e)}c.remove();a!=null&&a.call(null,this)};
ia.Report.prototype.updateDynamicText=function(a){for(var b=this.config.getComponents(),c=0;c<b.length;c++){var d=b[c],e=a.formatMessage(d.getProperty("title"));this.getWidget(d.id).title(e)}b=this.config.getTexts().concat(this.config.getButtons());for(c=0;c<b.length;c++)d=b[c],e=a.formatMessage(d.text),this.getWidget(d.id).text(e)};ia.Report.prototype._progressIds=[];
ia.Report.prototype.startProgress=function(a,b){this.$progressContainer.css("display","inline");ia.showWaitCursor();setTimeout(function(){b.call(null)},100)};ia.Report.prototype.endProgress=function(){this.$progressContainer.css("display","none");ia.showDefaultCursor()};ia.Report.prototype._blockIds=[];ia.Report.prototype.blockInteraction=function(a,b,c){this.$busyContainer.css("display","inline");b&&ia.showWaitCursor();setTimeout(function(){c.call(null)},100)};
ia.Report.prototype.allowInteraction=function(){this.$busyContainer.css("display","none");ia.showDefaultCursor()};
ia.Report.prototype.displayEvaluationMessage=function(a){var b="This report was prepared using an InstantAtlas&#153 evaluation license. It is not licensed for distribution or publication of any kind. For more information contact <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a>, or visit <a href='http://www.instantatlas.com/' target='_blank'>http://www.instantatlas.com/</a>.",c="Evaluation";this.locale&&(this.locale.getLanguage()=="de"?b="Dieser Bericht wurde mit einer InstantAtlas&#153 Testlizenz erstellt. Er ist nicht zur Verbreitung oder Ver\u00f6ffentlichung jeglicher Art lizensiert. F\u00fcr weitere Informationen kontaktieren Sie bitte <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> oder besuchen Sie <a href='http://www.instantatlas.com/de/' target='_blank'>http://www.instantatlas.com/</a>.":
this.locale.getLanguage()=="fr"?b="Ce rapport a \u00e9t\u00e9 cr\u00e9e avec une licence d\u2019\u00e9valuation. Cette licence ne permet pas la distribution ou la publication du rapport. Pour plus de renseignements veuillez contacter <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> ou consulter <a href='http://www.instantatlas.com/fr/' target='_blank'>http://www.instantatlas.com</a>.":this.locale.getLanguage()=="es"&&(b="Este informe ha sido generado con una licencia de evaluaci\u00f3n. La distribuci\u00f3n o publicaci\u00f3n del informe est\u00e1 prohibida. Para m\u00e1s informaci\u00f3n mande un email a <a href='mailto:support@geowise.co.uk'>support@geowise.co.uk</a> o consulte <a href='http://www.instantatlas.com/es/' target='_blank'>http://www.instantatlas.com</a>.",
c="Evaluaci\u00f3n"));var d=$j("<div>");d.css({position:"absolute",left:"5px",bottom:"5px","border-color":"#DCDCDC","border-width":"1px","border-style":"solid","background-color":"#f9f9f9","border-radius":"4px",padding:"5px","text-align":"right"});c=$j("<div>").text(c);c.css({"font-family":"Arial Black","font-size":"30px",color:"#bbbbbb"});var e=$j("<a href='http://www.instantatlas.com/' target='_blank'>").text("http://www.instantatlas.com");this.locale&&(this.locale.getLanguage()=="de"?e=$j("<a href='http://www.instantatlas.com/de/' target='_blank'>").text("http://www.instantatlas.com"):
this.locale.getLanguage()=="fr"?e=$j("<a href='http://www.instantatlas.com/fr/' target='_blank'>").text("http://www.instantatlas.com"):this.locale.getLanguage()=="es"&&(e=$j("<a href='http://www.instantatlas.com/es/' target='_blank'>").text("http://www.instantatlas.com")));e.css({"font-family":"Verdana","font-size":"11px",color:"#888888"});var f=$j("<div>").html(b);f.css({position:"absolute",left:"30%",top:"40%",width:"40%","border-color":"#DCDCDC","border-width":"1px","border-style":"solid","background-color":"#f9f9f9",
"border-radius":"5px",padding:"10px","z-index":999999});$j("body").bind("click",function(){f.hide()});a.append(d);d.append(c);d.append(e);this.container.append(f)};ia.Report.prototype.closePopups=function(a){for(var b=this.getPanels(),c=0;c<b.length;c++){var d=b[c];d.popup()&&d.id!=a&&d.hide()}b=this.getCallouts();for(c=0;c<b.length;c++)d=b[c],d.id!=a&&d.hide()};
ia.Report.prototype.setResponsive=function(a,b,c){this.container.removeClass("ia-flow-report-remove-scrollbars");$j(window).off(".responseEvents");this._isFlowLayout=!1;this._setNormalLayout();if(a){this.container.addClass("ia-flow-report-remove-scrollbars");var d=this,e;$j(window).on("resize.responseEvents",function(){clearTimeout(e);e=setTimeout(function(){d._positionFixedElements();d._updateLayout(b,c)},250)});$j(window).on("scroll.responseEvents",function(){$j(".ia-flow-menu").css("display","none");
clearTimeout(e);e=setTimeout(function(){d._positionFixedElements()},250)});this.container.on("scroll.responseEvents",function(){$j(".ia-flow-menu").css("display","none");clearTimeout(e);e=setTimeout(function(){d._positionFixedElements()},250)});this._updateLayout(b,c);d._positionFixedElements()}};
ia.Report.prototype._positionFixedElements=function(){if(this._isFlowLayout){var a=$j(window).scrollTop(),b=this.container.scrollTop();a+=b;$j(".ia-flow-menu").css("top",a+"px");$j(".ia-flow-menu").css("display","")}};ia.Report.prototype._updateLayout=function(a,b){if(this.container.width()<a){if(!this._isFlowLayout)this._setFlowLayout(b),this._isFlowLayout=!0}else if(this._isFlowLayout)this._setNormalLayout(),this._isFlowLayout=!1};
ia.Report.prototype._setFlowLayout=function(a){this._responsiveMenu.render(this);$j(".ia-flow-panel-container").remove();$j(".ia-flow-image-container").remove();var b=["dataExplorer","filterExplorer","geogExplorer","map","timeControl","legend","featureCard","scatterPlot","spineChart","radarChart","profileLegend","pyramidChart","pyramidLegend","barChart","boxAndWhisker","pieChart","timeSeries","discreteTimeSeries","stackedFeaturesTimeSeries","areaBreakdownBarChart","featureLegend","areaBreakdownPieChart",
"areaBreakdownPieLegend","stackedBarChart","stackedTimeSeries","stackedLegend","table","comparisonTable","statsbox","metadata"];this.container.addClass("ia-flow-report");this.container.append(this._responsiveMenu.container);$j(".ia-panel-btns").css({display:"none"});var c=this.getWidget("menuBar");c&&c.hide();for(var c=this.getTexts().concat(this.getButtons()),d=0;d<c.length;d++){var e=c[d];e.container.detach()}for(var f=[],c=this.getImages(),d=0;d<c.length;d++)if(e=c[d],a){var g=this.config.getWidget(e.id);
e.rescale=!1;e.setSize(g.getAttribute("width"),g.getAttribute("height"));g=$j('<div class="ia-flow-image-container" data-index="-1">');f.push(g);e.container.css({position:"static","max-width":"100%"}).appendTo(g)}else e.container.detach();c=this.getPanels();for(d=0;d<c.length;d++)if(e=c[d],e.popup())e.container.appendTo(this.container).css({left:"10%",width:"80%",height:"80%","min-height":"200px","max-height":"400px"});else if(e.visible()){g=e.id.replace(/[0-9]/g,"");a=e.id.slice(-1);g=b.indexOf(g);
if(g==-1)g=b.length;ia.isNumber(a)&&(g+=a*100);g=$j('<div class="ia-flow-panel-container" data-index="'+g+'">');f.push(g);e.container.css({position:"relative",left:0,width:""}).addClass("ia-flow-panel").appendTo(g)}f.sort(function(a,b){var c=a.data("index"),d=b.data("index");return c<d?-1:c>d?1:0});for(d=0;d<f.length;d++)f[d].appendTo(this.container);this.dispatchEvent(new ia.Event(ia.Event.FLOW_LAYOUT,this))};
ia.Report.prototype._setNormalLayout=function(){this.container.removeClass("ia-flow-report");$j(".ia-panel-btns").css({display:""});this._responsiveMenu.container.detach();for(var a=this.getWidgets(),b=0;b<a.length;b++)a[b].container.appendTo(this.container).css({position:"",top:"","min-height":"","max-height":"","max-width":""}).removeClass("ia-flow-panel");this.reset();$j(".ia-flow-panel-container").remove();$j(".ia-flow-image-container").remove();this.dispatchEvent(new ia.Event(ia.Event.NORMAL_LAYOUT,
this))};ia.Event.FLOW_LAYOUT="flowLayout";ia.Event.NORMAL_LAYOUT="normalLayout";ia.InteractionEvent=function(a,b,c){ia.InteractionEvent.baseConstructor.call(this,a,b);this.ids=c||[]};ia.extend(ia.Event,ia.InteractionEvent);ia.InteractionEvent.SELECTION_CHANGED="selectionChanged";ia.InteractionEvent.HIGHLIGHT_CHANGED="highlightChanged";
ia.InteractionGroup=function(){ia.InteractionGroup.baseConstructor.call(this);this._selection=[];this._highlight="";this._components=[];this._legendComponents=[];this.selectionMode="multiple"};ia.extend(ia.EventDispatcher,ia.InteractionGroup);ia.InteractionGroup.prototype.getComponents=function(){return this._components.concat(this._legendComponents)};
ia.InteractionGroup.prototype.addComponent=function(a){function b(a){this.dispatchEvent(a)}a.isLegendComponent?this._legendComponents.push(a):this._components.push(a);a.addEventListener(ia.ItemEvent.ITEM_MOUSE_OVER,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_OUT,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_UP,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_CLICK,this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.NONE_ITEM_CLICK,
this._itemEventHandler.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_DOWN,b.bind(this));a.addEventListener(ia.ItemEvent.ITEM_MOUSE_MOVE,b.bind(this))};ia.InteractionGroup.prototype.removeComponent=function(a){var b=this._components.indexOf(a);b!=-1&&this._components.splice(b,1);b=this._legendComponents.indexOf(a);b!=-1&&this._legendComponents.splice(b,1)};ia.InteractionGroup.prototype.getHighlight=function(){return this._highlight};
ia.InteractionGroup.prototype.clearHighlight=function(){this._highlight="";for(var a=0;a<this._components.length;a++){var b=this._components[a];b.clearHighlight()}for(a=0;a<this._legendComponents.length;a++)b=this._legendComponents[a],b.clearHighlight();this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))};
ia.InteractionGroup.prototype.setHighlight=function(a){if(a!=""){this._highlight=a;for(var b=0;b<this._components.length;b++)this._components[b].clearHighlight(),this._components[b].highlight(""+a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))}else this.clearHighlight()};ia.InteractionGroup.prototype.getSelection=function(){return this._selection};
ia.InteractionGroup.prototype.setSelection=function(a){if(a.length>0){this._selection=a.concat();for(a=0;a<this._components.length;a++)for(var b=0;b<this._selection.length;++b)this._components[a].select(""+this._selection[b]);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}else this.clearSelection()};
ia.InteractionGroup.prototype.clearSelection=function(){for(var a=0;a<this._components.length;a++){var b=this._components[a];b.clearSelection()}for(a=0;a<this._legendComponents.length;a++)b=this._legendComponents[a],b.clearSelection();this._selection=[];this.dispatchEvent(new ia.Event(ia.Event.CLEAR_SELECTION,{}));this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))};
ia.InteractionGroup.prototype.select=function(a){if(this._selection.indexOf(a)==-1){this._selection.push(a);for(var b=0;b<this._components.length;b++)this._components[b].select(""+a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}};
ia.InteractionGroup.prototype.unselect=function(a){var b=this._selection.indexOf(a);if(b!=-1){this._selection.splice(b,1);for(b=0;b<this._components.length;b++)this._components[b].unselect(""+a);this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection))}};
ia.InteractionGroup.prototype._itemEventHandler=function(a){var b=a.item;a.type==ia.ItemEvent.NONE_ITEM_CLICK?a.item.parent instanceof ia.FeatureLayer&&this.clearSelection():b.parent.isLegendComponent?a.type==ia.ItemEvent.ITEM_CLICK&&this.selectionMode=="single"?b.parent.unselect(""+b.id):this._onLegendClassEvent(a,b):(this._updateComponents(a,b),this._updateLegendClassComponents(a,b));this._dispatchInteractionEvent(a.type)};
ia.InteractionGroup.prototype._dispatchInteractionEvent=function(a){a==ia.ItemEvent.NONE_ITEM_CLICK||a==ia.ItemEvent.ITEM_CLICK?this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.SELECTION_CHANGED,this,this._selection)):(a==ia.ItemEvent.ITEM_MOUSE_OUT||a==ia.ItemEvent.ITEM_MOUSE_UP||a==ia.ItemEvent.ITEM_MOUSE_OVER)&&this.dispatchEvent(new ia.InteractionEvent(ia.InteractionEvent.HIGHLIGHT_CHANGED,this,[this._highlight]))};
ia.InteractionGroup.prototype._onLegendClassEvent=function(a,b){for(var c=b.id,d=b.parent,e=b.state,f=0;f<this._legendComponents.length;f++){var g=this._legendComponents[f];g!=d&&d.thematic==g.thematic&&(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP?g.clearHighlight():a.type==ia.ItemEvent.ITEM_MOUSE_OVER?(g.clearHighlight(),g.highlight(""+c)):a.type==ia.ItemEvent.ITEM_CLICK&&(e==ia.ItemLayer.UNSELECTED?g.unselect(""+c):g.select(""+c)))}if(a.type==ia.ItemEvent.ITEM_CLICK){c=
b.legendClass.items;d=c.length;for(f=0;f<d;f++)this._updateComponents(a,c[f])}};ia.InteractionGroup.prototype._updateLegendClassComponents=function(a,b){for(var c=0;c<this._legendComponents.length;c++){var d=this._legendComponents[c];if(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP)d.clearHighlight();else if(a.type==ia.ItemEvent.ITEM_MOUSE_OVER){d.clearHighlight();var e=d.thematic.getData();e&&(e=e[b.id])&&e.legendClass&&d.highlight(""+e.legendClass.index)}}};
ia.InteractionGroup.prototype._updateComponents=function(a,b){var c=b.id,d=b.parent,e=a.item.state;a.type==ia.ItemEvent.ITEM_CLICK&&this.selectionMode=="single"&&this.clearSelection();if(a.type==ia.ItemEvent.ITEM_CLICK)if(e==ia.ItemLayer.UNSELECTED){var f=this._selection.indexOf(c);f!=-1&&this._selection.splice(f,1)}else this._selection.push(c);else if(a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP)this._highlight="";else if(a.type==ia.ItemEvent.ITEM_MOUSE_OVER)this._highlight=
c;for(f=0;f<this._components.length;f++){var g=this._components[f];if(g!=d||a.type==ia.ItemEvent.ITEM_CLICK)a.type==ia.ItemEvent.ITEM_MOUSE_OUT||a.type==ia.ItemEvent.ITEM_MOUSE_UP?g.clearHighlight():a.type==ia.ItemEvent.ITEM_MOUSE_OVER&&(g.clearHighlight(),g.highlight(""+c)),a.type==ia.ItemEvent.ITEM_CLICK&&(e==ia.ItemLayer.UNSELECTED?g.unselect(""+c):g.select(""+c))}this.dispatchEvent(a)};
ia.DataGroup=function(a,b){function c(){q=!0;for(var c=[],d=0;d<u.length;d++){var e=u[d];c.push(e.id)}var c=c.filter(function(a,b,c){return b==c.indexOf(a)}),f=c.length;s.features=[];if(f>1){for(var g={},d=0;d<u.length;d++)e=u[d],g[e.id]=g[e.id]==void 0?e.features:g[e.id].concat(e.features);var e=0,i;for(i in g){i=g[i];for(d=0;d<i.length;d++){var e=0,l=i[d],k;for(k in g)g[k].indexOf(l)>0&&e++;e==f&&s.features.push(l)}break}}else for(d=0;d<u.length;d++)e=u[d],s.features=s.features.concat(e.features);
s.features=s.features.filter(function(a,b,c){return b==c.indexOf(a)});s.features.length==0&&c.length>0&&s.features.push("~~~");c=u.map(function(a){return a.value});a.textSubstitution.setVariable("filterValues"+b,c.join(", "));h();j.thematic.commitChanges()}function d(){m=!0;var c,d=a.data.getGeographies();a.config.template==ia.DOUBLE_PLOT_REPORT?(c=a.url.params.geog?d[a.url.params.geog]:d[0],j.mapData.baseLayer.setVisible(!0)):(a.url.params["geog"+b]&&(c=d[a.url.params["geog"+b]]),c==void 0&&(c=(a.config.template==
ia.DOUBLE_GEOG_REPORT||a.config.template==ia.DOUBLE_BASELAYER_REPORT||a.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)&&b!=""?d.length>=b?d[b-1]:d[0]:d[0]));var f=a.getButton("geographyButton"+b);f&&(d.length>1?f.show():f.hide());d=!0;if(f=a.config.getComponent("dataExplorer"+b))d=f.getProperty("reverseDates"),d==void 0&&(d=!0);var g;a.url.params["indicator"+b]&&(g=a.url.params["date"+b]?c.getIndicator(a.url.params["indicator"+b],a.url.params["date"+b]):c.getIndicator(a.url.params["indicator"+b],
void 0,d));g==void 0&&(g=c.getFirstIndicator(d),a.url.params["date"+b]&&(g=c.getIndicator(g.id,a.url.params["date"+b])));e(c.id,g.id,g.date)}function e(b,c,d){a.blockInteraction("onDataChangeProgress",!0,function(){var e=a.data.getGeography(b);e.loadIndicator(c,d,function(b){m||b.geography.id!=j.indicator.geography.id?g(e,function(){a.url.params.loadAllData?e.loadData(function(){f(b)}):f(b)}):f(b)})})}function f(a){o=!0;j.indicator=a;if(m||j.theme.id!=a.theme.id)l=!0;j.theme=a.theme;j.geography=a.geography;
h();i(j.thematic,j.indicator);m=!1;j.thematic.commitChanges()}function g(c,d){n=!0;if(m)if(a.url.params["filteredFeatures"+b])s.features=a.url.params["filteredFeatures"+b].split(","),q=!0;else{if(a.url.params["filter"+b]){var e=a.url.params["filter"+b].split(","),f=e[0],e=e[1];q=!0;s.id=f;s.name=c.getFilter(f).name;s.value=e;s.features=c.getFilteredFeatures(s.id,s.value);u=[];a.textSubstitution.setVariable("filterName"+b,s.name);a.textSubstitution.setVariable("filterValue"+b,s.value)}}else s.features=
[],a.textSubstitution.setVariable("filterName"+b,""),a.textSubstitution.setVariable("filterValue"+b,""),a.textSubstitution.setVariable("filterValues"+b,"");(f=a.getButton("filterButton"+b))&&(c.getFilters().length>0?f.show():f.hide());if(j.mapData){var g=j.mapData.baseLayer.getVisible();j.mapData.baseLayer.setVisible(!1);j.mapData.baseLayer=j.mapData.baseLayers[c.index];if(j.mapData.baseLayer==void 0)j.mapData.baseLayer=j.mapData.baseLayers[0];var h=function(){g&&j.mapData.baseLayer.setVisible(!0);
j.mapData.baseLayer.thematic=j.thematic;var c,e=j.thematic.numericClassifier.sizePalette;if(a.config.template==ia.BUBBLE_PLOT_REPORT&&b=="2"){var f=a.config.getComponent("scatterPlot");if(f)c="circle",j.thematic.setDataField(f.getProperty("sizeData")),j.legendSettings.legendType="continuous",e.minSize=f.getProperty("minBubbleSize"),e.maxSize=f.getProperty("maxBubbleSize"),j.thematic.categoricClassifier.symbolSize=8}else if(j.mapData.baseLayer.geometry=="point"){c=a.config.getProperty("symbolShape"+
b);c==void 0&&(c=a.config.getProperty("symbolShape"));e.minSize=a.config.getProperty("minSymbolSize"+b);if(e.minSize==void 0)e.minSize=a.config.getProperty("minSymbolSize");e.maxSize=a.config.getProperty("maxSymbolSize"+b);if(e.maxSize==void 0)e.maxSize=a.config.getProperty("maxSymbolSize");j.thematic.categoricClassifier.symbolSize=j.mapData.baseLayer.symbolSize}else if(j.mapData.baseLayer.geometry=="line"){c=ia.Shape.LINE;e.minSize=a.config.getProperty("minLineSize"+b);if(e.minSize==void 0)e.minSize=
a.config.getProperty("minLineSize");e.maxSize=a.config.getProperty("minLineSize"+b);if(e.maxSize==void 0)e.maxSize=a.config.getProperty("minLineSize");j.thematic.categoricClassifier.symbolSize=j.mapData.baseLayer.style.lineWidth}else c=ia.Shape.SQUARE,e.minSize=j.mapData.baseLayer.symbolSize,e.maxSize=j.mapData.baseLayer.symbolSize,j.thematic.categoricClassifier.symbolSize=j.mapData.baseLayer.symbolSize;j.mapData.baseLayer.symbol=c;j.thematic.symbol=c;d.call(null)};j.mapData.baseLayer.isLoaded?h():
(j.mapData.baseLayer.addEventListener(ia.Event.LAYER_READY,function(){h()}),j.mapData.baseLayer.loadSource())}else d.call(null)}function h(){s.features.length>0?(j.indicatorData=j.indicator.getData(s.features),j.themeData=j.theme.getData(j.indicator.id,s.features)):(j.indicatorData=j.indicator.getData(),j.themeData=j.theme.getData(j.indicator.id));j.comparisonData=j.indicator.getComparisonData();j.comparisonThemeData=j.theme.getComparisonData(j.indicator.id);j.comparisonThematic.setData(j.comparisonData);
var c=j.indicator.getDataType(j.thematic.getDataField());j.thematic.setDataType(c);j.thematic.setData(j.indicatorData);a.textSubstitution.setVariable("geogName"+b,j.geography.name);a.textSubstitution.setVariable("themeName"+b,j.theme.getParentThemes());a.textSubstitution.setVariable("indicatorName"+b,j.indicator.name);a.textSubstitution.setVariable("date"+b,j.indicator.date);var c=j.indicator.getProperties(),d;for(d in c)a.textSubstitution.setVariable(d+""+b,c[d]);a.updateDynamicText(a.textSubstitution)}
function i(c,d){var e=a.config.getMapPalette(),f=d.getProperty(a.config.getProperty("customClassifierKey"+b)),g=d.getProperty(a.config.getProperty("customColoursKey"+b)),h=d.getProperty(a.config.getProperty("customPaletteKey"+b)),i=d.getProperty(a.config.getProperty("customBreaksKey"+b)),l=d.getProperty(a.config.getProperty("customLabelsKey"+b)),k=d.getProperty("customAssociateForColourLegend");j.thematic.colorField=void 0;var m=d.getProperty("customNoClasses"),n=j.thematic.categoricClassifier;n.breaks=
[];n.labels=[];n.colorPalette=e.getColorScheme(j.legendSettings.schemeId);var o=j.thematic.numericClassifier;o.labels=[];o.classificationName=j.legendSettings.legendType;j.thematic.heatmap=!1;j.thematic.heatmapradius=void 0;if(j.mapData.baseLayer.geometry=="point"&&d.getProperty("heatmap")&&(d.getProperty("heatmap")=="true"||d.getProperty("heatmap")=="True"||d.getProperty("heatmap")=="TRUE"||d.getProperty("heatmap")==!0||d.getProperty("heatmap")=="heatmap"))if(o.classificationName="continuous",j.thematic.heatmap=
!0,d.getProperty("heatmapradius"))j.thematic.heatmapradius=d.getProperty("heatmapradius");o.colorPalette=j.mapData.baseLayer.themeColors!=void 0?new ia.ColorPalette(j.mapData.baseLayer.themeColors):e.getColorPalette(j.legendSettings.paletteId);if(d.type==ia.Thematic.CATEGORIC){a.textSubstitution.setVariable("legendType"+b,"");a.updateDynamicText(a.textSubstitution);if(i)n.breaks=i.split(";");if(l)n.labels=l.split(";");if(h){var p=e.getColorScheme(h).getColorList(p),e=new ia.ColorPalette(p),q;for(q in n.colorPalette.matchColorsToValues)e.matchColorsToValues[q]=
n.colorPalette.matchColorsToValues[q];n.colorPalette=e;n.customColorsDefined=!0}if(g){p=g.split(";");e=new ia.ColorPalette(p);for(q in n.colorPalette.matchColorsToValues)e.matchColorsToValues[q]=n.colorPalette.matchColorsToValues[q];n.colorPalette=e;n.customColorsDefined=!0}}else{if(f)o.classificationName=f;var s=a.config.getProperty(o.classificationName);a.textSubstitution.setVariable("legendType"+b,s);a.updateDynamicText(a.textSubstitution);if(i){var r=i.split(";"),i=function(){return r};f=="continuous"?
(o.getCalculator().addFunction("continuous",i),o.classificationName="continuous"):(o.getCalculator().addFunction("customClassifier",i),o.classificationName="customClassifier")}if(m)o.noClasses=m;if(l)o.labels=l.split(";");if(h)o.colorPalette=e.getColorPalette(h);if(g)p=g.split(";"),o.colorPalette=new ia.ColorPalette(p);if(k){j.thematic.colorField=k;f=d.getProperty("customBreaksForColourLegend");h=d.getProperty("customLabelsForColourLegend");l=d.getProperty("customPaletteForColourLegend");g=d.getProperty("customColoursForColourLegend");
if(f)n.breaks=f.split(";");if(h)n.labels=h.split(";");if(l){p=e.getColorScheme(l).getColorList(p);e=new ia.ColorPalette(p);for(q in n.colorPalette.matchColorsToValues)e.matchColorsToValues[q]=n.colorPalette.matchColorsToValues[q];n.colorPalette=e;n.customColorsDefined=!0}if(g){p=g.split(";");e=new ia.ColorPalette(p);for(q in n.colorPalette.matchColorsToValues)e.matchColorsToValues[q]=n.colorPalette.matchColorsToValues[q];n.colorPalette=e;n.customColorsDefined=!0}}}}function k(){if(j.indicator.getDataType(j.thematic.getDataField())==
ia.Thematic.CATEGORIC)a.textSubstitution.setVariable("mean"+b,""),a.textSubstitution.setVariable("median"+b,""),a.textSubstitution.setVariable("sum"+b,""),a.textSubstitution.setVariable("minValue"+b,""),a.textSubstitution.setVariable("maxValue"+b,""),a.textSubstitution.setVariable("range"+b,""),a.textSubstitution.setVariable("lowerQuartile"+b,""),a.textSubstitution.setVariable("upperQuartile"+b,""),a.textSubstitution.setVariable("interquartileRange"+b,""),a.textSubstitution.setVariable("variance"+
b,""),a.textSubstitution.setVariable("standardDeviation"+b,"");else{var c=j.indicator.precision||2;c==void 0&&(c=2);var d=a.locale.formatter,e=j.thematic.numericClassifier.getCalculator().getStats();a.textSubstitution.setVariable("sum"+b,d.format(e.sum,c));a.textSubstitution.setVariable("mean"+b,d.format(e.mean,c));a.textSubstitution.setVariable("median"+b,d.format(e.median,c));a.textSubstitution.setVariable("minValue"+b,d.format(e.minValue,c));a.textSubstitution.setVariable("maxValue"+b,d.format(e.maxValue,
c));a.textSubstitution.setVariable("range"+b,d.format(e.range,c));a.textSubstitution.setVariable("lowerQuartile"+b,d.format(e.lowerQuartile,c));a.textSubstitution.setVariable("upperQuartile"+b,d.format(e.upperQuartile,c));a.textSubstitution.setVariable("interquartileRange"+b,d.format(e.interquartileRange,c));a.textSubstitution.setVariable("variance"+b,d.format(e.variance,c));a.textSubstitution.setVariable("standardDeviation"+b,d.format(e.standardDeviation,c))}a.updateDynamicText(a.textSubstitution)}
ia.DataGroup.baseConstructor.call(this);var j=this,m=!0,n=!1,l=!1,o=!1,q=!1,p=!1,r,t,s={id:"",name:"",value:"",features:[]},u=[];this.suffix=b||"";this.legendSettings={};this.setData=function(b,c,d,f){f!=void 0&&(t=f);f=a.data.getGeography(b);c=f.getIndicator(c,d);c==void 0&&(c=f.getFirstIndicator(!0));e(b,c.id,c.date)};this.setFilter=function(c,d){q=!0;s.id=c;s.name=j.geography.getFilter(c).name;s.value=d;s.features=j.geography.getFilteredFeatures(s.id,s.value);u=[];a.textSubstitution.setVariable("filterName"+
b,s.name);a.textSubstitution.setVariable("filterValue"+b,s.value);h();j.thematic.commitChanges()};this.appendFilter=function(a,b){var d={};d.id=a;d.name=j.geography.getFilter(a).name;d.value=b;d.features=j.geography.getFilteredFeatures(a,b);u.push(d);c()};this.removeFilter=function(a,b){u=u.filter(function(c){return c.id==a&&c.value==b?!1:!0});c()};this.setFilteredFeatures=function(c){q=!0;s.id="";s.name="";s.value="";s.features=c.concat();u=[];a.textSubstitution.setVariable("filterName"+b,"");a.textSubstitution.setVariable("filterValue"+
b,"");a.textSubstitution.setVariable("filterValues"+b,"");h();j.thematic.commitChanges()};this.getFilteredFeatures=function(){return s.features};this.clearFilter=function(){q=!0;s.id="";s.name="";s.value="";s.features=[];u=[];a.textSubstitution.setVariable("filterName"+b,"");a.textSubstitution.setVariable("filterValue"+b,"");a.textSubstitution.setVariable("filterValues"+b,"");h();j.thematic.commitChanges()};this.update=function(a){r=a;d()};this.build=function(c){r=c;a.textSubstitution.setVariable("geogName"+
b," ");a.textSubstitution.setVariable("themeName"+b," ");a.textSubstitution.setVariable("indicatorName"+b," ");a.textSubstitution.setVariable("date"+b," ");a.textSubstitution.setVariable("filterName"+b,"");a.textSubstitution.setVariable("filterValue"+b,"");a.textSubstitution.setVariable("filterValues"+b,"");a.textSubstitution.setVariable("legendType"+b,"");a.updateDynamicText(a.textSubstitution);j.thematic=new ia.Thematic;j.thematic.noDataValue=a.locale.formatter.noDataValue;j.thematic.setDataField(a.config.getProperty("data"+
b));j.thematic.addEventListener(ia.Event.THEME_CHANGED,function(){if(j.indicator.type==ia.Thematic.CATEGORIC)a.textSubstitution.setVariable("legendType"+b,"");else{var c=a.config.getProperty(j.legendSettings.legendType);a.textSubstitution.setVariable("legendType"+b,c)}a.updateDynamicText(a.textSubstitution);m||(j.comparisonThematic.commitChanges(),p=!0,k(),a.blockInteraction("onThemeChangeProgress",!1,function(){n&&j.dispatchEvent(new ia.DataEvent(ia.DataEvent.GEOG_CHANGED,j,j.geography,j.theme,j.indicator));
q&&(a.url.params["filteredFeatures"+b]=s.features.length>0?s.features.join(","):"",j.dispatchEvent(new ia.FilterEvent(ia.FilterEvent.FILTER_CHANGED,j,s.id,s.name,s.value,s.features)));l&&j.dispatchEvent(new ia.DataEvent(ia.DataEvent.THEME_CHANGED,j,j.geography,j.theme,j.indicator));if(o)a.url.params["geog"+b]=j.geography.index,a.url.params["indicator"+b]=j.indicator.id,a.url.params["date"+b]=j.indicator.date?j.indicator.date:"",j.dispatchEvent(new ia.DataEvent(ia.DataEvent.INDICATOR_CHANGED,j,j.geography,
j.theme,j.indicator));(o||q)&&j.dispatchEvent(new ia.DataEvent(ia.DataEvent.DATA_CHANGED,j,j.geography,j.theme,j.indicator));if(p){a.url.params["prop_legendClassifier"+b]=j.thematic.numericClassifier.classificationName;if(b=="")a.url.params.pal_defaultPaletteId=j.legendSettings.paletteId,a.url.params.pal_defaultSchemeId=j.legendSettings.schemeId,a.url.params.pal_noClasses=j.thematic.numericClassifier.noClasses;if(b=="2")a.url.params.prop_mapPalette2=j.legendSettings.paletteId;var c=j.thematic.numericClassifier.sizePalette;
if(a.config.template==ia.BUBBLE_PLOT_REPORT&&b=="2"){if(a.config.getComponent("scatterPlot"))a.url.params["prop_minBubbleSize"+b]=c.minSize,a.url.params["prop_maxBubbleSize"+b]=c.maxSize}else if(j.mapData.baseLayer.geometry=="point")a.url.params["prop_minSymbolSize"+b]=c.minSize,a.url.params["prop_maxSymbolSize"+b]=c.maxSize;else if(j.mapData.baseLayer.geometry=="line")a.url.params["prop_minLineSize"+b]=c.minSize,a.url.params["prop_maxLineSize"+b]=c.maxSize;j.dispatchEvent(new ia.Event(ia.Event.THEMATIC_CHANGED,
j))}a.allowInteraction("onThemeChangeProgress");a.allowInteraction("onDataChangeProgress");r!=void 0&&(r.call(null),r=void 0);t&&t.call(null);p=l=o=q=n=!1}))});var c=a.config.getMapPalette(),e=j.thematic.categoricClassifier;e.formatter=a.locale.formatter;e.colorPalette=c.getColorScheme(c.defaultSchemeId);j.legendSettings.schemeId=c.defaultSchemeId;j.legendSettings.paletteId=b!=""?a.config.getProperty("mapPalette"+b)||c.defaultPaletteId:c.defaultPaletteId;j.legendSettings.legendType=a.config.getProperty("legendClassifier"+
b)||"quantile";e=j.thematic.numericClassifier;e.noClasses=c.noClasses;e.formatter=a.locale.formatter;e.classificationName=j.legendSettings.legendType;e.colorPalette=c.getColorPalette(j.legendSettings.paletteId);e.sdLabels=[a.config.getProperty("sd1"),a.config.getProperty("sd2"),a.config.getProperty("sd3"),a.config.getProperty("sd4"),a.config.getProperty("sd5"),a.config.getProperty("sd6")];if(a.config.getProperty("sdSize"))e.getCalculator().sdSize=a.config.getProperty("sdSize");c=a.config.getProperty("legendPrecision");
if(c!=void 0&&c>-1)e.precision=c;j.comparisonThematic=new ia.Thematic;j.comparisonThematic.setDataType(ia.Thematic.CATEGORIC);j.comparisonThematic.setDataField("id");d()}};ia.extend(ia.EventDispatcher,ia.DataGroup);ia.Color=function(){};ia.Color.r=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[0]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(0,2),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[0]));return b};
ia.Color.g=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[1]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(2,4),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[1]));return b};ia.Color.b=function(a){var b;ia.Color.isHSV(a)?b=ia.parseInt(ia.Color.cutRgb(ia.Color.HSVtoRGB(a))[2]):ia.Color.isHex(a)?b=ia.parseInt(ia.Color.cutHex(a).substring(4,6),16):ia.Color.isRGB(a)&&(b=ia.parseInt(ia.Color.cutRgb(a)[2]));return b};
ia.Color.a=function(a){var b;ia.Color.isHSV(a)?b=parseFloat(a[3]):ia.Color.isHex(a)?b=parseFloat(ia.Color.cutHex(a).substring(6,8),16):ia.Color.isRGB(a)&&(b=parseFloat(ia.Color.cutRgb(a)[3]));return b};ia.Color.h=function(a){return ia.Color.toHSVA(a)[0]};ia.Color.s=function(a){return ia.Color.toHSVA(a)[1]};ia.Color.v=function(a){return ia.Color.toHSVA(a)[2]};ia.Color.toRGBA=function(a,b){var c=b;c==void 0&&(c=1);var d=ia.Color.r(a),e=ia.Color.g(a),f=ia.Color.b(a);return ia.Color.rgba(d,e,f,c)};
ia.Color.toHex=function(a){var b=ia.Color.r(a),c=ia.Color.g(a),a=ia.Color.b(a);return"#"+ia.Color.intToHex(b)+ia.Color.intToHex(c)+ia.Color.intToHex(a)};ia.Color.toHSVA=function(a,b){var c=ia.Color.r(a),d=ia.Color.g(a),e=ia.Color.b(a),f,g=Math.max(c,d,e),h=Math.min(c,d,e);g==h?f=0:g==c?f=(60*(d-e)/(g-h)+360)%360:g==d?f=60*(e-c)/(g-h)+120:g==e&&(f=60*(c-d)/(g-h)+240);return[f,g==0?0:(1-h/g)*100,g/255*100,b]};
ia.Color.HSVtoRGB=function(a){var b=a[0],c=a[1]/100,d=a[2]/100*255,a=a[3];b<0&&(b+=360);var e=b/60-Math.floor(b/60),f=d*(1-c),g=d*(1-e*c),c=d*(1-(1-e)*c),h,i,k;switch(Math.floor(b/60)%6){case 0:h=d;i=c;k=f;break;case 1:h=g;i=d;k=f;break;case 2:h=f;i=d;k=c;break;case 3:h=f;i=g;k=d;break;case 4:h=c;i=f;k=d;break;case 5:h=d,i=f,k=g}return ia.Color.rgba(h,i,k,a)};
ia.Color.validHex=function(a){a=a.replace(/[^#a-fA-F0-9]/g,"");a=a.toLowerCase();a.match(/#/g)&&a.match(/#/g).length>1&&(a=a.replace(/#/g,""));a.indexOf("#")==-1&&(a="#"+a);a.length>7&&(a=a.substr(0,7));return a};ia.Color.intToHex=function(a){if(a==null)return"00";a=ia.parseInt(a);if(a==0||isNaN(a))return"00";a=Math.max(0,a);a=Math.min(a,255);a=Math.round(a);return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};
ia.Color.cutHex=function(a){return a.charAt(0)=="#"?a.substring(1,7):a};ia.Color.cutRgb=function(a){return a.substring(a.indexOf("(")+1,a.indexOf(")")).split(",")};ia.Color.isHex=function(a){return a.indexOf("#")==0};ia.Color.isRGB=function(a){return a.indexOf("rgb")!=-1};ia.Color.isHSV=function(a){return Object.prototype.toString.call(a)=="[object Array]"};ia.Color.rgba=function(a,b,c,d){d==void 0&&(d=1);return"rgba("+Math.floor(a)+","+Math.floor(b)+","+Math.floor(c)+","+d+")"};
ia.Color.getInterpolatedColor=function(a,b,c){var d;return ia.Color.rgba((d=ia.Color.r(a))+c*(ia.Color.r(b)-d),(d=ia.Color.g(a))+c*(ia.Color.g(b)-d),(d=ia.Color.b(a))+c*(ia.Color.b(b)-d))};ia.Color.getRandomColor=function(){return ia.Color.rgba(Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255))};ia.Color.lighten=function(a,b){var c=ia.Color.toHSVA(a),d=c[2];d+=d*b;d>100&&(d=100);d<0&&(d=0);c[2]=d;return ia.Color.toHex(c)};
ia.Color.shade=function(a,b){var c=ia.Color.toHex(a),d=parseInt(c.slice(1),16),c=b<0?0:255,e=b<0?b*-1:b,f=d>>16,g=d>>8&255;d&=255;return"#"+(16777216+(Math.round((c-f)*e)+f)*65536+(Math.round((c-g)*e)+g)*256+(Math.round((c-d)*e)+d)).toString(16).slice(1)};ia.Color.darken=function(a,b){return ia.Color.lighten(a,b*-1)};ia.Color.adjustSV=function(a,b,c){a=ia.Color.toHSVA(a);a[1]=b;a[2]=c;return ia.Color.toHex(a)};
ia.Color.saturate=function(a,b){var c=ia.Color.toHSVA(a),d=c[1];d+=d*b;d>100&&(d=100);d<0&&(d=0);c[1]=d;return ia.Color.toHex(c)};ia.Color.desaturate=function(a,b){return ia.Color.saturate(a,b*-1)};ia.Color.hueShift=function(a,b){for(a+=b;a>=360;)a-=360;for(;a<0;)a+=360;return a};ia.Color.complement=function(a){a=ia.Color.toHSVA(a);a[0]=ia.Color.hueShift(a[0],180);return ia.Color.toHex(a)};
ia.Color.triad=function(a){var b=ia.Color.toHSVA(a),c=b[0],a=[ia.Color.hueShift(c,156),b[1],b[2]],b=[ia.Color.hueShift(c,204),b[1],b[2]];return[ia.Color.toHex(a),ia.Color.toHex(b)]};ia.Color.analogic=function(a){var b=ia.Color.toHSVA(a),c=b[0],a=[ia.Color.hueShift(c,-24),b[1],b[2]],b=[ia.Color.hueShift(c,24),b[1],b[2]];return[ia.Color.toHex(a),ia.Color.toHex(b)]};ia.SvgShape=function(){};ia.SvgShape.CIRCLE="circle";ia.SvgShape.SQUARE="square";ia.SvgShape.LINE="line";ia.SvgShape.VERTICAL_LINE="vertical line";
ia.SvgShape.HORIZONTAL_LINE="horizontal line";ia.SvgShape.MINUS="minus";ia.SvgShape.PLUS="plus";ia.SvgShape.X="x";ia.SvgShape.DIAMOND="diamond";ia.SvgShape.STAR="star";ia.SvgShape.TRIANGLE_UP="triangle up";ia.SvgShape.TRIANGLE_DOWN="triangle down";ia.SvgShape.TRIANGLE_RIGHT="triangle right";ia.SvgShape.TRIANGLE_LEFT="triangle left";ia.SvgShape.ARROW_UP="arrow up";ia.SvgShape.ARROW_DOWN="arrow down";ia.SvgShape.ARROW_RIGHT="arrow right";ia.SvgShape.ARROW_LEFT="arrow left";
ia.SvgShape.draw=function(a,b,c,d){switch(a){case ia.SvgShape.SQUARE:return this.drawSquare(b,c,d);case ia.SvgShape.LINE:return this.drawLine(b,c,d);case ia.SvgShape.VERTICAL_LINE:return this.drawVerticalLine(b,c,d);case ia.SvgShape.HORIZONTAL_LINE:return this.drawHorizontalLine(b,c,d);case ia.SvgShape.MINUS:return this.drawMinus(b,c,d);case ia.SvgShape.PLUS:return this.drawPlus(b,c,d);case ia.SvgShape.X:return this.drawX(b,c,d);case ia.SvgShape.CIRCLE:return this.drawCircle(b,c,d);case ia.SvgShape.DIAMOND:return this.drawDiamond(b,
c,d);case ia.SvgShape.TRIANGLE_UP:return this.drawTriangleUp(b,c,d);case ia.SvgShape.TRIANGLE_DOWN:return this.drawTriangleDown(b,c,d);case ia.SvgShape.TRIANGLE_RIGHT:return this.drawTriangleRight(b,c,d);case ia.SvgShape.TRIANGLE_LEFT:return this.drawTriangleLeft(b,c,d);case ia.SvgShape.ARROW_UP:return this.drawArrowUp(b,c,d);case ia.SvgShape.ARROW_DOWN:return this.drawArrowDown(b,c,d);case ia.SvgShape.ARROW_RIGHT:return this.drawArrowRight(b,c,d);case ia.SvgShape.ARROW_LEFT:return this.drawArrowLeft(b,
c,d);case ia.SvgShape.STAR:return this.drawStar(b,c,d)}};ia.SvgShape.drawSquare=function(a,b,c){c/=2;var d="M"+(a-c)+" "+(b-c);d+=" L"+(a+c)+" "+(b-c);d+=" L"+(a+c)+" "+(b+c);d+=" L"+(a-c)+" "+(b+c);d+=" Z";return d};ia.SvgShape.drawLine=function(a,b,c){c/=2;var d="M"+(a-c)+" "+(b-0.5);d+=" L"+(a-c)+" "+(b+0.5);d+=" L"+(a+c)+" "+(b+0.5);d+=" L"+(a+c)+" "+(b-0.5);d+=" Z";return d};
ia.SvgShape.drawVerticalLine=function(a,b,c){c/=2;var d="M"+(a-1)+" "+(b-c);d+=" L"+(a+1)+" "+(b-c);d+=" L"+(a+1)+" "+(b+c);d+=" L"+(a-1)+" "+(b+c);d+=" Z";return d};ia.SvgShape.drawHorizontalLine=function(a,b,c){c/=2;var d="M"+(a-c)+" "+(b-1);d+=" L"+(a-c)+" "+(b+1);d+=" L"+(a+c)+" "+(b+1);d+=" L"+(a+c)+" "+(b-1);d+=" Z";return d};
ia.SvgShape.drawMinus=function(a,b,c){var d=c/2;c*=0.3;var e="M"+(a-d)+" "+(b-c/2);e+=" L"+(a-d)+" "+(b+c/2);e+=" L"+(a+d)+" "+(b+c/2);e+=" L"+(a+d)+" "+(b-c/2);e+=" Z";return e};
ia.SvgShape.drawPlus=function(a,b,c){var d=c/2,c=c*0.3/2,e="M"+(a-c)+" "+(b-d);e+=" L"+(a+c)+" "+(b-d);e+=" L"+(a+c)+" "+(b-c);e+=" L"+(a+d)+" "+(b-c);e+=" L"+(a+d)+" "+(b+c);e+=" L"+(a+c)+" "+(b+c);e+=" L"+(a+c)+" "+(b+d);e+=" L"+(a-c)+" "+(b+d);e+=" L"+(a-c)+" "+(b+c);e+=" L"+(a-d)+" "+(b+c);e+=" L"+(a-d)+" "+(b-c);e+=" L"+(a-c)+" "+(b-c);e+=" L"+(a-c)+" "+(b-d);return e};
ia.SvgShape.drawX=function(a,b,c){var d=c/2,c=c*0.3/2,e=a-c-a,f=b-d-b,g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180),e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180),h="M"+(g+a)+" "+(e+b),e=a+c-a,f=b-d-b,g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180),e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a+c-a;f=b-c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+
(e+b);e=a+d-a;f=b-c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a+d-a;f=b+c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a+c-a;f=b+c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a+c-a;f=b+d-b;g=e*Math.cos(45*Math.PI/
180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-c-a;f=b+d-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-c-a;f=b+c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-d-a;f=b+c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*
Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-d-a;f=b-c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-c-a;f=b-c-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+(g+a)+" "+(e+b);e=a-c-a;f=b-d-b;g=e*Math.cos(45*Math.PI/180)-f*Math.sin(45*Math.PI/180);e=e*Math.sin(45*Math.PI/180)+f*Math.cos(45*Math.PI/180);h+=" L"+
(g+a)+" "+(e+b);return h};ia.SvgShape.drawCircle=function(a,b,c){c/=2;a="M"+a+","+b;a+="m"+-c+",0";a+="a"+c+","+c+" 0 1,0 "+c*2+",0";a+="a"+c+","+c+" 0 1,0 "+-(c*2)+",0";return a};ia.SvgShape.drawDiamond=function(a,b,c){c/=2;var d="M"+a+" "+(b-c);d+=" L"+(a+c)+" "+b;d+=" L"+a+" "+(b+c);d+=" L"+(a-c)+" "+b;d+=" L"+a+" "+(b-c);return d};ia.SvgShape.drawTriangleUp=function(a,b,c){c/=2;var d="M"+a+" "+(b-c);d+=" L"+(a+c)+" "+(b+c);d+=" L"+(a-c)+" "+(b+c);d+=" L"+a+" "+(b-c);return d};
ia.SvgShape.drawTriangleDown=function(a,b,c){c/=2;var d="M"+(a-c)+" "+(b-c);d+=" L"+(a+c)+" "+(b-c);d+=" L"+a+" "+(b+c);d+=" L"+(a-c)+" "+(b-c);return d};ia.SvgShape.drawTriangleRight=function(a,b,c){c/=2;var d="M"+(a-c)+" "+(b-c);d+=" L"+(a+c)+" "+b;d+=" L"+(a-c)+" "+(b+c);d+=" L"+(a-c)+" "+(b-c);return d};ia.SvgShape.drawTriangleLeft=function(a,b,c){c/=2;var d="M"+(a+c)+" "+(b-c);d+=" L"+(a+c)+" "+(b+c);d+=" L"+(a-c)+" "+b;d+=" L"+(a+c)+" "+(b-c);return d};
ia.SvgShape.drawArrowUp=function(a,b,c){var d=c/2,e=c*0.5,f=c*1;c*=0.5;var g="M"+a+" "+(b-d);g+=" L"+(a+f/2)+" "+(b-d+c);g+=" L"+(a+e/2)+" "+(b-d+c);g+=" L"+(a+e/2)+" "+(b+d);g+=" L"+(a-e/2)+" "+(b+d);g+=" L"+(a-e/2)+" "+(b-d+c);g+=" L"+(a-f/2)+" "+(b-d+c);g+=" L"+a+" "+(b-d);return g};
ia.SvgShape.drawArrowDown=function(a,b,c){var d=c/2,e=c*0.5,f=c*1;c*=0.5;var g="M"+a+" "+(b+d);g+=" L"+(a+f/2)+" "+(b+d-c);g+=" L"+(a+e/2)+" "+(b+d-c);g+=" L"+(a+e/2)+" "+(b-d);g+=" L"+(a-e/2)+" "+(b-d);g+=" L"+(a-e/2)+" "+(b+d-c);g+=" L"+(a-f/2)+" "+(b+d-c);g+=" L"+a+" "+(b+d);return g};
ia.SvgShape.drawArrowRight=function(a,b,c){var d=c/2,e=c*0.5,f=c*1;c*=0.5;var g="M"+(a+d)+" "+b;g+=" L"+(a+d-c)+" "+(b+f/2);g+=" L"+(a+d-c)+" "+(b+e/2);g+=" L"+(a-d)+" "+(b+e/2);g+=" L"+(a-d)+" "+(b-e/2);g+=" L"+(a+d-c)+" "+(b-e/2);g+=" L"+(a+d-c)+" "+(b-f/2);g+=" L"+(a+d)+" "+b;return g};
ia.SvgShape.drawArrowLeft=function(a,b,c){var d=c/2,e=c*0.5,f=c*1;c*=0.5;var g="M"+(a-d)+" "+b;g+=" L"+(a-d+c)+" "+(b+f/2);g+=" L"+(a-d+c)+" "+(b+e/2);g+=" L"+(a+d)+" "+(b+e/2);g+=" L"+(a+d)+" "+(b-e/2);g+=" L"+(a-d+c)+" "+(b-e/2);g+=" L"+(a-d+c)+" "+(b-f/2);g+=" L"+(a-d)+" "+b;return g};
ia.SvgShape.drawStar=function(a,b,c){var d=0.25*c;c*=0.5;var e,f,g,h,i;e=Math.PI*2/5;f=e/2;g=0.5*Math.PI;for(var k="M"+(a+Math.cos(g)*c)+" "+(b-Math.sin(g)*c),j=1;j<=5;j++)h=a+Math.cos(g+e*j-f)*d,i=b-Math.sin(g+e*j-f)*d,k+=" L"+h+" "+i,h=a+Math.cos(g+e*j)*c,i=b-Math.sin(g+e*j)*c,k+=" L"+h+" "+i;return k};ia.Shape=function(){};ia.Shape.CIRCLE="circle";ia.Shape.SQUARE="square";ia.Shape.LINE="line";ia.Shape.VERTICAL_LINE="vertical line";ia.Shape.HORIZONTAL_LINE="horizontal line";ia.Shape.MINUS="minus";
ia.Shape.PLUS="plus";ia.Shape.X="x";ia.Shape.DIAMOND="diamond";ia.Shape.STAR="star";ia.Shape.TRIANGLE_UP="triangle up";ia.Shape.TRIANGLE_DOWN="triangle down";ia.Shape.TRIANGLE_RIGHT="triangle right";ia.Shape.TRIANGLE_LEFT="triangle left";ia.Shape.ARROW_UP="arrow up";ia.Shape.ARROW_DOWN="arrow down";ia.Shape.ARROW_RIGHT="arrow right";ia.Shape.ARROW_LEFT="arrow left";
ia.Shape.draw=function(a,b,c,d,e,f,g){switch(a){case ia.Shape.SQUARE:this.drawSquare(b,c,d,e);break;case ia.Shape.LINE:this.drawLine(b,c,d,e,f,g);break;case ia.Shape.VERTICAL_LINE:this.drawVerticalLine(b,c,d,e);break;case ia.Shape.HORIZONTAL_LINE:this.drawHorizontalLine(b,c,d,e);break;case ia.Shape.MINUS:this.drawMinus(b,c,d,e);break;case ia.Shape.PLUS:this.drawPlus(b,c,d,e);break;case ia.Shape.X:this.drawX(b,c,d,e);break;case ia.Shape.CIRCLE:this.drawCircle(b,c,d,e);break;case ia.Shape.DIAMOND:this.drawDiamond(b,
c,d,e);break;case ia.Shape.TRIANGLE_UP:this.drawTriangleUp(b,c,d,e);break;case ia.Shape.TRIANGLE_DOWN:this.drawTriangleDown(b,c,d,e);break;case ia.Shape.TRIANGLE_RIGHT:this.drawTriangleRight(b,c,d,e);break;case ia.Shape.TRIANGLE_LEFT:this.drawTriangleLeft(b,c,d,e);break;case ia.Shape.ARROW_UP:this.drawArrowUp(b,c,d,e);break;case ia.Shape.ARROW_DOWN:this.drawArrowDown(b,c,d,e);break;case ia.Shape.ARROW_RIGHT:this.drawArrowRight(b,c,d,e);break;case ia.Shape.ARROW_LEFT:this.drawArrowLeft(b,c,d,e);break;
case ia.Shape.STAR:this.drawStar(b,c,d,e)}};ia.Shape.drawSquare=function(a,b,c,d){var e=d/2;a.rect(b-e,c-e,d,d)};ia.Shape.drawLine=function(a,b,c,d,e,f){d/=2;e!=void 0?a.dashedLine(b-d,c,b+d,c,e,f):(a.moveTo(b-d,c),a.lineTo(b+d,c))};ia.Shape.drawVerticalLine=function(a,b,c,d){a.rect(b-1,c-d/2,2,d)};ia.Shape.drawHorizontalLine=function(a,b,c,d){a.rect(b-d/2,c-1,d,2)};ia.Shape.drawMinus=function(a,b,c,d){var e=d*0.3;a.rect(b-d/2,c-e/2,d,e)};
ia.Shape.drawPlus=function(a,b,c,d){var e=d/2,d=d*0.3/2;a.moveTo(b-d,c-e);a.lineTo(b+d,c-e);a.lineTo(b+d,c-d);a.lineTo(b+e,c-d);a.lineTo(b+e,c+d);a.lineTo(b+d,c+d);a.lineTo(b+d,c+e);a.lineTo(b-d,c+e);a.lineTo(b-d,c+d);a.lineTo(b-e,c+d);a.lineTo(b-e,c-d);a.lineTo(b-d,c-d);a.lineTo(b-d,c-e)};
ia.Shape.drawX=function(a,b,c,d){var e=d/2,d=d*0.3/2,f=b-d-b,g=c-e-c,h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180),f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.moveTo(h+b,f+c);f=b+d-b;g=c-e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+e-b;g=
c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+e-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b+d-b;g=c+e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=
f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c+e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-e-b;g=c+d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+
b,f+c);f=b-e-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c-d-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c);f=b-d-b;g=c-e-c;h=f*Math.cos(45*Math.PI/180)-g*Math.sin(45*Math.PI/180);f=f*Math.sin(45*Math.PI/180)+g*Math.cos(45*Math.PI/180);a.lineTo(h+b,f+c)};
ia.Shape.drawCircle=function(a,b,c,d){d/=2;d>0&&a.arc(b,c,d,0,2*Math.PI,!1)};ia.Shape.drawDiamond=function(a,b,c,d){d/=2;a.moveTo(b,c-d);a.lineTo(b+d,c);a.lineTo(b,c+d);a.lineTo(b-d,c);a.lineTo(b,c-d)};ia.Shape.drawTriangleUp=function(a,b,c,d){d/=2;a.moveTo(b,c-d);a.lineTo(b+d,c+d);a.lineTo(b-d,c+d);a.lineTo(b,c-d)};ia.Shape.drawTriangleDown=function(a,b,c,d){d/=2;a.moveTo(b-d,c-d);a.lineTo(b+d,c-d);a.lineTo(b,c+d);a.lineTo(b-d,c-d)};
ia.Shape.drawTriangleRight=function(a,b,c,d){d/=2;a.moveTo(b-d,c-d);a.lineTo(b+d,c);a.lineTo(b-d,c+d);a.lineTo(b-d,c-d)};ia.Shape.drawTriangleLeft=function(a,b,c,d){d/=2;a.moveTo(b+d,c-d);a.lineTo(b+d,c+d);a.lineTo(b-d,c);a.lineTo(b+d,c-d)};ia.Shape.drawArrowUp=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b,c-e);a.lineTo(b+g/2,c-e+d);a.lineTo(b+f/2,c-e+d);a.lineTo(b+f/2,c+e);a.lineTo(b-f/2,c+e);a.lineTo(b-f/2,c-e+d);a.lineTo(b-g/2,c-e+d);a.lineTo(b,c-e)};
ia.Shape.drawArrowDown=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b,c+e);a.lineTo(b+g/2,c+e-d);a.lineTo(b+f/2,c+e-d);a.lineTo(b+f/2,c-e);a.lineTo(b-f/2,c-e);a.lineTo(b-f/2,c+e-d);a.lineTo(b-g/2,c+e-d);a.lineTo(b,c+e)};ia.Shape.drawArrowRight=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b+e,c);a.lineTo(b+e-d,c+g/2);a.lineTo(b+e-d,c+f/2);a.lineTo(b-e,c+f/2);a.lineTo(b-e,c-f/2);a.lineTo(b+e-d,c-f/2);a.lineTo(b+e-d,c-g/2);a.lineTo(b+e,c)};
ia.Shape.drawArrowLeft=function(a,b,c,d){var e=d/2,f=d*0.5,g=d*1;d*=0.5;a.moveTo(b-e,c);a.lineTo(b-e+d,c+g/2);a.lineTo(b-e+d,c+f/2);a.lineTo(b+e,c+f/2);a.lineTo(b+e,c-f/2);a.lineTo(b-e+d,c-f/2);a.lineTo(b-e+d,c-g/2);a.lineTo(b-e,c)};
ia.Shape.drawStar=function(a,b,c,d){var e=0.25*d;d*=0.5;var f,g,h,i,k;f=Math.PI*2/5;g=f/2;h=0.5*Math.PI;a.moveTo(b+Math.cos(h)*d,c-Math.sin(h)*d);for(var j=1;j<=5;j++)i=b+Math.cos(h+f*j-g)*e,k=c-Math.sin(h+f*j-g)*e,a.lineTo(i,k),i=b+Math.cos(h+f*j)*d,k=c-Math.sin(h+f*j)*d,a.lineTo(i,k)};
ia.Shape.drawGradient=function(a,b,c){c==null&&(c="bottomToTop");var d=a.getContext("2d"),e;c=="leftToRight"?e=d.createLinearGradient(0,0,a.width,0):c=="rightToLeft"?e=d.createLinearGradient(a.width,0,0,0):c=="topToBottom"?e=d.createLinearGradient(0,0,0,a.height):c=="bottomToTop"&&(e=d.createLinearGradient(0,a.height,0,0));for(var c=b.length,f=0;f<c;f++)e.addColorStop(f/(c-1),b[f]);d.rect(0,0,a.width,a.height);d.fillStyle=e};
ia.Formatter=function(){this.language="en";this.noDataValue="No Data";this.decimalSeparatorTo=".";this.thousandsSeparatorTo=","};ia.Formatter.prototype.language=void 0;ia.Formatter.prototype.noDataValue=void 0;ia.Formatter.prototype.precision=void 0;ia.Formatter.prototype.decimalSeparatorTo=void 0;ia.Formatter.prototype.thousandsSeparatorTo=void 0;ia.Formatter.prototype.format=function(a,b){b=b==void 0?this.precision:b;return ia.isNumber(a)?this.formatNumber(a,b):this.formatText(a)};
ia.Formatter.prototype.unformat=function(a){return parseFloat(a.split(this.thousandsSeparatorTo).join("").split(this.decimalSeparatorTo).join("."))};
ia.Formatter.prototype.formatNumber=function(a,b){var c=a<0?"-":"",d,e;if(b==void 0){var f=String(a).split(".");d=Math.abs(f[0])+"";e=d.length>3?d.length%3:0;return c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+this.thousandsSeparatorTo)+(f.length==2?this.decimalSeparatorTo+f[1]:"")}else return b==0?(d=Math.abs(parseInt(Math.abs(a||0).toFixed(b),10))+"",e=d.length>3?d.length%3:0,c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,
"$1"+this.thousandsSeparatorTo)):(d=Math.abs(parseInt(Math.abs(a||0).toFixed(b),10))+"",e=d.length>3?d.length%3:0,c+(e?d.substr(0,e)+this.thousandsSeparatorTo:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+this.thousandsSeparatorTo)+(b?this.decimalSeparatorTo+Math.abs(a).toFixed(b).split(".")[1]:""))};ia.Formatter.prototype.formatText=function(a){return a==="null"||a===null||a==="NaN"||a===""||a==="No Data"||a===void 0?this.noDataValue:String(a)};
ia.Locale=function(a){this._propertyHash={};this.formatter=new ia.Formatter;this.setLanguage(a||"en")};ia.Locale.prototype.getLanguage=function(){return this._language};
ia.Locale.prototype.setLanguage=function(a){this._language=a;this._language=="be"?(this._displayLanguage="\u0431\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0456",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="bg"?(this._displayLanguage="\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="ca"?(this._displayLanguage="catal\u00e0",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="."):this._language=="cs"?(this._displayLanguage="\u010de\u0161tina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="da"?(this._displayLanguage="dansk",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="de"?(this._displayLanguage="Deutsch",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="el"?(this._displayLanguage=
"\u03b5\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="en"?(this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=","):this._language=="es"?(this._displayLanguage="espa\u00f1ol",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="et"?(this._displayLanguage="Eesti",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo=
"\u00a0"):this._language=="fi"?(this._displayLanguage="suomi",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="fr"?(this._displayLanguage="fran\u00e7ais",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="hr"?(this._displayLanguage="hrvatski",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="hu"?(this._displayLanguage="magyar",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="is"?(this._displayLanguage="\u00edslenska",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="it"?(this._displayLanguage="italiano",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="lt"?(this._displayLanguage="Lietuvi\u0173",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="lv"?(this._displayLanguage=
"Latvie\u0161u",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="mk"?(this._displayLanguage="\u043c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="nl"?(this._displayLanguage="Nederlands",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="no"?(this._displayLanguage="norsk",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="pl"?(this._displayLanguage="polski",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="pt"?(this._displayLanguage="portugu\u00eas",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="ro"?(this._displayLanguage="rom\u00e2n\u0103",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="ru"?(this._displayLanguage=
"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="sk"?(this._displayLanguage="Sloven\u010dina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="sl"?(this._displayLanguage="Sloven\u0161\u010dina",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="sq"?(this._displayLanguage="shqipe",this.formatter.decimalSeparatorTo=
",",this.formatter.thousandsSeparatorTo="."):this._language=="sr"?(this._displayLanguage="\u0421\u0440\u043f\u0441\u043a\u0438",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language=="sv"?(this._displayLanguage="svenska",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="\u00a0"):this._language=="tr"?(this._displayLanguage="T\u00fcrk\u00e7e",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language==
"uk"?(this._displayLanguage="\u0443\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",this.formatter.decimalSeparatorTo=",",this.formatter.thousandsSeparatorTo="."):this._language.toLowerCase()=="none"?(this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=""):(this._language="en",this._displayLanguage="English",this.formatter.decimalSeparatorTo=".",this.formatter.thousandsSeparatorTo=",");this.formatter.language=this._language};
ia.Statistics=function(a){a!=void 0&&this.setData(a)};ia.Statistics.prototype.getData=function(){return this._data};ia.Statistics.prototype.setData=function(a){this._data=a;this._invalidateData()};ia.Statistics.prototype.getPercentile=function(a,b){if(a<0||a>1)return NaN;var c=a*(b.length+1),d=Math.floor(c);c-=d;var e=b[d-1],d=b[d];return parseFloat(e)+c*(d-e)};
ia.Statistics.prototype.toString=function(){return"-----Data-----\n Data: "+this.getData()+"\n Sorted data: "+this.sorted+"\n Unique data: "+this.unique+"\n\n -----Central tendency-----\n Mean: "+this.mean+"\n Median: "+this.median+"\n Mode: "+this.mode+"\n Mode Count: "+this.modeCount+"\n\n -----Variability-----\n Min: "+this.minValue+"\n Max: "+this.maxValue+"\n Range: "+this.range+"\n Lower quartile: "+this.lowerQuartile+"\n Upper quartile: "+this.upperQuartile+"\n Interquartile range: "+this.interquartileRange+
"\n Population Variance: "+this.variance+"\n Population Standard deviation: "+this.standardDeviation};
ia.Statistics.prototype.statsToString=function(){return"-----Central tendency-----\n Mean: "+this.mean+"\n Median: "+this.median+"\n Mode: "+this.mode+"\n Mode Count: "+this.modeCount+"\n\n -----Variability-----\n Min: "+this.minValue+"\n Max: "+this.maxValue+"\n Range: "+this.range+"\n Lower quartile: "+this.lowerQuartile+"\n Upper quartile: "+this.upperQuartile+"\n Interquartile range: "+this.interquartileRange+"\n Population Variance: "+this.variance+"\n Population Standard deviation: "+this.standardDeviation};
ia.Statistics.prototype._invalidateData=function(){this.sorted=[];for(var a=this._data.length,b=0;b<a;b++){var c=this._data[b];ia.isNumber(c)&&(this.sorted[this.sorted.length]=c)}this.sorted.sort(function(a,b){return a-b});this.unique=[];var d;this.count=this._data.length;var c=this.sum=0,e;this.mode=[];this.modeCount=0;for(var f=1,a=this.sorted.length,b=0;b<a;b++){e=this.sorted[b];if(e!=d){this.unique.push(e);if(f>this.modeCount)this.mode=[];if(f==this.modeCount)this.mode.push(d),this.modeCount=
f;f=1}else f++;d=e;this.sum+=parseFloat(e);e*=e;c+=e}this.mean=this.sum/a;this.lowerQuartile=this.getPercentile(0.25,this.sorted);this.median=this.getPercentile(0.5,this.sorted);this.upperQuartile=this.getPercentile(0.75,this.sorted);this.interquartileRange=this.upperQuartile-this.lowerQuartile;for(b=d=0;b<a;b++)e=this.sorted[b],c=e-this.mean,d+=c*c;this.variance=d/(a-1);this.standardDeviation=Math.sqrt(Math.abs(this.variance));this.minValue=this.sorted[0];this.maxValue=this.sorted[a-1];this.range=
this.maxValue-this.minValue};ia.TextSubstitution=function(){this._TAB=9;this._LINEFEED=10;this._CARRIAGE=13;this._SPACE=32;this._substitutionVariables={}};ia.TextSubstitution.prototype.setVariable=function(a,b){this._substitutionVariables[a]=b};ia.TextSubstitution.prototype.clearVariables=function(){this._substitutionVariables={}};
ia.TextSubstitution.prototype.formatMessage=function(a){for(a+="";a.indexOf("${")>=0;){var b=a.indexOf("${"),c=a.indexOf("}",b),b=a.substring(b,c+1);if((b.indexOf("&&")!=-1||b.indexOf("||")!=-1)&&b.indexOf("==")!=-1){for(var d=b.split("=="),c=this._trim(d[1]),c=c.substring(c.indexOf("(")+1,c.indexOf(")")),d=this._trim(d[0]),e=d.split(/&&|\|\|/),f=0;f<e.length;f++){var g=e[f],h;h=f==0?this._processVariable(this._trim(g)+"}"):this._processVariable("${"+this._trim(g)+"}");d=this._replace(d,g,h)}h=this._processVariable("${andOrTest('"+
d+"',"+c+")}")}else h=this._processVariable(b);a=this._replace(a,b,h)}return a};
ia.TextSubstitution.prototype._processVariable=function(a){var b=a.substring(a.indexOf("{")+1,a.indexOf("("));if(b.indexOf("themeName")!=-1){var b=this._substitutionVariables[b],c="";if(b!=void 0)if(b.length==1)c=b[0];else for(var a=a.substring(a.indexOf("'")+1,a.lastIndexOf("'")),d=0,e=0;e<b.length;e++){var f=b[e],c=d==0?f:c+a+f;d++}return c}if(b=="${")return this._formatValue(a.substring(2,a.length-1));a=this._trim(a.substring(a.indexOf("(")+1,a.lastIndexOf(")}")));c=a.split(",");b=b.toLowerCase();
if(b=="andortest"){a=this._formatValue(c[0]);d=this._formatValue(c[1]);e=this._formatValue(c[2]);try{if(b=eval(a),b==!0)return d;else if(b==!1)return e}catch(g){}}else if(b=="empty")if(a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a==void 0||a.toString()=="")return d;else{if(e!=void 0)return e}else if(b=="notempty")if(a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a!=void 0&&a.toString()!=
"")return d;else{if(e!=void 0)return e}else if(b=="equals")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a==b)return d;else{if(e!=void 0)return e}else if(b=="notequals")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a!=b)return d;else{if(e!=void 0)return e}else if(b=="greaterthan")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),
d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a>b)return d;else{if(e!=void 0)return e}else if(b=="greaterthanorequalto")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a>=b)return d;else{if(e!=void 0)return e}else if(b=="lessthan")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a<b)return d;else{if(e!=void 0)return e}else if(b==
"lessthanorequalto")if(a=this._formatValue(c[0]),b=this._formatValue(c[1]),d=this._formatValue(c[2]),e=this._formatValue(c[3]),c.length<3&&(d=!0,e=!1),a<=b)return d;else{if(e!=void 0)return e}else if(b=="even")return a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a%2==0?d:e;else if(b=="odd")return a=this._formatValue(c[0]),d=this._formatValue(c[1]),e=this._formatValue(c[2]),c.length<2&&(d=!0,e=!1),a%2==0?e:d;else if(b=="multiply")return a=this._formatValue(c[0]),
b=this._formatValue(c[1]),a*b;else if(b=="divide")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a/b;else if(b=="add")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a+b;else if(b=="subtract")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),a-b;else if(b=="min")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),Math.min(a,b);else if(b=="max")return a=this._formatValue(c[0]),b=this._formatValue(c[1]),Math.max(a,b);else if(b=="pow")return a=this._formatValue(c[0]),
b=this._formatValue(c[1]),Math.pow(a,b);else if(b=="sqrt")return a=this._formatValue(c[0]),Math.sqrt(a);else if(b=="exp")return a=this._formatValue(c[0]),Math.exp(a);else if(b=="log")return a=this._formatValue(c[0]),Math.log(a);else if(b=="abs")return a=this._formatValue(c[0]),Math.abs(a);return""};
ia.TextSubstitution.prototype._formatValue=function(a){if(a!=void 0){var b=this._trim(a),a="";if(b.indexOf("[")!=-1&&b.indexOf("]")!=-1){var c=b.substring(0,b.indexOf("[")),b=b.substring(b.indexOf("[")+1,b.indexOf("]")),c=this._substitutionVariables[c];c.indexOf(";")!=-1?a=c.split(";")[b]:c.indexOf(",")!=-1&&(a=c.split(",")[b])}else a=ia.isNumber(b)?parseFloat(b):b.charAt(0)=='"'||b.charAt(0)=="'"?b.substring(1,b.length-1):this._substitutionVariables[b];ia.isNumber(a)&&(a=parseFloat(a));if(a!=void 0)return a}return""};
ia.TextSubstitution.prototype._trim=function(a){return this._leftTrim(this._rightTrim(a))};ia.TextSubstitution.prototype._rightTrim=function(a){for(var b=a.length-1;a.charCodeAt(b)==this._SPACE||a.charCodeAt(b)==this._CARRIAGE||a.charCodeAt(b)==this._LINEFEED||a.charCodeAt(b)==this._TAB;)b--;return a.substring(0,b+1)};
ia.TextSubstitution.prototype._leftTrim=function(a){for(var b=0;a.charCodeAt(b)==this._SPACE||a.charCodeAt(b)==this._CARRIAGE||a.charCodeAt(b)==this._LINEFEED||a.charCodeAt(b)==this._TAB;)b++;return a.substring(b,a.length)};ia.TextSubstitution.prototype._replace=function(a,b,c){return a.split(b).join(c)};
ia.UrlParams=function(a){this.href=a;this.path=ia.File.getFileDirectory(decodeURIComponent(a));this.filename=ia.File.getFileName(decodeURIComponent(a));if(location.href.indexOf("#")!=-1)this.href=this.href.split("#")[0],a=a.split("#")[0];this.params={};if(a.indexOf("?")!=-1)for(var a=a.slice(a.indexOf("?")+1).split("&"),b=0;b<a.length;b++){var c=a[b].split("="),d=decodeURIComponent(c[0]),c=decodeURIComponent(c[1]);c=="false"&&(c=!1);c=="true"&&(c=!0);ia.isNumber(c)&&d!="select"&&d!="select2"&&(c=
parseFloat(c));this.params[d]=c}};ia.UrlParams.prototype.getReportUrl=function(){var a=this.path+this.filename+"?",b=!1,c;for(c in this.params){var d=this.params[c];d!=""&&d!=void 0&&(b==!0&&(a+="&"),a=a+c+"="+encodeURIComponent(this.params[c]),b=!0)}return a};
var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].substring)!=-1)return a[b].identity}else if(d)return a[b].identity}},
searchVersion:function(a){var b=a.indexOf(this.versionSearchString);return b==-1?void 0:parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,substring:"Chrome",identity:"Chrome"},{string:navigator.userAgent,substring:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,substring:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,substring:"iCab",
identity:"iCab"},{string:navigator.vendor,substring:"KDE",identity:"Konqueror"},{string:navigator.userAgent,substring:"Firefox",identity:"Firefox"},{string:navigator.vendor,substring:"Camino",identity:"Camino"},{string:navigator.userAgent,substring:"Netscape",identity:"Netscape"},{string:navigator.userAgent,substring:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,substring:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,substring:"Mozilla",
identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,substring:"Win",identity:"Windows"},{string:navigator.platform,substring:"Mac",identity:"Mac"},{string:navigator.userAgent,substring:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,substring:"Linux",identity:"Linux"}]};BrowserDetect.init();ia.File=function(){};ia.File.errorHandler=void 0;
ia.File.load=function(a){var b={};b.type=a.type||"GET";b.url=ia.getDomainSafeUrl(a.url);b.dataType=a.dataType||"text";if(a.contentType)b.contentType=a.contentType;if(a.data)b.data=a.data;if(a.onSuccess)b.success=a.onSuccess;b.error=function(c,d,e){if(a.onFail)a.onFail(c,d,e);ia.File.errorHandler&&ia.File.errorHandler(b.url,c,d,e,a)};$j.ajax(b)};
ia.File.getFileDirectory=function(a){var b=a;a.indexOf("?")>0&&(b=a.substring(0,a.lastIndexOf("?")));return b.indexOf("/")<0?b.substring(0,b.lastIndexOf("\\")+1):b.substring(0,b.lastIndexOf("/")+1)};ia.File.getFileName=function(a){var b=a;a.indexOf("?")>0&&(b=a.substring(0,a.lastIndexOf("?")));return b.indexOf("/")<0?b.substring(b.lastIndexOf("\\")+1):b.substring(b.lastIndexOf("/")+1)};ia.FeatureServiceReader=function(){};
ia.FeatureServiceReader.buildQuery=function(a,b,c){var d=a.split("?")[0],a=ia.FeatureServiceReader.getParam(a,"where");d.indexOf("/query?")==-1&&(d+="/query?where="+(a&&a!=""?encodeURIComponent(a):"1+%3D+1"));ia.isUndefined(c)||(d+="&objectIds="+c.join());ia.isUndefined(b)||(d+="&outFields="+b.join());return d};
ia.FeatureServiceReader.getFeatureServiceUrl=function(a){a.indexOf("/query?")!=-1?a=a.split("/query?")[0]:a.indexOf("/export?")!=-1?a=a.split("/export?")[0]:a.indexOf("/export")!=-1?a=a.split("/export")[0]:a.indexOf("?")!=-1&&(a=a.split("?")[0]);return a};ia.FeatureServiceReader.getParam=function(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);return c==null?"":decodeURIComponent(c[1].replace(/\+/g," "))};
ia.FeatureServiceReader.sendQuery=function(a,b,c){var d=ia.FeatureServiceReader.getParam(a,"outFields"),d=d!=""?d.split(/[\s,]+/):void 0,e=ia.FeatureServiceReader.getParam(a,"objectIds"),e=e!=""?e.split(/[\s,]+/):void 0,f=ia.FeatureServiceReader.getParam(a,"where");e==""&&(f=void 0);a.indexOf("f=json")==-1&&(a+=a.indexOf("?")>0?"&f=json":"?f=json");ia.FeatureServiceReader.getInfo(a,b,function(b,h){var i=Infinity;ia.isUndefined(b.maxRecordCount)||(i=ia.parseInt(b.maxRecordCount));ia.isUndefined(e)?
ia.FeatureServiceReader.getObjectIds(a,h,f,function(b){ia.isUndefined(b)?c.call(null,[]):ia.FeatureServiceReader.sendFeatureRequests(a,h,b,d,i,function(a){c.call(null,a)})}):ia.FeatureServiceReader.sendFeatureRequests(a,h,e,d,i,function(a){c.call(null,a)})})};
ia.FeatureServiceReader.sendFeatureRequests=function(a,b,c,d,e,f){a=ia.FeatureServiceReader.getFeatureServiceUrl(a);if(c.length>0){for(var e=Math.min(c.length,e),g=[];c.length>0;)g[g.length]=c.splice(0,e);var h=[],i=g.length,k=0,j=function(c){h=h.concat(c);k++;k==i?f.call(null,h):ia.FeatureServiceReader.getFeatureAttributes(a,b,g[k],d,j)};ia.FeatureServiceReader.getFeatureAttributes(a,b,g[k],d,j)}else f.call(null,[])};
ia.FeatureServiceReader.getInfo=function(a,b,c){var d=ia.FeatureServiceReader.getFeatureServiceUrl(a);!ia.isUndefined(b)&&b.indexOf("?")==0?a="token="+b:(a="f=json",ia.isUndefined(b)||(a+="&token="+b));ia.File.load({url:d,dataType:"json",type:"POST",data:a,onSuccess:function(a){if(a.error&&a.error.code==498)return ia.FeatureServiceReader.getInfo(d,void 0,c);else a.error&&a.error.code==499?ia.redirectToArcGisOnlineAuth():c.call(null,a,b)}})};
ia.FeatureServiceReader.getObjectIds=function(a,b,c,d){a=ia.FeatureServiceReader.getFeatureServiceUrl(a);a+="/query";var e="f=json&returnGeometry=false&returnIdsOnly=true&returnCountOnly=false";e+=ia.isUndefined(c)?"&where=1+%3D+1":"&where="+c;ia.isUndefined(b)||(e+="&token="+b);ia.File.load({url:a,type:"POST",dataType:"json",data:e,onSuccess:function(a){d.call(null,a.objectIds)}})};
ia.FeatureServiceReader.getFeatureAttributes=function(a,b,c,d,e){a=ia.FeatureServiceReader.getFeatureServiceUrl(a);a+="/query";var f="where=1+%3D+1&f=json&returnGeometry=false&returnIdsOnly=false&returnCountOnly=false";ia.isUndefined(c)||(f+="&objectIds="+c);f+=ia.isUndefined(d)?"&outFields=*":"&outFields="+d;ia.isUndefined(b)||(f+="&token="+b);ia.File.load({url:a,type:"POST",dataType:"json",data:f,onSuccess:function(a){e.call(null,a.features)}})};
ia.FeatureServiceReader.getFeatureGeometry=function(a,b,c,d,e,f,g){a=ia.FeatureServiceReader.getFeatureServiceUrl(a);a+="/query";var h="where=1+%3D+1&f=json&returnGeometry=true&returnIdsOnly=false&returnCountOnly=false";ia.isUndefined(c)||(h+="&objectIds="+c);ia.isUndefined(d)||(h+="&outFields="+d);ia.isUndefined(e)||(h+="&outSR="+e);ia.isUndefined(f)||(h+="&maxAllowableOffset="+f);ia.isUndefined(b)||(h+="&token="+b);ia.File.load({url:a,type:"POST",dataType:"json",data:h,onSuccess:function(a){g.call(null,
a.features)}})};ia.ReportConfig=function(){};ia.ReportConfig.prototype.loadSource=function(a,b){var c=this;ia.File.load({url:a,dataType:"xml",onSuccess:function(a){c.parseXML(a,b)}})};
ia.ReportConfig.prototype.parseXML=function(a,b){var c=this;c.xml=a;var d=$j(a),e=d.find("AtlasInterface").get(0);$j.each(e.attributes,function(a,b){c[b.name]=b.value});e=c.template.indexOf("::arcgisonline");if(e!=-1)c.template=c.template.substring(0,e);c._componentArray=[];c._componentHash={};e=d.find("Table[id^=comparisonTable]");$j.each(e,function(a,b){if($j(b).attr("visible")=="true"){var d=new ia.TableConfig(b);c._componentArray[c._componentArray.length]=d;c._componentHash[d.id]=d}});e=d.find("Component");
$j.each(e,function(a,b){if($j(b).attr("visible")=="true"){var d=new ia.ComponentConfig(b);c._componentArray[c._componentArray.length]=d;c._componentHash[d.id]=d}});e=d.find("Table").not("[id^=comparisonTable]");$j.each(e,function(a,b){if($j(b).attr("visible")=="true"){var d=new ia.TableConfig(b);c._componentArray[c._componentArray.length]=d;c._componentHash[d.id]=d}});c.properties={};e=d.find("PropertyGroup");$j.each(e,function(a,b){var d=$j(b).find("Property");$j.each(d,function(a,b){var d=new ia.PropertyConfig(b,
c);c.properties[d.id]=d})});c._buttonArray=[];c._buttonHash={};e=d.find("Button");$j.each(e,function(a,b){var d=new ia.ButtonConfig(b);c._buttonArray[c._buttonArray.length]=d;c._buttonHash[d.id]=d});c._textArray=[];c._textHash={};e=d.find("Text");$j.each(e,function(a,b){var d=new ia.TextConfig(b);c._textArray[c._textArray.length]=d;c._textHash[d.id]=d});c._imageArray=[];c._imageHash={};e=d.find("Image");$j.each(e,function(a,b){var d=new ia.ImageConfig(b);c._imageArray[c._imageArray.length]=d;c._imageHash[d.id]=
d});c._palette=new ia.PaletteConfig(d.find("MapPalettes"),c.getProperty("noDataColor"),c.getProperty("noDataValue"));b.call(null,c)};
ia.ReportConfig.prototype.removeWidget=function(a){var b=this.getWidget(a);if(b!=void 0){delete this._textHash[a];delete this._buttonHash[a];delete this._imageHash[a];delete this._componentHash[a];for(var c=0;c<this._textArray.length;c++)if(b=this._textArray[c],b.id==a){this._textArray.splice(c,1);break}for(c=0;c<this._buttonArray.length;c++)if(b=this._buttonArray[c],b.id==a){this._buttonArray.splice(c,1);break}for(c=0;c<this._imageArray.length;c++)if(b=this._imageArray[c],b.id==a){this._imageArray.splice(c,
1);break}for(c=0;c<this._componentArray.length;c++)if(b=this._componentArray[c],b.id==a){this._componentArray.splice(c,1);break}}};ia.ReportConfig.prototype.getWidgets=function(){return this._componentArray.concat(this._buttonArray).concat(this._textArray).concat(this._imageArray)};ia.ReportConfig.prototype.getWidget=function(a){if(this.getComponent(a))return this.getComponent(a);else if(this.getButton(a))return this.getButton(a);else if(this.getText(a))return this.getText(a);else if(this.getImage(a))return this.getImage(a)};
ia.ReportConfig.prototype.addComponent=function(a){a=new ia.ComponentConfig(a);this._componentArray[this._componentArray.length]=a;return this._componentHash[a.id]=a};ia.ReportConfig.prototype.addTable=function(a){a=new ia.TableConfig(a);this._componentArray[this._componentArray.length]=a;return this._componentHash[a.id]=a};ia.ReportConfig.prototype.addButton=function(a){a=new ia.ButtonConfig(a);this._buttonArray[this._buttonArray.length]=a;return this._buttonHash[a.id]=a};
ia.ReportConfig.prototype.addText=function(a){a=new ia.TextConfig(a);this._textArray[this._textArray.length]=a;return this._textHash[a.id]=a};ia.ReportConfig.prototype.addImage=function(a){a=new ia.ImageConfig(a);this._imageArray[this._imageArray.length]=a;return this._imageHash[a.id]=a};ia.ReportConfig.prototype.getComponents=function(){return this._componentArray};ia.ReportConfig.prototype.getComponent=function(a){return this._componentHash[a]};ia.ReportConfig.prototype.getButtons=function(){return this._buttonArray};
ia.ReportConfig.prototype.getButton=function(a){return this._buttonHash[a]};ia.ReportConfig.prototype.getTexts=function(){return this._textArray};ia.ReportConfig.prototype.getText=function(a){return this._textHash[a]};ia.ReportConfig.prototype.getImages=function(){return this._imageArray};ia.ReportConfig.prototype.getImage=function(a){return this._imageHash[a]};ia.ReportConfig.prototype.getMapPalette=function(){return this._palette};ia.ReportConfig.prototype.getProperties=function(){return this.properties};
ia.ReportConfig.prototype.getProperty=function(a){if(a=this.properties[a])return a.value};ia.ReportConfig.prototype.setProperty=function(a,b,c){if(a=this.properties[a])a.value=c?a.castValue(b):b};ia.WidgetConfig=function(a){this.xml=a;this._parseWidgetXML(a)};ia.WidgetConfig.prototype.parseXML=function(a){this._parseWidgetXML(a)};
ia.WidgetConfig.prototype._parseWidgetXML=function(a){var b=this;b.xml=a;this.anchor="left";this.visible=!0;$j.each(a.attributes,function(a,c){b[c.name]=c.value;if(c.name=="zIndex")b.zIndex=c.value});b.properties={};var c=$j(a).find("Property");$j.each(c,function(a,c){var f=new ia.PropertyConfig(c,b);b.properties[f.id]=f;if(f.id=="zIndex")b.zIndex=f.value;if(f.id=="visible")b.visible=f.value});if(this.x!=void 0)this.x=parseFloat(this.x)/800*100,this.x=Math.round(this.x*10)/10;if(this.y!=void 0)this.y=
parseFloat(this.y)/600*100,this.y=Math.round(this.y*10)/10;if(this.rescale=="false")this.width=parseFloat(this.width),this.height=parseFloat(this.height);else{if(this.width!=void 0)this.width=parseFloat(this.width)/800*100,this.width=Math.round(this.width*10)/10;if(this.height!=void 0)this.height=parseFloat(this.height)/600*100,this.height=Math.round(this.height*10)/10}this.type=a.nodeName.toLowerCase()};ia.WidgetConfig.prototype.getProperties=function(){return this.properties};
ia.WidgetConfig.prototype.getProperty=function(a){if(a=this.properties[a])return a.value};ia.WidgetConfig.prototype.setProperty=function(a,b,c){if(a=this.properties[a])a.value=c?a.castValue(b):b};ia.WidgetConfig.prototype.getAttribute=function(a){return $j(this.xml).attr(a)};ia.ComponentConfig=function(a){ia.ComponentConfig.baseConstructor.call(this,a);this._parseComponentXML(a)};ia.extend(ia.WidgetConfig,ia.ComponentConfig);ia.ComponentConfig.prototype.parseXML=function(a){this._parseWidgetXML(a)};
ia.ComponentConfig.prototype._parseComponentXML=function(){};ia.PropertyConfig=function(a,b){var c=this;this.parent=b;this.xml=a;$j.each(a.attributes,function(a,b){c[b.name]=b.value});c.value=c.castValue(c.value);if(c.choices)c.choices=c.choices.split(";")};
ia.PropertyConfig.prototype.castValue=function(a){if(this.type=="float"){if(a!="")return parseFloat(a)}else if(this.type=="integer"){if(a!="")return ia.parseInt(a)}else if(this.type=="boolean")return a==!0||a==!1?a:a=="true";else if(this.type=="string-array"||this.type=="colour-array"){if(a!=""){for(var b=a.split(","),a=0;a<b.length;a++)b[a].substring(0,1)=="'"&&(b[a]=b[a].substring(1)),b[a].substring(b[a].length-1)=="'"&&(b[a]=b[a].substring(0,b[a].length-1));return b}}else if(this.type=="float-array"){if(a!=
""){for(var b=a.split(","),c=Array(b.length),a=0;a<b.length;a++)c[a]=parseFloat(b[a]);return c}}else if(this.type=="integer-array"){if(a!=""){b=a.split(",");c=Array(b.length);for(a=0;a<b.length;a++)c[a]=ia.parseInt(b[a]);return c}}else if(this.type=="boolean-array"){b=a.split(",");c=Array(b.length);for(a=0;a<b.length;a++)c[a]=b[a]=="true";return c}else if(a!="")return a};ia.TableConfig=function(a){ia.TableConfig.baseConstructor.call(this,a);this._parseTableXML(a)};ia.extend(ia.WidgetConfig,ia.TableConfig);
ia.TableConfig.prototype.parseXML=function(a){this._parseTableXML(a)};
ia.TableConfig.prototype._parseTableXML=function(a){this._parseWidgetXML(a);var b=this,a=$j(a);b.customColumns=[];b._columnArray=[];b._columnHash={};var c=0,a=a.find("Column");$j.each(a,function(a,d){var g={},h=$j(d).attr("name");h!="name"&&(h+="_formatted");g.id=$j(d).attr("name");g.formattedId=h;g.label=$j(d).attr("alias");g.width=parseFloat($j(d).attr("width"));b._columnArray[a]=g;b._columnHash[g.id]=g;c+=g.width});a=1-c;if(a!=0){a/=b._columnArray.length;for(var d=0;d<b._columnArray.length;d++)b._columnArray[d].width+=
a}};ia.TableConfig.prototype.getColumn=function(){return this._columnHash[id]};ia.TableConfig.prototype.getColumns=function(){return this._columnArray};
ia.TableConfig.prototype.getColumnsForIndicator=function(a,b){for(var c=[],c=this.customColumns.length>0?this.customColumns.concat():this._columnArray.concat(),d=[],e=0;e<c.length;e++){var f=c[e],g={};g.id=f.id;g.formattedId=f.formattedId;g.label=b.formatMessage(f.label);g.width=f.width;g.type="categoric";if(g.id=="name")g.type="categoric";else if(g.id=="value")g.type=a.type;else if(f=a.getAssociate(g.id),f!=null)g.type=f.type;d.push(g)}return d};
ia.TableConfig.prototype.getColumnsForIndicators=function(a,b){for(var c=a[0],d=[],d=this.customColumns.length>0?this.customColumns.concat():this._columnArray.concat(),e=[],f=0;f<d.length;f++){var g=d[f],h=!0,i={};i.id=g.id;i.formattedId=g.formattedId;i.label=b.formatMessage(g.label);i.width=g.width;i.type="categoric";if(i.id=="name")i.type="categoric";else if(i.id=="value")i.type=c.type;else if(i.id.indexOf("~")!=-1){var g=i.id.split("~")[0],k=i.id.split("~")[1],k=a[k-1];if(k!=void 0)if(g=="value")i.type=
k.type;else{var j=k.getAssociate(g),m=k.geography.getFeatures()[0];g.toLowerCase()=="lowerlimit"&&k.getLowerLimits()!=void 0?i.type="numeric":g.toLowerCase()=="upperlimit"&&k.getUpperLimits()!=void 0?i.type="numeric":j?i.type=j.type:m.getProperty(i.id)?i.type="categoric":h=!1}}else j=c.getAssociate(i.id),m=c.geography.getFeatures()[0],i.id.toLowerCase()=="lowerlimit"&&c.getLowerLimits()!=void 0?i.type="numeric":i.id.toLowerCase()=="upperlimit"&&c.getUpperLimits()!=void 0?i.type="numeric":j?i.type=
j.type:m.getProperty(i.id)?i.type="categoric":h=!1;h&&e.push(i)}return e};ia.ButtonConfig=function(a){ia.ButtonConfig.baseConstructor.call(this,a);this._parseButtonXML(a)};ia.extend(ia.WidgetConfig,ia.ButtonConfig);ia.ButtonConfig.prototype.parseXML=function(a){this._parseButtonXML(a)};
ia.ButtonConfig.prototype._parseButtonXML=function(a){this._parseWidgetXML(a);this["css-class"]=this["css-class"]||"";this.text=this.text||"";this.target=this.target||"_blank";this.tooltip=this.tooltip||"";this.href=this.href||"";if(this.href!=""&&this.href.indexOf("http")==-1&&this.href.indexOf("javascript")==-1)this.href=ia.IAS_PATH+this.href};ia.TextConfig=function(a){ia.TextConfig.baseConstructor.call(this,a);this._parseTextXML(a)};ia.extend(ia.ButtonConfig,ia.TextConfig);
ia.TextConfig.prototype.parseXML=function(a){this._parseTextXML(a)};
ia.TextConfig.prototype._parseTextXML=function(a){this._parseButtonXML(a);this.cssProps={};if(this["wrap-width"]!="-1")this.width=parseFloat(this["wrap-width"])/800*100,this.width=Math.round(this.width*10)/10;this.fill!=void 0&&(this.cssProps.color=this.fill);this["font-family"]!=void 0&&(this.cssProps["font-family"]=this["font-family"]);this["font-size"]!=void 0&&(this.cssProps["font-size"]=this["font-size"]+"px");this["font-style"]!=void 0&&(this.cssProps["font-style"]=this["font-style"]);this["font-weight"]!=
void 0&&(this.cssProps["font-weight"]=this["font-weight"]);this.text=$j(a).text()};ia.ImageConfig=function(a){ia.ImageConfig.baseConstructor.call(this,a);this._parseImageXML(a)};ia.extend(ia.ButtonConfig,ia.ImageConfig);ia.ImageConfig.prototype.parseXML=function(a){this._parseImageXML(a)};ia.ImageConfig.prototype._parseImageXML=function(a){this._parseButtonXML(a);this.src=this.src||"";if(this.src!=""&&this.src.indexOf("http")==-1&&this.src.indexOf("javascript")==-1)this.src=ia.IAS_PATH+this.src};
ia.PaletteConfig=function(a,b,c){this.noDataColor=b;this.noDataValue=c;this.parseXML(a)};ia.PaletteConfig.prototype.noDataValue="";ia.PaletteConfig.prototype.noDataColor="";
ia.PaletteConfig.prototype.parseXML=function(a){var b=this,a=$j(a);this.defaultSchemeId=this.defaultPaletteId="";this.noClasses=5;this.minNoClasses=2;this.maxNoClasses=10;if(a.attr("default")!=void 0)this.defaultPaletteId=a.attr("default");if(a.attr("classes")!=void 0)this.noClasses=ia.parseInt(a.attr("classes"));if(a.attr("maxclasses")!=void 0)this.maxNoClasses=ia.parseInt(a.attr("maxclasses"));b._paletteArray=[];b._paletteHash={};var c=a.find("ColourRange");$j.each(c,function(a,c){var d=$j(c).find("Colour"),
e=[];$j.each(d,function(a,b){e.push($j(b).text())});d=new ia.ColorPalette(e);d.id=$j(c).attr("id");b._paletteHash[d.id]=d;b._paletteArray.push(d)});var d=this.noDataColor==void 0?"#f9f9f9":this.noDataColor,e=["null",null,"NaN","","No Data",void 0];e[e.length]=this.noDataValue;b._schemeArray=[];b._schemeHash={};c=a.find("ColourScheme");$j.each(c,function(a,c){var h=[],i=new ia.ColorPalette,k=$j(c).find("ColourMatch");$j.each(k,function(a,b){var c=$j(b).attr("for"),d=$j(b).text();h.push(d);i.matchColorsToValues[c]=
d});for(a=0;a<e.length;a++)i.matchColorsToValues[e[a]]=d;i.setColorList(h);i.id=$j(c).attr("id");b._schemeHash[i.id]=i;b._schemeArray.push(i)});this.defaultSchemeId=b._schemeArray[0].id};ia.PaletteConfig.prototype.getColorPalettes=function(){return this._paletteArray};ia.PaletteConfig.prototype.getColorPalettes=function(){return this._paletteArray};ia.PaletteConfig.prototype.getColorPalette=function(a){return this._paletteHash[a]};ia.PaletteConfig.prototype.getColorSchemes=function(){return this._schemeArray};
ia.PaletteConfig.prototype.getColorScheme=function(a){return this._schemeHash[a]};
ia.BaseData=function(a,b){this.data=a;this.parent=b;this._properties={};this.hasData=!1;this.type="categoric";if(this.parent!=void 0){this.type=this.parent.type;this.precision=this.parent.precision;var c=this.parent.getProperties();if(c!=void 0){var d=c.length,e;for(e in c)this._properties[e]=c[e]}}this.id=this.data.themeId||this.data.id;this.name=this.data.themeName||this.data.name;this.href=this.data.href;this.id=""+this.id;this.fileName=this.data.fileName;if(this.data.type!=void 0)this.type=this.data.type;
if(this.data.precision!=void 0)this.precision=ia.parseInt(this.data.precision);c=this.data.properties;if(c!=void 0){d=c.length;for(e=0;e<d;e++){var f=c[e];this._properties[f.name]=f.value}}this.customColumns=[];for(var g in this._properties)if(g.indexOf("column_")!=-1){c={};c.id=g.substring(g.indexOf("_")+1,g.length);if(c.id=="indicator")c.id="value";c.formattedId=c.id!="name"?c.id+"_formatted":c.id;c.label=this._properties[g];this.customColumns.push(c)}};ia.BaseData.prototype.getProperty=function(a){return this._properties[a]};
ia.BaseData.prototype.getProperties=function(){return this._properties};ia.BaseData.prototype.getChildren=function(){};
ia.BaseData.prototype.getDataTree=function(a,b,c,d){var c=c==void 0?{}:c,e={};e.id=this.geography?this.geography.id+"~"+this.id:this.id;e.label=this.name;if(this.href!=void 0)e.href=this.href;if(d!=void 0)e.parent=d;var f=this.getChildren(),d=[];if(f!=null){e.type="branch";for(var g=f.length,h,i=0;i<g;i++){var k=f[i];k.id!=h&&(this.geography?d.push(this.geography.id+"~"+k.id):d.push(this.id+"~"+k.id),k.getDataTree(a,b,c,e.id));h=k.id}if(d.length>0)e.children=d}else if(a!=!1&&this.date!=void 0){e.type=
"branch";a=this.theme.getIndicators(this.id);g=a.length;if(b)for(i=g-1;i>=0;i--){b=a[i];h={};h.id=this.geography.id+"~"+b.id+"~"+b.date;h.label=b.date;h.type="leaf";h.parent=e.id;if(b.href!=void 0)h.href=b.href;d.push(h.id);c[h.id]=h}else for(i=0;i<g;i++){b=a[i];h={};h.id=this.geography.id+"~"+b.id+"~"+b.date;h.label=b.date;h.type="leaf";h.parent=e.id;if(b.href!=void 0)h.href=b.href;d.push(h.id);c[h.id]=h}if(d.length>0)e.children=d}else e.type="leaf";c[e.id]=e;return c};
ia.ReportData=function(){ia.ReportData.baseConstructor.call(this);this._propertyHash={};this.loadByIndicator=!1;this.path=this.url="";this.formatter=new ia.Formatter};ia.extend(ia.EventDispatcher,ia.ReportData);ia.ReportData.prototype.getGeographies=function(){return this._geogArray};ia.ReportData.prototype.getProperty=function(a){return this._propertyHash[a]};ia.ReportData.prototype.setProperty=function(a,b){this._propertyHash[a]=b};ia.ReportData.prototype.getProperties=function(){return this._propertyHash};
ia.ReportData.prototype.getGeography=function(a){return this._geogHash[a]};ia.ReportData.prototype.addGeography=function(a){this.data.geographies[this.data.geographies.length]=a;a=new ia.Geography(this,a);a.index=this._geogArray.length;this._geogArray[a.index]=a;return this._geogHash[a.id]=a};ia.ReportData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(a);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseData(a,b)}})};
ia.ReportData.prototype.parseData=function(a,b){this.data=a;this._geogArray=[];this._geogHash={};var c=a.geographies;if(c!=void 0)for(var d=c.length,e=0;e<d;e++){var f=new ia.Geography(this,c[e]);f.index=e;this._geogArray[e]=f;this._geogHash[f.id]=f}b.call(null,this)};ia.ReportData.prototype.refresh=function(a){var b=this;b.parseData(b.data,function(){a.call(null,b)})};
ia.ReportData.prototype.getDataTree=function(a,b){var c={},d={id:"topLevel",label:"topLevel",type:"branch"};c[d.id]=d;var e=[],f;for(f in this._geogHash)e.push(f),this._geogHash[f].getDataTree(a,b,c,d.id);d.children=e;return c};ia.ReportData.prototype.getGeographyTree=function(){var a={},b={id:"topLevel",label:"topLevel",type:"branch"};a[b.id]=b;for(var c=[],d=0;d<this._geogArray.length;d++){var e=this._geogArray[d],f={};f.id=e.id;f.label=e.name;f.type="leaf";a[f.id]=f;c.push(e.id)}b.children=c;return a};
ia.Geography=function(a,b){this.reportData=a;this.parseData(b)};ia.extend(ia.BaseData,ia.Geography);
ia.Geography.prototype.parseData=function(a){ia.Geography.baseConstructor.call(this,a,this.reportData);this._featureArray=[];this._featureHash={};var b=this.data.features;if(b!=void 0)for(var a=b.length,c=0;c<a;c++){var d=new ia.Feature(b[c]);this._featureArray[c]=d;this._featureHash[d.id]=d}this._comparisonArray=[];this._comparisonHash={};b=this.data.comparisonFeatures;if(b!=void 0){a=b.length;for(c=0;c<a;c++)d=new ia.Feature(b[c]),d.isComparison=!0,this._comparisonArray[c]=d,this._comparisonHash[d.id]=
d}this._filterArray=[];this._filterHash={};b=this.data.filters;if(b!=void 0){a=b.length;for(c=0;c<a;c++)d=new ia.Filter(b[c]),this._filterArray[c]=d,this._filterHash[d.id]=d}this._themeArray=[];this._themeHash={};d=this.data.themes;if(d!=void 0){a=d.length;for(c=0;c<a;c++)b=new ia.Theme(this,void 0,d[c]),this._themeArray[c]=b,this._themeHash[b.id]=b}};ia.Geography.prototype.getThemes=function(){return this._themeArray};ia.Geography.prototype.getTheme=function(a){return this._themeHash[a]};
ia.Geography.prototype.getFeatures=function(){return this._featureArray};ia.Geography.prototype.getFeature=function(a){return this._featureHash[a]!=void 0?this._featureHash[a]:this.getComparisonFeature(a)};ia.Geography.prototype.getComparisonFeatures=function(){return this._comparisonArray};ia.Geography.prototype.getComparisonFeature=function(a){return this._comparisonHash[a]};ia.Geography.prototype.getFilters=function(){return this._filterArray};ia.Geography.prototype.getFilter=function(a){return this._filterHash[a]};
ia.Geography.prototype.getChildren=function(){return this._themeArray};ia.Geography.prototype.getFirstIndicator=function(a){return this._themeArray[0].getFirstIndicator(a)};ia.Geography.prototype.getIndicator=function(a,b,c){for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e].getNestedIndicator(a,b,c);if(f!=void 0)return f}};
ia.Geography.prototype.getIndicatorByName=function(a,b){for(var c=this._themeArray.length,d=0;d<c;d++){var e=this._themeArray[d].getIndicatorByName(a,b);if(e!=void 0)return e}};ia.Geography.prototype.loadIndicator=function(a,b,c){if(this.reportData.model!=void 0)this._loadIndicatorFromModel(a,b,c);else{var d=this.getIndicator(a,b);d&&d.parent.loadIndicator(a,b,c)}};
ia.Geography.prototype._loadIndicatorFromModel=function(a,b,c){function d(){if(e.reportData.loadByIndicator==!0){var d=e.getIndicator(a,b);d&&d.hasData?c.call(null,d):f.getIndicator(e.id,a,b,function(d){for(var f=0;f<d.length;f++){var g=d[f],j=e.getIndicator(g.id,g.date);if(j&&!j.hasData)j.data=g,j.parseData()}j=e.getIndicator(a,b);c.call(null,j)})}else(d=e.getIndicator(a,b))&&d.parent.loadIndicator(a,b,c)}var e=this,f=e.reportData.model;e.getFeatures().length==0?f.getFeatures(e.id,function(a){e.parseData(a);
d()}):d()};ia.Geography.prototype.getFilteredFeatures=function(a,b){for(var c=this._featureArray.length,d=[],e=0;e<c;e++){var f=this._featureArray[e],g=f.getFilterValue(a);if(g!=void 0)if(g.indexOf(";")!=-1)for(var g=g.split(";"),h=0;h<g.length;h++){if(g[h]==b){d.push(f.id);break}}else g==b&&d.push(f.id)}return d};
ia.Geography.prototype.getFilterTree=function(){var a={},b={id:"topLevel",label:"topLevel",type:"branch"};a[b.id]=b;for(var c=[],d=this._filterArray.length,e=this._featureArray.length,f=0;f<d;f++){var g=this._filterArray[f];if(d!=1){var h={};h.id=g.id;h.label=g.name;h.type="branch";h.parent=b.id;a[h.id]=h;c.push(h.id)}for(var i=[],k=0;k<e;k++){var j=this._featureArray[k].getFilterValue(g.id);if(j!=void 0)if(j.indexOf(";")!=-1)for(var j=j.split(";"),m=0;m<j.length;m++){var n=j[m];if(n!=void 0&&i.indexOf(g.id+
"~"+n)==-1){var l={};l.id=g.id+"~"+n;l.label=n;l.type="leaf";if(d!=1)l.parent=g.id;a[l.id]=l;i.push(l.id)}}else if(i.indexOf(g.id+"~"+j)==-1){l={};l.id=g.id+"~"+j;l.label=j;l.type="leaf";if(d!=1)l.parent=g.id;a[l.id]=l;i.push(l.id)}}i.sort();d!=1?h.children=i:b.children=i}if(d!=1)b.children=c;return a};ia.Geography.prototype.loadData=function(a){function b(){d++;d==c._themeArray.length?a.call(null,c):c._themeArray[d].loadData(b)}var c=this,d=0;this._themeArray.length>0&&this._themeArray[0].loadData(b)};
ia.Geography.prototype.getFeatureData=function(a,b,c){var d={};d.id=this.id;d.name=this.name;d.features=[];var e=this.getThemes(),f=e.length,g,h;a!=null?g=a.length:(h=this.getFeatures(),g=h.length);for(var i=0;i<g;i++){var k;k=a!=null?this.getFeature(a[i]):h[i];if(k!=void 0){var j={};j.id=k.id;j.name=k.name;j.href=k.href;j.properties=[];var m=k.getProperties(),n;for(n in m){var l={};l.name=n;l.value=m[n];l.formattedValue=this.reportData.formatter.format(l.value);j.properties[j.properties.length]=
l}j.themes=[];d.features[d.features.length]=j;if(c!=void 0)l=this.getTheme(c),l.hasData&&(l=l.getFeatureData(k,b),j.themes[j.themes.length]=l);else for(m=0;m<f;m++)l=e[m],l.hasData&&(l=l.getFeatureData(k,b),j.themes[j.themes.length]=l)}}return d};ia.Geography.prototype.getIndicatorData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.themes=[];for(var d=this.getThemes(),e=d.length,f=0;f<e;f++){var g=d[f];g.hasData&&(g=g.getIndicatorData(a,b),c.themes[c.themes.length]=g)}return c};
ia.Geography.prototype.getProfileData=function(a,b,c){var d={};d.id=this.id;d.name=this.name;d.themes=[];for(var e=this.getThemes(),f=e.length,g=0;g<f;g++)e[g].getProfileData(a,d.themes,b,c);return d};ia.Theme=function(a,b,c){ia.Theme.baseConstructor.call(this,c,b||a);this.hasThemes=!1;this.geography=a;this.hasData=c.fileName!=void 0||this.geography.reportData.model!=void 0?!1:!0;this.parseData(c)};ia.extend(ia.BaseData,ia.Theme);
ia.Theme.prototype.getCSV=function(a,b){var c=[],d=-1,e=this.getData(a,b),f=e.dates,g=f.length,h=e[f[0]];c[++d]='"id","name",';for(var i=0;i<g;i++){var k=f[i];c[++d]='"'+k+'"';i!=g-1&&(c[++d]=",")}c[++d]="\n";for(var j in h){k=h[j];c[++d]='"'+k.id+'",';c[++d]='"'+k.name+'",';for(i=0;i<g;i++)k=f[i],k=e[k][j],k=k.value,ia.isNumber(k)?c[++d]=k:c[++d]='"'+k+'"',i!=g-1&&(c[++d]=",");c[++d]="\n"}c.join("")};
ia.Theme.prototype.parseData=function(){if(this.data.fileName!=void 0)this.fileName=this.geography.reportData.path+this.data.fileName;this._themeArray=[];var a=this.data.themes;if(a!=void 0)for(var b=a.length,c=0;c<b;c++)this.hasThemes=!0,this._themeArray[c]=new ia.Theme(this.geography,this,a[c]);this._indicatorArray=[];this._indicatorHash={};this._indicatorDateHash={};a=this.data.indicators;if(a!=void 0)for(var d=[],e,b=a.length,c=0;c<b;c++){var f=new ia.Indicator(this.geography,this,a[c]);this._indicatorArray[c]=
f;f.date?(this._indicatorHash[f.id+"_"+f.date]=f,f.id!=e&&(d=[]),d.push(f.date),e=f.id,this._indicatorDateHash[f.id]=d):this._indicatorHash[f.id]=f}};ia.Theme.prototype.getThemes=function(){return this._themeArray};ia.Theme.prototype.getParentThemes=function(){for(var a=[this.name],b=this.parent;b.hasThemes==!0;)a.push(b.name),b=b.parent;return a.reverse()};ia.Theme.prototype.getChildren=function(){return this.hasThemes?this._indicatorArray.concat(this._themeArray):this._indicatorArray};
ia.Theme.prototype.getData=function(a,b){var c={dates:[],type:[]},d;d=a?this.getIndicators(a):this.getIndicators();for(var e=d.length,f=0;f<e;f++){var g=d[f];g.date!=void 0?(c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.date,c[g.date]=g.getData(b)):(c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.name,c[g.name]=g.getData(b))}return c};
ia.Theme.prototype.getDataForDate=function(a,b){for(var c={dates:[],type:[]},d=this.getIndicators(),e=d.length,f=0;f<e;f++){var g=d[f];if(g.date==a)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.name,c[g.name]=g.getData(b)}return c};ia.Theme.prototype.getComparisonData=function(a){for(var b={dates:[],type:[]},a=this.getIndicators(a),c=a.length,d=0;d<c;d++){var e=a[d];if(e.date!=void 0)b.type[b.type.length]=e.type,b.dates[b.dates.length]=e.date,b[e.date]=e.getComparisonData()}return b};
ia.Theme.prototype.getComparisonDataForDate=function(a){for(var b={dates:[],type:[]},c=this.getIndicators(),d=c.length,e=0;e<d;e++){var f=c[e];if(f.date==a)b.type[b.type.length]=f.type,b.dates[b.dates.length]=f.name,b[f.name]=f.getComparisonData()}return b};
ia.Theme.prototype.getIndicators=function(a){if(a==null||a==void 0)return this._indicatorArray;else{var b=this.getIndicatorDates(a),c=[];if(b!=void 0)for(var d=b.length,e=0;e<d;e++)c.push(this.getIndicator(a,b[e]));else c.push(this.getIndicator(a));return c}};ia.Theme.prototype.getIndicatorsWithDate=function(a){for(var b=this.getIndicatorIds(),c=[],d=0;d<b.length;d++)c[c.length]=this.getIndicator(b[d],a);return c};
ia.Theme.prototype.getFirstIndicator=function(a){a==void 0&&(a=!0);if(this._indicatorArray.length>0){var b=this.getIndicators(this._indicatorArray[0].id);return a?b[b.length-1]:b[0]}else if(this.hasThemes)for(b=this._themeArray.length;0<b;)return this._themeArray[0].getFirstIndicator(a)};
ia.Theme.prototype.getIndicator=function(a,b,c){c==void 0&&(c=!0);if(b!=void 0&&b!=""&&this._indicatorHash[a+"_"+b]!=void 0)return this._indicatorHash[a+"_"+b];else if(this._indicatorHash[a]!=void 0)return this._indicatorHash[a];else if(b=this.getIndicatorDates(a))return c?this._indicatorHash[a+"_"+b[b.length-1]]:this._indicatorHash[a+"_"+b[0]]};
ia.Theme.prototype.getIndicatorByName=function(a,b){for(var c=this._indicatorArray.length,d=0;d<c;d++){var e=this._indicatorArray[d];if(e.name==a)if(b){if(e.date==b)return e}else return e}};ia.Theme.prototype.getNestedIndicator=function(a,b,c){var d=this.getIndicator(a,b,c);if(d!=void 0)return d;if(this.hasThemes)for(var e=this._themeArray.length,f=0;f<e;f++)if(d=this._themeArray[f].getNestedIndicator(a,b,c),d!=void 0)return d};ia.Theme.prototype.getIndicatorDates=function(a){return this._indicatorDateHash[a]};
ia.Theme.prototype.getIndicatorIds=function(){for(var a=this._indicatorArray.length,b=[],c=0;c<a;c++){var d=this._indicatorArray[c];b.indexOf(d.id)==-1&&b.push(d.id)}return b};ia.Theme.prototype.getIndicatorNames=function(){for(var a=this._indicatorArray.length,b=[],c=0;c<a;c++){var d=this._indicatorArray[c];b.indexOf(d.name)==-1&&b.push(d.name)}return b};
ia.Theme.prototype.loadData=function(a){var b=this;if(b.hasData==!1){var c=b.geography.reportData.model;c!=void 0?c.getTheme(b.geography.id,b.id,function(c){b.data=c;b.hasData=!0;b.parseData();if(b.hasThemes){var e=0,f=function(){e++;e==b._themeArray.length?a.call(null,b):b._themeArray[e].loadData(f)};b._themeArray.length>0&&b._themeArray[0].loadData(f)}else a.call(null,b)}):ia.File.load({url:b.fileName,dataType:"json",onSuccess:function(c){b.data=c;b.hasData=!0;b.parseData();if(b.hasThemes){var e=
0,f=function(){e++;e==b._themeArray.length?a.call(null,b):b._themeArray[e].loadData(f)};b._themeArray.length>0&&b._themeArray[0].loadData(f)}else a.call(null,b)}})}else a.call(null,b)};ia.Theme.prototype.loadIndicator=function(a,b,c){var d=this,e=d.getIndicator(a,b);e!=void 0&&(d.hasData==!1?d.loadData(function(){var e=d.getIndicator(a,b);c.call(null,e)}):c.call(null,e))};
ia.Theme.prototype.getProfileData=function(a,b,c,d){var e={};e.id=this.id;e.name=this.name;e.indicators=[];b[b.length]=e;if(this.hasThemes)for(var f=this._themeArray.length,g=0;g<f;g++)this._themeArray[g].getProfileData(a,b,c,d);if(d&&c!=void 0)b=this.getIndicatorsWithDate(c);else if(d&&c==void 0){c=this.getIndicatorIds();b=[];for(g=0;g<c.length;g++)b[b.length]=this.getIndicator(c[g],void 0,!0)}else b=this.getIndicators();c=b.length;for(g=0;g<c;g++){d=b[g];f=d.profile;f.features=[];for(var h=a.length,
i=0;i<h;i++){var k=d.featureProfiles[a[i]];k&&(f.features[f.features.length]=k)}e.indicators[e.indicators.length]=f}};
ia.Theme.prototype.getFeatureData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.href=this.href;c.precision=this.precision;c.themes=[];c.indicators=[];if(this.hasThemes)for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e];f.hasData&&(f=f.getFeatureData(a,b),c.themes[c.themes.length]=f)}d=this.getIndicators();f=d.length;for(e=0;e<f;e++){var g=d[e];if(b==void 0||b==g.date){var h={};h.id=g.id;h.name=g.name;h.date=g.date;h.type=g.type;h.href=g.href;h.precision=g.precision;
h.value=g.getValue(a.id);h.formattedValue=g.getFormattedValue(a.id);h.associates=[];h.properties=[];for(var i=g.getAssociates(),k=i.length,j=0;j<k;j++){var m=i[j],n={};n.name=m.name;n.type=m.type;n.precision=m.precision;n.value=m.getValue(a.id);n.formattedValue=m.getFormattedValue(a.id);h.associates[h.associates.length]=n}if(k=g.getLowerLimits())i={},i.value=k.getValue(a.id),i.precision=k.precision,i.formattedValue=k.getFormattedValue(a.id),h.lowerLimit=i;if(k=g.getUpperLimits())i={},i.value=k.getValue(a.id),
i.precision=k.precision,i.formattedValue=k.getFormattedValue(a.id),h.upperLimit=i;var g=g.getProperties(),l;for(l in g)i={},i.name=l,i.value=g[l],i.formattedValue=this.geography.reportData.formatter.format(i.value),h.properties[h.properties.length]=i;c.indicators[c.indicators.length]=h}}return c};
ia.Theme.prototype.getIndicatorData=function(a,b){var c={};c.id=this.id;c.name=this.name;c.href=this.href;c.precision=this.precision;c.themes=[];c.indicators=[];if(this.hasThemes)for(var d=this._themeArray.length,e=0;e<d;e++){var f=this._themeArray[e];f.hasData&&(f=f.getIndicatorData(o,b),c.themes[c.themes.length]=f)}var g;a!=null?d=a.length:(g=this.geography.getFeatures(),d=g.length);for(var f=this.getIndicators(),h=f.length,e=0;e<h;e++){var i=f[e];if(b==void 0||b==i.date){var k={};k.id=i.id;k.name=
i.name;k.date=i.date;k.type=i.type;k.href=i.href;k.precision=i.precision;k.properties=[];var j=i.getProperties(),m;for(m in j){var n={};n.name=m;n.value=j[m];n.formattedValue=this.geography.reportData.formatter.format(n.value);k.properties[k.properties.length]=n}k.features=[];for(var l=0;l<d;l++){var o;o=a!=null?this.geography.getFeature(a[l]):g[l];var q={};q.id=o.id;q.name=o.name;q.href=o.href;q.value=i.getValue(o.id);q.formattedValue=i.getFormattedValue(o.id);q.associates=[];q.properties=[];j=o.getProperties();
for(m in j)n={},n.name=m,n.value=j[m],n.formattedValue=this.geography.reportData.formatter.format(n.value),q.properties[q.properties.length]=n;for(var j=i.getAssociates(),n=j.length,p=0;p<n;p++){var r=j[p],t={};t.name=r.name;t.type=r.type;t.precision=r.precision;t.value=r.getValue(o.id);t.formattedValue=r.getFormattedValue(o.id);q.associates[q.associates.length]=t}if(n=i.getLowerLimits())j={},j.value=n.getValue(o.id),j.precision=n.precision,j.formattedValue=n.getFormattedValue(o.id),q.lowerLimit=
j;if(n=i.getUpperLimits())j={},j.value=n.getValue(o.id),j.precision=n.precision,j.formattedValue=n.getFormattedValue(o.id),q.upperLimit=j;k.features[k.features.length]=q}c.indicators[c.indicators.length]=k}}return c};ia.Associate=function(a,b,c){ia.Associate.baseConstructor.call(this,c,b);this._stats=new ia.Statistics;this.indicator=b;this.geography=a;this.parseData(c)};ia.extend(ia.BaseData,ia.Associate);
ia.Associate.prototype.parseData=function(){this.id=this.data.name;this._indexHash={};this._valueArray=[];this._fValueArray=[];this.hasData=!1;if(this.data.values&&this.data.values.length>0){this.hasData=!0;this._valueArray=this.data.values.concat();for(var a=this.geography.getFeatures(),b=a.length,c,d,e=0;e<b;e++)d=a[e].id,c=this._valueArray[e],c=this.type=="categoric"?this.geography.reportData.formatter.formatText(c):this.geography.reportData.formatter.format(c,this.precision),c==this.geography.reportData.formatter.noDataValue&&
(this._valueArray[e]=c),this._indexHash[d]=e,this._fValueArray.push(c),d=this.indicator.featureProfiles[d],d[this.name]=this._valueArray[e],d[this.name+"_formatted"]=c,d[this.name+"_type"]=this.type;this._stats.setData(this._valueArray);this.mean=this._stats.mean;this.median=this._stats.median;this.count=this._stats.count;this.sum=this._stats.sum;this.minValue=this._stats.minValue;this.maxValue=this._stats.maxValue;this.range=this._stats.range;this.lowerQuartile=this._stats.lowerQuartile;this.upperQuartile=
this._stats.upperQuartile;this.interquartileRange=this._stats.interquartileRange;this.variance=this._stats.variance;this.standardDeviation=this._stats.standardDeviation;this.mean_formatted=this.geography.reportData.formatter.format(this.mean,this.precision);this.median_formatted=this.geography.reportData.formatter.format(this.median,this.precision);this.sum_formatted=this.geography.reportData.formatter.format(this.sum,this.precision);this.minValue_formatted=this.geography.reportData.formatter.format(this.minValue,
this.precision);this.maxValue_formatted=this.geography.reportData.formatter.format(this.maxValue,this.precision);this.range_formatted=this.geography.reportData.formatter.format(this.range,this.precision);this.lowerQuartile_formatted=this.geography.reportData.formatter.format(this.lowerQuartile,this.precision);this.upperQuartile_formatted=this.geography.reportData.formatter.format(this.upperQuartile,this.precision);this.interquartileRange_formatted=this.geography.reportData.formatter.format(this.interquartileRange,
this.precision);this.variance_formatted=this.geography.reportData.formatter.format(this.variance,this.precision);this.standardDeviation_formatted=this.geography.reportData.formatter.format(this.standardDeviation,this.precision);this.indicator.profile[this.name+"_minValue"]=this.minValue;this.indicator.profile[this.name+"_maxValue"]=this.maxValue;this.indicator.profile[this.name+"_sum"]=this.sum;this.indicator.profile[this.name+"_count"]=this.count;this.indicator.profile[this.name+"_mean"]=this.mean;
this.indicator.profile[this.name+"_median"]=this.median;this.indicator.profile[this.name+"_range"]=this.range;this.indicator.profile[this.name+"_lowerQuartile"]=this.lowerQuartile;this.indicator.profile[this.name+"_upperQuartile"]=this.upperQuartile;this.indicator.profile[this.name+"_interquartileRange"]=this.interquartileRange;this.indicator.profile[this.name+"_variance"]=this.variance;this.indicator.profile[this.name+"_standardDeviation"]=this.standardDeviation;this.indicator.profile[this.name+
"_minValue_formatted"]=this.minValue_formatted;this.indicator.profile[this.name+"_maxValue_formatted"]=this.maxValue_formatted;this.indicator.profile[this.name+"_sum_formatted"]=this.sum_formatted;this.indicator.profile[this.name+"_mean_formatted"]=this.mean_formatted;this.indicator.profile[this.name+"_median_formatted"]=this.median_formatted;this.indicator.profile[this.name+"_range_formatted"]=this.range_formatted;this.indicator.profile[this.name+"_lowerQuartile_formatted"]=this.lowerQuartile_formatted;
this.indicator.profile[this.name+"_upperQuartile_formatted"]=this.upperQuartile_formatted;this.indicator.profile[this.name+"_interquartileRange_formatted"]=this.interquartileRange_formatted;this.indicator.profile[this.name+"_variance_formatted"]=this.variance_formatted;this.indicator.profile[this.name+"_standardDeviation_formatted"]=this.standardDeviation_formatted}this._comparisonIndexHash={};this._comparisonArray=[];this._fComparisonArray=[];if(this.data.comparisonValues&&this.data.comparisonValues.length>
0){this._comparisonArray=this.data.comparisonValues.concat();a=this.geography.getComparisonFeatures();b=a.length;for(e=0;e<b;e++)d=a[e].id,c=this._comparisonArray[e],this._comparisonIndexHash[d]=e,c=this.geography.reportData.formatter.format(c,this.precision),this._fComparisonArray.push(c)}};ia.Associate.prototype.getValue=function(a){return this._indexHash[a]!=void 0?this._valueArray[this._indexHash[a]]:this.getComparisonValue(a)};ia.Associate.prototype.getValues=function(){return this._valueArray};
ia.Associate.prototype.getFormattedValue=function(a){return this._indexHash[a]!=void 0?this._fValueArray[this._indexHash[a]]:this.getFormattedComparisonValue(a)};ia.Associate.prototype.getFormattedValues=function(){return this._fValueArray};ia.Associate.prototype.getComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._comparisonArray[this._comparisonIndexHash[a]]};ia.Associate.prototype.getComparisonValues=function(){return this._comparisonArray};
ia.Associate.prototype.getFormattedComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._fComparisonArray[this._comparisonIndexHash[a]]};ia.Associate.prototype.getFormattedComparisonValues=function(){return this._fComparisonArray};
ia.Associate.prototype.getData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getFeatures(),c=d.length);for(var e=0;e<c;e++){var f;f=a!=null?this.geography.getFeature(a[e]):d[e];var g={};g.id=f.id;g.name=f.name;g.value=this.getValue(f.id);g.value_formatted=this.getFormattedValue(f.id);b[f.id]=g}return b};
ia.Associate.prototype.getComparisonData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getComparisonFeatures(),c=d.length);for(var e=0;e<c;e++){var f;f=a!=null?this.geography.getComparisonFeature(a[e]):d[e];var g={};g.id=f.id;g.name=f.name;g.value=this.getComparisonValue(f.id);g.value_formatted=this.getFormattedComparisonValue(f.id);b[f.id]=g}return b};
ia.Indicator=function(a,b,c){ia.Indicator.baseConstructor.call(this,c,b);this._stats=new ia.Statistics;this.theme=b;this.geography=a;this.profile={};this.featureProfiles={};this.parseData(c)};ia.extend(ia.BaseData,ia.Indicator);
ia.Indicator.prototype.parseData=function(){if(this.data.fileName!=void 0)this.fileName=this.geography.reportData.path+this.data.fileName;if(this.data.date!=void 0)this.date=this.data.date;this.hasData=!1;if(this.data.values&&this.data.values.length>0){this.hasData=!0;this._indexHash={};this._valueArray=this.data.values.concat();this._fValueArray=[];var a=this.geography.getFeatures(),b=a.length,c,d;this.featureProfiles={};for(var e=0;e<b;e++){var f=a[e];d=f.id;c=this._valueArray[e];c=this.type=="categoric"?
this.geography.reportData.formatter.formatText(c):this.geography.reportData.formatter.format(c,this.precision);c==this.geography.reportData.formatter.noDataValue&&(this._valueArray[e]=c);this._indexHash[d]=e;this._fValueArray.push(c);d={id:f.id,name:f.name,value:this._valueArray[e],value_formatted:c,isComparison:f.isComparison};c=this.getProperties();for(var g in c)d[g]=c[g],d[g+"_formatted"]=this.geography.reportData.formatter.format(c[g]),d[g+"_type"]=ia.Thematic.CATEGORIC;this.featureProfiles[f.id]=
d}this._stats.setData(this._valueArray);this.mean=this._stats.mean;this.median=this._stats.median;this.sum=this._stats.sum;this.count=this._stats.count;this.minValue=this._stats.minValue;this.maxValue=this._stats.maxValue;this.range=this._stats.range;this.lowerQuartile=this._stats.lowerQuartile;this.upperQuartile=this._stats.upperQuartile;this.interquartileRange=this._stats.interquartileRange;this.variance=this._stats.variance;this.standardDeviation=this._stats.standardDeviation;this.mean_formatted=
this.geography.reportData.formatter.format(this.mean,this.precision);this.median_formatted=this.geography.reportData.formatter.format(this.median,this.precision);this.sum_formatted=this.geography.reportData.formatter.format(this.sum,this.precision);this.minValue_formatted=this.geography.reportData.formatter.format(this.minValue,this.precision);this.maxValue_formatted=this.geography.reportData.formatter.format(this.maxValue,this.precision);this.range_formatted=this.geography.reportData.formatter.format(this.range,
this.precision);this.lowerQuartile_formatted=this.geography.reportData.formatter.format(this.lowerQuartile,this.precision);this.upperQuartile_formatted=this.geography.reportData.formatter.format(this.upperQuartile,this.precision);this.interquartileRange_formatted=this.geography.reportData.formatter.format(this.interquartileRange,this.precision);this.variance_formatted=this.geography.reportData.formatter.format(this.variance,this.precision);this.standardDeviation_formatted=this.geography.reportData.formatter.format(this.standardDeviation,
this.precision);this.profile={id:this.id,name:this.name,date:this.date,type:this.type,href:this.href,minValue:this.minValue,maxValue:this.maxValue,count:this.count,sum:this.sum,mean:this.mean,median:this.median,range:this.range,lowerQuartile:this.lowerQuartile,upperQuartile:this.upperQuartile,interquartileRange:this.interquartileRange,variance:this.variance,standardDeviation:this.standardDeviation,minValue_formatted:this.minValue_formatted,maxValue_formatted:this.maxValue_formatted,sum_formatted:this.sum_formatted,
mean_formatted:this.mean_formatted,median_formatted:this.median_formatted,range_formatted:this.range_formatted,lowerQuartile_formatted:this.lowerQuartile_formatted,upperQuartile_formatted:this.upperQuartile_formatted,interquartileRange_formatted:this.interquartileRange_formatted,variance_formatted:this.variance_formatted,standardDeviation_formatted:this.standardDeviation_formatted}}this._comparisonIndexHash={};this._comparisonArray=[];this._fComparisonArray=[];if(this.data.comparisonValues&&this.data.comparisonValues.length>
0){this._comparisonArray=this.data.comparisonValues.concat();a=this.geography.getComparisonFeatures();b=a.length;for(e=0;e<b;e++)d=a[e].id,c=this._comparisonArray[e],this._comparisonIndexHash[d]=e,c=this.geography.reportData.formatter.format(c,this.precision),this._fComparisonArray.push(c)}this._associateArray=[];this._associateHash={};a=this.data.associates;if(a!=void 0){b=a.length;for(e=0;e<b;e++){d=new ia.Associate(this.geography,this,a[e]);this._associateArray[e]=d;this._associateHash[d.id]=d;
if(a[e].name.toLowerCase()=="lowerlimit"||a[e].name.toLowerCase()=="lowerlimits")this._lowerLimits=new ia.Limits(this.geography,this,a[e].values);if(a[e].name.toLowerCase()=="upperlimit"||a[e].name.toLowerCase()=="upperlimits")this._upperLimits=new ia.Limits(this.geography,this,a[e].values)}}if(this.data.limits!=void 0)this._lowerLimits=new ia.Limits(this.geography,this,this.data.limits.lower),this._upperLimits=new ia.Limits(this.geography,this,this.data.limits.upper)};
ia.Indicator.prototype.getLowerLimits=function(){return this._lowerLimits};ia.Indicator.prototype.getUpperLimits=function(){return this._upperLimits};ia.Indicator.prototype.getValue=function(a){return this._indexHash[a]!=void 0?this._valueArray[this._indexHash[a]]:this.getComparisonValue(a)};ia.Indicator.prototype.getValues=function(){return this._valueArray};ia.Indicator.prototype.getFormattedValue=function(a){return this._indexHash[a]!=void 0?this._fValueArray[this._indexHash[a]]:this.getFormattedComparisonValue(a)};
ia.Indicator.prototype.getFormattedValues=function(){return this._fValueArray};ia.Indicator.prototype.getComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._comparisonArray[this._comparisonIndexHash[a]]};ia.Indicator.prototype.getComparisonValues=function(){return this._comparisonArray};ia.Indicator.prototype.getFormattedComparisonValue=function(a){if(this._comparisonIndexHash[a]!=void 0)return this._fComparisonArray[this._comparisonIndexHash[a]]};
ia.Indicator.prototype.getFormattedComparisonValues=function(){return this._fComparisonArray};ia.Indicator.prototype.getAssociate=function(a){return this._associateHash[a]};ia.Indicator.prototype.getAssociates=function(){return this._associateArray};ia.Indicator.prototype.getDataType=function(a){if(a=="value")return this.type;else if(this.getAssociate(a)!=void 0)return this.getAssociate(a).type;else if(a=="name")return ia.Thematic.CATEGORIC};
ia.Indicator.prototype.getDataPrecision=function(a){if(a=="value")return this.precision;else if(this.getAssociate(a)!=void 0)return this.getAssociate(a).precision};
ia.Indicator.prototype.getData=function(a){var b={},c,d;a!=null?c=a.length:(d=this.geography.getFeatures(),c=d.length);for(var e=this.getAssociates(),f=e.length,g=this.getLowerLimits(),h=this.getUpperLimits(),i=0;i<c;i++){var k;k=a!=null?this.geography.getFeature(a[i]):d[i];if(k!=void 0){var j={};j.id=k.id;j.name=k.name;j.value=this.getValue(k.id);j.value_formatted=this.getFormattedValue(k.id);var m=k.getProperties(),n;for(n in m)j[n]=m[n],j[n+"_formatted"]=this.geography.reportData.formatter.format(m[n]);
if(g)j.lowerLimit=g.getValue(k.id),j.lowerLimit_formatted=g.getFormattedValue(k.id);if(h)j.upperLimit=h.getValue(k.id),j.upperLimit_formatted=h.getFormattedValue(k.id);if(k.href)j.href=k.href;for(m=0;m<f;m++)j[e[m].name]=e[m].getValue(k.id),j[e[m].name+"_formatted"]=e[m].getFormattedValue(k.id);b[k.id]=j}}return b};
ia.Indicator.prototype.getComparisonData=function(){for(var a={},b=this.geography.getComparisonFeatures(),c=b.length,d=this.getAssociates(),e=d.length,f=this.getLowerLimits(),g=this.getUpperLimits(),h=0;h<c;h++){var i=b[h],k={};k.id=i.id;k.name=i.name;k.value=this.getComparisonValue(i.id);k.value_formatted=this.getFormattedComparisonValue(i.id);var j=i.getProperties(),m;for(m in j)k[m]=j[m],k[m+"_formatted"]=this.geography.reportData.formatter.format(j[m]);if(f)k.lowerLimit=f.getValue(i.id),k.lowerLimit_formatted=
f.getFormattedValue(i.id);if(g)k.upperLimit=g.getValue(i.id),k.upperLimit_formatted=g.getFormattedValue(i.id);if(i.href)k.href=i.href;for(j=0;j<e;j++)k[d[j].name]=d[j].getComparisonValue(i.id),k[d[j].name+"_formatted"]=d[j].getFormattedComparisonValue(i.id);a[i.id]=k}return a};
ia.Indicator.prototype.getAssociateData=function(a,b){for(var c={dates:[],type:[]},d=this.getAssociates(),e=d.length,f=0;f<e;f++){var g=d[f];if(a!=void 0){if(a.indexOf(g.id)!=-1)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getData(b)}else c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getData(b)}return c};
ia.Indicator.prototype.getAssociateComparisonData=function(a,b){for(var c={dates:[],type:[]},d=this.getAssociates(),e=d.length,f=0;f<e;f++){var g=d[f];if(a!=void 0){if(a.indexOf(g.id)!=-1)c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getComparisonData(b)}else c.type[c.type.length]=g.type,c.dates[c.dates.length]=g.id,c[g.name]=g.getComparisonData(b)}return c};
ia.Feature=function(a){ia.Feature.baseConstructor.call(this,a);this._filterHash={};this._filterHash={};a=this.data.filters;if(a!=void 0)for(var b=a.length,c=0;c<b;c++){var d=a[c];this._filterHash[d["for"]]=d.name}};ia.extend(ia.BaseData,ia.Feature);ia.Feature.prototype.getFilterValue=function(a){return this._filterHash[a]};ia.Filter=function(a){ia.Filter.baseConstructor.call(this,a)};ia.extend(ia.BaseData,ia.Filter);
ia.Limits=function(a,b,c){this._indexHash={};this._valueArray=c;this._fValueArray=[];if(this._valueArray){var d=a.getFeatures(),e=d.length;this.minValue=Infinity;this.maxValue=-Infinity;var f,g,h;for(h=0;h<e;h++)g=d[h].id,c=this._valueArray[h],f=a.reportData.formatter.format(c,b.precision),this._indexHash[g]=h,this.minValue=c<this.minValue?c:this.minValue,this.maxValue=c>this.maxValue?c:this.maxValue,this._fValueArray.push(f);for(var d=a.getComparisonFeatures(),e=d.length,i=0;i<e;i++){g=d[i].id;var k=
h++;this._valueArray.length>=k+1&&(c=this._valueArray[k],f=a.reportData.formatter.format(c,b.precision),this._indexHash[g]=k,this._fValueArray.push(f))}}};ia.Limits.prototype.getValue=function(a){return this._valueArray[this._indexHash[a]]};ia.Limits.prototype.getValues=function(){return this._valueArray};ia.Limits.prototype.getFormattedValue=function(a){return this._fValueArray[this._indexHash[a]]};ia.Limits.prototype.getFormattedValues=function(){return this._fValueArray};
ia.MapData=function(a){ia.MapData.baseConstructor.call(this);this._report=a;this._layerCount=-1;this._visibleLayers=[];this._callbackFnc=void 0;this._layerHash={};this._layerProperties={};this.tilePath="./";this.useGoogleMaps=!1;this.path="";this.maintainLayerOrder=!1};ia.extend(ia.EventDispatcher,ia.MapData);ia.MapData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(a);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseData(a,b)}})};
ia.MapData.prototype.getLayer=function(a){return this._layerHash[a]};
ia.MapData.prototype.parseData=function(a,b){this._layerCount=-1;this.useGoogleMaps=!1;this._callbackFnc=b;for(var c in this._layerHash)delete this._layerHash[c];this._visibleLayers=[];this.layers=[];this.baseLayers=[];this.noneBaseLayers=[];this.imageLayers=[];c=[];var d=[],e=[],f=[],g=[];this._layerHash={};this._layerProperties={};if(a.template!=void 0)this.template=a.template;if(a.version!=void 0)this.version=a.version;if(a.boundingBox!=void 0){var h=a.boundingBox.split(" ");this.mapBBox=new ia.BoundingBox(parseFloat(h[0]),
parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]))}if(this._report.config.template==ia.DOUBLE_BASELAYER_REPORT||this._report.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)this.maintainLayerOrder=!1;else if(a.maintainLayerOrder!=void 0)this.maintainLayerOrder=a.maintainLayerOrder;h=a.layers;if(h!=void 0){for(var i=h.length,k=0;k<i;k++){var j=h[k];if(j.type=="google-layer"&&navigator.onLine)this.useGoogleMaps=!0,this.googleMapType=j.mapType,this.googleApiKey=j.apiKey}for(k=0;k<i;k++){j=h[k];if(j.geometry==
"image"&&this.useGoogleMaps==!1){var m;j.type=="tile-layer"?(m=new ia.TileLayer(this.path+j.url),m.path=this.tilePath,this.setLayerJson(j,m)):j.type=="ags-layer"&&navigator.onLine?(j.tile==!0?(j.url=ia.FeatureServiceReader.getFeatureServiceUrl(j.url),m=new ia.WebTileLayer(j.url)):m=new ia.AGSLayer,this.setLayerJson(j,m)):j.type=="wms-layer"&&navigator.onLine&&(m=new ia.WMSLayer,this.setLayerJson(j,m));j.isReference?(m.isReference=!0,d[d.length]=m):this.imageLayers[this.imageLayers.length]=m}if(j.geometry!=
"image"){var n=!1,l=!1;j.dataType!=void 0?n=j.dataType=="geoJson":l=j.idField!=void 0;if(j.type=="base-layer"){if(m=n?new ia.GeoJsonLayer(j.url):l?new ia.FeatureServiceLayer(j.url):new ia.FeatureLayer(this.path+j.url),this.baseLayers[this.baseLayers.length]=m,this.baseLayers.length==1)this.baseLayer=m}else j.type=="contextual-layer"?m=n?new ia.GeoJsonLayer(j.url):l?new ia.FeatureServiceLayer(j.url):new ia.FeatureLayer(this.path+j.url):j.type=="rss-layer"&&(m=new ia.GeoRSSLayer(j.url));this.setLayerJson(j,
m);j.type=="base-layer"&&this.baseLayers.length>1&&(m=this._visibleLayers.pop(),m.setVisible(!1));j.type!="base-layer"&&(c[c.length]=m,m.geometry=="point"?e[e.length]=m:m.geometry=="line"?f[f.length]=m:m.geometry=="polygon"&&(g[g.length]=m));this._layerHash[m.id]=m}this.maintainLayerOrder&&j.isReference!=!0&&(this.layers[this.layers.length]=m,j.type!="base-layer"&&(this.noneBaseLayers[this.noneBaseLayers.length]=m))}if(a.maintainContextualLayerOrder){c.reverse();this.noneBaseLayers=this.imageLayers.concat(c).concat(d);
for(k=this.baseLayers.length-1;k>=0;k--)m=this.baseLayers[k],m.geometry=="point"?c.push(m):m.geometry=="line"?c.push(m):m.geometry=="polygon"&&c.unshift(m);this.layers=this.imageLayers.concat(c).concat(d)}else if(this.maintainLayerOrder)this.layers=d.concat(this.layers),this.noneBaseLayers=d.concat(this.noneBaseLayers);else{this.noneBaseLayers=this.imageLayers.concat(g).concat(f).concat(e).concat(d);for(k=this.baseLayers.length-1;k>=0;k--)m=this.baseLayers[k],m.geometry=="point"?e.unshift(m):m.geometry==
"line"?f.unshift(m):m.geometry=="polygon"&&g.unshift(m);this.layers=this.imageLayers.concat(g).concat(f).concat(e).concat(d)}}this.useGoogleMaps&&ia.googleMapsLoaded==!1?(m=document.createElement("script"),m.type="text/javascript",c=window.location.protocol=="file:"?"http:":window.location.protocol,m.src=this.googleApiKey!=""?c+"//maps.googleapis.com/maps/api/js?key="+this.googleApiKey+"&sensor=false&callback=ia.initGoogleMaps":c+"//maps.google.com/maps/api/js?sensor=false&callback=ia.initGoogleMaps",
document.body.appendChild(m)):this.loadVisibleLayers()};
ia.MapData.prototype.setLayerJson=function(a,b,c){b.id=a.id;this._layerProperties[b.id]=a;b.name=a.name;b.type=a.type;b.showInLayerList=a.showInLayerList;if(a.visible!=void 0&&c!=!0&&(b.setVisible(a.visible),a.visible==!0||a.type=="base-layer"))this._visibleLayers[this._visibleLayers.length]=b;if(a.displayLabelsOnly!=void 0)b.displayLabelsOnly=a.displayLabelsOnly;if(a.labelPosition!=void 0)b.labelPosition=a.labelPosition;if(a.labelFunction!=void 0)b.labelFunction=a.labelFunction;if(a.minLabelExtent!=
void 0)b.minLabelExtent=a.minLabelExtent;if(a.maxLabelExtent!=void 0)b.maxLabelExtent=a.maxLabelExtent;if(a.showLabels!=void 0)b.showLabels=a.showLabels;if(a.showDataTips!=void 0)b.showDataTips=a.showDataTips;if(a.iconPath!=void 0&&a.iconPath!=""&&(b.iconPath=a.iconPath,b.iconPath.indexOf("http")==-1&&b.iconPath.indexOf("javascript")==-1))b.iconPath=ia.IAS_PATH+b.iconPath;if(a.dataType!=void 0)b.dataType=a.dataType;if(a.idField!=void 0)b.idField=a.idField;if(a.nameField!=void 0)b.nameField=a.nameField;
if(a.srs!=void 0)b.srs=a.srs;if(a.featureIds!=void 0)b.featureIds=a.featureIds;if(a.objectIds!=void 0)b.objectIds=a.objectIds;if(a.boundingBox!=void 0)c=a.boundingBox.split(" "),b.bBox=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));if(a.themeColors!=void 0)b.themeColors=a.themeColors;b.geometry=a.geometry;if(a.geometry!="image"){c=b.style;if(a.symbolSize!=void 0)b.symbolSize=a.symbolSize;if(a.fillColor!=void 0)c.fillStyle=ia.Color.toRGBA(a.fillColor,a.fillOpacity);
if(a.borderThickness!=void 0)c.lineWidth=a.borderThickness;if(a.borderColor!=void 0){var d=1;c.lineWidth==0&&(d=0);c.strokeStyle=ia.Color.toRGBA(a.borderColor,d)}b.style=c}else if(a.opacity!=void 0)b.opacity=a.opacity;if(a.url!=void 0)b.url=a.url;if(a.layers!=void 0)b.layers=a.layers;if(a.srs!=void 0)b.srs=a.srs;if(a.version!=void 0)b.version=a.version;if(a.params!=void 0)b.params=a.params;if(a.requiresAxisSwitch!=void 0)b.requiresAxisSwitch=a.requiresAxisSwitch;if(a.minExtent!=void 0)b.minExtent=
a.minExtent;if(a.maxExtent!=void 0)b.maxExtent=a.maxExtent};ia.MapData.prototype.getLayerJson=function(a){return this._layerProperties[a]};
ia.MapData.prototype.loadVisibleLayers=function(){this._layerCount++;var a=this;if(this._visibleLayers.length>this._layerCount){var b=this._visibleLayers[this._layerCount];b.addEventListener(ia.Event.LAYER_READY,function(){a.loadVisibleLayers()});b.loadSource()}else this._callbackFnc.call(null,this),a.dispatchEvent(new ia.DataEvent(ia.DataEvent.MAP_DATA_CHANGED,a))};
ia.DataEvent=function(a,b,c,d,e){ia.DataEvent.baseConstructor.call(this,a,b);this.data=b;this.geography=c;this.theme=d;this.indicator=e};ia.extend(ia.Event,ia.DataEvent);ia.DataEvent.DATA_CHANGED="dataChanged";ia.DataEvent.GEOG_CHANGED="geogChanged";ia.DataEvent.THEME_CHANGED="themeChanged";ia.DataEvent.INDICATOR_CHANGED="indicatorChanged";
ia.FilterEvent=function(a,b,c,d,e,f){ia.FilterEvent.baseConstructor.call(this,a,b);this.data=b;this.filterId=c;this.filterName=d;this.filterValue=e;this.filterFeatures=f.concat()};ia.extend(ia.Event,ia.FilterEvent);ia.FilterEvent.FILTER_CHANGED="filterChanged";ia.AGOLData=function(){this.iaData={};this.geogModels={};this.geogs={};this.themes={};this.indicators={}};
ia.AGOLData.prototype.loadSource=function(a,b){var c=this;this.url=a;this.path=ia.File.getFileDirectory(this.url);ia.File.load({url:a,dataType:"json",onSuccess:function(a){c.parseData(a,b)}})};
ia.AGOLData.prototype.parseData=function(a,b){var c=this;this.geogModels={};this.geogs={};this.themes={};this.indicators={};this.dataModel=a;this.iaData={version:a.version,geographies:[]};var d=a.geographies;if(d!=void 0&&d.length>0){var e=-1,f=function(){e++;e==d.length?b.call(null,c.iaData):c.buildGeography(d[e],function(){f()})};f()}else b.call(null,c.iaData)};ia.AGOLData.prototype.getGeography=function(a){return this.geogs[a]};
ia.AGOLData.prototype.buildGeography=function(a,b){var c={id:a.id,name:a.name,type:a.type,url:a.url,idField:a.idField,nameField:a.nameField,themes:[],features:[],comparisonFeatures:[],fieldNames:[a.idField,a.nameField],urlList:[],indicatorList:[]};this.geogs[c.id]==void 0&&(this.iaData.geographies[this.iaData.geographies.length]=c);this.geogModels[a.id]=a;this.geogs[c.id]=c;if(a.objectIds!=void 0)c.objectIds=a.objectIds.split(",");if(a.model.filters!=void 0)c.filters=a.model.filters;if(a.model.features!=
void 0){var d=a.model.features.properties;if(d!=void 0)for(var e=0;e<d.length;e++){var f=d[e];if(c.fieldNames.indexOf(f.src.fieldName)==-1)c.fieldNames[c.fieldNames.length]=f.src.fieldName}d=a.model.features.filters;if(d!=void 0)for(e=0;e<d.length;e++)if(f=d[e],c.fieldNames.indexOf(f.src.fieldName)==-1)c.fieldNames[c.fieldNames.length]=f.src.fieldName}e=a.model.themes;e!=void 0&&e.length>0?this.buildThemes(c,c,e,function(){b.call(null,c)}):b.call(null,c)};
ia.AGOLData.prototype.buildThemes=function(a,b,c,d){function e(){g++;g==c.length?d.call(null):f.buildTheme(a,b,c[g],e)}var f=this,g=-1;e()};
ia.AGOLData.prototype.buildTheme=function(a,b,c,d){if(c.sourceType&&c.sourceType=="IA-JSON")$j.getJSON(ia.getDomainSafeUrl(c.url)).done(function(a){if(a.geographies)for(var c=0;c<a.geographies.length;c++)for(var e=a.geographies[c],f=0;f<e.themes.length;f++)b.themes[b.themes.length]=e.themes[f];else b.themes[b.themes.length]=a;d.call(null)}).fail(function(){});else{var e={id:c.id,precision:c.precision,href:c.href,name:c.name,properties:c.properties,indicators:[]};this.themes[e.id]=e;if(c.src)e.url=
c.src.url;b.themes[b.themes.length]=e;for(var f=c.indicators,g=0;g<f.length;g++){var h=f[g],i=this.buildIndicator(a,e,h);e.indicators[e.indicators.length]=i;if(h.associates!=void 0&&h.associates.length>0){i.associates=[];for(var k=0;k<h.associates.length;k++){var j=this.buildIndicator(a,e,h.associates[k]);i.associates[i.associates.length]=j}}}c.themes&&c.themes.length>0?(e.themes=[],this.buildThemes(a,e,c.themes,function(){d.call(null)})):d.call(null)}return e};
ia.AGOLData.prototype.buildIndicator=function(a,b,c){var d={id:c.id,name:c.name,precision:c.precision,href:c.href,url:c.src.url,srcFormat:c.src.format,fieldName:c.src.fieldName,rowFilters:c.src.rowFilters,properties:c.properties,values:[],comparisonValues:[]};c.date!="null"&&c.date!=null&&c.date!="NaN"&&c.date!=""&&c.date!="No Data"&&c.date!=void 0?(d.date=c.date,this.indicators[d.id+"_"+d.date]=d):this.indicators[d.id]=d;d.type=c.type?c.type.toLowerCase():"numeric";if(d.url==a.url||d.url==void 0||
d.url==""){c=",0";if(d.fieldName&&d.fieldName.indexOf(c,this.length-c.length)!==-1)c=d.fieldName.split(","),c.pop(),d.fieldName=c.join(",");if(b.url!=void 0&&b.url!="")a.urlList[b.url]==void 0&&(a.urlList[b.url]=[]),a.urlList[b.url].push(d),d.url=b.url;else{if(a.fieldNames.indexOf(d.fieldName)==-1)a.fieldNames[a.fieldNames.length]=d.fieldName;a.indicatorList[a.indicatorList.length]=d}}else{if((!d.srcFormat||d.srcFormat.toLowerCase().indexOf("csv")<0)&&(d.url.indexOf("FeatureServer")!=-1||d.url.indexOf("MapServer")!=
-1||d.url.indexOf("?f=geojson")>0||d.url.indexOf("&f=geojson")>0||d.url.indexOf("?sv=")>0)){if(d.idField=c.src.idField!=void 0&&c.src.idField!=""?c.src.idField:a.idField,c=",0",d.fieldName&&d.fieldName.indexOf(c,this.length-c.length)!==-1)c=d.fieldName.split(","),c.pop(),d.fieldName=c.join(",")}else c=c.src.fieldName.split(","),d.idField=c.pop(),d.fieldName=c.join(",");a.urlList[d.url]==void 0&&(a.urlList[d.url]=[]);a.urlList[d.url].push(d)}if(a.firstIndicator==void 0)a.firstIndicator=d;return d};
ia.AGOLData.prototype.getFeatures=function(a,b){var c=this,d=c.geogs[a];d.url.indexOf("?f=geojson")>0||d.url.indexOf("&f=geojson")>0||d.url.indexOf("?sv=")>0?ia.File.load({url:d.url,dataType:"json",onSuccess:function(e){d.fsFeatures=e.features;c._processFeatures(a,e.features,function(){var a=d.firstIndicator;a!=void 0?c.getIndicator(d.id,a.id,a.date,function(){b.call(null,d)}):b.call(null,d)})}}):this._checkForRelationships(a,function(){var e=ia.FeatureServiceReader.buildQuery(d.url,d.fieldNames,
d.objectIds);ia.FeatureServiceReader.sendQuery(e,ia.accessToken,function(e){d.fsFeatures=e;c._processFeatures(a,e,function(){var a=d.firstIndicator;a!=void 0?c.getIndicator(d.id,a.id,a.date,function(){b.call(null,d)}):b.call(null,d)})})})};
ia.AGOLData.prototype._checkForRelationships=function(a,b){var c=this,d=this.geogs[a];ia.FeatureServiceReader.getInfo(d.url,ia.accessToken,function(a){if(a.relationships!=void 0&&a.relationships.length>0){var f=-1,g=function(){f++;if(f==a.relationships.length)b.call(null);else{var h=a.relationships[f];if(h.cardinality=="esriRelCardinalityOneToMany"){var i=d.url+"/queryRelatedRecords",k="outFields="+d.fieldNames.join(",")+"&relationshipId="+h.id+"&objectids=1&returnGeometry=false&f=pjson";ia.File.load({url:i,
type:"POST",dataType:"json",data:k,onSuccess:function(a){if(a.relatedRecordGroups!=void 0&&a.relatedRecordGroups.length>0&&(a=a.relatedRecordGroups[0],a.relatedRecords!=void 0&&a.relatedRecords.length>0)){a=a.relatedRecords[0].attributes;d.comparisonFeatures[d.comparisonFeatures.length]={id:String(h.id),name:String(a.NAME)};for(var b=0;b<d.indicatorList.length;b++){var e=d.indicatorList[b],f=a[e.fieldName];if(f==="null"||f===null||f==="NaN"||f===""||f===void 0)f=c.formatter.noDataValue;e.comparisonValues[e.comparisonValues.length]=
f}}g()},onFail:function(){g()}})}else g()}};g()}else b.call(null)})};ia.AGOLData.prototype.getTheme=function(a,b,c){function d(){h++;if(h==g.indicators.length)c.call(null,g);else{var a=g.indicators[h];if(a.values&&a.values.length>0)d();else{var b=f.urlList[a.url];b&&b.length>0?e._loadIndicatorData(f,a.url,b,function(){d()}):d()}}}var e=this,f=e.geogs[a],g=getThemeJson(f.themes,b),h=-1;d()};
function getThemeJson(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.id==b)return d;else if(d.themes&&d.themes.length>0&&(d=getThemeJson(d.themes,b),d!=!1))return d}return!1}ia.AGOLData.prototype.getIndicator=function(a,b,c,d){var a=this.geogs[a],b=c!="null"&&c!=null&&c!="NaN"&&c!=""&&c!="No Data"&&c!=void 0?this.indicators[b+"_"+c]:this.indicators[b],e=a.urlList[b.url];e&&e.length>0?this._loadIndicatorData(a,b.url,e,function(){d.call(null,e)}):d.call(null,e)};
function updateJson(a,b,c){for(b=0;b<c.length;b++)for(var d=c[b],e=d.id,f=d.date,g=0;g<a.themes.length;g++)for(var h=a.themes[g],i=0;i<h.indicators.length;i++){var k=h.indicators[i];if(f!="null"&&f!=null&&f!="NaN"&&f!=""&&f!="No Data"&&f!=void 0){if(k.id==e&&k.date==f)k.values=d.values.concat()}else if(k.id==e)k.values=d.values.concat()}}
ia.AGOLData.prototype._loadIndicatorData=function(a,b,c,d){function e(){g++;if(g==c.length)d.call(null);else{var h=c[g];h.values&&h.values.length>0?e():(!h.srcFormat||h.srcFormat.toLowerCase().indexOf("csv")<0)&&(b.indexOf("FeatureServer")!=-1||b.indexOf("MapServer")!=-1)?f.getQueryData(a.idField,a.features,b,c,e):(!h.srcFormat||h.srcFormat.toLowerCase().indexOf("csv")<0)&&(b.indexOf("?f=geojson")>0||b.indexOf("&f=geojson")>0||b.indexOf("?sv=")>0)?f.getGeoJsonData(a.idField,a.features,b,c,e):f.readCsvFile(a,
a.idField,a.fsFeatures,b,c,e)}}var f=this,g=-1;e()};
ia.AGOLData.prototype._processFeatures=function(a,b,c){for(var d=this.geogModels[a],a=this.geogs[a],e=b.length,f=0;f<e;f++){var g=b[f],h;if(g.attributes)h=g.attributes;else if(g.properties)h=g.properties;g={id:String(h[a.idField]),name:String(h[a.nameField])};if(d.model.features!=void 0){var i=d.model.features.properties;if(i!=void 0){g.properties=[];for(var k=0;k<i.length;k++){var j=i[k];g.properties[g.properties.length]={name:j.name,value:h[j.src.fieldName]}}}i=d.model.features.filters;if(i!=void 0){g.filters=
[];for(k=0;k<i.length;k++)j=i[k],g.filters[g.filters.length]={"for":j.id,name:h[j.src.fieldName]}}}g.id.indexOf("#")==0?a.comparisonFeatures[a.comparisonFeatures.length]=g:a.features[a.features.length]=g;for(k=0;k<a.indicatorList.length;k++){i=a.indicatorList[k];j=h[i.fieldName];if(j==="null"||j===null||j==="NaN"||j===""||j===void 0)j=this.formatter.noDataValue;g.id.indexOf("#")==0?i.comparisonValues[i.comparisonValues.length]=j:i.values[i.values.length]=j}}c&&c.call(null,a)};
ia.AGOLData.prototype.getQueryData=function(a,b,c,d,e){var f=this;ia.FeatureServiceReader.sendQuery(c,ia.accessToken,function(c){for(var h=0;h<d.length;h++)f._getDataValues(a,b,c,d[h]);e.call(null)})};ia.AGOLData.prototype.getGeoJsonData=function(a,b,c,d,e){var f=this;ia.File.load({url:c,dataType:"json",onSuccess:function(c){for(var h=0;h<d.length;h++)f._getDataValues(a,b,c.features,d[h]);e.call(null)}})};
ia.AGOLData.prototype._getDataValues=function(a,b,c,d){for(var a={},e={},f=c.length,g=0;g<f;g++){var h=c[g],i;if(h.attributes)i=h.attributes;else if(h.properties)i=h.properties;h=!0;if(d.rowFilters!=void 0)for(var k in d.rowFilters)if(i[k]!=d.rowFilters[k]){h=!1;break}if(h==!0){var h=String(i[d.idField]),j=i[d.fieldName];d.type=="numeric"&&ia.isNumber(j)&&(j=parseFloat(j));h.indexOf("#")==0?e[h]=j:a[h]=j}}f=b.length;for(g=0;g<f;g++)h=b[g].id,h.indexOf("#")==0?(j=e[h],d.comparisonValues[d.comparisonValues.length]=
j==="null"||j===null||j==="NaN"||j===""||j===void 0?this.formatter.noDataValue:e[h]):(j=a[h],d.values[d.values.length]=j==="null"||j===null||j==="NaN"||j===""||j===void 0?this.formatter.noDataValue:a[h])};ia.AGOLData.prototype._CSVToArray=function(a,b){for(var b=b||",",c=RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[[]],e=null;e=c.exec(a);){var f=e[1];f.length&&f!==b&&d.push([]);e=e[2]?e[2].replace(RegExp('""',"g"),'"'):e[3];d[d.length-1].push(e)}return d};
ia.AGOLData.prototype.readCsvFile=function(a,b,c,d,e,f){var g=this;ia.accessToken!=""&&(d+=d.indexOf("?")==-1?"?":"&",d+="token="+ia.accessToken);ia.File.load({url:d,contentType:"text/plain",dataType:"text",onSuccess:function(d){for(var d=g._CSVToArray(d),i=d[0],k=0;k<e.length;k++){for(var j=e[k],m=0,n=0,l=0;l<i.length;l++){var o=i[l];$j.trim(j.idField)==$j.trim(o)&&(m=l);$j.trim(j.fieldName)==$j.trim(o)&&(n=l)}for(var q={},o={},p=d.slice(1,d.length),l=0;l<p.length;l++){var r=p[l],t=r[m],s=r[n],u;
r.length>1&&(u=r[1]);j.type=="numeric"&&ia.isNumber(s)&&(s=parseFloat(s));t!=void 0&&t!=""&&(t.indexOf("#")==0?o[t]={name:u,data:s}:q[t]=s)}n=c.length;m=[];for(l=0;l<n;l++){var s=c[l],v;if(s.attributes)v=s.attributes;else if(s.properties)v=s.properties;t=String(v[b]);t.indexOf("#")==0?(m.push(t),s=o[t].data,j.comparisonValues[j.comparisonValues.length]=s==="null"||s===null||s==="NaN"||s===""||s===void 0?g.formatter.noDataValue:s):(s=q[t],j.values[j.values.length]=s==="null"||s===null||s==="NaN"||
s===""||s===void 0?g.formatter.noDataValue:s)}for(var w in o){s=o[w].data;if(s==="null"||s===null||s==="NaN"||s===""||s===void 0)s=g.formatter.noDataValue;q=o[w].name;if(q!=void 0&&m.indexOf(w)==-1){t=!1;for(l=0;l<a.comparisonFeatures.length;l++)if(a.comparisonFeatures[l].id==w){t=!0;break}t||a.comparisonFeatures.push({id:w,name:q});j.comparisonValues.push(s)}}}f.call(null)}})};ia.Widget=function(a){this.id=a;this._zIndex=void 0;this._xAnchor="left";this._yAnchor="top";this._popup=this._visible=!1};
ia.Widget.prototype.rescale=!0;ia.Widget.prototype.id="";ia.Widget.prototype.name="";ia.Widget.prototype.x=function(a){if(a!=void 0)this.setPosition(a,this._y,this._xAnchor,this._yAnchor);else return this._x};ia.Widget.prototype.y=function(a){if(a!=void 0)this.setPosition(this._x,a,this._xAnchor,this._yAnchor);else return this._y};ia.Widget.prototype.width=function(a){if(a!=void 0)this.setSize(a,this._height);else return this._width};
ia.Widget.prototype.height=function(a){if(a!=void 0)this.setSize(this._width,a);else return this._height};ia.Widget.prototype.zIndex=function(a){if(a!=void 0)this._zIndex=a,this.container.css({"z-index":this._zIndex});else{if(this._zIndex==void 0)this._zIndex=this.container.css("z-index");return this._zIndex}};ia.Widget.prototype.xAnchor=function(a){if(a!=void 0)this.setPosition(this._x,this._y,a,this._yAnchor);else return this._xAnchor};
ia.Widget.prototype.yAnchor=function(a){if(a!=void 0)this.setPosition(this._x,this._y,this._xAnchor,a);else return this._yAnchor};ia.Widget.prototype.setDimensions=function(a,b,c,d,e,f){this.setSize(c,d);this.setPosition(a,b,e,f)};ia.Widget.prototype.restore=function(){this.setDimensions(this._x,this._y,this._width,this._height,this._xAnchor,this._yAnchor);this.zIndex(this._zIndex)};ia.Widget.prototype.maximize=function(){this.container.css({left:0,top:0,width:"100%",height:"100%","z-index":500})};
ia.Widget.prototype.setSize=function(a,b){var c="%";if(this.rescale=="false"||this.rescale==!1)c="px";this._width=a;this._height=b;this._width!=void 0&&this.container.css({width:this._width+c});this._height!=void 0&&this.container.css({height:this._height+c})};ia.Widget.prototype._addedResizeListener=!1;
ia.Widget.prototype.setPosition=function(a,b,c,d){this._x=a;this._y=b;this._xAnchor=c||this._xAnchor;this._yAnchor=d||this._xAnchor;this.container.css({left:"","margin-left":"",right:"",bottom:"",top:""});if(this._xAnchor=="end"||this._xAnchor=="right")this.container.css({right:100-this._x+"%"});else if(this._xAnchor=="middle"||this._xAnchor=="center"){this.container.css({left:this._x+"%"});if(this._width==void 0&&this._addedResizeListener==!1)this._addedResizeListener=!0,this.container.resize(function(){this.setPosition(this._x,
this._y)}.bind(this));this.container.css({"margin-left":this.container.width()/2*-1+"px"})}else this.container.css({left:this._x+"%"});this._yAnchor=="bottom"?this.container.css({bottom:this._y+"%"}):this.container.css({top:this._y+"%"})};ia.Widget.prototype.toggle=function(){this.visible(!this._visible)};ia.Widget.prototype.show=function(){this.visible(!0)};ia.Widget.prototype.hide=function(){this.visible(!1)};
ia.Widget.prototype.visible=function(a){if(a!=void 0){var b=this;b._visible=a;b.container.stop();b._visible?(b._zIndex&&b.container.css("z-index",b._zIndex),b.container.css("visibility","visible").animate({opacity:1})):b.container.animate({opacity:0},function(){b._zIndex&&b.container.css("z-index",0);b.container.css("visibility","hidden")})}else return this._visible};ia.Widget.prototype.tooltip=function(a){this.container.attr("title",a)};
ia.Widget.prototype.onclick=function(a,b){var c=this;c.container.off("click");if(a)if(c.container.css("cursor","pointer"),typeof a=="function")c.container.on("click",function(b){b.stopPropagation();a.call(null,b)});else(function(){c.container.on("click",function(c){c.stopPropagation();ia.callFunction(a,b,c)})})()};ia.Widget.prototype.addCssClass=function(a){a&&a!=""&&this.container.addClass(a)};
ia.Widget.prototype.popup=function(a){var b=this;if(a==!0)this._popup=!0,this.container.addClass("ia-popup-panel"),$j("body").bind("click.popup-"+this.id,function(){b.hide()}),this.container.bind("click.popup-"+this.id,function(a){a.stopPropagation()});else if(a==!1)this._popup=!1,this.container.removeClass("ia-popup-panel"),$j("body").unbind("click.popup-"+this.id),this.container.unbind("click.popup-"+this.id);else return this._popup};
ia.Widget.prototype.updateWidget=function(a){if(a!=void 0)this.name=a.name,this.setDimensions(a.x,a.y,a.width,a.height,a.anchor,"top")};ia.Panel=function(a,b){ia.Panel.baseConstructor.call(this,a);this._title=b;this._settingsBtn=void 0;this._hasSettings=!1;this._closeBtn=void 0;this._closeable=!1;this._exportBtn=void 0;this._exportable=!1;this._resizeBtn=void 0;this._isMaximized=this._resizeable=!1;this._borderRadius=0;this._build()};ia.extend(ia.Widget,ia.Panel);
ia.Panel.prototype._build=function(){var a=this;this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.container=$j("<div>").addClass("ia-widget ia-panel").attr("id","ia-widget-"+this.id);this.container.css("visibility","hidden");this.container.resize(function(){a._size()});this.content=$j("<div>").addClass("ia-panel-content").attr("id","ia-widget-"+this.id+"-content");this.contentText=$j("<div>").addClass("ia-panel-content-text ia-nodata-text").attr("id",
"ia-widget-"+this.id+"-content-text");this.header=$j("<div>").addClass("ia-panel-header").attr("id","ia-widget-"+this.id+"-header");this.header.css("border-top-left-radius",this._borderRadius+"px");this.header.css("border-top-right-radius",this._borderRadius+"px");this.header.css({display:"none"});this.container.append(this.header);this.container.append(this.content);this.container.append(this.contentText);this.footer=$j("<div>").addClass("ia-panel-footer").attr("id","ia-widget-"+this.id+"-footer");
this.container.append(this.footer);var b=$j("<div>").addClass("ia-panel-btns").attr("id","ia-widget-"+this.id+"-btns");this.container.append(b);this.container.mouseenter(function(){b.stop().css({visibility:"visible"}).animate({opacity:0.5})});this.container.mouseleave(function(){b.stop().animate({opacity:0},function(){b.css({visibility:"hidden"})})});b.mouseenter(function(){b.stop().animate({opacity:1})});b.mouseleave(function(){b.stop().animate({opacity:0.5})});var c;this.container.bind("touchstart",
function(){b.stop();b.css({visibility:"visible"}).animate({opacity:1});clearTimeout(c);c=setTimeout(function(){clearTimeout(c);b.stop().animate({opacity:0},function(){b.css({visibility:"hidden"})})},5E3)});this._resizeBtn=$j("<div>").addClass("ia-panel-btn ia-panel-resize-btn-maximize").attr("id","ia-widget-"+this.id+"-resize").css("display","none");b.append(this._resizeBtn);this._resizeBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.resizeFunction&&a.resizeFunction.call(null,
a)});this._exportBtn=$j("<div>").addClass("ia-panel-btn ia-panel-export-btn").attr("id","ia-widget-"+this.id+"-export").css("display","none");this._exportBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.exportFunction&&a.exportFunction.call(null,b)});b.append(this._exportBtn);this._closeBtn=$j("<div>").addClass("ia-panel-btn ia-panel-close-btn").attr("id","ia-widget-"+this.id+"-close").css("display","none");this._closeBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();
a.closeFunction&&a.closeFunction.call(null,a)});b.append(this._closeBtn);this._settingsBtn=$j("<div>").addClass("ia-panel-btn ia-panel-settings-btn").attr("id","ia-widget-"+this.id+"-settings").css("display","none");this._settingsBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.settingsFunction&&a.settingsFunction.call(null,b)});b.append(this._settingsBtn);this.title(this._title);this._size()};
ia.Panel.prototype.hasSettings=function(a){if(a==!0)this._hasSettings=!0,this._settingsBtn.css("display","");else if(a==!1)this._hasSettings=!1,this._settingsBtn.css("display","none");else return this._hasSettings};ia.Panel.prototype.closeable=function(a){if(a==!0)this._closeable=!0,this._closeBtn.css("display","");else if(a==!1)this._closeable=!1,this._closeBtn.css("display","none");else return this._closeable};ia.Panel.prototype.closeFunction=function(a){a.hide()};
ia.Panel.prototype.exportable=function(a){if(a==!0)this._exportable=!0,this._exportBtn.css("display","");else if(a==!1)this._exportable=!1,this._exportBtn.css("display","none");else return this._exportable};ia.Panel.prototype.resizeable=function(a){if(a==!0)this._resizeable=!0,this._resizeBtn.css("display","");else if(a==!1)this._resizeable=!1,this._resizeBtn.css("display","none");else return this._resizeable};ia.Panel.prototype.resizeFunction=function(a){a.resize()};
ia.Panel.prototype.resize=function(){this._isMaximized?(this._resizeBtn.addClass("ia-panel-resize-btn-maximize").removeClass("ia-panel-resize-btn-minimize"),this.restore()):(this._resizeBtn.addClass("ia-panel-resize-btn-minimize").removeClass("ia-panel-resize-btn-maximize"),this.maximize());this._isMaximized=!this._isMaximized};ia.Panel.prototype.append=function(a){this.content.append(a)};ia.Panel.prototype.appendToFooter=function(a){this.footer.append(a)};
ia.Panel.prototype.title=function(a){a!=void 0&&a!="undefined"&&a!=""?(this.header.css("display",""),this.header.html(a),this.header.attr("title",a)):(this.header.css("display","none"),this.header.html(""),this.header.attr("title",""));this._size()};ia.Panel.prototype.text=function(a){this.contentText.html(a);a==""?this.contentText.css("display","none"):this.contentText.css("display","inline")};
ia.Panel.prototype._size=function(){var a=this.container.height(),b=0;this.header.css("display")!="none"&&(b=this.header.outerHeight());footerHeight=this.footer.outerHeight();this.content.height(a-b-footerHeight)};
ia.Panel.prototype.update=function(a){if(a!=void 0){var b=a.getProperty("isPopUp")||!1,c=!0;if(a.id.indexOf("menuBar")!=-1||a.id.indexOf("timeControl")!=-1)c=!1;var d=a.getProperty("isExportable")||!1,e=a.getProperty("visible")||!1;this.popup(b);this.closeable(b);this.resizeable(c);this.exportable(d);this.visible(e);this.zIndex(a.zIndex);this.updateWidget(a)}};
ia.Button=function(a,b){ia.Button.baseConstructor.call(this,a);this.container=$j("<button type='button'>").addClass("ia-widget ia-button button").attr("id","ia-widget-"+a);b!=void 0&&this.text(b)};ia.extend(ia.Widget,ia.Button);ia.Button.prototype.text=function(a){this.container.html(a)};ia.Button.prototype.update=function(a){a!=void 0&&(a.text!=void 0&&this.text(a.text),this.onclick(a.href,a.target),this.tooltip(a.tooltip),this.addCssClass(a["css-class"]),a.zIndex&&this.zIndex(a.zIndex),this.updateWidget(a))};
ia.MenuButton=function(a,b){ia.MenuButton.baseConstructor.call(this,a,b);this.container.addClass("menuButton")};ia.extend(ia.Button,ia.MenuButton);ia.Text=function(a,b){ia.Text.baseConstructor.call(this,a);this.container=$j("<div>").addClass("ia-widget ia-text").attr("id","ia-widget-"+a);b!=void 0&&this.text(b)};ia.extend(ia.Widget,ia.Text);ia.Text.prototype.text=function(a){this.container.html(a)};
ia.Text.prototype.update=function(a){if(a!=void 0){var b=this;a.text!=""&&this.text(a.text);this.tooltip(a.tooltip);this.addCssClass(a["css-class"]);a.href!=""&&(this.onclick(a.href,a.target),this.addCssClass("ia-link"));$j.each(a.cssProps,function(a,d){b.container.css(a,d)});a.zIndex&&this.zIndex(a.zIndex);this.updateWidget(a)}};ia.Image=function(a,b){ia.Image.baseConstructor.call(this,a);this.container=$j("<img>").addClass("ia-widget ia-image").attr("id","ia-widget-"+a).attr("src",b)};
ia.extend(ia.Widget,ia.Image);ia.Image.prototype.src=function(a){this.container.attr("src",a)};ia.Image.prototype.update=function(a){if(a!=void 0)a.src!=void 0&&this.src(a.src),this.onclick(a.href,a.target),this.tooltip(a.tooltip),this.addCssClass(a["css-class"]),this.rescale=a.rescale,a.zIndex&&this.zIndex(a.zIndex),this.updateWidget(a)};ia.ScrollBox=function(a){this._touchScroll=void 0;this.isScrolling=!1;this.container=a;var b=this;this.container.resize(function(){b._resize()})};
ia.ScrollBox.prototype._resize=function(){this._touchScroll!=null&&this._touchScroll.refresh()};ia.ScrollBox.prototype.scrollToElement=function(a){this._touchScroll!=null&&this._touchScroll.scrollToElement(a,300)};
ia.ScrollBox.prototype.refresh=function(){var a=this;if(ia.IS_TOUCH_DEVICE&&document.getElementById(a.container.attr("id"))!=null){if(a._touchScroll!=null)a._touchScroll.destroy(),a._touchScroll=null;a._touchScroll=new iScroll(a.container.attr("id"),{hideScrollbar:!0,scrollbarClass:"touchScrollbar",onScrollMove:function(){a.isScrolling=!0},onScrollEnd:function(){a.isScrolling=!1},onTouchEnd:function(){a.isScrolling=!1}})}};
ia.DataExplorer=function(a,b){this.id=a;this._data=void 0;this._treeId="";this.closeBranchesOnSelection=!0;this.container=$j("<div id='"+a+"' class='ia-explorer'>");this.$sb=$j("<div id='"+a+"-scrollbox' class='ia-explorer-scrollbox'>");this.container.append(this.$sb);this.$sb.bind("click",function(a){a.stopPropagation()});this.$tree=$j("<div class='ia-explorer-tree'>");this.$sb.append(this.$tree);this.filterType="single";if(b)this.callbackFunction=b;var c=this;this.container.resize(function(){c._size()})};
ia.DataExplorer.prototype.closeBranchesOnSelection=!1;ia.DataExplorer.prototype._size=function(){this.$sb.height(this.container.height());this.$sb.width(this.container.width())};ia.DataExplorer.prototype.data=function(a){if(a!=void 0)this._data=a;else return this._data};ia.DataExplorer.prototype.refresh=function(){this._treeId!=""&&this.build(this._treeId)};
ia.DataExplorer.prototype.build=function(a){this._treeId=a;if(this._treeId==void 0)this._treeId="topLevel";this.$tree.empty();for(var a=this._data[this._treeId],b=a.children.length,c=0;c<b;c++)this._buildItem(a.children[c],this.$tree)};
ia.DataExplorer.prototype._buildItem=function(a,b){var c=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),d=this._data[a],e=$j("<div id='"+c+"' class='ia-explorer-item ia-list-item'>");b.append(e);c=$j("<div class='ia-explorer-label'>").html(d.label);e.append(c);var f=this;if(d.type=="branch"){e.addClass("ia-explorer-branch-icon");e.addClass("ia-explorer-branch");c=$j("<div class='ia-explorer-group'>");c.hide();b.append(c);e.data("childGroup",c);(function(){e.bind("click",function(a){a.stopPropagation();
f._toggleBranch(e)})})();for(var g=d.children.length,h=0;h<g;h++)f._buildItem(d.children[h],c)}else{e.addClass("ia-explorer-leaf");if(d.href!=void 0){var i=$j("<div class='ia-explorer-notes-icon'>");e.prepend(i);(function(){var a=d.href;i.bind("click",function(b){b.stopPropagation();ia.callFunction(a,"_blank")})})()}(function(){e.bind("click",function(a){a.stopPropagation();f._selectLeaf(e)})})()}};
ia.DataExplorer.prototype.clearSelection=function(){this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item");this.isFilterExplorer&&this.$tree.find(".ia-explorer-leaf").removeClass("ia-filter-explorer-selected-item")};
ia.DataExplorer.prototype.showItem=function(a){var b=this.$tree.find("div[id='"+String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#")+"']");b&&(b.hasClass("ia-explorer-branch")?this._openBranch(b):b.hasClass("ia-explorer-leaf")&&(this.$tree.find(".ia-explorer-leaf").removeClass("ia-explorer-selected-item"),b.addClass("ia-explorer-selected-item")),this._data[a]&&this._data[a].parent&&this.showItem(this._data[a].parent))};
ia.DataExplorer.prototype._selectLeaf=function(a){var b=a.attr("id");this.isFilterExplorer?a.hasClass("ia-filter-explorer-selected-item")?(b+="~clearFilter",a.removeClass("ia-explorer-selected-item"),a.removeClass("ia-filter-explorer-selected-item")):(this.filterType=="single"&&(this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item"),this.$tree.find(".ia-explorer-leaf").removeClass("ia-filter-explorer-selected-item")),a.addClass("ia-explorer-selected-item"),a.addClass("ia-filter-explorer-selected-item")):
(this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item"),a.addClass("ia-explorer-selected-item"));a=String(b).replace(/#quote#/g,"'").replace(/#double-quote#/g,'"');this.callbackFunction&&this.callbackFunction.call(null,a)};
ia.DataExplorer.prototype._toggleBranch=function(a){a.hasClass("ia-explorer-branch")&&(this.$tree.find(".ia-explorer-item").removeClass("ia-explorer-selected-item"),a.data("childGroup").is(":visible")?this._closeBranch(a):(a.addClass("ia-explorer-selected-item"),this._openBranch(a)))};
ia.DataExplorer.prototype._closeBranch=function(a){if(a.hasClass("ia-explorer-branch")){a.addClass("ia-explorer-branch-icon");a.removeClass("ia-explorer-branch-expanded-icon");var b=this;a.data("childGroup").slideUp("fast",function(){b._size()})}};
ia.DataExplorer.prototype._openBranch=function(a){if(a.hasClass("ia-explorer-branch")){this.closeBranchesOnSelection&&a.siblings(".ia-explorer-branch-expanded-icon").each(function(){$j(this).addClass("ia-explorer-branch-icon");$j(this).removeClass("ia-explorer-branch-expanded-icon");$j(this).data("childGroup").slideToggle("fast",function(){})});a.removeClass("ia-explorer-branch-icon");a.addClass("ia-explorer-branch-expanded-icon");var b=this;a.data("childGroup").slideDown("fast",function(){b._size()})}};
ia.Table=function(a){ia.Table.baseConstructor.call(this);this.id=a;this._sDirection=this._cId=this._data=void 0;this._selectedRows={};this._scrollTimeout=void 0;this._highlightRows={};this._stickyIds=[];this.allowUserSorting=this.showLegendColor=!0;this.container=$j("<div id='"+a+"' class='ia-table'>");this._containerId=a+"-";this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.$tableCorner=$j("<span class='ia-table-header ia-table-header-corner'>");
this.$tableCorner.css("border-top-right-radius",this._borderRadius+"px");this.container.append(this.$tableCorner);this.$tableHeaders=$j("<table>");this.container.append(this.$tableHeaders);this.$tableContainer=$j("<div id='"+a+"-container' class='ia-table-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$table=$j("<table>");this.$tableContainer.append(this.$table);this._addMouseEvents();var b,c=this;this.container.resize(function(){clearTimeout(b);
b=setTimeout(function(){clearTimeout(b);c._size()},500)})};ia.extend(ia.EventDispatcher,ia.Table);ia.Table.prototype._size=function(){var a=this.container.width(),b=this.$tableContainer.get(0).offsetWidth-this.$tableContainer.get(0).clientWidth;a-=b;this.$table.width(a);this.$tableHeaders.width(a);var a=this.container.height(),c=this.$tableHeaders.outerHeight();this.$tableContainer.height(a-c);this.$tableCorner.width(b);this.$tableCorner.height(c)};ia.Table.prototype.getData=function(){return this._data};
ia.Table.prototype.setData=function(a){this._data=a};
ia.Table.prototype.render=function(){var a=this;this.$table.empty();this.$tableHeaders.empty();var b=$j("<thead>"),c=$j("<tr>");b.append(c);this.$tableHeaders.append(b);for(var d=!1,e,f=this.columns.length,g=0;g<f;g++){e=this.columns[g];var h=e.width*110,i=$j("<th id='"+e.id+"' class='ia-table-header' title='"+e.label+"' style='width:"+h+"%'>").html(e.label);i.data("type",e.type);e.label!=""&&(d=!0);g==0&&i.css("border-top-left-radius",this._borderRadius+"px");c.append(i);this.allowUserSorting&&function(){var b=
e.id;i.click(function(){var c="ascending";$j(this).is(".sort-asc")&&(c="descending");a.sort(b,c)})}()}d==!1&&b.css("display","none");var b=[],g=-1,c=0,k,j;b[++g]="<colgroup>";for(d=0;d<f;d++)e=this.columns[d],h=e.width*110,b[++g]="<col style='width:"+h+"%'>";b[++g]="</colgroup>";b[++g]="<tbody>";for(id in this._data){h=this._data[id];d=String(id).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#");c%2==0?b[++g]="<tr id='"+this._containerId+d+"' class='ia-table-row ia-table-row-even'>":b[++g]="<tr id='"+
this._containerId+d+"' class='ia-table-row ia-table-row-odd'>";c++;var m=void 0,n=0;if(h.color&&this.showLegendColor)m=ia.Color.toRGBA(h.color,1),n=h.symbolSize;for(d=0;d<f;d++){e=this.columns[d];if(e.id.indexOf("~")!=-1){j=e.id.split("~")[0];var l=e.id.split("~")[1];k=this["data"+l][id][j];j=this["data"+l][id][j+"_formatted"]}else k=h[e.id],j=h[e.formattedId];e.type=="categoric"?b[++g]="<td class='ia-table-cell ia-table-cell-categoric' title='"+j+"' data-value='"+j+"'>":b[++g]="<td class='ia-table-cell ia-table-cell-numeric' title='"+
j+"' data-value='"+k+"'>";m&&e.id=="name"&&n>0&&(b[++g]="<span class='ia-table-legend-swatch' style='background-color:"+m+";'></span>");h.href&&e.id=="name"&&(b[++g]="<span id='"+h.href+"' class='ia-table-notes-icon'></span>");b[++g]=j;b[++g]="</td>"}b[++g]="</tr>"}b[++g]="</tbody>";this.$table.append(b.join(""));this._scrollBox.refresh();this._size();this._cId!=void 0&&this.sort(this._cId,this._sDirection);this.renderSelection()};
ia.Table.prototype.exportData=function(){for(var a=this.columns.length,b=[],c=-1,d,e,f,g=0;g<a;g++){var h=this.columns[g];g>0&&(b[++c]=",");b[++c]='"'+h.label+'"'}b[++c]="\n";if(Object.keys(this._selectedRows).length>0)for(id in this._selectedRows){var i=String(id).replace(/#quote#/g,"'").replace(/#double-quote#/g,'"');d=this._data[i];for(g=0;g<a;g++)h=this.columns[g],h.id.indexOf("~")!=-1?(f=h.id.split("~")[0],h=h.id.split("~")[1],e=this["data"+h][i][f],f=this["data"+h][i][f+"_formatted"]):(e=d[h.id],
f=d[h.formattedId]),g>0&&(b[++c]=","),ia.isNumber(e)?b[++c]=e:b[++c]='"'+f+'"';b[++c]="\n"}else for(i in this._data){d=this._data[i];for(g=0;g<a;g++)h=this.columns[g],h.id.indexOf("~")!=-1?(f=h.id.split("~")[0],h=h.id.split("~")[1],e=this["data"+h][i][f],f=this["data"+h][i][f+"_formatted"]):(e=d[h.id],f=d[h.formattedId]),g>0&&(b[++c]=","),ia.isNumber(e)?b[++c]=e:b[++c]='"'+f+'"';b[++c]="\n"}return b.join("")};
ia.Table.prototype.renderSelection=function(){for(var a in this._selectedRows){var b=$j("[id='"+this._containerId+a+"']");b.addClass("ia-table-row-select");var c=ia.Color.shade(this.selectionColor,0.68);b.css("background-color",c)}};
ia.Table.prototype._addMouseEvents=function(){var a=this;this.$table.delegate("tr","mouseover",function(){var b=$j(this).attr("id").substring(a._containerId.length);a._highlightRows[b]=$j(this);if($j(this).hasClass("ia-table-row-select")){$j(this).addClass("ia-table-row-highlight-select");var c=ia.Color.shade(a.selectionColor,0.64)}else $j(this).addClass("ia-table-row-highlight"),c=ia.Color.shade(a.highlightColor,0.7);$j(this).css("background-color",c);a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OVER,
ia.ItemLayer.ROLLOVER)});this.$table.delegate("tr","mouseout",function(){var b=$j(this).attr("id").substring(a._containerId.length);delete a._highlightRows[b];$j(this).removeClass("ia-table-row-highlight");$j(this).hasClass("ia-table-row-highlight-select")?($j(this).removeClass("ia-table-row-highlight-select").addClass("ia-table-row-select"),a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.SELECTED),b=ia.Color.shade(a.selectionColor,0.68)):(a._dispatchItemEvent(b,ia.ItemEvent.ITEM_MOUSE_OUT,
ia.ItemLayer.UNSELECTED),b="");$j(this).css("background-color",b)});this.$table.delegate("tr","click",function(){var b=$j(this).attr("id").substring(a._containerId.length);$j(this).hasClass("ia-table-row-select")||$j(this).hasClass("ia-table-row-highlight-select")?($j(this).removeClass("ia-table-row-select").removeClass("ia-table-row-highlight-select"),delete a._selectedRows[b],a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),b=""):($j(this).removeClass("ia-table-row-highlight").addClass("ia-table-row-highlight-select"),
a._selectedRows[b]=b,a._dispatchItemEvent(b,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.SELECTED),b=ia.Color.shade(a.selectionColor,0.64));$j(this).css("background-color",b)});this.$table.delegate("span.ia-table-notes-icon","click",function(a){a.stopPropagation();a=$j(this).attr("id");window.open(a,"_blank")});this.$table.delegate("span.ia-table-notes-icon","mouseover touchstart",function(a){a.stopPropagation()})};
ia.Table.prototype.sort=function(a,b){var c=this._getColumnIndex(a);if(c!=-1){this._cId=a;this._sDirection=b;b!=void 0&&(b=b.toLowerCase());var d=1;b=="descending"&&(d=-1);var e=this.$tableHeaders.find("th:eq("+c+")");this.$tableHeaders.find("th").removeClass("sort-asc").removeClass("sort-desc");var f;d==1?(e.addClass("sort-asc"),f=Infinity):(e.addClass("sort-desc"),f=-Infinity);var g;g=e.data("type")=="categoric"?function(a){return a.toUpperCase()}:function(a){a=parseFloat(a);return isNaN(a)?f:a};
for(var e=[],h=this.$table.find("tbody > tr").get(),i,k=h.length,j=0;j<k;j++)i=$j(h[j].childNodes[c]).attr("data-value"),h[j].sortKey=g(i);c=Object.prototype.toString;Object.prototype.toString=function(){return this.key};h.sort(function(a,b){return a.sortKey<b.sortKey?-d:a.sortKey>b.sortKey?d:0});Object.prototype.toString=c;for(j=0;j<k;j++)e.push(h[j]),h[j].sortKey=null;this.$table.children("tbody").append(e);this.$table.find("tbody > tr.ia-table-row:odd").removeClass("ia-table-row-even").addClass("ia-table-row-odd");
this.$table.find("tbody > tr.ia-table-row:even").removeClass("ia-table-row-odd").addClass("ia-table-row-even");this.promoteToTop(this._stickyIds)}};ia.Table.prototype.stickToTop=function(a){this._stickyIds=a.concat();this.promoteToTop(this._stickyIds)};ia.Table.prototype.promoteToTop=function(a){for(var b=a.length-1;b>=0;b--){var c=$j("tr[id='"+this._containerId+a[b]+"']");c&&this.$table.prepend(c)}};
ia.Table.prototype.selectText=function(){var a=this.container.get(0),b=document.body;b.createTextRange?(b=b.createTextRange(),b.moveToElementText(a),b.select()):document.createRange&&window.getSelection&&(sel=window.getSelection(),sel.removeAllRanges(),b=document.createRange(),b.selectNodeContents(a),sel.addRange(b))};
ia.Table.prototype._dispatchItemEvent=function(a,b,c){var a=String(a).replace(/#quote#/g,"'").replace(/#double-quote#/g,'"'),d={};d.id=a;d.state=c;d.parent=this;this.dispatchEvent(new ia.ItemEvent(b,d))};ia.Table.prototype._getColumnIndex=function(a){for(var b=-1,c=0;c<this.columns.length;c++)if(this.columns[c].id==a){b=c;break}return b};
ia.Table.prototype.select=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");b.addClass("ia-table-row-select");this._selectedRows[a]=a;a=ia.Color.shade(this.selectionColor,0.68);b.css("background-color",a);clearTimeout(this._scrollTimeout);var c=this;this._scrollTimeout=setTimeout(function(){clearTimeout(c._scrollTimeout);c._scrollIntoView(b)},500)};
ia.Table.prototype._scrollIntoView=function(a){var b=a.get(0);if(b!=void 0)if(ia.IS_TOUCH_DEVICE)this._scrollBox.scrollToElement(b);else{var c=this.$tableContainer.scrollTop(),d=c+this.$tableContainer.height(),b=b.offsetTop;(b+a.height()>d||b<c)&&this.$tableContainer.scrollTop(b)}};
ia.Table.prototype.unselect=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");b.removeClass("ia-table-row-select");delete this._selectedRows[a];b.css("background-color","")};ia.Table.prototype.clearSelection=function(){for(var a in this._selectedRows)this.unselect(a)};
ia.Table.prototype.highlight=function(a){var a=String(a).replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),b=$j("tr[id='"+this._containerId+a+"']");if(b.hasClass("ia-table-row-select")){b.addClass("ia-table-row-highlight-select");var c=ia.Color.shade(this.selectionColor,0.64)}else b.addClass("ia-table-row-highlight"),c=ia.Color.shade(this.highlightColor,0.7);b.css("background-color",c);this._highlightRows[a]=b};
ia.Table.prototype.clearHighlight=function(){for(var a in this._highlightRows){var b=this._highlightRows[a];b.removeClass("ia-table-row-highlight").removeClass("ia-table-row-highlight-select");delete this._highlightRows[a];var c=b.hasClass("ia-table-row-select")?ia.Color.shade(this.selectionColor,0.68):"";b.css("background-color",c)}};ia.ComparisonTable=function(a){ia.ComparisonTable.baseConstructor.call(this,a)};ia.extend(ia.Table,ia.ComparisonTable);ia.ComparisonTable.prototype.clearSelection=function(){};
ia.LayerList=function(a){ia.LayerList.baseConstructor.call(this);this.id=a;this.container=$j("<div id='"+a+"' class='ia-layer-list'>");this.$tableContainer=$j("<div id='"+a+"-container' class='ia-layer-list-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$tableList=$j("<table class='ia-layer-list-table'>");this.$tableContainer.append(this.$tableList);var b=this;this.container.resize(function(){b._size()})};
ia.extend(ia.EventDispatcher,ia.LayerList);ia.LayerList.prototype._size=function(){this.$tableContainer.height(this.container.height());this.$tableContainer.width(this.container.width())};
ia.LayerList.prototype.render=function(){function a(){b._buildLayerItem(b.mapData.baseLayer,!0);var a=$j("<tr>");b.$tableList.append(a);var c=$j("<td colspan='2' class='ia-layer-list-legend-td'>");a.append(c);b.gradientLegend&&(c.append(b.gradientLegend.container),b.gradientLegend.container.resize(function(){b._size()}));if(b.discreteLegend)c.append(b.discreteLegend.container),b.discreteLegend.scrollBox=b._scrollBox,b.discreteLegend.container.resize(function(){b._size()})}var b=this;this.$tableList.empty();
if(this.mapData){a();var c=this.mapData.noneBaseLayers.length;if(this.mapData.maintainLayerOrder)for(var d=0;d<c;d++){var e=this.mapData.noneBaseLayers[d];this._buildLayerItem(e)}else for(d=c-1;d>=0;d--)e=this.mapData.noneBaseLayers[d],this._buildLayerItem(e)}this._scrollBox.refresh()};
ia.LayerList.prototype._buildLayerItem=function(a,b){if(a.showInLayerList){a.addEventListener(ia.Event.LAYER_VISIBLE_CHANGED,this._layerEventHandler.bind(this));var c=$j("<tr id='"+this.id+"_"+replaceBadCharacters(a.id)+"' class='ia-list-item'>");this.$tableList.append(c);if(!b&&a.geometry!="image"){var d=$j("<td class='ia-legend-item' style='text-align:center'>");c.append(d);if(a.iconPath!=""){var e=$j("<img>").attr("src",a.iconPath);d.append(e)}else{var f=a.style.lineWidth,e=a.symbolSize+f*2,f=
a.symbolSize+f*2,g=$j("<div class='ia-legend-symbol' style='width:"+e+";height:"+f+";'>");d.append(g);var h=document.createElement("canvas");h.width=e;h.height=f;g.append($j(h));this._drawSymbol(h,a)}}d=$j("<td style='width:100%' id='"+replaceBadCharacters(a.id)+"' class='ia-layer-list-item ia-layer-list-item-unchecked'>");(b||a.geometry=="image")&&d.attr("colspan",2);d.html(a.name);c.append(d);a.getVisible()==!0&&d.addClass("ia-layer-list-item-checked");(function(){var b=d;c.bind("click",function(c){c.stopPropagation();
c.preventDefault();b.hasClass("ia-layer-list-item-checked")?(b.removeClass("ia-layer-list-item-checked"),a.setVisible(!1)):(b.addClass("ia-layer-list-item-checked"),a.setVisible(!0),a.isLoaded||a.loadSource())})})()}};function replaceBadCharacters(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"")}ia.LayerList.prototype.showLayer=function(a){this.$tableList.find("tr[id='"+this.id+"_"+replaceBadCharacters(a)+"']").show()};
ia.LayerList.prototype.hideLayer=function(a){this.$tableList.find("tr[id='"+this.id+"_"+replaceBadCharacters(a)+"']").hide()};ia.LayerList.prototype.clickFunction=function(){};
ia.LayerList.prototype._drawSymbol=function(a,b){var c=a.getContext("2d"),d=b.style,e;for(e in d)c[e]=d[e];if(b.geometry=="line")c.beginPath(),ia.Shape.draw(ia.Shape.LINE,c,a.width/2,a.height/2,b.symbolSize);else{c.beginPath();d=ia.Shape.SQUARE;if(b.geometry=="point")d=ia.Shape.CIRCLE;ia.Shape.draw(d,c,a.width/2,a.height/2,b.symbolSize);c.fill()}c.stroke()};
ia.LayerList.prototype._layerEventHandler=function(a){if(a.type==ia.Event.LAYER_VISIBLE_CHANGED){var a=a.object,b=replaceBadCharacters(a.id);a.getVisible()?this.$tableList.find("#"+b).addClass("ia-layer-list-item-checked"):this.$tableList.find("#"+b).removeClass("ia-layer-list-item-checked")}};
ia.DiscreteLegend=function(a){ia.DiscreteLegend.baseConstructor.call(this);this.id=a;this.container=$j("<div id='"+a+"' class='ia-legend'>");this.$table=$j("<table class='ia-legend-table'>");this.container.append(this.$table);this.style={fillStyle:"#EFEFEF",strokeStyle:"#cccccc",lineWidth:"0.5",lineJoin:"miter"};this.interactive=this.isLegendComponent=!0;this.layout="vertical";this.thematic=new ia.Thematic;this._touchStart=0};ia.extend(ia.EventDispatcher,ia.DiscreteLegend);
ia.DiscreteLegend.prototype.render=function(){this.renderLegend(this.thematic.getClasses())};ia.DiscreteLegend.prototype.renderNumeric=function(){this.renderLegend(this.thematic.numericClassifier.getClasses())};ia.DiscreteLegend.prototype.renderCategoric=function(){this.renderLegend(this.thematic.categoricClassifier.getClasses())};
ia.DiscreteLegend.prototype.renderLegend=function(a){this.$table.empty();var b;this.layout=="horizontal"&&(this.container.hasClass("ia-legend-horizontal")||this.container.addClass("ia-legend-horizontal"),this.$table.css("height","100%"),this.$table.css("width","auto"),this.container.css("width","auto"),b=$j("<tr>"),this.$table.append(b));for(var c=0;c<a.length;c++){var d=a[c];this.layout=="vertical"&&(b=$j("<tr data-index='"+c+"''>"),this.$table.append(b));d.size==0&&b.css("display","none");var e=
$j("<td class='ia-legend-item'>");this.interactive&&e.addClass("ia-legend-item-interactive");b.append(e);var f=this.style.lineWidth,g=d.size+f*2;d.symbol==ia.Shape.LINE&&(g=30);var f=d.size+f*2,h=$j("<div class='ia-legend-symbol' style='width:"+g+";height:"+f+";'>");e.append(h);e=document.createElement("canvas");e.width=g;e.height=f;h.append($j(e));var g=e.getContext("2d"),i;for(i in this.style)g[i]=this.style[i];g.lineJoin="miter";g.fillStyle=d.color;d.symbol==ia.Shape.LINE?(g.strokeStyle=d.color,
g.lineWidth=d.size,g.beginPath(),ia.Shape.draw(d.symbol,g,e.width/2,e.height/2,e.width,d.dashWidth,d.gapWidth)):(g.beginPath(),ia.Shape.draw(d.symbol,g,e.width/2,e.height/2,d.size+0.5),g.fill());g.stroke();d=$j("<td class='ia-legend-item ia-legend-label'>").html(d.getLabel());this.interactive&&d.addClass("ia-legend-item-interactive");this.layout=="horizontal"&&(d.css("white-space","nowrap"),d.css("width","auto"));b.append(d);this.interactive&&this._addMouseEvents(b)}};
ia.DiscreteLegend.prototype._addMouseEvents=function(a){var b=this;a.hover(function(){var a=b.$table.find("tbody > tr").data("index");if($j(this).hasClass("ia-legend-select")){$j(this).addClass("ia-legend-highlight-select");var d=ia.Color.shade(b.selectionColor,0.64);b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OVER,ia.ItemLayer.ROLLOVER_SELECTED)}else $j(this).addClass("ia-legend-highlight"),d=ia.Color.shade(b.highlightColor,0.7),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OVER,ia.ItemLayer.ROLLOVER);
$j(this).css("background-color",d)},function(){var a=b.$table.find("tbody > tr").data("index");$j(this).removeClass("ia-legend-highlight");if($j(this).hasClass("ia-legend-highlight-select")){$j(this).removeClass("ia-legend-highlight-select");$j(this).addClass("ia-legend-select");var d=ia.Color.shade(b.selectionColor,0.68);b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.SELECTED)}else d="",b._dispatchItemEvent(a,ia.ItemEvent.ITEM_MOUSE_OUT,ia.ItemLayer.UNSELECTED);$j(this).css("background-color",
d)});a.bind("click",function(){var a=b.$table.find("tbody > tr").index($j(this));$j(this).hasClass("ia-legend-select")||$j(this).hasClass("ia-legend-highlight-select")?($j(this).removeClass("ia-legend-select").removeClass("ia-legend-highlight-select"),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.UNSELECTED),a=""):($j(this).removeClass("ia-legend-highlight").addClass("ia-legend-highlight-select"),b._dispatchItemEvent(a,ia.ItemEvent.ITEM_CLICK,ia.ItemLayer.SELECTED),a=ia.Color.shade(b.selectionColor,
0.64));$j(this).css("background-color",a)})};ia.DiscreteLegend.prototype._dispatchItemEvent=function(a,b,c){var d={};d.id=a;d.parent=this;d.state=c;d.legendClass=this.thematic.numericClassifier.classificationName==ia.Thematic.CONTINUOUS?this.thematic.categoricClassifier.getClasses()[a]:this.thematic.getClasses()[a];this.dispatchEvent(new ia.ItemEvent(b,d))};
ia.DiscreteLegend.prototype.select=function(a){a=this.$table.find("tr:eq("+a+")");a!=void 0&&(a.removeClass("ia-legend-highlight").addClass("ia-legend-select"),a.css("background-color",ia.Color.shade(this.selectionColor,0.64)))};ia.DiscreteLegend.prototype.unselect=function(a){a=this.$table.find("tr:eq("+a+")");a!=void 0&&(a.removeClass("ia-legend-highlight-select").removeClass("ia-legend-select").addClass("ia-legend-highlight"),a.css("background-color",""))};
ia.DiscreteLegend.prototype.clearSelection=function(){this.$table.find("tbody > tr").removeClass("ia-legend-select").css("background-color","")};ia.DiscreteLegend.prototype.highlight=function(a){a=this.$table.find("tr:eq("+a+")");if(a.hasClass("ia-legend-select")){a.addClass("ia-legend-highlight-select");var b=ia.Color.shade(this.selectionColor,0.64)}else a.addClass("ia-legend-highlight"),b=ia.Color.shade(this.highlightColor,0.7);a.css("background-color",b)};
ia.DiscreteLegend.prototype.clearHighlight=function(){var a=this.$table.find("tbody > tr");a.removeClass("ia-legend-highlight").removeClass("ia-legend-highlight-select");var b=this;a.each(function(){var a=$j(this).hasClass("ia-legend-select")?ia.Color.shade(b.selectionColor,0.68):"";$j(this).css("background-color",a)})};ia.DiscreteLegend.prototype.hide=function(){};ia.DiscreteLegend.prototype.show=function(){};
ia.GradientLegend=function(a){ia.GradientLegend.baseConstructor.call(this);this.id=a;this._context=this._canvas=this._maxLabel=this._minLabel=this._maxValue=this._minValue=void 0;this.container=$j("<div id='"+a+"' class='ia-legend'>");this.$table=$j("<table>");this.container.append(this.$table);this.style={fillStyle:"#EFEFEF",strokeStyle:"#cccccc",lineWidth:"1",lineJoin:"miter"}};ia.extend(ia.EventDispatcher,ia.GradientLegend);
ia.GradientLegend.prototype.render=function(){if(this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE||this.thematic.heatmap==!0)this._build(20,120),this._renderBlock();else{var a=Math.max(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize);this._build(a+10,a+10);this._renderPoint()}};
ia.GradientLegend.prototype._build=function(a,b){this.$table.empty();var c=this.thematic.numericClassifier.getBreaks();this._minValue=c[0];this._maxValue=c[c.length-1];var d;this.thematic.numericClassifier.sizePalette.maxSize>=this.thematic.numericClassifier.sizePalette.minSize?(c=this.thematic.numericClassifier.formatter.format(this._minValue,this.precision),d=this.thematic.numericClassifier.formatter.format(this._maxValue,this.precision)):(c=this.thematic.numericClassifier.formatter.format(this._maxValue,
this.precision),d=this.thematic.numericClassifier.formatter.format(this._minValue,this.precision));var e=$j("<tr>");this._maxLabel=$j("<td class='ia-legend-item ia-legend-label ia-gradient-legend-label'>");this._maxLabel.html(d);e.append(this._maxLabel);this.$table.append(e);e=$j("<tr>");d=$j("<td class='ia-legend-item'>");e.append(d);this.$table.append(e);e=$j("<div class='ia-legend-symbol' style='width:"+a+";height:"+b+";'>");d.append(e);this._canvas=document.createElement("canvas");this._canvas.width=
a;this._canvas.height=b;e.append($j(this._canvas));this._context=this._canvas.getContext("2d");e=$j("<tr>");this._minLabel=$j("<td class='ia-legend-item ia-legend-label ia-gradient-legend-label'>");this._minLabel.html(c);e.append(this._minLabel);this.$table.append(e)};
ia.GradientLegend.prototype._renderBlock=function(){if(this._context){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);this._context.strokeStyle=this.style.strokeStyle;this._context.lineWidth=this.style.lineWidth;var a=this.thematic.numericClassifier.colorPalette.getColorList();this._context.beginPath();ia.Shape.drawGradient(this._canvas,a,"bottomToTop");this._context.fill();this._context.stroke()}};
ia.GradientLegend.prototype._renderPoint=function(){if(this._context){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var a=Math.min(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize),b=Math.max(this.thematic.numericClassifier.sizePalette.minSize,this.thematic.numericClassifier.sizePalette.maxSize),c=this._canvas.width/2,d=this._canvas.height/2;this._context.strokeStyle=this.style.strokeStyle;this._context.lineWidth=this.style.lineWidth;
this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,c,d,a);this._context.stroke();this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,c,d,b);this._context.stroke()}};ia.GradientLegend.prototype.highlight=function(a){if(this._context&&this.thematic&&(a=this.thematic.getData()[a])&&a.legendClass)a=a.legendClass.value,this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE||this.thematic.heatmap==!0?this._highlightBlock(a):this._highlightPoint(a)};
ia.GradientLegend.prototype._highlightBlock=function(a){this._renderBlock();if(ia.isNumber(a))this._context.strokeStyle=this.highlightColor,this._context.lineWidth=3,a=this._canvas.height-(a-this._minValue)/(this._maxValue-this._minValue)*this._canvas.height,this._context.beginPath(),this._context.moveTo(1,a),this._context.lineTo(this._canvas.width-1,a),this._context.stroke()};
ia.GradientLegend.prototype._highlightPoint=function(a){this._renderPoint();if(ia.isNumber(a)&&(a=this.thematic.getClass(a),a!=void 0)){var b=this._canvas.width/2,c=this._canvas.height/2;this._context.strokeStyle=this.style.strokeStyle;this._context.lineWidth=this.style.lineWidth;this._context.fillStyle=a.color;this._context.beginPath();ia.Shape.draw(this.thematic.symbol,this._context,b,c,a.size);this._context.fill();this._context.stroke()}};
ia.GradientLegend.prototype.clearHighlight=function(){this.thematic.symbol==ia.Shape.SQUARE||this.thematic.symbol==ia.Shape.LINE||this.thematic.heatmap==!0?this._renderBlock():this._renderPoint()};ia.GradientLegend.prototype.select=function(){};ia.GradientLegend.prototype.unselect=function(){};ia.GradientLegend.prototype.clearSelection=function(){};ia.GradientLegend.prototype.hide=function(){this.container.css("display","none")};
ia.GradientLegend.prototype.show=function(){this.container.css("display","inline")};ia.Metadata=function(a){this.container=$j("<div id='"+a+"' class='ia-metadata-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this._textBox=$j("<div class='ia-metadata'>");this.container.append(this._textBox)};
ia.Metadata.prototype.setHtml=function(a){if(a!=void 0)if(a=""+a,(ia.endsWith(a,".htm")||ia.endsWith(a,".html"))&&a.indexOf("href=")==-1){var b=this;this._textBox.load(a,function(){b._scrollBox.refresh()})}else this._textBox.html(a),this._scrollBox.refresh()};ia.HTMLContainer=function(a){this.container=$j("<div id='"+a+"'>")};ia.HTMLContainer.prototype.setHtml=function(a){a!=void 0&&((ia.endsWith(a,".htm")||ia.endsWith(a,".html"))&&a.indexOf("href=")==-1?this.container.load(a,function(){}):this.container.html(a))};
ia.LegendEditor=function(a,b,c,d){var e=this;this.showSizePanel=this.showPalettePanel=this.showLegendTools=this.showLegendTypePanel=!0;this._options=d;this._updateTimeout=void 0;this._isVisible=this._lockEditor=!1;this._thematic=a;this._thematic.addEventListener(ia.Event.THEME_CHANGED,function(){e.render()},e);this._reportConfig=b;this._settings=c;this._dataType=this._thematic.getDataType();this.container=$j('<div class="ia-editor"></div>');$j("body").bind("click",function(){e.hide()});this.container.bind("click",
function(a){a.stopPropagation()});e.render()};ia.LegendEditor.prototype.setParams=function(a,b,c){var d=this;this._thematic=a;this._thematic.removeListener(d);this._thematic.addEventListener(ia.Event.THEME_CHANGED,function(){d.render()});this._reportConfig=b;this._settings=c;this._dataType=this._thematic.getDataType();this.render()};
ia.LegendEditor.prototype.render=function(){var a=this;this.container.empty();var b=$j("<div>");this.container.append(b);var c=this._thematic.numericClassifier,d=this._thematic.categoricClassifier,e=this._reportConfig.getMapPalette();if(this._thematic.getDataType()==ia.Thematic.CATEGORIC){if(this._dataType!=ia.Thematic.CATEGORIC&&a._options&&a._options.onDataTypeChanged)this._dataType=ia.Thematic.CATEGORIC,a._options.onDataTypeChanged.call(null,ia.Thematic.CATEGORIC,d.colorPalette);if(this.showPalettePanel){var f=
$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);var g=$j("<tr>");f.append(g);var h=$j("<td>");g.append(h);var i=$j("<table class='ia-editor-color-panel'>");h.append(i);f=$j("<tr>");i.append(f);for(var i=e.getColorSchemes(),k=0;k<i.length;k++){var j=i[k],h=$j("<td class='ia-list-item'>");f.append(h);(function(){var b=j;h.bind("click",function(){d.colorPalette=b;a._settings.schemeId=b.id;a._updateTheme();a._options&&a._options.onSchemeChanged&&a._options.onSchemeChanged.call(null,
d.colorPalette)})})();for(var m=j.getColorList(),n=0;n<m.length;n++){var l=m[n],o=$j("<div class='ia-editor-color-panel-discrete-swatch'>");j.id==d.colorPalette.id&&o.addClass("ia-editor-swatch-selected");o.css({"background-color":l});h.append(o)}}}if(this._thematic.symbol!=ia.Shape.SQUARE&&this.showSizePanel){this.showPalettePanel&&(f=$j("<div class='ia-editor-separator'>"),b.append(f));var q=5,p=5;this._thematic.symbol==ia.Shape.LINE&&(p=q=1);var r=d.symbolSize,m=$j("<table class='ia-editor-panel ia-editor-size-panel'>");
b.append(m);f=$j("<tr>");m.append(f);h=$j("<td class='ia-list-item' style='width:50px'>").html("-");f.append(h);h.bind("click",function(){var b=r-q;b<p&&(b=p);d.symbolSize=b;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&a._options.onSymbolSizeChanged.call(null,d.symbolSize)});h=$j("<td style='padding:5px'>");f.append(h);m=document.createElement("canvas");m.width=r+2;if(this._thematic.symbol==ia.Shape.LINE)m.width=100;m.height=r+2;h.append($j(m));n=m.getContext("2d");this._thematic.symbol==
ia.Shape.LINE?(n.strokeStyle="#cccccc",n.lineWidth=r,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,m.width)):(n.strokeStyle="#cccccc",n.fillStyle="#f9f9f9",n.lineWidth=1,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,r),n.fill());n.stroke();h=$j("<td class='ia-list-item' style='width:50px'>").html("+");f.append(h);h.bind("click",function(){d.symbolSize=r+q;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&a._options.onSymbolSizeChanged.call(null,
d.symbolSize)})}}else{if(this._dataType!=ia.Thematic.NUMERIC&&a._options&&a._options.onDataTypeChanged)this._dataType=ia.Thematic.NUMERIC,a._options.onDataTypeChanged.call(null,ia.Thematic.NUMERIC,c.colorPalette);m=c.classificationName;i=$j("<table class='ia-editor-panel ia-editor-classifier-panel'>");b.append(i);f=$j("<tr>");i.append(f);if(this.showLegendTypePanel){g=[ia.Thematic.QUANTILE,ia.Thematic.EQUAL_INTERVAL,ia.Thematic.NATURAL,ia.Thematic.CONTINUOUS,ia.Thematic.STANDARD_DEVIATION];i=[this._reportConfig.getProperty("quantile"),
this._reportConfig.getProperty("equalInterval"),this._reportConfig.getProperty("natural"),this._reportConfig.getProperty("continuous"),this._reportConfig.getProperty("standardDeviation")];n=i[g.indexOf(m)];for(k=0;k<g.length;k++){var t=g[k],s=i[k];s!=void 0&&(h=$j("<td class='ia-list-item'>").html(s),s==n&&h.addClass("ia-editor-classifier-selected"),f.append(h),function(){var b=t;h.bind("click",function(){a._typeMenuOpen=!1;c.classificationName=b;a._settings.legendType=b;a._updateTheme();a._options&&
a._options.onClassificationChanged&&a._options.onClassificationChanged.call(null,c.classificationName)})}())}}if(m!=ia.Thematic.CONTINUOUS){if(this.showPalettePanel){this.showLegendTypePanel&&(f=$j("<div class='ia-editor-separator'>"),b.append(f));f=$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);g=$j("<tr>");f.append(g);h=$j("<td>");g.append(h);i=$j("<table class='ia-editor-color-panel'>");h.append(i);f=$j("<tr>");i.append(f);i=e.getColorPalettes();for(k=0;k<i.length;k++){j=
i[k];h=$j("<td class='ia-list-item'>");j.id==c.colorPalette.id&&h.addClass("ia-editor-selected");f.append(h);(function(){var b=j;h.bind("click",function(){c.colorPalette=b;a._settings.paletteId=b.id;a._updateTheme();a._options&&a._options.onPaletteChanged&&a._options.onPaletteChanged.call(null,c.colorPalette)})})();n=c.noClasses;m==ia.Thematic.STANDARD_DEVIATION&&(n=6);s=j.getInterpolatedColors(n);for(n=0;n<s.length;n++)l=s[n],o=$j("<div class='ia-editor-color-panel-discrete-swatch'>"),j.id==c.colorPalette.id&&
o.addClass("ia-editor-swatch-selected"),o.css({"background-color":l}),h.append(o)}this.showLegendTools&&(h=$j("<td>"),g.append(h),i=$j("<table class='ia-editor-tool-panel'>"),h.append(i),f=$j("<tr>"),i.append(f),h=$j("<td class='ia-list-item'>").html("&uArr;&dArr;"),f.append(h),h.bind("click",function(){c.colorPalette.getColorList().reverse();a._updateTheme();a._options&&a._options.onPaletteFlipped&&a._options.onPaletteFlipped.call(null,c.colorPalette)}),m!=ia.Thematic.STANDARD_DEVIATION&&(f=$j("<tr>"),
i.append(f),h=$j("<td class='ia-list-item'>").html("-"),f.append(h),h.bind("click",function(){c.noClasses>e.minNoClasses&&(c.noClasses--,a._updateTheme(),a._options&&a._options.onNoClassesChanged&&a._options.onNoClassesChanged.call(null,c.noClasses))}),f=$j("<tr>"),i.append(f),h=$j("<td class='ia-list-item'>").html("+"),f.append(h),h.bind("click",function(){c.noClasses<e.maxNoClasses&&(a._thematic.numericClassifier.noClasses++,a._updateTheme(),a._options&&a._options.onNoClassesChanged&&a._options.onNoClassesChanged.call(null,
c.noClasses))})))}}else if(this.showPalettePanel){this.showLegendTypePanel&&(f=$j("<div class='ia-editor-separator'>"),b.append(f));f=$j("<table class='ia-editor-panel ia-editor-palette-panel'>");b.append(f);g=$j("<tr>");f.append(g);h=$j("<td>");g.append(h);i=$j("<table class='ia-editor-color-panel'>");h.append(i);f=$j("<tr>");i.append(f);i=e.getColorPalettes();for(k=0;k<i.length;k++)j=i[k],h=$j("<td class='ia-list-item'>"),f.append(h),function(){var b=j;h.bind("click",function(){c.colorPalette=b;
a._settings.paletteId=b.id;a._updateTheme();a._options&&a._options.onPaletteChanged&&a._options.onPaletteChanged.call(null,c.colorPalette)})}(),s=j.getColorList(),m=document.createElement("canvas"),$j(m).addClass("ia-editor-color-panel-continuous-swatch"),j.id==c.colorPalette.id&&$j(m).addClass("ia-editor-swatch-selected"),h.append($j(m)),n=m.getContext("2d"),n.beginPath(),ia.Shape.drawGradient(m,s,"bottomToTop"),n.fill();this.showLegendTools&&(h=$j("<td>"),g.append(h),i=$j("<table class='ia-editor-tool-panel'>"),
h.append(i),f=$j("<tr>"),i.append(f),h=$j("<td class='ia-list-item'>").html("&uArr;&dArr;"),f.append(h),h.bind("click",function(){c.colorPalette.getColorList().reverse();a._updateTheme();a._options&&a._options.onPaletteFlipped&&a._options.onPaletteFlipped.call(null,c.colorPalette)}))}if(this._thematic.symbol!=ia.Shape.SQUARE&&this.showSizePanel){if(this.showPalettePanel||this.showLegendTypePanel)f=$j("<div class='ia-editor-separator'>"),b.append(f);p=q=5;this._thematic.symbol==ia.Shape.LINE&&(p=q=
1);var u=c.sizePalette,m=c.colorPalette.getColorList(),k=m[0],g=m[m.length-1],m=$j("<table class='ia-editor-panel ia-editor-size-panel'>");b.append(m);b=$j("<tr>");m.append(b);h=$j("<td style='vertical-align:top;width:50px;padding:0px'>");b.append(h);i=$j("<table style='width:100%'>");h.append(i);f=$j("<tr>");i.append(f);h=$j("<td class='ia-list-item'>").html("-");f.append(h);h.bind("click",function(){var b=u.minSize-q;b<p&&(b=p);u.minSize=b;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&
a._options.onSymbolSizeChanged.call(null,u.minSize,u.maxSize)});f=$j("<tr>");i.append(f);h=$j("<td class='ia-list-item'>").html("+");f.append(h);h.bind("click",function(){u.minSize+=q;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&a._options.onSymbolSizeChanged.call(null,u.minSize,u.maxSize)});h=$j("<td style='padding:5px'>");b.append(h);f=Math.max(u.minSize,u.maxSize)+2;m=document.createElement("canvas");m.width=f;if(this._thematic.symbol==ia.Shape.LINE)m.width=100;m.height=f;h.append($j(m));
n=m.getContext("2d");this._thematic.symbol==ia.Shape.LINE?(n.strokeStyle=k,n.lineWidth=u.minSize,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,m.width)):(n.strokeStyle="#cccccc",n.fillStyle=k,n.lineWidth=1,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,u.minSize),n.fill());n.stroke();h=$j("<td style='padding:5px'>");b.append(h);m=document.createElement("canvas");m.width=f;if(this._thematic.symbol==ia.Shape.LINE)m.width=100;m.height=f;h.append($j(m));
n=m.getContext("2d");this._thematic.symbol==ia.Shape.LINE?(n.strokeStyle=g,n.lineWidth=u.maxSize,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,m.width)):(n.strokeStyle="#cccccc",n.fillStyle=g,n.lineWidth=1,n.beginPath(),ia.Shape.draw(this._thematic.symbol,n,m.width/2,m.height/2,u.maxSize),n.fill());n.stroke();h=$j("<td style='vertical-align:top;width:50px;padding:0px'>");b.append(h);i=$j("<table style='width:100%'>");h.append(i);f=$j("<tr>");i.append(f);h=$j("<td class='ia-list-item'>").html("-");
f.append(h);h.bind("click",function(){var b=u.maxSize-q;b<p&&(b=p);u.maxSize=b;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&a._options.onSymbolSizeChanged.call(null,u.minSize,u.maxSize)});f=$j("<tr>");i.append(f);h=$j("<td class='ia-list-item'>").html("+");f.append(h);h.bind("click",function(){u.maxSize+=q;a._updateTheme();a._options&&a._options.onSymbolSizeChanged&&a._options.onSymbolSizeChanged.call(null,u.minSize,u.maxSize)})}}this._lockEditor=!1};
ia.LegendEditor.prototype._updateTheme=function(){if(!this._lockEditor){var a=this;clearTimeout(this._updateTimeout);this._updateTimeout=setTimeout(function(){a._lockEditor=!0;a._thematic.commitChanges()},100)}};ia.LegendEditor.prototype.toggle=function(){this._isVisible?this.hide():this.show()};ia.LegendEditor.prototype.hide=function(){this._isVisible&&this.container.animate({opacity:0},function(){this.container.css({visibility:"hidden"});this._isVisible=!1})};
ia.LegendEditor.prototype.show=function(){this._isVisible||this.container.css({visibility:"visible"}).animate({opacity:1},function(){this._isVisible=!0})};
ia.MapTools=function(a,b,c,d,e){this._filterBtn=this._clearBtn=void 0;this._map=a;this._useGoogleMaps=d;this._includeSearchTool=e;this._searching=!1;this._interactionGroup=c;this._dataGroup=b;this._marker=new Image;this._marker.src="./map_tool_search.png";this.container=this._useGoogleMaps?$j('<div class="ia-google-map-toolbar"></div>'):$j('<div class="ia-map-toolbar"></div>');c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,this._updateToolbar.bind(this));b.addEventListener(ia.FilterEvent.FILTER_CHANGED,
this._updateToolbar.bind(this))};
ia.MapTools.prototype._updateToolbar=function(){this._interactionGroup.getSelection().length>0?(this._clearBtn&&this._clearBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"),this._filterBtn&&this._filterBtn.removeClass("ia-cross-btn ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn-disabled")):(this._clearBtn&&this._clearBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled"),this._filterBtn&&
(this._dataGroup.getFilteredFeatures().length>0?this._filterBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"):this._filterBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled")))};ia.MapTools.prototype.filterFunction=function(){};ia.MapTools.prototype.clearFunction=function(){};
ia.MapTools.prototype.searchFunction=function(a,b){var c=this._map.controller.defaultBBox,c='{"xmin":'+c.getXMin()+',"ymin":'+c.getXMin()+',"xmax":'+c.getXMax()+',"ymax":'+c.getYMax()+',"spatialReference":{"wkid":102100}}';ia.File.load({url:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find?text="+a+"&outSR=102100&bbox="+c+"&maxLocations=4&f=json",dataType:"json",onSuccess:function(a){var c=[];if(a.locations!=void 0)for(var a=a.locations,f=0;f<a.length;f++){var g=a[f],h={};h.name=
g.name;h.location=g.feature.geometry;h.bounds=g.extent;c[c.length]=h}b.call(null,c)}})};
ia.MapTools.prototype.render=function(){this.container.empty();var a=this,b=!1;this._map.container.mouseenter(function(){b||(a.container.stop(),a.container.css({visibility:"visible"}).animate({opacity:1}))});this._map.container.mouseleave(function(){a.container.stop();a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})});b=!1});this.container.mouseenter(function(){b=!0;a.container.stop();a.container.animate({opacity:1})});this.container.mouseleave(function(){b=!1;a.container.stop();
a.container.animate({opacity:1})});var c;this.container.bind("touchstart",function(){a.container.stop();a.container.css({visibility:"visible"}).animate({opacity:1});clearTimeout(c);c=setTimeout(function(){clearTimeout(c);a.container.stop();a._searching||a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})})},5E3)});this._map.container.bind("touchstart",function(){a._searching=!1;a.container.stop();a.container.css({visibility:"visible"}).animate({opacity:1});clearTimeout(c);
c=setTimeout(function(){clearTimeout(c);a.container.stop();a._searching||a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})})},5E3)});var d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomfull-btn"></div>');this.container.append(d);d.bind("click",function(b){b.stopPropagation();b.preventDefault();a._map.controller.zoomFull()});d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomout-btn"></div>');this.container.append(d);d.bind("click",function(b){b.stopPropagation();
b.preventDefault();a._useGoogleMaps?a._map.gMap.setZoom(a._map.gMap.getZoom()-1):a._map.controller.zoomOut()});d=$j('<div class="ia-toolbar-btn ia-list-item ia-zoomin-btn"></div>');this.container.append(d);d.bind("click",function(b){b.stopPropagation();b.preventDefault();a._useGoogleMaps?a._map.gMap.setZoom(a._map.gMap.getZoom()+1):a._map.controller.zoomIn()});var e;this._includeSearchTool&&(e=$j('<div class="ia-toolbar-btn ia-list-item ia-search-btn"></div>'),a.container.append(e));if(this.clearButtonText)a._clearBtn=
$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(a.clearButtonText),a.container.append(a._clearBtn),a._clearBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.clearFunction()});if(this.filterButtonText)this._filterBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.filterButtonText),this.container.append(this._filterBtn),this._filterBtn.bind("click",function(b){b.stopPropagation();
b.preventDefault();a.filterFunction()});if(this._includeSearchTool)if(this._useGoogleMaps){var f=$j("<div id='ia-search-holder-"+this._map.id+"' class='ui-widget'>"),g=$j("<input id='ia-search-"+this._map.id+"' class='ia-search-input'>");f.append(g);this.container.append(f);f.hide();var h=!0,i=new google.maps.Geocoder,k;e.bind("click",function(b){a._searching=!0;b.stopPropagation();b.preventDefault();f.toggle();h&&(h=!1,g.autocomplete({source:function(b,c){i.geocode({address:b.term,bounds:a._map.defaultBounds},
function(b,d){if(d==google.maps.GeocoderStatus.OK){var e=[],f;for(f in b){var g=b[f];g.geometry.bounds&&a._map.defaultBounds.intersects(g.geometry.bounds)&&(e[e.length]=b[f])}c($j.map(e,function(a){return{label:a.formatted_address,value:a.formatted_address,location:a.geometry.location,bounds:a.geometry.bounds}}))}})},minLength:2,select:function(b,c){a._map.gMap.fitBounds(c.item.bounds);k&&k.setMap(null);k=new google.maps.Marker({map:a._map.gMap,position:c.item.location});f.toggle()},open:function(){},
close:function(){},appendTo:"#ia-search-holder-"+a._map.id+""}));g.focus();g.val([]);g.autocomplete("close")})}else f=$j("<div id='ia-search-holder-"+this._map.id+"' class='ui-widget'>"),g=$j("<input id='ia-search-"+this._map.id+"' class='ia-search-input'>"),f.append(g),this.container.append(f),f.hide(),h=!0,e.bind("click",function(b){a._searching=!0;a._map.markerLayer.clearMarkers();b.stopPropagation();b.preventDefault();f.toggle();h&&(h=!1,g.autocomplete({source:function(b,c){a.searchFunction(b.term,
function(a){c($j.map(a,function(a){return{label:a.name,value:a.name,location:a.location,bounds:a.bounds}}))})},minLength:2,select:function(b,c){var d=c.item.bounds,e=c.item.location;d!=void 0?(d=new ia.BoundingBox(d.xmin,d.ymin,d.xmax,d.ymax),a._map.maxZoom!=-1&&Math.min(d.getWidth(),d.getHeight())<a._map.maxZoom&&(cx=d.getXCenter(),cy=d.getYCenter(),d.setWidth(a._map.maxZoom),d.setHeight(a._map.maxZoom),d.setXCenter(cx),d.setYCenter(cy)),a._map.controller.zoomToBBox(d)):e!=void 0&&a._map.controller.centerOnCoords(e.x,
e.y);e!=void 0&&(a._map.markerLayer.clearMarkers(),a._map.markerLayer.addMarker(a._marker,e.x,e.y),a._map.markerLayer.render());f.toggle();a.container.animate({opacity:0},function(){a.container.css({visibility:"hidden"})})},open:function(){},close:function(){},appendTo:"#ia-search-holder-"+a._map.id+""}));g.focus();g.val([]);g.autocomplete("close")});this._updateToolbar()};
ia.TableTools=function(a,b){this._filterBtn=this._clearBtn=void 0;this._interactionGroup=b;this._dataGroup=a;this._borderRadius=0;this._borderRadius=parseInt($j(".ia-panel").css("border-top-left-radius"))-1;if(this._borderRadius<0)this._borderRadius=0;this.container=$j('<div class="ia-table-toolbar"></div>');this.container.css("border-bottom-left-radius",this._borderRadius+"px");this.container.css("border-bottom-right-radius",this._borderRadius+"px");b.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,
this._updateToolbar.bind(this));a.addEventListener(ia.FilterEvent.FILTER_CHANGED,this._updateToolbar.bind(this))};
ia.TableTools.prototype._updateToolbar=function(){this._interactionGroup.getSelection().length>0?(this._clearBtn&&this._clearBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"),this._filterBtn&&this._filterBtn.removeClass("ia-cross-btn ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn-disabled")):(this._clearBtn&&this._clearBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled"),
this._filterBtn&&(this._dataGroup.getFilteredFeatures().length>0?this._filterBtn.removeClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled").addClass("ia-list-item ia-cross-btn"):this._filterBtn.removeClass("ia-list-item ia-cross-btn").addClass("ia-cross-btn-disabled ia-toolbar-text-btn-disabled")))};ia.TableTools.prototype.filterFunction=function(){};ia.TableTools.prototype.clearFunction=function(){};
ia.TableTools.prototype.render=function(){this.container.empty();var a=this;if(this.clearButtonText)this._clearBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.clearButtonText),this.container.append(this._clearBtn),this._clearBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.clearFunction()}),this._clearBtn.css("border-radius",this._borderRadius+"px");if(this.filterButtonText)this._filterBtn=$j("<div class='ia-toolbar-text-btn ia-list-item ia-toolbar-text-btn-disabled ia-cross-btn-disabled'>").html(this.filterButtonText),
this.container.append(this._filterBtn),this._filterBtn.bind("click",function(b){b.stopPropagation();b.preventDefault();a.filterFunction()}),this._filterBtn.css("border-radius",this._borderRadius+"px");this._updateToolbar()};
ia.AdvancedPieComponent=function(a,b){ia.AdvancedPieComponent.baseConstructor.call(this);this.id=a;this.tip="";this._layout=b;this._chartTitle1="";this._layer1=this._chart1=void 0;this._chartTitle2="";this._legend=this._layer2=this._chart2=void 0;this._selectionIds=[];this._scrollContainer=this._scrollBox=void 0;this._multiLayout=!0;this._data=void 0;this._isVisible=!0};ia.extend(ia.EventDispatcher,ia.AdvancedPieComponent);
ia.AdvancedPieComponent.prototype.build=function(){var a=new ia.InteractionGroup;this.container=$j("<div id='"+this.id+"' class='ia-advanced-chart'>");var b=this;this.container.resize(function(){b._size()});this._scrollContainer=$j("<div id='"+this.id+"-scroll-container' class='ia-advanced-chart-scrollbox'>");this._scrollBox=new ia.ScrollBox(this._scrollContainer);this.container.append(this._scrollContainer);this.thematic=new ia.Thematic;this.thematic.setDataType(ia.Thematic.CATEGORIC);this.thematic.setDataField("value");
var c,d,e;this._layout=="vertical"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:90%;height:30%'>"),d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:35%;width:90%;height:30%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:70%;width:90%'>")):this._layout=="horizontal"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:30%;height:80%'>"),
d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:30%;top:0%;width:30%;height:80%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:60%;top:0%;height:80%;width:35%'>")):this._layout=="box"?(c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:50%;height:40%'>"),d=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:50%;width:50%;height:40%'>"),
e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:50%;top:0%;width:45%'>")):(this._multiLayout=!1,c=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:0%;top:0%;width:50%;height:90%'>"),e=$j("<div class='ia-ui-item ia-ui-item-align-center' style='position:absolute;left:50%;top:0%;width:45%;'>"));this._scrollContainer.append(c);this._multiLayout&&this._scrollContainer.append(d);this._scrollContainer.append(e);this._chartTitle1=$j("<div>").html("");
c.append(this._chartTitle1);this._chart1=new ia.PieChart(this.id+"-pie-chart-1");this._chart1.container.css("position","relative");c.append(this._chart1.container);this._layer1=new ia.AdvancedPieLayer;this._layer1.thematic=this.thematic;this._layer1.highlightColor=this.highlightColor;this._layer1.selectionColor=this.selectionColor;this._layer1.tip=this.tip;this._layer1.setVisible(!0);this._layer1.interactive=!0;a.addComponent(this._layer1);this._chart1.addLayer(this._layer1);if(this._multiLayout)this._chartTitle2=
$j("<div>"),d.append(this._chartTitle2).html(""),this._chart2=new ia.PieChart(this.id+"-pie-chart-2"),this._chart2.container.css("position","relative"),d.append(this._chart2.container),this._layer2=new ia.AdvancedPieLayer,this._layer2.thematic=this.thematic,this._layer2.highlightColor=this.highlightColor,this._layer2.selectionColor=this.selectionColor,this._layer2.tip=this.tip,this._layer2.setVisible(!0),this._layer2.interactive=!0,a.addComponent(this._layer2),this._chart2.addLayer(this._layer2);
this._legend=new ia.DiscreteLegend(this.id+"-this._legend-discrete");this._legend.thematic=this.thematic;this._legend.highlightColor=this.highlightColor;this._legend.selectionColor=this.selectionColor;a.addComponent(this._legend);e.append(this._legend.container);this._legend.container.resize(function(){b._size()})};ia.AdvancedPieComponent.prototype._size=function(){this._scrollContainer.height(this.container.height());this._scrollContainer.width(this.container.width());this._scrollBox.refresh()};
ia.AdvancedPieComponent.prototype.setData=function(a){this._data=a;this._layer1.setData(a);this._multiLayout&&this._layer2.setData(a)};
ia.AdvancedPieComponent.prototype.highlight=function(a){if(this._multiLayout)if(this._selectionIds.length==1)this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName);else{if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)}else if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)};
ia.AdvancedPieComponent.prototype.clearHighlight=function(){if(this._multiLayout)if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render();else{if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};
ia.AdvancedPieComponent.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._multiLayout?this._selectionIds.length>1?(this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this._layer2.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._chartTitle1.html(this._layer1.itemName))};
ia.AdvancedPieComponent.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);if(this._multiLayout)if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render();else{if(this._selectionIds.length==1)this._chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render()}else if(this._selectionIds.length==0)this._chartTitle1.html(this.title1),this._layer1.itemId=
null,this._layer1.update(),this._layer1.render()};ia.AdvancedPieComponent.prototype.clearSelection=function(){this._selectionIds=[];this._layer1.itemId=null;this._layer1.update();this._layer1.render();this._chartTitle1.html(this.title1);if(this._multiLayout)this._layer2.itemId=null,this._layer2.update(),this._layer2.render(),this._chartTitle2.html(this.title2)};
ia.AdvancedPieComponent.prototype.render=function(){this._legend.render();this._layer1.update();this._layer1.render();this._chartTitle1.html()==""&&this._chartTitle1.html(this.title1);this._multiLayout&&(this._layer2.update(),this._layer2.render(),this._chartTitle2.html()==""&&this._chartTitle2.html(this.title2));this._size()};ia.AdvancedPieComponent.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.AdvancedPieComponent.prototype.hide=function(){if(this._isVisible)this._isVisible=!1,this.container.stop(),this.container.animate({opacity:0},function(){})};ia.AdvancedPieComponent.prototype.show=function(){if(!this._isVisible)this._isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};
ia.FeatureLegend=function(a){ia.FeatureLegend.baseConstructor.call(this,a);this._selectionIds=[];this.container.addClass("ia-feature-legend");this._scrollBox=new ia.ScrollBox(this.container);this._renderTimeout=null;this.interactive=this.isLegendComponent=!1;this.colorPalette=new ia.ColorPalette};ia.extend(ia.DiscreteLegend,ia.FeatureLegend);
ia.FeatureLegend.prototype.render=function(){this._renderTimeout=null;for(var a=[],b=this._selectionIds.length,c=this.colorPalette.getColors(b),d=0;d<b;d++){var e=this.geography.getFeature(this._selectionIds[d]);if(e!=void 0)e=new ia.CategoricClass(e.name),e.color=c[d],a[d]=e}this.renderLegend(a);this._scrollBox.refresh()};ia.FeatureLegend.prototype.highlight=function(){};ia.FeatureLegend.prototype.clearHighlight=function(){};
ia.FeatureLegend.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._triggerRender()};ia.FeatureLegend.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);this._triggerRender()};ia.FeatureLegend.prototype.clearSelection=function(){this._selectionIds=[];this._triggerRender()};
ia.FeatureLegend.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};ia.MenuBar=function(a){this.container=$j("<div id='"+a+"' class='ia-menubar'>")};
ia.MenuBar.prototype.render=function(a){this.container.empty();var b=$j("<table class='ia-menubar-table'>");this.container.append(b);var c=$j("<tr>");b.append(c);var b=a.getProperties(),d;for(d in b)if(d.indexOf("menuItem")!=-1){var e=d.substring(8,d.length),f=a.getProperty("menuItem"+e);if(f){$td=$j("<td class='ia-list-item ia-menubar-btn'>").html(f);c.append($td);var g=a.getProperty("menuFunc"+e);g!=void 0&&function(){var a=g;a.indexOf("http")==-1&&a.indexOf("javascript")==-1&&(a=ia.IAS_PATH+a);
$td.bind("click",function(b){b.stopPropagation();ia.callFunction(a,"_blank",b)})}()}}};
ia.CalloutBox=function(a,b){this.id=a;this.notchPosition=b||"left-right";this.container=$j('<div id="'+a+'" class="callout"></div>');this._py=this._px=0;this._popup=this._isVisible=!1;this._notchBorder=$j('<div class="callout-notch"></div>');this._notchBorder.addClass("callout-notch-"+this.notchPosition);this.container.append(this._notchBorder);this._notchFill=$j('<div class="callout-notch"></div>');this._notchFill.addClass("callout-notch-"+this.notchPosition);this.container.append(this._notchFill);
this.notchPosition=="none"&&(this._notchBorder.css({display:"none"}),this._notchFill.css({display:"none"}));var c=$j("<div>").addClass("ia-panel-btns").attr("id",a+"-btns");this.container.append(c);var d=!1;this.container.mouseenter(function(){d||(c.stop(),c.css({visibility:"visible"}).animate({opacity:0.4}))});this.container.mouseleave(function(){c.stop();c.animate({opacity:0},function(){c.css({visibility:"hidden"})})});c.mouseenter(function(){d=!0;c.animate({opacity:1})});c.mouseleave(function(){d=
!1;c.stop();c.animate({opacity:0.4})});var e;this.container.bind("touchstart",function(){c.stop();c.css({visibility:"visible"}).animate({opacity:1});clearTimeout(e);e=setTimeout(function(){clearTimeout(e);c.stop();c.animate({opacity:0},function(){c.css({visibility:"hidden"})})},5E3)});var f=this,g=$j("<div>").addClass("ia-panel-btn ia-panel-close-btn").attr("id",a+"-close");g.bind("click",function(a){a.stopPropagation();f.hide()});c.append(g);var h;this.container.resize(function(){clearTimeout(h);
h=setTimeout(function(){clearTimeout(h);f._isVisible&&f.position()},300)})};
ia.CalloutBox.prototype.position=function(a,b){if(this.container.parent()!=void 0){if(a)a-=this.container.parent().offset().left,this._px=a;if(b)b-=this.container.parent().offset().top,this._py=b;this._notchBorder.removeClass("callout-notch-left callout-notch-right callout-notch-border-left callout-notch-border-right");this._notchFill.removeClass("callout-notch-left callout-notch-right");this._notchBorder.css({left:"",right:"",top:"",bottom:""});this._notchFill.css({left:"",right:"",top:"",bottom:""});
var c=a||this._px,d=b||this._py,e=this.container.parent().width(),f=this.container.parent().height(),g=this.container.outerWidth(),h=this.container.outerHeight(),i=e/2,k=f/2,j,m;this.notchPosition=="left-right"?(j=30,m=Math.min(30,h/2),d-=m):(m=30,j=Math.min(30,g/2),c-=j);this.notchPosition=="left-right"?c<i?(this._notchBorder.hasClass("callout-notch-right")&&(this._notchBorder.removeClass("callout-notch-right callout-notch-border-right"),this._notchFill.removeClass("callout-notch-right")),c+=j,this._notchBorder.addClass("callout-notch-left callout-notch-border-left"),
this._notchFill.addClass("callout-notch-left"),this._notchBorder.css({left:"-11px"}),this._notchFill.css({left:"-10px"})):(this._notchBorder.hasClass("callout-notch-left")&&(this._notchBorder.removeClass("callout-notch-left callout-notch-border-left"),this._notchFill.removeClass("callout-notch-left")),c=c-g-j,this._notchBorder.addClass("callout-notch-right callout-notch-border-right"),this._notchFill.addClass("callout-notch-right"),this._notchBorder.css({right:"-11px"}),this._notchFill.css({right:"-10px"})):
d<k?(this._notchBorder.hasClass("callout-notch-bottom")&&(this._notchBorder.removeClass("callout-notch-bottom callout-notch-border-bottom"),this._notchFill.removeClass("callout-notch-bottom")),d+=m,this._notchBorder.addClass("callout-notch-top callout-notch-border-top"),this._notchFill.addClass("callout-notch-top"),this._notchBorder.css({top:"-11px"}),this._notchFill.css({top:"-10px"})):(this._notchBorder.hasClass("callout-notch-top")&&(this._notchBorder.removeClass("callout-notch-top callout-notch-border-top"),
this._notchFill.removeClass("callout-notch-top")),d=d-h-m,this._notchBorder.addClass("callout-notch-bottom callout-notch-border-bottom"),this._notchFill.addClass("callout-notch-bottom"),this._notchBorder.css({bottom:"-11px"}),this._notchFill.css({bottom:"-10px"}));j=c+g-(e-10);j>0&&(c-=j);c<10&&(c=10);m=d+h-(f-10);m>0&&(d-=m);d<10&&(d=10);this.notchPosition=="left-right"?(e=this._py-d-5,this._notchBorder.css({top:e+"px"}),this._notchFill.css({top:e+"px"})):(e=this._px-c-5,this._notchBorder.css({left:e+
"px"}),this._notchFill.css({left:e+"px"}));this.container.css({left:c+"px",top:d+"px"})}};ia.CalloutBox.prototype.popup=function(a){if(a==!0){this._popup=!0;var b=this;$j("body").bind("click",function(){b.hide()});this.container.bind("click",function(a){a.stopPropagation()})}else if(a==!1)this._popup=!1;else return this._popup};ia.CalloutBox.prototype.append=function(a){this.container.append(a)};ia.CalloutBox.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.CalloutBox.prototype.hide=function(){this._isVisible=!1;this.container.hide()};ia.CalloutBox.prototype.show=function(){this._isVisible=!0;this.container.fadeIn()};ia.PrintBar=function(a){this._report=a;this._ratio=this._report.container.height()/this._report.container.width();this.container=$j('<div class="ia-print-bar"></div>')};
ia.PrintBar.prototype.render=function(){this.container.empty();var a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-drag-btn"><input style="cursor:pointer" type="checkbox" checked>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>');this.container.append(a);var b=a.find("input:checkbox:first");a.bind("click",function(a){if($j(a.target).is(":checkbox"))if(b.is(":checked"))builder.canvas.on();else builder.canvas.off();else b.is(":checked")?(b.prop("checked",!1),
builder.canvas.off()):(b.prop("checked",!0),builder.canvas.on())});var c=this,a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-minus-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.container.append(a);a.bind("click",function(a){a.stopPropagation();a.preventDefault();a=c._report.container.width()-10;c._report.container.css({width:a+"px",height:a*c._ratio+"px"})});a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-plus-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
this.container.append(a);a.bind("click",function(a){a.stopPropagation();a.preventDefault();a=c._report.container.width()+10;c._report.container.css({width:a+"px",height:a*c._ratio+"px"})});a=$j('<div class="ia-ui-item ia-ui-item-align-center ia-list-item ia-ui-item-table-cell ia-print-btn"></div>').html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.container.append(a);a.bind("click",function(a){a.stopPropagation();a.preventDefault();window.print()})};
ia.PrintBar.prototype.loadDragScript=function(){var a=this;$j.getScript("./db-canvas-min.js").done(function(){builder.report=a._report;builder.canvas.init({onRemoveBtnClick:function(a){builder.report.getWidget(a).container.hide()},onSendToBackBtnClick:function(b){for(var c=a._report.getWidgets(),d=0;d<c.length;d++){var e=c[d],f=e.zIndex();e.id===b?e.zIndex(0):e.zIndex(f+1)}},onBringToFrontBtnClick:function(b){for(var c=a._report.getWidgets(),d=0,e=0;e<c.length;e++)d=Math.max(d,c[e].zIndex());a._report.getWidget(b).zIndex(d+
1)}})}).fail(function(){})};
ia.Profile=function(a,b,c){ia.Profile.baseConstructor.call(this);this.displayMode="Selected date";this.displayDatesInProfile=!1;this.includeMinMaxColumns=!0;this.symbols=[];this.targets=[];this.breaks=[];this.id=a;this._useMouseClick=b;this._data=void 0;this._isCollapsed=!1;this._renderTimeout=null;this._featureIds=[];this._collapseIds=[];this._nonComparisonIds=[];this.container=$j('<div id="'+a+'" class="ia-table">');this._containerId=a;this.$tableCorner=$j('<span class="ia-table-header-corner">');this.container.append(this.$tableCorner);
this.$tableHeaders=$j("<table>");this.container.append(this.$tableHeaders);this.$tableContainer=$j('<div id="'+a+'-container" class="ia-table-scrollbox">');this._scrollBox=new ia.ScrollBox(this.$tableContainer);this.container.append(this.$tableContainer);this.$table=$j("<table>");this.$tableContainer.append(this.$table);this._addMouseEvents();if(c)this.callbackFunction=c;var d,e=this;this.container.resize(function(){clearTimeout(d);d=setTimeout(function(){clearTimeout(d);e._size()},250)})};
ia.extend(ia.EventDispatcher,ia.Profile);ia.Profile.prototype._size=function(){var a=this.container.width(),b=this.$tableContainer.get(0).offsetWidth-this.$tableContainer.get(0).clientWidth;a-=b;this.$table.width(a);this.$tableHeaders.width(a);var a=this.container.height(),c=this.$tableHeaders.outerHeight();this.$tableContainer.height(a-c);this.$tableCorner.css("background-color",$j(".ia-table-header").css("background-color"));this.$tableCorner.width(b);this.$tableCorner.height(c)};
ia.Profile.prototype.expandThemes=function(a){if(this._data){var b=this,c=a.length;this._isCollapsed=!1;this._collapseIds=[];$j.each(this._data.themes,function(d,e){for(var f=!0,g=0;g<c;g++)if(e.id==a[g]){f=!1;b.$table.find('td[id="'+e.id+'"]').removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");b.$table.find('tbody[id="'+e.id+'-children"]').show();break}if(f==!0)b._collapseIds[b._collapseIds.length]=e.id,b.$table.find('td[id="'+e.id+'"]').removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),
b.$table.find('tbody[id="'+e.id+'-children"]').hide()})}};
ia.Profile.prototype.toggleTree=function(){if(this._data){var a=this;this._isCollapsed=!this._isCollapsed;this._collapseIds=[];var b=this._data.themes;this._isCollapsed?$j.each(b,function(b,d){a._collapseIds[a._collapseIds.length]=d.id;a.$table.find('td[id="'+d.id+'"]').removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand");a.$table.find('tbody[id="'+d.id+'-children"]').hide()}):$j.each(b,function(b,d){a.$table.find('td[id="'+d.id+'"]').removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");
a.$table.find('tbody[id="'+d.id+'-children"]').show()})}};
ia.Profile.prototype.render=function(){this._nonComparisonIds=[];this._renderTimeout=null;if(this.displayMode==void 0)this.displayMode="Selected date";this._data=this.displayMode=="Selected date"?this.geography.getProfileData(this._featureIds,this.indicator.date,!0):this.displayMode=="Most recent date"?this.geography.getProfileData(this._featureIds,void 0,!0):this.geography.getProfileData(this._featureIds);this.$table.empty();this.$tableHeaders.empty();var a=[],b=-1;a[++b]="<thead><tr>";for(var c=
this.columns.length,d=0;d<c;d++){var e=this.columns[d],f=e.width*100,g=e.label.replace(/"/g,"&quot;");if(e.id=="performance"){var h=f*0.2;a[++b]='<th id="'+e.id+'" class="ia-table-header" style="width:'+h+'%"></th>';h=f*0.6;a[++b]='<th id="'+e.id+'" class="ia-table-header" title="'+g+'" style="width:'+h+'%;border-left-width:0px">'+g+"</th>";h=f*0.2;a[++b]='<th id="'+e.id+'" class="ia-table-header" style="width:'+h+'%;border-left-width:0px">'}else a[++b]='<th id="'+e.id+'" class="ia-table-header" title="'+
g+'" style="width:'+f+'%">'+g;if(e.id=="profile"){g=this.bar.minValue+(this.bar.maxValue-this.bar.minValue)/2;a[++b]='<div style="display:table;width:100%">';a[++b]='<div style="display:table-cell;width:30%;text-align:left" title="'+this.bar.minValue+'">'+this.bar.minValue+"</div>";a[++b]='<div style="display:table-cell;width:40%" title="'+g+'">'+g+"</div>";a[++b]='<div style="display:table-cell;width:30%;text-align:right" title="'+this.bar.maxValue+'">'+this.bar.maxValue+"</div>";a[++b]="</div>";
e.canvasHeight=this.bar.height;f=this.targets.length;for(g=0;g<f;g++)h=this.targets[g],e.canvasHeight=Math.max(e.canvasHeight,h.size)}else if(e.id=="election"){e.canvasHeight=this.bar.height;f=this.targets.length;for(g=0;g<f;g++)h=this.targets[g],e.canvasHeight=Math.max(e.canvasHeight,h.size)}else if(e.id=="performance"){e.canvasHeight=this.bar.height;f=this.targets.length;for(g=0;g<f;g++)h=this.targets[g],e.canvasHeight=Math.max(e.canvasHeight,h.size);if(e.canvasHeight<=this.bar.height+8)e.canvasHeight=
this.bar.height+8}else if(e.id.indexOf("health")!=-1){var g=this.bar.minValue?this.bar.minValue:"",i=this.bar.midValue?this.bar.midValue:"",k=this.bar.minValue?this.bar.minValue:"";a[++b]='<div style="display:table;width:100%">';h=f*0.2;a[++b]='<div style="width:'+h+'%;display:table-cell;text-align:right" title="'+g+'">'+g+"</div>";h=f*0.6;a[++b]='<div style="width:'+h+'%;display:table-cell" title="'+i+'">'+i+"</div>";h=f*0.2;a[++b]='<div style="width:'+h+'%;display:table-cell;text-align:left" title="'+
k+'">'+k+"</div>";a[++b]="</div>";e.canvasHeight=0;f=this.targets.length;for(g=0;g<f;g++)h=this.targets[g],e.canvasHeight=Math.max(e.canvasHeight,h.size);f=this.symbols.length;for(g=0;g<f;g++)e.canvasHeight=Math.max(e.canvasHeight,this.symbols[g].size);g=e.id.substring(e.id.indexOf("(")+1,e.id.indexOf(")"));f=g.split(",");e.symbolAlign="right";for(g=0;g<f.length;g++)i=f[g].split(":"),h=i[0],i=i[1],e[h]=i}else if(e.id.indexOf("symbol(")!=-1){g=e.id.substring(e.id.indexOf("(")+1,e.id.indexOf(")"));
f=g.split(",");e.symbolAlign="right";for(g=0;g<f.length;g++)i=f[g].split(":"),h=i[0],i=i[1],e[h]=i}a[++b]="</th>"}a[++b]="</tr></thead>";this.$tableHeaders.html(a.join(""));a=[];b=-1;a[++b]='<tr class="ia-table-row">';for(var j=c,g=0;g<c;g++)e=this.columns[g],f=e.width*100,(e.id=="performance"||e.id.indexOf("health")!=-1)&&this.includeMinMaxColumns?(j=c+2,h=f*0.2,a[++b]='<td class="ia-table-cell" style="width:'+h+'%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px"></td>',h=f*0.6,
a[++b]='<td class="ia-table-cell" style="width:'+h+'%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px"></td>',h=f*0.2,a[++b]='<td class="ia-table-cell" style="width:'+h+'%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px"></td>'):a[++b]='<td class="ia-table-cell" style="width:'+f+'%;padding-top:0px;padding-bottom:0px;margin-top:0px;margin-bottom:0px"></td>';a[++b]="</tr>";this.$table.append(a.join(""));var m=this;$j.each(this._data.themes,function(d,e){a=[];
b=-1;var f=e.name.replace(/"/g,"&quot;");a[++b]="<tbody>";a[++b]='<tr class="ia-table-row">';a[++b]='<td id="'+e.id+'" class="ia-table-cell ia-profile-theme-name-cell ia-profile-theme-collapse ia-profile-row" title="'+f+'" colspan="'+j+'">'+f+"</td>";a[++b]="</tr>";a[++b]="</tbody>";a[++b]='<tbody id="'+e.id+'-children">';$j.each(e.indicators,function(d,e){var f=e.features;if(f.length==0){var g=e.id;e.date!=void 0&&(g=e.id+"~"+e.date);d%2==0?a[++b]='<tr id="'+e.id+'" class="ia-table-row ia-profile-row ia-table-row-even indicator-row" data-linkId="'+
g+'">':a[++b]='<tr id="'+e.id+'" class="ia-table-row ia-profile-row ia-table-row-odd indicator-row" data-linkId="'+g+'">';for(g=0;g<c;g++){var h=m.columns[g],i=h.width*100;(h.id=="performance"||h.id.indexOf("health")!=-1)&&this.includeMinMaxColumns?(h=i*0.2,a[++b]='<td class="ia-table-cell" style="width:'+h+'%"></td>',h=i*0.6,a[++b]='<td class="ia-table-cell" style="width:'+h+'%;border-left-width:0px"></td>',h=i*0.2,a[++b]='<td class="ia-table-cell" style="width:'+h+'%;border-left-width:0px"></td>'):
h.id=="indicatorName"?(h=m.displayDatesInProfile?e.date?e.name+" ("+e.date+")":e.name:e.name,h=h.replace(/"/g,"&quot;"),a[++b]='<td class="ia-profile-indicator-name-cell" style="width:'+i+'%" title="'+h+'">',m.displayDatesInProfile?(e.href&&(a[++b]='<span class="ia-table-notes-icon" onmouseover="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="event.stopPropagation();window.open(\''+e.href+"', '_blank')\"></span>"),e.date?a[++b]=e.name+" ("+e.date+")":a[++b]=e.name):(e.href&&
(a[++b]='<span class="ia-table-notes-icon" onmouseover="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="event.stopPropagation();window.open(\''+e.href+"', '_blank')\"></span>"),a[++b]=e.name),a[++b]="</td>"):a[++b]='<td class="ia-table-cell" style="width:'+i+'%"></td>'}a[++b]="</tr>"}$j.each(f,function(g,h){if(h.isComparison!=!0&&m._nonComparisonIds.indexOf(h.id)==-1)m._nonComparisonIds[m._nonComparisonIds.length]=h.id;var i=e.id;e.date!=void 0&&(i=e.id+"~"+e.date);d%2==0?
a[++b]='<tr id="'+e.id+'" class="ia-table-row ia-profile-row ia-table-row-even indicator-row" data-linkId="'+i+'">':a[++b]='<tr id="'+e.id+'" class="ia-table-row ia-profile-row ia-table-row-odd indicator-row" data-linkId="'+i+'">';for(i=0;i<c;i++){var j=m.columns[i],k=h[j.formattedId],l=j.width*100;if(g==0&&j.id=="indicatorName")j=m.displayDatesInProfile?e.date?e.name+" ("+e.date+")":e.name:e.name,j=j.replace(/"/g,"&quot;"),a[++b]='<td class="ia-profile-indicator-name-cell" rowspan="'+f.length+'" style="width:'+
l+'%" title="'+j+'">',m.displayDatesInProfile?(e.href&&(a[++b]='<span class="ia-table-notes-icon" onmouseover="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="event.stopPropagation();window.open(\''+e.href+"', '_blank')\"></span>"),e.date?a[++b]=e.name+" ("+e.date+")":a[++b]=e.name):(e.href&&(a[++b]='<span class="ia-table-notes-icon" onmouseover="event.stopPropagation()" ontouchstart="event.stopPropagation()" onclick="event.stopPropagation();window.open(\''+e.href+"', '_blank')\"></span>"),
a[++b]=e.name),a[++b]="</td>";else if(j.id=="name")a[++b]='<td class="ia-table-cell ia-table-cell-categoric" style="width:'+l+'%" title="'+k+'">'+k+"</td>";else if(j.id=="profile"||j.id=="election")a[++b]='<td class="ia-table-cell ia-profile-cell" style="width:'+l+'%">',a[++b]=m._getProfileSvg(h,j),a[++b]="</td>";else if(j.id=="performance"||j.id.indexOf("health")!=-1)a[++b]=m._getPerformanceSvg(h,e,j);else if(j.id.indexOf("symbol(")!=-1){k="";if(j.textValue!=void 0)k=h[j.textValue+"_formatted"],
j.textValue=="indicatorName"?k=m.displayDatesInProfile?e.date?e.name+" ("+e.date+")":e.name:e.name:j.textValue=="name"&&(k=h.name);var n=h[j.symbolValue],o="";if(n!=void 0)for(var s=0;s<m.symbols.length;s++){var t=m.symbols[s];if(t.value==n){o+="<svg style='overflow:hidden;width:"+t.size+"px;height:"+t.size+"px;' preserveAspectRatio='none'>";o+="<path d='"+ia.SvgShape.draw(t.shape,t.size/2,t.size/2,t.size)+"' fill='"+t.color+"'><title>"+t.label+"</title></path>";o+="</svg>";break}}a[++b]='<td class="ia-table-cell ia-symbol-cell" style="width:'+
l+"%;vertical-align:middle;text-align:"+j.symbolAlign+'">';j.symbolAlign=="right"?(a[++b]=k+"&nbsp;",a[++b]=o):j.symbolAlign=="left"?(a[++b]=o,a[++b]="&nbsp;"+k):a[++b]=o;a[++b]="</td>"}else j.id=="value"?(j=e.type=="categoric"?"ia-table-cell-categoric":"ia-table-cell-numeric",k!=void 0?a[++b]='<td class="ia-table-cell '+j+'" style="width:'+l+'%" title="'+k+'">'+k+"</td>":a[++b]='<td class="ia-table-cell '+j+'" style="width:'+l+'%"></td>'):j.id!="indicatorName"&&j.id!="name"&&(j=h[j.id+"_type"]==
"categoric"?"ia-table-cell-categoric":"ia-table-cell-numeric",k!=void 0?a[++b]='<td class="ia-table-cell '+j+'" style="width:'+l+'%" title="'+k+'">'+k+"</td>":a[++b]='<td class="ia-table-cell '+j+'" style="width:'+l+'%"></td>')}a[++b]="</tr>"})});a[++b]="</tbody>";m.$table.append(a.join(""))});for(d=0;d<this._collapseIds.length;d++)e=this._collapseIds[d],this.$table.find('td[id="'+e+'"]').removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),this.$table.find('tbody[id="'+e+
'-children"]').hide();this._scrollBox.refresh();this._size();this.dispatchEvent(new ia.Event("onRender",this))};
ia.Profile.prototype._getProfileSvg=function(a,b){var c=[],d=-1,e=a[this.bar.data],f=a[this.bar.data+"_formatted"],g=a[this.bar.symbolValue],h=this.bar.maxValue-this.bar.minValue;c[++d]="<div style='position:relative'>";if(ia.isNumber(e)){var i,k;if(a.isComparison&&this.comparisonThematic){var j=this.comparisonThematic.getClass(a.id);if(j!=void 0)k=j.color}if(k!=void 0)i=k;else if(this.colorPalette)k=this._nonComparisonIds.length,i=this.colorPalette.getColors(k),k=this._nonComparisonIds.indexOf(a.id),
i=i[k];else if(g!=void 0){k=this.symbols.length;for(j=0;j<k;j++){var m=this.symbols[j];if(m.value==g){i=m.color;break}}}else i=this.bar.color;j=Math.abs(e);k=this.bar.height;g=0;e<0&&(g=e);m=k/2*-1;this.bar.shape=="bar"||this.bar.shape==void 0?(c[++d]="<svg style='overflow:hidden;position:absolute;left:0px;top:50%;margin-top:"+m+"px;width:100%;height:"+k+"px' preserveAspectRatio='none' viewBox='"+this.bar.minValue+" 0 "+h+" "+k+"'>",c[++d]="<rect x='"+g+"' y='0' width='"+j+"' height='"+k+"' fill='"+
i+"'><title>"+f+"</title></rect>",c[++d]="</svg>"):(g={color:"#cccccc"},g.size=k,g.shape=ia.Shape.VERTICAL_LINE,c[++d]=this._drawTarget(g,0,0,this.bar.minValue,this.bar.maxValue,h,b.canvasHeight),g={},g.color=i,g.size=k,g.shape=this.bar.shape,c[++d]=this._drawTarget(g,e,f,this.bar.minValue,this.bar.maxValue,h,b.canvasHeight))}k=this.targets.length;for(j=0;j<k;j++)g=this.targets[j],e=a[g.data],f=a[g.data+"_formatted"],e!=void 0&&(c[++d]=this._drawTarget(g,e,g.label+" : "+f,this.bar.minValue,this.bar.maxValue,
h,b.canvasHeight));c[++d]="</div>";return c.join("")};
ia.Profile.prototype._getPerformanceSvg=function(a,b,c){var d=[],e=-1,f;c.id=="performance"?f="ia-performance-cell":c.id.indexOf("health")!=-1&&(f="ia-health-cell");var g=c.width*100,h=a[this.bar.data],i=a[this.bar.data+"_formatted"],k=a[this.bar.breaksFlip],j,m,n,l,o,q;if(this.bar.breaksData){var p=a[this.bar.breaksData];if(p!=void 0){j=p.split(",");m=[];n=Infinity;l=-Infinity;o=j.length;for(var r=0;r<o;r++)q=j[r],m.push(this.formatter.format(q)),n=Math.min(n,q),l=Math.max(l,q);o=this.formatter.format(n);
q=this.formatter.format(l)}}if(j==void 0)this.bar.data=="value"||this.bar.data==void 0?(n=b.minValue,l=b.maxValue,o=b.minValue_formatted,q=b.maxValue_formatted,j=[b.minValue,b.lowerQuartile,b.upperQuartile,b.maxValue],m=[b.minValue_formatted,b.lowerQuartile_formatted,b.upperQuartile_formatted,b.maxValue_formatted]):(n=b[this.bar.data+"_minValue"],l=b[this.bar.data+"_maxValue"],o=b[this.bar.data+"_minValue_formatted"],q=b[this.bar.data+"_maxValue_formatted"],j=[b[this.bar.data+"_minValue"],[this.bar.data+
"_lowerQuartile"],b[this.bar.data+"_upperQuartile"],b[this.bar.data+"_maxValue"]],m=[b[this.bar.data+"_minValue_formatted"],b[this.bar.data+"_lowerQuartile_formatted"],b[this.bar.data+"_upperQuartile_formatted"],b[this.bar.data+"_maxValue_formatted"]]);j=j.map(function(a){return parseFloat(a)});n=parseFloat(n);l=parseFloat(l);p=l-n;if(f=="ia-health-cell"){var t=a[c.symbolValue],s=a[c.areaValue],u=a[c.nationalValue],v=a[c.areaValue+"_formatted"],w=a[c.nationalValue+"_formatted"];if(u==void 0)this.bar.data==
"value"||this.bar.data==void 0?(u=b.median,w=b.median_formatted):(u=b[this.bar.data+"_median"],w=b[this.bar.data+"_median_formatted"]);l=Math.max(Math.abs(l-u),Math.abs(u-n));n=u-l;l=u+l;p=l-n}b=!1;j[0]>j[1]&&(b=!0,j.reverse(),m.reverse(),r=o,o=q,q=r);this.includeMinMaxColumns?(d[++e]='<td class="ia-table-cell" style="text-align:right" style="width:'+g*0.2+'%" title="'+o+'">'+o+"</td>",d[++e]='<td class="ia-table-cell '+f+'" style="width:'+g*0.6+'%;border-left-width:0px">'):d[++e]='<td class="ia-table-cell '+
f+'" style="width:'+g+'%">';o=c.canvasHeight/2*-1;d[++e]="<div style='position:relative'>";d[++e]="<svg style='overflow:hidden;position:absolute;left:0px;top:50%;margin-top:"+o+"px;width:100%;height:"+c.canvasHeight+"px' preserveAspectRatio='none' viewBox='"+n+" 0 "+p+" "+c.canvasHeight+"'>";o=this.breaks.length;for(r=0;r<o;r++)if(j.length>r+1){var x=this.breaks[r];if(k==!0||k=="true"||k=="TRUE"||k=="True")x=this.breaks[o-r-1];var y=j[r],B=r+1,C=Math.abs(j[B]-y);b&&(y=l-(y-n)-C);B=x.label+" : "+m[r]+
" - "+m[B];d[++e]="<rect x='"+y+"' y='0' width='"+C+"' height='"+c.canvasHeight+"' fill='"+x.color+"'><title>"+B+"</title></rect>"}if(ia.isNumber(h)){var A;if(a.isComparison&&this.comparisonThematic&&(k=this.comparisonThematic.getClass(a.id),k!=void 0))A=k.color;A!=void 0?k=A:this.colorPalette?(o=this._nonComparisonIds.length,A=this.colorPalette.getColors(o),k=this._nonComparisonIds.indexOf(a.id),k=A[k]):k=this.bar.color;j=this.bar.height;A=(c.canvasHeight-j)/2;m=0;b&&(m=l+n-h);this.bar.shape=="bar"||
this.bar.shape==void 0?(d[++e]="<rect x='"+m+"' y='"+A+"' width='"+h+"' height='"+j+"' fill='"+k+"'><title>"+i+"</title></rect>",d[++e]="</svg>"):(d[++e]="</svg>",A={},A.color=k,A.size=j,A.shape=this.bar.shape,d[++e]=this._drawTarget(A,h,i,n,l,p,c.canvasHeight))}else d[++e]="</svg>";if(f=="ia-health-cell")if(A={color:"#999999",size:14},A.shape=ia.Shape.VERTICAL_LINE,d[++e]=this._drawTarget(A,u,w,n,l,p,c.canvasHeight,b),t!=void 0){o=this.symbols.length;for(r=0;r<o;r++)if(f=this.symbols[r],f.value==
t){d[++e]=this._drawTarget(f,s,f.label+" : "+v,n,l,p,c.canvasHeight,b);break}}else f={},f.color=this.bar.color,f.size=14,f.shape=ia.Shape.DIAMOND,d[++e]=this._drawTarget(f,s,v,n,l,p,c.canvasHeight,b);o=this.targets.length;for(r=0;r<o;r++)A=this.targets[r],t=a[A.data],s=a[A.data+"_formatted"],t!=void 0&&(d[++e]=this._drawTarget(A,t,A.label+" : "+s,n,l,p,c.canvasHeight,b));d[++e]="</div></td>";this.includeMinMaxColumns&&(d[++e]='<td class="ia-table-cell" style="text-align:left;border-left-width:0px" style="width:'+
g*0.2+'%" title="'+q+'">'+q+"</td>");return d.join("")};
ia.Profile.prototype._drawTarget=function(a,b,c,d,e,f,g,h){b=(b-d)/f*100;h&&(b=100-b);h=g/2;d=h*-1;e=[];f=-1;e[++f]="<svg style='overflow:hidden;position:absolute;left:"+b+"%;top:50%;margin-left:"+d+"px;margin-top:"+d+"px;width:"+g+"px;height:"+g+"px' preserveAspectRatio='none'>";e[++f]="<path d='"+ia.SvgShape.draw(a.shape,h,h,a.size)+"' fill='"+a.color+"'></path>";e[++f]="<rect fill-opacity='0' x='0' y='0' width='"+g+"' height='"+g+"'><title>"+c+"</title></rect>";e[++f]="</svg>";return e.join("")};
ia.Profile.prototype._addMouseEvents=function(){var a=this;this.$table.delegate("td.ia-profile-theme-name-cell","click",function(){a._onThemeClick($j(this))});this._useMouseClick&&this.$table.delegate("tr.indicator-row","click",function(){a._onIndicatorClick($j(this))})};
ia.Profile.prototype._onThemeClick=function(a){var b=a.attr("id");if(a.hasClass("ia-profile-theme-expand")){var c=this._collapseIds.indexOf(b);c!=-1&&this._collapseIds.splice(c,1);a.removeClass("ia-profile-theme-expand").addClass("ia-profile-theme-collapse");this.$table.find('tbody[id="'+b+'-children"]').show()}else this._collapseIds[this._collapseIds.length]=b,a.removeClass("ia-profile-theme-collapse").addClass("ia-profile-theme-expand"),this.$table.find('tbody[id="'+b+'-children"]').hide();this._size()};
ia.Profile.prototype._onIndicatorClick=function(a){this.callbackFunction&&this.callbackFunction.call(null,a.data("linkid"))};ia.Profile.prototype.select=function(a){this._featureIds.indexOf(a)==-1&&this._featureIds.push(a);this._triggerRender()};ia.Profile.prototype.unselect=function(a){a=this._featureIds.indexOf(a);a!=-1&&this._featureIds.splice(a,1);this._triggerRender()};
ia.Profile.prototype.clearSelection=function(){for(var a=this._nonComparisonIds.length,b=0;b<a;b++){var c=this._featureIds.indexOf(this._nonComparisonIds[b]);c!=-1&&this._featureIds.splice(c,1)}this._triggerRender()};ia.Profile.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};ia.Profile.prototype.highlight=function(){};ia.Profile.prototype.clearHighlight=function(){};
ia.ProfileLegend=function(a){ia.ProfileLegend.baseConstructor.call(this,a);this.container.addClass("ia-profile-legend");this._scrollBox=new ia.ScrollBox(this.container);this.interactive=this.isLegendComponent=!1;this.legendClasses=[]};ia.extend(ia.DiscreteLegend,ia.ProfileLegend);ia.ProfileLegend.prototype.render=function(){this.renderLegend(this.legendClasses);this._scrollBox.refresh()};
ia.FeatureCard=function(a){ia.FeatureCard.baseConstructor.call(this);this.id=a;this.displaySelectedDateOnly=!1;this.ignoreThemeIds=[];this.ignoreIndicatorIds=[];this.displayFeatureHeader=this.displayThemeHeader=!1;this.displayMode="All themes";this.dataOrder="Order data by feature";this._renderTimeout=null;this._featureIds=[];this.container=$j("<div id='"+a+"' class='ia-feature-card-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this.$content=$j("<div>");this.container.append(this.$content);
this._textSubstitution=new ia.TextSubstitution;this._snippet=""};ia.extend(ia.EventDispatcher,ia.FeatureCard);ia.FeatureCard.prototype.noDataValue="";
ia.FeatureCard.prototype.setSnippet=function(a,b){var c=this;a!=""&&a!=void 0?(c._snippet=a,c._snippet.indexOf("&lt;")==-1&&c._snippet.indexOf("&gt;")==-1&&c._snippet.indexOf("<")==-1&&c._snippet.indexOf(">")==-1?ia.File.load({url:a,dataType:"html",onSuccess:function(a){c._snippet=a;b!=void 0&&b.call(null)},onFail:function(){b!=void 0&&b.call(null)}}):b!=void 0&&b.call(null)):b!=void 0&&b.call(null)};
ia.FeatureCard.prototype.render=function(){this._renderTimeout=null;if(this._snippet!=""){this.$content.empty();this._textSubstitution.clearVariables();var a=!0;this.dataOrder!="Order data by feature"&&(a=!1);var b=this._featureIds.concat().reverse();data=this.displaySelectedDateOnly?a?this.geography.getFeatureData(b,this.indicator.date):this.geography.getIndicatorData(b,this.indicator.date):a?this.geography.getFeatureData(b):this.geography.getIndicatorData(b);a?this._renderFeatureList(data):this._renderIndicatorList(data);
this._scrollBox.refresh()}};
ia.FeatureCard.prototype._renderFeatureList=function(a){var b=this;b._textSubstitution.setVariable("geog-id",a.id);b._textSubstitution.setVariable("geog-name",a.name);var c=[],d=-1;$j.each(a.features,function(a,f){b._textSubstitution.setVariable("feature-id",f.id);b._textSubstitution.setVariable("feature-name",f.name);b._textSubstitution.setVariable("feature-href",f.href);b._textSubstitution.setVariable("feature-index",a);$j.each(f.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",
c.value);b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue)});c[++d]="<div class='ia-feature-card'>";b.displayFeatureHeader&&(c[++d]="<div id='"+f.id+"' class='ia-feature-card-header'>"+f.name+"</div>");$j.each(f.themes,function(a,e){var f=!0;if(b.displayMode=="Selected theme only")b.indicator.theme.id!=e.id&&(f=!1);else for(var k=0;k<b.ignoreThemeIds.length;k++)if(e.id==b.ignoreThemeIds[k]){f=!1;break}if(f){b._textSubstitution.setVariable("theme-id",e.id);b._textSubstitution.setVariable("theme-name",
e.name);b._textSubstitution.setVariable("theme-index",a);if(b.displayThemeHeader&&e.indicators.length>0)if(b.displayMode=="Selected indicator only"){var j=!1,f=e.indicators;$j.each(f,function(a,c){b.indicator.id==c.id&&(j=!0)});j==!0&&(c[++d]="<div id='"+e.id+"' class='ia-feature-card-sub-header'>"+e.name+"</div>")}else c[++d]="<div id='"+e.id+"' class='ia-feature-card-sub-header'>"+e.name+"</div>";c[++d]="<div class='ia-feature-card-content'>";var f=e.indicators,m,n="";$j.each(f,function(a,e){var f=
!0;if(b.displayMode=="Selected indicator only")b.indicator.id!=e.id&&(f=!1);else for(var g=0;g<b.ignoreIndicatorIds.length;g++)if(e.id==b.ignoreIndicatorIds[g]){f=!1;break}if(f){b._textSubstitution.setVariable("indicator-id",e.id);b._textSubstitution.setVariable("indicator-name",e.name);b._textSubstitution.setVariable("indicator-index",a);b._textSubstitution.setVariable("indicator-type",e.type);b._textSubstitution.setVariable("indicator-href",e.href);b._textSubstitution.setVariable("indicator-formatted-value",
e.formattedValue);b._textSubstitution.setVariable("indicator-date",e.date);if(e.id!=n)n=e.id,m=0;b._textSubstitution.setVariable("indicator-date-index",m);m++;e.value==="null"||e.value===null||e.value==="NaN"||e.value===""||e.value==="No Data"||e.value===void 0||e.value===b.noDataValue?b._textSubstitution.setVariable("indicator-value",""):b._textSubstitution.setVariable("indicator-value",e.value);$j.each(e.associates,function(a,c){c.value==="null"||c.value===null||c.value==="NaN"||c.value===""||c.value===
"No Data"||c.value===void 0||c.value===b.noDataValue?b._textSubstitution.setVariable(c.name+"-value",""):b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue);b._textSubstitution.setVariable(c.name+"-type",c.type)});$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue)});e.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",
e.lowerLimit.value),b._textSubstitution.setVariable("lower-limit-formatted-value",e.lowerLimit.formattedValue));e.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",e.upperLimit.value),b._textSubstitution.setVariable("upper-limit-formatted-value",e.upperLimit.formattedValue));f=b._textSubstitution.formatMessage(b._snippet);c[++d]=f;$j.each(e.associates,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",void 0);
b._textSubstitution.setVariable(c.name+"-type",void 0)});$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",void 0)});e.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",void 0),b._textSubstitution.setVariable("lower-limit-formatted-value",void 0));e.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",void 0),b._textSubstitution.setVariable("upper-limit-formatted-value",void 0))}});
c[++d]="</div>"}});c[++d]="</div>";$j.each(f.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",void 0)})});this.$content.append(c.join("").replace(/(\r\n|\n|\r)/gm,""))};
ia.FeatureCard.prototype._renderIndicatorList=function(a){var b=this;b._textSubstitution.setVariable("geog-id",a.id);b._textSubstitution.setVariable("geog-name",a.name);var c=[],d=-1;$j.each(a.themes,function(a,f){var g=!0;if(b.displayMode=="Selected theme only")b.indicator.theme.id!=f.id&&(g=!1);else for(var h=0;h<b.ignoreThemeIds.length;h++)if(f.id==b.ignoreThemeIds[h]){g=!1;break}if(g){c[++d]="<div class='ia-feature-card'>";b._textSubstitution.setVariable("theme-id",f.id);b._textSubstitution.setVariable("theme-name",
f.name);b._textSubstitution.setVariable("theme-index",a);if(b.displayThemeHeader&&f.indicators.length>0)if(b.displayMode=="Selected indicator only"){var i=!1,g=f.indicators;$j.each(g,function(a,c){b.indicator.id==c.id&&(i=!0)});i==!0&&(c[++d]="<div id='"+f.id+"' class='ia-feature-card-header'>"+f.name+"</div>")}else c[++d]="<div id='"+f.id+"' class='ia-feature-card-header'>"+f.name+"</div>";c[++d]="<div class='ia-feature-card-content'>";var g=f.indicators,k,j="";$j.each(g,function(a,e){var f=!0;if(b.displayMode==
"Selected indicator only")b.indicator.id!=e.id&&(f=!1);else for(var g=0;g<b.ignoreIndicatorIds.length;g++)if(e.id==b.ignoreIndicatorIds[g]){f=!1;break}if(f){b.displayFeatureHeader&&(c[++d]="<div id='"+e.id+"' class='ia-feature-card-sub-header'>"+e.name+"</div>");b._textSubstitution.setVariable("indicator-id",e.id);b._textSubstitution.setVariable("indicator-name",e.name);b._textSubstitution.setVariable("indicator-index",a);b._textSubstitution.setVariable("indicator-type",e.type);b._textSubstitution.setVariable("indicator-href",
e.href);b._textSubstitution.setVariable("indicator-date",e.date);if(e.id!=j)j=e.id,k=0;b._textSubstitution.setVariable("indicator-date-index",k);k++;$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue)});$j.each(e.features,function(a,e){b._textSubstitution.setVariable("feature-id",e.id);b._textSubstitution.setVariable("feature-name",e.name);b._textSubstitution.setVariable("feature-href",
e.href);b._textSubstitution.setVariable("feature-index",a);b._textSubstitution.setVariable("indicator-formatted-value",e.formattedValue);e.value==="null"||e.value===null||e.value==="NaN"||e.value===""||e.value==="No Data"||e.value===void 0||e.value===b.noDataValue?b._textSubstitution.setVariable("indicator-value",""):b._textSubstitution.setVariable("indicator-value",e.value);$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+
"-formatted-value",c.formattedValue)});$j.each(e.associates,function(a,c){c.value==="null"||c.value===null||c.value==="NaN"||c.value===""||c.value==="No Data"||c.value===void 0||c.value===b.noDataValue?b._textSubstitution.setVariable(c.name+"-value",""):b._textSubstitution.setVariable(c.name+"-value",c.value);b._textSubstitution.setVariable(c.name+"-formatted-value",c.formattedValue);b._textSubstitution.setVariable(c.name+"-type",c.type)});e.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",
e.lowerLimit.value),b._textSubstitution.setVariable("lower-limit-formatted-value",e.lowerLimit.formattedValue));e.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",e.upperLimit.value),b._textSubstitution.setVariable("upper-limit-formatted-value",e.upperLimit.formattedValue));var f=b._textSubstitution.formatMessage(b._snippet);c[++d]=f;$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",
void 0)});$j.each(e.associates,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",void 0);b._textSubstitution.setVariable(c.name+"-type",void 0)});e.lowerLimit&&(b._textSubstitution.setVariable("lower-limit-value",void 0),b._textSubstitution.setVariable("lower-limit-formatted-value",void 0));e.upperLimit&&(b._textSubstitution.setVariable("upper-limit-value",void 0),b._textSubstitution.setVariable("upper-limit-formatted-value",
void 0))});$j.each(e.properties,function(a,c){b._textSubstitution.setVariable(c.name+"-value",void 0);b._textSubstitution.setVariable(c.name+"-formatted-value",void 0)})}});c[++d]="</div></div>"}});this.$content.append(c.join("").replace(/(\r\n|\n|\r)/gm,""))};ia.FeatureCard.prototype._triggerRender=function(){if(!this._renderTimeout)this._renderTimeout=setTimeout(function(){this.render()}.bind(this),5)};
ia.FeatureCard.prototype.select=function(a){this._featureIds.indexOf(a)==-1&&this._featureIds.push(a);this._triggerRender()};ia.FeatureCard.prototype.unselect=function(a){a=this._featureIds.indexOf(a);a!=-1&&this._featureIds.splice(a,1);this._triggerRender()};ia.FeatureCard.prototype.clearSelection=function(){this._featureIds=[];this._triggerRender()};ia.FeatureCard.prototype.highlight=function(){};ia.FeatureCard.prototype.clearHighlight=function(){};
ia.TimeControl=function(a,b,c){this.id=a;if(c)this._callbackFunction=c;this._dataGroup=b;this.delay=1.5;this._playing=!1;this._currentIndicatorId=this._currentGeographyId=this.$playBtn=void 0;this.container=$j("<div id='"+a+"-container' class='ia-time-control-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this.$table=$j("<table class='ia-time-control-table'>");this.container.append(this.$table);var d=this;this._dataGroup.addEventListener(ia.DataEvent.GEOG_CHANGED,function(a){d._stop();
d._currentIndicatorId=a.indicator.id;d._currentGeographyId=a.indicator.geography.id;d._render(a.indicator);a.indicator.date!=void 0&&(a=a.indicator.date.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#"),d.$table.find("td.ia-time-control-date-btn[id='"+a+"-btn']").addClass("ia-time-control-date-btn-active"))});this._dataGroup.addEventListener(ia.DataEvent.INDICATOR_CHANGED,function(a){if(a.indicator.geography.id!=d._currentGeographyId||d._currentIndicatorId!=a.indicator.id)d._stop(),d._currentIndicatorId=
a.indicator.id,d._currentGeographyId=a.indicator.geography.id,d._render(a.indicator);else if(d._playing)var b=setTimeout(function(){clearTimeout(b);if(d._playing){var c=d._getDates(a.theme.getIndicatorDates(a.indicator.id)),g=c.indexOf(a.indicator.date)+1;g<c.length?d._dataGroup.setData(a.geography.id,a.indicator.id,c[g]):d._stop()}},d.delay*1E3);d.$table.find("td.ia-time-control-date-btn").removeClass("ia-time-control-date-btn-active");if(a.indicator.date!=void 0){var c=a.indicator.date.replace(/'/g,
"#quote#").replace(/"/g,"#double-quote#");d.$table.find("td.ia-time-control-date-btn[id='"+c+"-btn']").addClass("ia-time-control-date-btn-active")}})};ia.TimeControl.prototype._getDates=function(a){if(this.dropDates!=void 0&&this.dropDates.length>0){var b=this;return a.filter(function(a){return b.dropDates.indexOf(a)<0})}return a};
ia.TimeControl.prototype._play=function(){if(this._playing)this._stop();else{this._callbackFunction&&this._callbackFunction.call(null,!0);this._playing=!0;this.$playBtn.removeClass("ia-time-control-btn-play");this.$playBtn.addClass("ia-time-control-btn-stop");var a=this._getDates(this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id)),b=a.indexOf(this._dataGroup.indicator.date)+1;b<a.length?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,
this._dataGroup.indicator.id,a[0])}};ia.TimeControl.prototype._stop=function(){this._callbackFunction&&this._callbackFunction.call(null,!1);this._playing=!1;this.$playBtn&&(this.$playBtn.removeClass("ia-time-control-btn-stop"),this.$playBtn.addClass("ia-time-control-btn-play"))};
ia.TimeControl.prototype._back=function(){this._stop();var a=this._getDates(this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id)),b=a.indexOf(this._dataGroup.indicator.date)-1;b>-1?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[a.length-1])};
ia.TimeControl.prototype._next=function(){this._stop();var a=this._getDates(this._dataGroup.theme.getIndicatorDates(this._dataGroup.indicator.id)),b=a.indexOf(this._dataGroup.indicator.date)+1;b<a.length?this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[b]):this._dataGroup.setData(this._dataGroup.geography.id,this._dataGroup.indicator.id,a[0])};
ia.TimeControl.prototype.setData=function(a){this._stop();this._currentIndicatorId=a.id;this._currentGeographyId=a.geography.id;this._render(a);this.$table.find("td.ia-time-control-date-btn").removeClass("ia-time-control-date-btn-active");a.date!=void 0&&this.$table.find("td.ia-time-control-date-btn[id='"+a.date.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#")+"-btn']").addClass("ia-time-control-date-btn-active")};
ia.TimeControl.prototype._render=function(a){this.$table.empty();var b=this._getDates(a.theme.getIndicatorDates(a.id));if(b){var c=this;$tr=$j("<tr>");this.$table.append($tr);this.$playBtn=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-play'>");$tr.append(this.$playBtn);this.$playBtn.bind("click",function(a){a.stopPropagation();c._play()});var d=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-back'>");$tr.append(d);d.bind("click",function(a){a.stopPropagation();
c._back()});d=$j("<td class='ia-list-item ia-time-control-btn ia-time-control-btn-forward'>");$tr.append(d);d.bind("click",function(a){a.stopPropagation();c._next()});for(d=0;d<b.length;d++){var e=b[d],f=e.replace(/'/g,"#quote#").replace(/"/g,"#double-quote#");$dateBtn=$j("<td id='"+f+"-btn' class='ia-list-item ia-time-control-td ia-time-control-date-btn'>").html(e);$tr.append($dateBtn);(function(){var b=a.geography.id,d=a.id,f=e;$dateBtn.bind("click",function(a){a.stopPropagation();c._stop();c._dataGroup.setData(b,
d,f)})})()}}this._scrollBox.refresh()};ia.TextBox=function(a){this.container=$j("<div id='"+a+"' class='ia-textbox-scrollbox'>");this._scrollBox=new ia.ScrollBox(this.container);this._textBox=$j("<div class='ia-textbox'>");this.container.append(this._textBox)};ia.TextBox.prototype.setHtml=function(a){if(a!=void 0)if((ia.endsWith(a,".htm")||ia.endsWith(a,".html"))&&a.indexOf("href=")==-1){var b=this;this._textBox.load(a,function(){b._scrollBox.refresh()})}else this._textBox.html(a),this._scrollBox.refresh()};
ia.AreaBreakdownPieComponent=function(a,b){ia.AreaBreakdownPieComponent.baseConstructor.call(this);this.id=a;this.tip="";this.layout=b;this._selectionIds=[];this._multiLayout=!0;this._data=void 0;this._isVisible=!0;this._chart2Defined=this._chart1Defined=!1;this.container=$j("<div id='"+a+"'class='ia-area-breakdown-pie-chart'>");this._$pieContainer1=$j("<div style='display:inline-block;padding:8px;text-align:center'>").appendTo(this.container);this._$pieContainer2=$j("<div style='display:inline-block;padding:8px;text-align:center'>");
this.thematic=new ia.Thematic;this.thematic.setDataType(ia.Thematic.CATEGORIC);this.thematic.setDataField("value");this._$chartTitle1=$j("<div>").html("").appendTo(this._$pieContainer1);this._$chartTitle2=$j("<div>").html("").appendTo(this._$pieContainer2);this._chart1=new ia.PieChart(this.id+"-pie-chart-1");this._chart1.container.css("position","relative");this._layer1=new ia.AdvancedPieLayer;this._layer1.thematic=this.thematic;this._layer1.setVisible(!0);this._layer1.interactive=!0;this._layer1.selectable=
!1;this._chart1.addLayer(this._layer1);this._chart2=new ia.PieChart(this.id+"-pie-chart-2");this._chart2.container.css("position","relative");this._layer2=new ia.AdvancedPieLayer;this._layer2.thematic=this.thematic;this._layer2.setVisible(!0);this._layer2.interactive=!0;this._layer2.selectable=!1;this._chart2.addLayer(this._layer2);var c=new ia.InteractionGroup;c.addComponent(this._layer1);c.addComponent(this._layer2)};ia.extend(ia.EventDispatcher,ia.AreaBreakdownPieComponent);
ia.AreaBreakdownPieComponent.prototype.build=function(a){this.layout=="vertical"?(this.container.append(this._$pieContainer2),this._multiLayout=!0,this._$pieContainer1.css({width:"100%",height:"50%"}),this._$pieContainer2.css({width:"100%",height:"50%"})):this.layout=="horizontal"?(this.container.append(this._$pieContainer2),this._multiLayout=!0,this._$pieContainer1.css({width:"50%",height:"100%"}),this._$pieContainer2.css({width:"50%",height:"100%"})):(this._$pieContainer2.detach(),this._multiLayout=
!1,this._$pieContainer1.css({width:"100%",height:"100%"}));this._layer1.highlightColor=this.highlightColor;this._layer1.selectionColor=this.selectionColor;this._layer1.tip=this.tip;this._chart1Defined==!1?(this._chart1Defined=!0,this._$pieContainer1.append(this._chart1.container),this._multiLayout||this._chart1.addEventListener(ia.Event.MAP_READY,function(){a!=void 0&&a.call(null)})):!this._multiLayout&&a!=void 0&&a.call(null);if(this._multiLayout)this._layer2.highlightColor=this.highlightColor,this._layer2.selectionColor=
this.selectionColor,this._layer2.tip=this.tip,this._chart2Defined==!1?(this._chart2Defined=!0,this._$pieContainer2.append(this._chart2.container),this._chart2.addEventListener(ia.Event.MAP_READY,function(){a!=void 0&&a.call(null)})):a!=void 0&&a.call(null)};ia.AreaBreakdownPieComponent.prototype.setData=function(a){this._data=a;this._layer1.setData(a);this._multiLayout&&this._layer2.setData(a)};
ia.AreaBreakdownPieComponent.prototype.highlight=function(a){if(this._multiLayout)if(this._selectionIds.length==1)this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._$chartTitle2.html(this._layer2.itemName);else{if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._$chartTitle1.html(this._layer1.itemName)}else if(this._selectionIds.length==0)this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._$chartTitle1.html(this._layer1.itemName)};
ia.AreaBreakdownPieComponent.prototype.clearHighlight=function(){if(this._multiLayout)if(this._selectionIds.length==1)this._$chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render();else{if(this._selectionIds.length==0)this._$chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()}else if(this._selectionIds.length==0)this._$chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};
ia.AreaBreakdownPieComponent.prototype.select=function(a){this._selectionIds.indexOf(a)==-1&&this._selectionIds.push(a);this._multiLayout?this._selectionIds.length>1?(this._layer2.itemId=a,this._layer2.update(),this._layer2.render(),this._$chartTitle2.html(this._layer2.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._$chartTitle1.html(this._layer1.itemName)):(this._layer1.itemId=a,this._layer1.update(),this._layer1.render(),this._$chartTitle1.html(this._layer1.itemName))};
ia.AreaBreakdownPieComponent.prototype.unselect=function(a){a=this._selectionIds.indexOf(a);a!=-1&&this._selectionIds.splice(a,1);if(this._multiLayout)if(this._selectionIds.length==0)this._$chartTitle1.html(this.title1),this._layer1.itemId=null,this._layer1.update(),this._layer1.render();else{if(this._selectionIds.length==1)this._$chartTitle2.html(this.title2),this._layer2.itemId=null,this._layer2.update(),this._layer2.render()}else if(this._selectionIds.length==0)this._$chartTitle1.html(this.title1),
this._layer1.itemId=null,this._layer1.update(),this._layer1.render()};ia.AreaBreakdownPieComponent.prototype.clearSelection=function(){this._selectionIds=[];this._layer1.itemId=null;this._layer1.update();this._layer1.render();this._$chartTitle1.html(this.title1);if(this._multiLayout)this._layer2.itemId=null,this._layer2.update(),this._layer2.render(),this._$chartTitle2.html(this.title2)};
ia.AreaBreakdownPieComponent.prototype.render=function(){this._layer1.update();this._layer1.render();this._$chartTitle1.html()==""&&this._$chartTitle1.html(this.title1);this._multiLayout&&(this._layer2.update(),this._layer2.render(),this._$chartTitle2.html()==""&&this._$chartTitle2.html(this.title2))};ia.AreaBreakdownPieComponent.prototype.toggle=function(){this._isVisible?this.hide():this.show()};
ia.AreaBreakdownPieComponent.prototype.hide=function(){if(this._isVisible)this._isVisible=!1,this.container.stop(),this.container.animate({opacity:0},function(){})};ia.AreaBreakdownPieComponent.prototype.show=function(){if(!this._isVisible)this._isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};
ia.ResponsiveMenu=function(){var a=this;this._menuIsDisplayed=!1;this.container=$j('<div class="ia-panel ia-flow-menu">').on("click",function(b){b.stopPropagation();a.toggleMenu()});$j('<div class="ia-list-item ia-flow-menu-icon"></div>').appendTo(this.container);this._$menuItems=$j('<div class="ia-flow-menu-items">').appendTo(this.container)};
ia.ResponsiveMenu.prototype.render=function(a){this._$menuItems.empty();for(var b=a.getButtons(),c=0;c<b.length;c++){var d=b[c];d.visible()&&(d=a.config.getWidget(d.id),this.addMenuItem(a,d.text,d.href,d.target))}if((d=a.getWidget("menuBar"))&&d.visible()){var d=a.config.getWidget(d.id),b=d.getProperties(),e;for(e in b)if(e.indexOf("menuItem")!=-1){var f=e.substring(8,e.length),c=d.getProperty("menuItem"+f),f=d.getProperty("menuFunc"+f);f!="javascript:iaToggleShare()"&&c&&f&&this.addMenuItem(a,c,
f,"_blank")}}};ia.ResponsiveMenu.prototype.toggleMenu=function(){this._menuIsDisplayed?this.hideMenu():this.showMenu()};ia.ResponsiveMenu.prototype.showMenu=function(){this._menuIsDisplayed=!0;this._$menuItems.slideDown()};ia.ResponsiveMenu.prototype.hideMenu=function(){this._menuIsDisplayed=!1;this._$menuItems.slideUp()};
ia.ResponsiveMenu.prototype.addMenuItem=function(a,b,c,d){var e=this,f=$j('<div class="ia-list-item ia-flow-menu-item">'+b+"<div>").appendTo(this._$menuItems);if(c)if(typeof c=="function")f.on("click",function(a){a.stopPropagation();c.call(null,a);e.hideMenu()});else(function(){f.on("click",function(b){var f=$j(window).scrollTop(),i=a.container.scrollTop(),f=f+i+20;$j(".ia-popup-panel").css("top",f+"px");b.stopPropagation();ia.callFunction(c,d,b);e.hideMenu()})})()};
ia.BoundingBox=function(a,b,c,d){this.setXMin(a||0);this.setYMin(b||0);this.setXMax(c||100);this.setYMax(d||100)};ia.BoundingBox.prototype.left=function(){return this._xMin};ia.BoundingBox.prototype.right=function(){return this._xMax};ia.BoundingBox.prototype.bottom=function(){return this._yMin};ia.BoundingBox.prototype.top=function(){return this._yMax};ia.BoundingBox.prototype.getXMin=function(){return this._xMin};
ia.BoundingBox.prototype.setXMin=function(a){this._xMin=a;this._width=Math.abs(this._xMax-this._xMin);this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getXMax=function(){return this._xMax};ia.BoundingBox.prototype.setXMax=function(a){this._xMax=a;this._width=Math.abs(this._xMax-this._xMin);this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getXCenter=function(){return this._xCenter};
ia.BoundingBox.prototype.setXCenter=function(a){this._xCenter=a;this._xMin=this._xCenter-this._width/2;this._xMax=this._xCenter+this._width/2};ia.BoundingBox.prototype.getWidth=function(){return this._width};ia.BoundingBox.prototype.setWidth=function(a){this._width=a;this._xMax=this._xMin+this._width;this._xCenter=this._xMin+this._width/2};ia.BoundingBox.prototype.getYMin=function(){return this._yMin};
ia.BoundingBox.prototype.setYMin=function(a){this._yMin=a;this._height=Math.abs(this._yMax-this._yMin);this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.getYMax=function(){return this._yMax};ia.BoundingBox.prototype.setYMax=function(a){this._yMax=a;this._height=Math.abs(this._yMax-this._yMin);this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.getYCenter=function(){return this._yCenter};
ia.BoundingBox.prototype.setYCenter=function(a){this._yCenter=a;this._yMin=this._yCenter-this._height/2;this._yMax=this._yCenter+this._height/2};ia.BoundingBox.prototype.getHeight=function(){return this._height};ia.BoundingBox.prototype.setHeight=function(a){this._height=a;this._yMax=this._yMin+this._height;this._yCenter=this._yMin+this._height/2};ia.BoundingBox.prototype.clone=function(){return new ia.BoundingBox(this._xMin,this._yMin,this._xMax,this._yMax)};
ia.BoundingBox.prototype.equals=function(a){return a.getXMin()!=this._xMin?!1:a.getYMin()!=this._yMin?!1:a.getXMax()!=this._xMax?!1:a.getYMax()!=this._yMax?!1:!0};ia.BoundingBox.prototype.intersects=function(a){return a.getXMin()>this._xMax?!1:a.getXMax()<this._xMin?!1:a.getYMin()>this._yMax?!1:a.getYMax()<this._yMin?!1:!0};ia.BoundingBox.prototype.contains=function(a){return a.getXMin()<this._xMin?!1:a.getXMax()>this._xMax?!1:a.getYMin()<this._yMin?!1:a.getYMax()>this._yMax?!1:!0};
ia.BoundingBox.prototype.addMargin=function(a){var b=this.clone(),a=a||0.2,c=b.getWidth()*a;a*=b.getHeight();var d=b.getXCenter(),e=b.getYCenter();b.setWidth(b.getWidth()+c*2);b.setHeight(b.getHeight()+a*2);b.setXCenter(d);b.setYCenter(e);return b};ia.BoundingBox.prototype.toString=function(){return"[object ia.BoundingBox xMin='"+this._xMin+"' yMin='"+this._yMin+"' xMax='"+this._xMax+"' yMax='"+this._yMax+"']"};
ia.BBoxEvent=function(a,b,c,d){ia.BBoxEvent.baseConstructor.call(this,a,b);this.bBox=c;this.oldBBox=d};ia.extend(ia.Event,ia.BBoxEvent);ia.BBoxEvent.BBOX_TRANSLATE=0;ia.BBoxEvent.BBOX_SCALE=1;ia.CartesianSpace=function(a,b,c,d){ia.CartesianSpace.baseConstructor.call(this);this.canvasX=a||0;this.canvasY=b||0;this.canvasWidth=c||0;this.canvasHeight=d||0;this.bBox=new ia.BoundingBox;this.oldBBox=new ia.BoundingBox;this._oldBBoxSet=!1;this.maxZoom=this.minZoom=-1;this.maintainAspectRatio=!1};
ia.extend(ia.EventDispatcher,ia.CartesianSpace);ia.CartesianSpace.prototype.getBBox=function(){return this.bBox};ia.CartesianSpace.prototype.setBBox=function(a){this.oldBBox=this._oldBBoxSet?this.bBox.clone():a.clone();this.bBox=a.clone();this._oldBBoxSet=!0;this.commitChanges()};ia.CartesianSpace.prototype.getPixelPoint=function(a){return new ia.Point(this.getPixelX(a.x),this.getPixelY(a.y))};
ia.CartesianSpace.prototype.getPixelRect=function(a){return new ia.Rectangle(this.getPixelX(a.getXMin()),this.getPixelY(a.getYMax()),this.getPixelWidth(a.getWidth()),this.getPixelHeight(a.getHeight()))};ia.CartesianSpace.prototype.getPixelX=function(a){return this.canvasX+this.getPixelWidth(a-this.bBox.getXMin())};ia.CartesianSpace.prototype.getPixelY=function(a){return this.canvasY+this.canvasHeight-this.getPixelHeight(a-this.bBox.getYMin())};
ia.CartesianSpace.prototype.getPixelWidth=function(a){return a==0?0:a/this.bBox.getWidth()*this.canvasWidth};ia.CartesianSpace.prototype.getPixelHeight=function(a){return a==0?0:a/this.bBox.getHeight()*this.canvasHeight};ia.CartesianSpace.prototype.getDataPoint=function(a){return new ia.Point(this.getDataX(a.x),this.getDataY(a.y))};
ia.CartesianSpace.prototype.getDataBBox=function(a){var b=this.getPixelX(a.left()),c=this.getPixelY(a.bottom()),d=b+this.getPixelWidth(a.width),a=c+this.getPixelHeight(a.height);return new ia.BoundingBox(b,c,d,a)};ia.CartesianSpace.prototype.getDataX=function(a){return this.bBox.getXMin()+this.getDataWidth(a)};ia.CartesianSpace.prototype.getDataY=function(a){return this.bBox.getYMin()+this.getDataHeight(this.canvasHeight-a)};
ia.CartesianSpace.prototype.getDataWidth=function(a){return a==0?0:a/this.canvasWidth*this.bBox.getWidth()};ia.CartesianSpace.prototype.getDataHeight=function(a){return a==0?0:a/this.canvasHeight*this.bBox.getHeight()};
ia.CartesianSpace.prototype.commitChanges=function(){this.maintainAspectRatio&&this.adjustBBox(this.bBox);var a=!0;this.minZoom!=-1&&Math.max(this.bBox.getWidth(),this.bBox.getHeight())>this.minZoom&&(a=!1);this.maxZoom!=-1&&Math.min(this.bBox.getWidth(),this.bBox.getHeight())<this.maxZoom&&(a=!1);if(a){var a=this.getPixelRect(this.oldBBox),b=this.getPixelRect(this.bBox),c=Math.round(b.height),d=Math.round(a.height);eventType=Math.round(b.width)==Math.round(a.width)&&c==d?ia.BBoxEvent.BBOX_TRANSLATE:
ia.BBoxEvent.BBOX_SCALE}else this.bBox=this.oldBBox.clone(),this.maintainAspectRatio&&this.adjustBBox(this.bBox),eventType=ia.BBoxEvent.BBOX_SCALE;this.dispatchEvent(new ia.BBoxEvent(eventType,this,this.bBox,this.oldBBox))};
ia.CartesianSpace.prototype.adjustBBox=function(a){var b=a.getHeight()/this.canvasHeight,c=a.getWidth()/this.canvasWidth,d,e;b>c?(c=a.getYMin(),e=a.getHeight(),d=this.canvasWidth/this.canvasHeight*e,b=a.getXMin()-(d-a.getWidth())/2):c>b?(b=a.getXMin(),d=a.getWidth(),e=this.canvasHeight/this.canvasWidth*d,c=a.getYMin()-(e-a.getHeight())/2):(b=a.getXMin(),c=a.getYMin(),d=a.getWidth(),e=a.getHeight());a.setXMin(b);a.setYMin(c);a.setWidth(d);a.setHeight(e)};
ia.CartesianSpace.prototype.adjustY=function(a){var b=a.getXMin(),c=a.getWidth(),d=this.canvasHeight/this.canvasWidth*c,e=a.getYMin()-(d-a.getHeight())/2;a.setXMin(b);a.setYMin(e);a.setWidth(c);a.setHeight(d)};ia.Rectangle=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};ia.Rectangle.prototype.left=function(){return this.x};ia.Rectangle.prototype.right=function(){return this.x+this.width};ia.Rectangle.prototype.bottom=function(){return this.y+this.height};
ia.Rectangle.prototype.top=function(){return this.y};ia.Rectangle.prototype.clone=function(){return new ia.Rectangle(this.x,this.y,this.width,this.height)};ia.Rectangle.prototype.intersects=function(a,b){return b<this.top()?!1:b>this.bottom()?!1:a>this.right()?!1:a<this.left()?!1:!0};
ia.Rectangle.prototype.intersectsLine=function(a,b){return this.lineIntersectsLine({x:this.left(),y:this.top()},{x:this.right(),y:this.top()},a,b)||this.lineIntersectsLine({x:this.right(),y:this.top()},{x:this.right(),y:this.bottom()},a,b)||this.lineIntersectsLine({x:this.right(),y:this.bottom()},{x:this.left(),y:this.bottom()},a,b)||this.lineIntersectsLine({x:this.left(),y:this.bottom()},{x:this.left(),y:this.top()},a,b)||this.intersects(a.x,a.y)&&this.intersects(b.x,b.y)};
ia.Rectangle.prototype.lineIntersectsLine=function(a,b,c,d){var e=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),f=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),a=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);return a!=0?(e/=a,f/=a,0<=e&&e<=1&&0<=f&&f<=1?!0:!1):!1};ia.Rectangle.prototype.toString=function(){return"[object Rectangle x='"+this.x+"' y='"+this.y+"' width='"+this.width+"' height='"+this.height+"']"};ia.Point=function(a,b){this.x=a||0;this.y=b||0};
ia.Point.prototype.subtract=function(a){return new ia.Point(this.x-a.x,this.y-a.y)};ia.Point.prototype.toString=function(){return"[object Point x='"+this.x+"' y='"+this.y+"']"};ia.ChartTip=function(a){this._container=a;this._tipContainer=$j("<svg>").addClass("ia-datatip").hide();$j("body").append(this._tipContainer)};
ia.ChartTip.prototype.position=function(a,b){var c=this._tipContainer.outerWidth(),d=this._tipContainer.outerHeight();this._container!=void 0&&(a+=this._container.offset().left,b+=this._container.offset().top);if(a<10)a=10;else{var e=$j(window).scrollLeft(),f=$j(window).width(),c=a+c-(e+f-10);c>0&&(a-=c)}b<10?b=10:(c=$j(window).scrollTop(),e=$j(window).height(),d=b+d-(c+e-10),d>0&&(b-=d));this._tipContainer.css("left",a+"px").css("top",b+"px")};ia.ChartTip.prototype.text=function(a){this._tipContainer.html(a)};
ia.ChartTip.prototype.getWidth=function(){return this._tipContainer.outerWidth()};ia.ChartTip.prototype.getHeight=function(){return this._tipContainer.outerHeight()};ia.ChartTip.prototype.show=function(){this._tipContainer.css("display","inline")};ia.ChartTip.prototype.hide=function(){this._tipContainer.css("display","none")};
ia.CanvasBase=function(a){ia.CanvasBase.baseConstructor.call(this,0,0,100,100);this._touchStart=0;this._pinching=this._mouseOverMap=this._mouseDragged=this._dragging=this._mouseDown=!1;this._layers=[];this._mouseDownY=this._mouseDownX=0;this.id=a;this.isVisible=!0;this.mouseY=this.mouseX=0;this.animationMode=this.isDraggable=this.embeddedInGoogleMaps=!1;this.container=$j("<div id='"+a+"' class='ia-chart'>");this.mapContainer=$j("<div id='mapContainer'>");this.backgroundContainer=$j("<div id='backgroundContainer'>");
this.layerContainer=$j("<div id='layercontainer'>");this.foregroundContainer=$j("<div id='foregroundContainer'>");this.mapContainer.append(this.backgroundContainer);this.mapContainer.append(this.layerContainer);this.mapContainer.append(this.foregroundContainer);this.container.append(this.mapContainer);this.labelStyle=$j("<div class='ia-map-labels' style='visibility:hidden'>");this.mapContainer.append(this.labelStyle);this.canvas=this._createCanvas(this.backgroundContainer);this.context=this.canvas.getContext("2d");
this.foregroundCanvas=this._createCanvas(this.foregroundContainer);this.foregroundContext=this.foregroundCanvas.getContext("2d");this.datatip=new ia.ChartTip(this.foregroundContainer);this._addListeners();var b,c=!1,d=this;this.container.resize(function(){clearTimeout(b);b=setTimeout(function(){clearTimeout(b);var a=d.container.width(),f=d.container.height();d.foregroundContainer.width(a);d.foregroundContainer.height(f);d.canvas.width=a;d.canvas.height=f;d.foregroundCanvas.width=a;d.foregroundCanvas.height=
f;d.canvasX=0;d.canvasY=0;d.canvasWidth=a;d.canvasHeight=f;a=new ia.Event(ia.Event.MAP_RESIZE,d);d.dispatchEvent(a);d.commitChanges();c==!1&&(c=!0,a=new ia.Event(ia.Event.MAP_READY,d),d.dispatchEvent(a))},500)}.bind(this))};ia.extend(ia.CartesianSpace,ia.CanvasBase);ia.CanvasBase.prototype._createCanvas=function(a){var b=document.createElement("canvas");b.width=a.width();b.height=a.height();$j(b).css({position:"absolute",left:0,top:0});a.append($j(b));return b};
ia.CanvasBase.prototype._addListeners=function(){this.mapContainer.on("touchstart.canvasbase touchmove.canvasbase touchend.canvasbase",this._touchEventHandler.bind(this));this.mapContainer.on("mousemove.canvasbase mouseup.canvasbase mouseenter.canvasbase mouseleave.canvasbase mousedown.canvasbase click.canvasbase",this._mouseEventHandler.bind(this));var a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener&&document.addEventListener(a,this._mouseEventHandler.bind(this),
!1)};
ia.CanvasBase.prototype._mouseEventHandler=function(a){var b=!0,c=$j("#widget-"+this.id);c&&c.css("visibility")=="hidden"&&(b=!1);if(this.isVisible&&b){var d;this.mouseX=a.pageX-this.container.offset().left;this.mouseY=a.pageY-this.container.offset().top;if(a.type=="mouseenter")d=ia.MapMouseEvent.MAP_MOUSE_OVER,this._dragging&&$j(document).off(".canvasbasedoc"),this._mouseOverMap=!0;else if(a.type=="mouseleave"){d=ia.MapMouseEvent.MAP_MOUSE_OUT;if(this._dragging)$j(document).on("mousemove.canvasbasedoc mouseup.canvasbasedoc",this._mouseEventHandler.bind(this));
this._mouseOverMap=!1}else if(a.type=="mousemove")if(this._mouseOverMap=!0,this._mouseDown&&(this._mouseDownX!=a.pageX||this._mouseDownY!=a.pageY))d=ia.MapMouseEvent.MAP_MOUSE_DRAG,this._dragging=!0;else{if(this._mouseOverMap)d=ia.MapMouseEvent.MAP_MOUSE_MOVE}else if(a.type=="mouseup"){if(this._dragging)d=ia.MapMouseEvent.MAP_MOUSE_DRAG_UP,$j(document).off(".canvasbasedoc"),this._dragging=!1,this._mouseDragged=!0;else if(this._mouseOverMap)d=ia.MapMouseEvent.MAP_MOUSE_UP;this._mouseDown=!1}else if(a.type==
"mousedown")d=ia.MapMouseEvent.MAP_MOUSE_DOWN,this._mouseDownX=a.pageX,this._mouseDownY=a.pageY,this._mouseDragged=!1,this._mouseDown=!0;else if(a.type=="mousewheel"||a.type=="onmousewheel"||a.type=="DOMMouseScroll")this._mouseOverMap&&this.isDraggable&&a.preventDefault(),d=ia.MapMouseEvent.MAP_MOUSE_WHEEL;else if(a.type=="click"){if(this._mouseDragged==!1)d=ia.MapMouseEvent.MAP_MOUSE_CLICK;this._mouseDragged=this._mouseDown=this._dragging=!1}d!=null&&(b=this.getDataX(this.mouseX),c=this.getDataY(this.mouseY),
this.dispatchEvent(new ia.MapMouseEvent(this,a,d,b,c,this.mouseX,this.mouseY,void 0,void 0,a.pageX,a.pageY)))}};
ia.CanvasBase.prototype._touchEventHandler=function(a){if(this.isVisible){a.preventDefault();var b;!this.embeddedInGoogleMaps&&this.isDraggable&&a.preventDefault();var c,d,e,f;if(a.originalEvent.touches.length>1){var g=a.originalEvent.touches[0];f=a.originalEvent.touches[1];c=g.pageX-this.container.offset().left;d=g.pageY-this.container.offset().top;e=f.pageX-this.container.offset().left;f=f.pageY-this.container.offset().top;if(this.isDraggable&&this._dragging)b=ia.MapMouseEvent.MAP_MOUSE_DRAG_UP,
this._DispatchMapMouseEvent(a,b,g,c,d,e,f);this._dragging=!1;this._pinching=!0;if(a.type=="touchstart")b=ia.MapMouseEvent.MAP_PINCH_DOWN;else if(a.type=="touchmove")b=ia.MapMouseEvent.MAP_PINCH_MOVE}else if(g=a.originalEvent.changedTouches[0],c=g.pageX-this.container.offset().left,d=g.pageY-this.container.offset().top,f=e=null,a.type=="touchstart")this._touchStart=(new Date).getTime(),b=ia.MapMouseEvent.MAP_MOUSE_DOWN;else if(a.type=="touchmove")this.isDraggable?(b=ia.MapMouseEvent.MAP_MOUSE_DRAG,
this._pinching=!1,this._dragging=!0):b=ia.MapMouseEvent.MAP_MOUSE_MOVE;else if(a.type=="touchend")b=(new Date).getTime()-this._touchStart,b=this._pinching?ia.MapMouseEvent.MAP_PINCH_UP:this._dragging?this.isDraggable?ia.MapMouseEvent.MAP_MOUSE_DRAG_UP:ia.MapMouseEvent.MAP_MOUSE_UP:b<500?ia.MapMouseEvent.MAP_MOUSE_CLICK:ia.MapMouseEvent.MAP_MOUSE_UP,this._dragging=this._pinching=!1;this._DispatchMapMouseEvent(a,b,g,c,d,e,f);if(a.originalEvent.touches.length==1&&a.type=="touchend"){b=ia.MapMouseEvent.MAP_MOUSE_DOWN;
g=a.originalEvent.touches[0];c=g.pageX-this.container.offset().left;d=g.pageY-this.container.offset().top;if(this.isDraggable)this._dragging=!0;this._DispatchMapMouseEvent(a,b,g,c,d,null,null)}}};
ia.CanvasBase.prototype._DispatchMapMouseEvent=function(a,b,c,d,e,f,g){if(b!=null){if(f!=null){var h=Math.min(e,g),i=Math.max(e,g);this.mouseX=(Math.min(d,f)+Math.max(d,f))/2;this.mouseY=(h+i)/2}else this.mouseX=d,this.mouseY=e;h=this.getDataX(this.mouseX);i=this.getDataY(this.mouseY);this.dispatchEvent(new ia.MapMouseEvent(this,a,b,h,i,d,e,f,g,c.pageX,c.pageX))}};ia.CanvasBase.prototype.mouseCoords=function(){var a=this.getDataX(this.mouseX),b=this.getDataY(this.mouseY);return new ia.Point(a,b)};
ia.CanvasBase.prototype.setCopyright=function(a){this._copyright=a};ia.CanvasBase.prototype.addLogo=function(a){this._logo=new Image;this._logo.src=ia.getDomainSafeUrl(a)};
ia.CanvasBase.prototype.exportData=function(a){for(var b=0;b<this._layers.length;b++){var c=this._layers[b];c.canvas&&c.exportable&&(this.context.drawImage(c.canvas,0,0),c.selectionCanvas&&this.context.drawImage(c.selectionCanvas,0,0),c.labelCanvas&&this.context.drawImage(c.labelCanvas,0,0))}if(this._logo!=void 0&&a)c=this._logo.width,this.context.drawImage(this._logo,this.canvas.width-c,this.canvas.height-this._logo.height);if(this._copyright!=void 0&&this._copyright!=""){var c="Verdana",d="#AAAAAA",
b=10,e=$j("#map-copyright");e.length&&(e.css("font-family")&&(c=e.css("font-family")),e.css("color")&&(d=ia.Color.toHex(e.css("color"))),e.css("font-size")&&(b=e.css("font-size"),b.indexOf("px")>-1&&(b=b.substring(0,b.indexOf("px"))),b=ia.parseInt(b)));this.context.font=""+b+"px "+c;this.context.fillStyle=d;c=this.canvas.width-10;this._logo!=void 0&&a&&(c-=this._logo.width);this._wrapText(this._copyright,5,this.canvas.height-5,c,b+2,"bottom")}a=this.canvas.toDataURL("image/png");this.clear();this.render();
return a};ia.CanvasBase.prototype._wrapText=function(a,b,c,d,e,f){var a=a.split(" "),g="";if(f=="middle"||f=="bottom"){for(var h=0,i=0;i<a.length;i++){var k=a[i],j;j=i==0?k:g+" "+k;var m=this.context.measureText(j),m=m.width;i!=0&&m>d?(g=k,h++):g=j}h++;h*=e;f=="middle"?c=c-h/2+e/2:f=="bottom"&&(c=c-h+e)}for(i=0;i<a.length;i++)k=a[i],j=i==0?k:g+" "+k,m=this.context.measureText(j),m=m.width,i!=0&&m>d?(this.context.fillText(g,b,c),g=k,c+=e):g=j;this.context.fillText(g,b,c)};
ia.CanvasBase.prototype.render=function(){this.datatip.hide();for(var a=0;a<this._layers.length;a++)this._layers[a].render()};ia.CanvasBase.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a=0;a<this._layers.length;a++)this._layers[a].clear()};ia.CanvasBase.prototype.clearForeground=function(){this.foregroundContext.clearRect(0,0,this.foregroundCanvas.width,this.foregroundCanvas.height)};
ia.CanvasBase.prototype.addLayer=function(a){this._layers.push(a);a.setMap(this,this.layerContainer)};ia.CanvasBase.prototype.getLayers=function(){return this._layers};ia.CanvasBase.prototype.removeLayers=function(){for(var a=0;a<this._layers.length;a++){var b=this._layers[a];b.removeCanvases();this.removeListener(b)}this._layers=[]};ia.CanvasBase.prototype.getLayer=function(a){for(var b=0;b<this._layers.length;b++){var c=this._layers[b];if(c.id==a)return c}};
ia.CanvasBase.prototype.startDrag=function(){this._dragging=!0};ia.CanvasBase.prototype.endDrag=function(){$j(document).off(".canvasbasedoc");this._dragging=!1;this._mouseDragged=!0;this._mouseDown=!1};ia.CanvasBase.prototype.toggle=function(){this.isVisible?this.hide():this.show()};ia.CanvasBase.prototype.hide=function(){if(this.isVisible){var a=this;a.isVisible=!1;a.container.stop();a.container.animate({opacity:0},function(){a.clear()})}};
ia.CanvasBase.prototype.show=function(){if(!this.isVisible)this.isVisible=!0,this.container.stop(),this.container.animate({opacity:1},function(){})};
ia.ChartBase=function(a){ia.ChartBase.baseConstructor.call(this,a);this.itemStyle=$j("<div class='ia-chart-items' style='visibility:hidden'>");this.mapContainer.append(this.itemStyle);this.orientation="vertical";this.showXAxisLabels=!0;this.xAxisTitle=void 0;this.showYAxisLabels=!0;this.yAxisTitle=void 0;this.showRightBorder=this.showLeftBorder=this.showTopBorder=this.showBottomBorder=this.showBox=!1;this.showYAxisGrid=this.showXAxisGrid=!0;this.useTightLabels=this.showYAxisTickMarks=this.showXAxisTickMarks=
this.centerYAxisLabels=this.centerXAxisLabels=!1;this.formatter=new ia.Formatter;this.wrapXAxisLabels=!1;var b=this,c=!1;b.addEventListener(ia.Event.MAP_READY,function(){c=!0});b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,function(){c&&b.render()});b.addEventListener(ia.BBoxEvent.BBOX_SCALE,function(){c&&b.render()})};ia.extend(ia.CanvasBase,ia.ChartBase);
ia.ChartBase.prototype.renderAxes=function(a,b,c,d){if(ia.isNumber(a)&&ia.isNumber(b)&&ia.isNumber(c)&&ia.isNumber(d)&&this.canvas.width>0&&this.canvas.height>0){var e="Verdana",f="#AAAAAA",g=10,h="#E5E5E5";this.container.css("font-family")&&(e=this.container.css("font-family"));this.container.css("color")&&(f=ia.Color.toHex(this.container.css("color")));this.container.css("font-size")&&(g=this.container.css("font-size"),g.indexOf("px")>-1&&(g=g.substring(0,g.indexOf("px"))),g=ia.parseInt(g));this.container.css("borderRightColor")&&
(h=ia.Color.toHex(this.container.css("borderRightColor")));this.canvasY=this.canvasX=0;this.canvasWidth=this.canvas.width;this.canvasHeight=this.canvas.height;this.context.lineWidth=1;this.context.strokeStyle=h;this.context.font=""+g+"px "+e;this.context.fillStyle=f;g+=2;var i=g+10,h=f=20,k=10,e=10;if(this.showYAxisLabels){var j=this.canvasHeight-(e+k),m=this._getYAxisLabels(c,d,5,j,i);f+=this._getMaxLabelWidth(m,5);this.centerYAxisLabels||(k+=i/2,e+=i/2)}if(this.showXAxisLabels){var j=this.canvasWidth-
(f+h),n=this._getXAxisLabels(a,b,5,j,5),m=i;if(this.wrapXAxisLabels)var l=j/n.length,m=this._getMaxLabelHeight(n,5,g,l);k=10+m;this.centerXAxisLabels||(l=this._getLabelWidth(n[0],5),l>f-20&&(f=l/2+20),l=this._getLabelWidth(n[n.length-1],5),h+=l/2)}this.xAxisTitle!=void 0&&(l=this.canvasWidth-(f+h),m=this._getLabelHeight(this.xAxisTitle,5,g,l),k=k+m-5);this.yAxisTitle!=void 0&&(l=this.canvasHeight-(k+e),m=this._getLabelHeight(this.yAxisTitle,5,g,l),f=f+m-5);j=this.canvasWidth-(f+h);m=0;if(this.showXAxisLabels){n=
this._getXAxisLabels(a,b,5,j,5);m=i;this.wrapXAxisLabels&&(l=j/n.length,m=this._getMaxLabelHeight(n,5,g,l));k=0;this.xAxisTitle!=void 0&&(l=this.canvasWidth-(f+h),k=this._getLabelHeight(this.xAxisTitle,5,g,l));k=10+m+k;this.context.textAlign="center";this.context.textBaseline="top";var a=n.length,b=this.canvasHeight-k+5,o,q,p;this.centerXAxisLabels?(o=j/a,l=f+o/2,q=o,p=f):(o=j/(a-1),l=f,q=o,p=l);for(j=0;j<a;j++){var r=n[j];this.isPyramidChart==!0&&r.indexOf("-")!=-1&&(r=r.substring(1));this.wrapXAxisLabels?
this._wrapText(r,l,b,o-10,g):this.context.fillText(r,l,b);if(this.showXAxisTickMarks){var r=l,t=Math.floor(this.canvasHeight-k)+0.5,s=l,u=t+5;this.context.beginPath();this.context.moveTo(r,t);this.context.lineTo(s,u);this.context.stroke()}this.showXAxisGrid&&(r=Math.floor(p)+0.5,t=Math.floor(e)+0.5,s=r,u=Math.floor(this.canvasHeight-k)+0.5,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke());l+=o;p+=q}this.showXAxisGrid&&this.centerXAxisLabels&&(r=Math.floor(p)+
0.5,t=Math.floor(e)+0.5,s=r,u=Math.floor(this.canvasHeight-k)+0.5,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke())}if(this.xAxisTitle!=void 0)l=this.canvasWidth-(f+h),this.showXAxisLabels||(k=this._getLabelHeight(this.xAxisTitle,5,g,l),k=10+k),this.context.textAlign="center",this.context.textBaseline="top",a=this.canvasHeight-k+(m+5),this._wrapText(this.xAxisTitle,f+l/2,a,l,g);j=this.canvasHeight-(e+k);n=0;if(this.showYAxisLabels){m=this._getYAxisLabels(c,
d,5,j,i);n=this._getMaxLabelWidth(m,5);this.context.textAlign="right";this.context.textBaseline="middle";a=m.length;l=f-5;this.centerYAxisLabels?(c=j/a,b=e+c/2,d=c,i=e):(c=j/(a-1),b=e,d=c,i=b);for(j=0;j<a;j++)r=m[j],this.context.fillText(r,l,b),this.showYAxisTickMarks&&(r=Math.floor(f)+0.5,t=b,s=r-5,u=b,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke()),this.showYAxisGrid&&(r=Math.floor(f)+0.5,t=Math.floor(i)+0.5,s=Math.floor(this.canvasWidth-h)+0.5,
u=t,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke()),b+=c,i+=d;this.showYAxisGrid&&this.centerYAxisLabels&&(r=Math.floor(f)+0.5,t=Math.floor(i)+0.5,s=Math.floor(this.canvasWidth-h)+0.5,u=t,this.context.beginPath(),this.context.moveTo(r,t),this.context.lineTo(s,u),this.context.stroke())}if(this.yAxisTitle!=void 0)l=this.canvasHeight-(k+e),m=this._getLabelHeight(this.yAxisTitle,5,g,l),a=e+l/2,c=f-n-m+5,this.context.save(),this.context.translate(c,a),
this.context.rotate(-Math.PI/2),this.context.textAlign="center",this.context.textBaseline="top",this._wrapText(this.yAxisTitle,0,0,l,g),this.context.restore();this.canvasX=f;this.canvasWidth-=f+h;this.canvasY=e;this.canvasHeight-=e+k;c=Math.floor(f)+0.5;f=Math.floor(f+this.canvasWidth)+0.5;d=Math.floor(e)+0.5;e=Math.floor(e+this.canvasHeight)+0.5;this.showBox&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(f,d),this.context.lineTo(f,e),this.context.lineTo(c,e),this.context.closePath(),
this.context.stroke());this.showBottomBorder&&(this.context.beginPath(),this.context.moveTo(c,e),this.context.lineTo(f,e),this.context.closePath(),this.context.stroke());this.showTopBorder&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(f,d),this.context.closePath(),this.context.stroke());this.showLeftBorder&&(this.context.beginPath(),this.context.moveTo(c,d),this.context.lineTo(c,e),this.context.closePath(),this.context.stroke());this.showRightBorder&&(this.context.beginPath(),
this.context.moveTo(f,d),this.context.lineTo(f,e),this.context.closePath(),this.context.stroke())}};ia.ChartBase.prototype._getLabelWidth=function(a,b){return this.context.measureText(a).width+b*2};ia.ChartBase.prototype._getMaxLabelWidth=function(a,b){for(var c=0,d=0;d<a.length;d++)c=Math.max(c,this._getLabelWidth(a[d],b));return c};ia.ChartBase.prototype._getLabelHeight=function(a,b,c,d){return this._getNoLines(a,d-b*2)*c+b*2};
ia.ChartBase.prototype._getMaxLabelHeight=function(a,b,c,d){for(var e=0,f=0;f<a.length;f++)e=Math.max(e,this._getLabelHeight(a[f],b,c,d));return e};ia.ChartBase.prototype._getNoLines=function(a,b){for(var c=a.split(" "),d="",e=1,f=0;f<c.length;f++)d=d+c[f]+" ",this.context.measureText(d).width>b&&(d=c[f]+" ",e++);return e};ia.ChartBase.prototype._getXAxisLabels=function(a,b,c,d,e){return this.xAxisLabels?this._dropXLabels(this.xAxisLabels,d,e):this._calculateXAxisLabels(a,b,c,d,e)};
ia.ChartBase.prototype._calculateXAxisLabels=function(a,b,c,d,e){for(var f,g=!0,h=c;g;){f=this.useTightLabels?this._getTightLabels(a,b,h):this._getLooseLabels(a,b,h);var i=f.labels;f=f.values;c=i.length;if(c<3)i=[this.formatter.format(a),this.formatter.format(b)],f=[a,b],g=!1;else if(c==3)g=!1;else{for(var k=0,j=0;j<c;j++){var m=this.context.measureText(i[j]).width+e*2;k+=m}k>d?h--:g=!1}}a=this.getBBox();a.setXMin(f[0]);a.setXMax(f[f.length-1]);return i};
ia.ChartBase.prototype._dropXLabels=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;f++)for(var g=a[f].split(" "),h=g.length,i=0,k=0;k<h;k++){var j=g[k],m=this.context.measureText(j).width;m>i&&(i=m,d[f]=j)}e=d.concat();for(g=!0;g;){g=!1;for(f=i=0;f<e.length;f++)h=e[f],h!=""&&i++;if(i<=2){for(f=0;f<d.length;f++)e[f]="";e[0]=d[0];e[e.length-1]=d[d.length-1]}else{i=b/i;for(f=0;f<e.length;f++)if(h=e[f],h!=""&&this.context.measureText(h).width+c*2>i){g=!0;break}if(g)for(f=i=0;f<e.length;f++)h=e[f],h!=
""&&(i%2==0&&(e[f]=""),i++)}}for(f=0;f<d.length;f++)h=a[f],e[f]!=""&&(e[f]=h);return e};ia.ChartBase.prototype._getYAxisLabels=function(a,b,c,d,e){this.yAxisLabels?(a=this.yAxisLabels.concat(),a=this._dropYLabels(a,d,e)):(a=this._calculateYAxisLabels(a,b,c,d,e).concat(),a.reverse());return a};
ia.ChartBase.prototype._calculateYAxisLabels=function(a,b,c,d,e){for(var f,g=!0,h=c;g;){f=this.useTightLabels?this._getTightLabels(a,b,h):this._getLooseLabels(a,b,h);var i=f.labels;f=f.values;c=i.length;c<3?(i=[this.formatter.format(a),this.formatter.format(b)],f=[a,b],g=!1):c==3?g=!1:d/c<e?h--:g=!1}a=this.getBBox();a.setYMin(f[0]);a.setYMax(f[f.length-1]);return i};
ia.ChartBase.prototype._dropYLabels=function(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];d[e]=f}for(var g=!0;g;){for(var h=0,e=0;e<d.length;e++)f=d[e],f!=""&&h++;if(h<=2){for(e=0;e<a.length;e++)d[e]="";d[0]=a[0];d[d.length-1]=a[a.length-1];g=!1}else{for(e=h=0;e<d.length;e++)f=d[e],f!=""&&(h+=c);if(h>b)for(e=h=0;e<d.length;e++)f=d[e],f!=""&&(h%2==0&&(d[e]=""),h++);else g=!1}}return d};
ia.ChartBase.prototype.getAxisValues=function(a,b,c){var d=[];if(c<=2)d=[a,b];else for(var e=(b-a)/(c-1),f=0;f<c;f++)d[f]=f==c-1?b:a,a+=e;return d};ia.ChartBase.prototype._getLooseLabels=function(a,b,c){for(var c=ia.getNiceNum((b-a)/(c-1),!0),a=Math.floor(a/c)*c,b=Math.ceil(b/c)*c,d=Math.max(-1*Math.floor(ia.log10(c)),0),e=[],f=[];a<b+0.5*c;a+=c)e[e.length]=ia.round(a,d),f[f.length]=this.formatter.format(ia.round(a,d));return{values:e,labels:f}};
ia.ChartBase.prototype._getTightLabels=function(a,b,c){var d=(b-a)/(c-1),e=parseFloat(a),f=[];f.push(a);for(a=1;a<c-1;a++)e+=d,f.push(e);f.push(b);b=[];d=ia.getPrecision(f);for(a=0;a<c;a++)b.push(this.formatter.format(f[a],d));return{values:f,labels:b}};
ia.BarChart=function(a){ia.BarChart.baseConstructor.call(this,a);this.limitsColor="#cccccc";this.limitsWidth=1;this.limitsContainer=$j("<div id='limitsContainer' style='display:none' class='ia-chart-limits'>");this.container.append(this.limitsContainer);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.BarChart);
ia.BarChart.prototype.render=function(){this.clear();if(this.limitsContainer.css("borderRightColor"))this.limitsColor=ia.Color.toHex(this.limitsContainer.css("borderRightColor"));if(this.limitsContainer.css("borderRightWidth")){this.limitsWidth=this.limitsContainer.css("borderRightWidth");if(this.limitsWidth.indexOf("px")>-1)this.limitsWidth=this.limitsWidth.substring(0,this.limitsWidth.indexOf("px"));this.limitsWidth=parseFloat(this.limitsWidth)}for(var a=Infinity,b=-Infinity,c=this.getLayers(),
d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);d=this.getBBox();this.orientation=="vertical"?(this.showXAxisLabels=!1,this.showYAxisLabels=!0,this.showXAxisGrid=!1,this.showYAxisGrid=!0,this.renderAxes(d.getXMin(),d.getXMax(),
a,b)):(this.showXAxisLabels=!0,this.showYAxisLabels=!1,this.showXAxisGrid=!0,this.showYAxisGrid=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.GridChart=function(a){ia.GridChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.GridChart);ia.GridChart.prototype.render=function(){this.clear();for(var a=this.getLayers(),b=0;b<a.length;b++)a[b].update();b=this.getBBox();this.renderAxes(b.getXMin(),b.getXMax(),b.getYMin(),b.getYMax());for(b=0;b<a.length;b++)a[b].render()};
ia.PyramidChart=function(a){ia.PyramidChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1;this.isPyramidChart=!0};ia.extend(ia.ChartBase,ia.PyramidChart);
ia.PyramidChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update(this.date);a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;Math.abs(a)>b?b=Math.abs(a):a=b*-1;d=this.getBBox();this.showXAxisGrid=this.showXAxisLabels=
this.centerYAxisLabels=!0;this.showYAxisGrid=!1;this.renderAxes(a,b,d.getYMin(),d.getYMax());for(d=0;d<c.length;d++)c[d].render()};ia.TimeChart=function(a){ia.TimeChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.TimeChart);
ia.TimeChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);d=this.getBBox();this.orientation=="vertical"?(this.centerXAxisLabels=!0,this.showXAxisGrid=this.centerYAxisLabels=!1,this.showYAxisGrid=
!0,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.centerXAxisLabels=!1,this.showXAxisGrid=this.centerYAxisLabels=!0,this.showYAxisGrid=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.PieChart=function(a){ia.PieChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.PieChart);ia.PieChart.prototype.render=function(){this.clear();for(var a=this.getLayers(),b=0;b<a.length;b++){var c=a[b];c.update();c.render()}};
ia.BoxChart=function(a){ia.BoxChart.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.BoxChart);
ia.BoxChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);d=this.getBBox();this.orientation=="vertical"?(this.showXAxisLabels=!1,this.showYAxisLabels=!0,this.renderAxes(d.getXMin(),
d.getXMax(),a,b)):(this.showXAxisLabels=!0,this.showYAxisLabels=!1,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.TimeBarChart=function(a){ia.TimeBarChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.TimeBarChart);
ia.TimeBarChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);d=this.getBBox();this.orientation=="vertical"?(this.showXAxisGrid=!1,this.centerXAxisLabels=
this.showYAxisGrid=!0,this.centerYAxisLabels=!1,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisGrid=!0,this.centerXAxisLabels=this.showYAxisGrid=!1,this.centerYAxisLabels=!0,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};ia.Plot=function(a){ia.Plot.baseConstructor.call(this,a)};ia.extend(ia.ChartBase,ia.Plot);
ia.Plot.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=Infinity,d=-Infinity,e=this.getLayers(),f=0;f<e.length;f++){var g=e[f];g.update();a=Math.min(a,g.xMinValue);b=Math.max(b,g.xMaxValue);c=Math.min(c,g.yMinValue);d=Math.max(d,g.yMaxValue)}if(this.fixedMinValueX!=void 0)a=this.fixedMinValueX;if(this.fixedMaxValueX!=void 0)b=this.fixedMaxValueX;if(this.fixedMinValueY!=void 0)c=this.fixedMinValueY;if(this.fixedMaxValueY!=void 0)d=this.fixedMaxValueY;a==b&&(b<0?b=0:a=0);c==
d&&(d<0?d=0:c=0);if(a==Infinity||b==-Infinity)a=0,b=100;if(c==Infinity||d==-Infinity)c=0,d=100;this.renderAxes(a,b,c,d);for(f=0;f<e.length;f++)e[f].render()};ia.RadarChart=function(a){ia.RadarChart.baseConstructor.call(this,a);this.radarPadding=60;this.radarCenterY=this.radarCenterX=this.radarRadius=0;this.startAxisFromZero=!1;this.type="radar"};ia.extend(ia.ChartBase,ia.RadarChart);
ia.RadarChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();a=Math.min(a,e.minValue);b=Math.max(b,e.maxValue)}if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.startAxisFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);this.renderAxes(a,b);for(d=0;d<c.length;d++)c[d].render()};
ia.RadarChart.prototype.renderAxes=function(a,b){if(ia.isNumber(a)&&ia.isNumber(b)&&this.canvas.width>0&&this.canvas.height>0&&this.xAxisLabels){var c="Verdana",d="#AAAAAA",e=10,f="#E5E5E5";this.container.css("font-family")&&(c=this.container.css("font-family"));this.container.css("color")&&(d=ia.Color.toHex(this.container.css("color")));this.container.css("font-size")&&(e=this.container.css("font-size"),e.indexOf("px")>-1&&(e=e.substring(0,e.indexOf("px"))),e=ia.parseInt(e));this.container.css("borderRightColor")&&
(f=ia.Color.toHex(this.container.css("borderRightColor")));this.radarRadius=Math.min(this.canvasWidth,this.canvasHeight)/2-this.radarPadding;this.radarCenterX=this.canvasWidth/2;this.radarCenterY=this.canvasHeight/2;this.context.lineWidth=1;this.context.strokeStyle=f;this.context.font=""+e+"px "+c;this.context.fillStyle=d;var c=e+2,e=this.radarRadius,g=this._getYAxisLabels(a,b,5,e,c+6);this.context.textAlign="right";this.context.textBaseline="middle";var d=g.length,h=this.radarCenterX-3,i,k,j;k=e/
(d-1);j=i=this.radarCenterY-this.radarRadius;for(e=0;e<d;e++)f=g[e],this.context.textBaseline="top",this.context.fillText(f,h,i),f=this.radarCenterY-Math.floor(j),this.context.beginPath(),ia.Shape.drawCircle(this.context,this.radarCenterX,this.radarCenterY,f*2),this.context.stroke(),i+=k,j+=k;g=1.5*Math.PI;d=this.xAxisLabels.length;h=Math.PI*2*(1/d);for(e=0;e<d;e++){i=this.radarCenterX+this.radarRadius*Math.cos(g);k=this.radarCenterY+this.radarRadius*Math.sin(g);this.context.beginPath();this.context.moveTo(this.radarCenterX,
this.radarCenterY);this.context.lineTo(i,k);this.context.stroke();f=this.xAxisLabels[e];j=this._getLabelWidth(f,3);var m;this.type=="rose"&&(i=this.radarCenterX+this.radarRadius*Math.cos(g+h/2),k=this.radarCenterY+this.radarRadius*Math.sin(g+h/2));i<this.radarCenterX+2&&i>this.radarCenterX-2?(this.context.textAlign="center",m=this.canvas.width,k<this.radarCenterY?k-=3:k+=3):i>this.radarCenterX?(this.context.textAlign="left",i+=3,m=this.canvas.width-i):(this.context.textAlign="right",i-=3,m=i);this.context.textBaseline=
k<this.radarCenterY+2&&k>this.radarCenterY-2?"middle":k<this.radarCenterY?"bottom":"top";m=Math.min(m,this.radarRadius);j>m?this._wrapText(f,i,k,m,c,this.context.textBaseline):this.context.fillText(f,i,k);g+=h}}};ia.StackedTimeChart=function(a){ia.StackedTimeChart.baseConstructor.call(this,a);this.drawBarsFromZero=!1};ia.extend(ia.ChartBase,ia.StackedTimeChart);
ia.StackedTimeChart.prototype.render=function(){this.clear();for(var a=Infinity,b=-Infinity,c=this.getLayers(),d=0;d<c.length;d++){var e=c[d];e.update();e.getVisible()==!0&&(a=Math.min(a,e.minValue),b=Math.max(b,e.maxValue))}b>100&&b<101&&(b=100);if(this.fixedMinValue!=void 0)a=this.fixedMinValue;if(this.fixedMaxValue!=void 0)b=this.fixedMaxValue;this.drawBarsFromZero&&(b<0&&(b=0),a>0&&(a=0));a==b&&(b<0?b=0:a=0);if(a==Infinity||b==-Infinity)a=0,b=100;a==b&&(b=a,a=b-1,b+=1);d=this.getBBox();this.orientation==
"vertical"?(this.showXAxisGrid=!1,this.centerXAxisLabels=this.showYAxisGrid=!0,this.centerYAxisLabels=!1,this.renderAxes(d.getXMin(),d.getXMax(),a,b)):(this.showXAxisGrid=!0,this.centerXAxisLabels=this.showYAxisGrid=!1,this.centerYAxisLabels=!0,this.renderAxes(a,b,d.getYMin(),d.getYMax()));for(d=0;d<c.length;d++)c[d].render()};
ia.LayerBase=function(){ia.LayerBase.baseConstructor.call(this);this.isLoaded=this.showInLayerList=this._mapMouseEventListenersAdded=this._visible=!1;this.exportable=!0;this.highlightable=this.interactive=!1;this.selectable=!0;this.showLabels=!1;this.showDataTips=!0};ia.extend(ia.EventDispatcher,ia.LayerBase);ia.LayerBase.prototype.loadSource=function(){this.isLoaded=!0;this.dispatchEvent(new ia.Event(ia.Event.LAYER_READY,this))};ia.LayerBase.prototype.getVisible=function(){return this._visible};
ia.LayerBase.prototype.setVisible=function(a){this._visible=a;this.map&&(this._visible?(this.addCanvases(),this.render()):this.removeCanvases());this.dispatchEvent(new ia.Event(ia.Event.LAYER_VISIBLE_CHANGED,this))};
ia.LayerBase.prototype.setMap=function(a,b){this.map=a;var c=this;this._canvasContainer=$j("<div>");b.append(this._canvasContainer);this.addMapMouseEventListeners();this._visible&&this.addCanvases();a.addEventListener(ia.Event.MAP_RESIZE,function(){var a=c.map.container.width(),b=c.map.container.height();if(c.canvas)c.canvas.width=a,c.canvas.height=b;if(c.selectionCanvas)c.selectionCanvas.width=a,c.selectionCanvas.height=b;if(c.highlightCanvas)c.highlightCanvas.width=a,c.highlightCanvas.height=b;
if(c.showLabels&&c.labelCanvas)c.labelCanvas.width=a,c.labelCanvas.height=b},this)};ia.LayerBase.prototype.commitChanges=function(){this.addMapMouseEventListeners();this.addCanvases()};
ia.LayerBase.prototype.addCanvases=function(){var a=this.map.container.width(),b=this.map.container.height();if(this.canvas==void 0)this.canvas=this.createCanvas(this._canvasContainer),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b;this.interactive||this.highlightable?(this.selectionCanvas==void 0&&this.addSelectionCanvas(),this.highlightCanvas==void 0&&this.addHighlightCanvas()):(this.removeHighlightCanvas(),this.removeSelectionCanvas());this.showLabels&&this.labelCanvas==
void 0?this.addLabelCanvas():this.removeLabelCanvas()};
ia.LayerBase.prototype.addMapMouseEventListeners=function(){if(!this._mapMouseEventListenersAdded&(this.interactive||this.showDataTips))this._mapMouseEventListenersAdded=!0,this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_MOVE,this._mapEventHandler.bind(this),this),this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OVER,this._mapEventHandler.bind(this),this),this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OUT,this._mapEventHandler.bind(this),this),this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_WHEEL_END,
this._mapEventHandler.bind(this),this),this.selectable&&(this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_CLICK,this._mapEventHandler.bind(this),this),this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DOWN,this._mapEventHandler.bind(this),this),this.map.addEventListener(ia.MapMouseEvent.MAP_MOUSE_UP,this._mapEventHandler.bind(this),this))};
ia.LayerBase.prototype.removeCanvases=function(){if(this.canvas!=void 0)$j(this.canvas).remove(),this._heatmap=this.canvas=void 0;if(this.selectionCanvas!=void 0)$j(this.selectionCanvas).remove(),this.selectionCanvas=void 0;if(this.highlightCanvas!=void 0)$j(this.highlightCanvas).remove(),this.highlightCanvas=void 0;if(this.labelCanvas!=void 0)$j(this.labelCanvas).remove(),this.labelCanvas=void 0};
ia.LayerBase.prototype.addSelectionCanvas=function(){this.selectionCanvas=this.createCanvas(this.map.foregroundContainer);this.selectionContext=this.selectionCanvas.getContext("2d");this.selectionCanvas.width=this.map.container.width();this.selectionCanvas.height=this.map.container.height()};ia.LayerBase.prototype.removeSelectionCanvas=function(){if(this.selectionCanvas!=void 0)$j(this.selectionCanvas).remove(),this.selectionCanvas=void 0};
ia.LayerBase.prototype.addHighlightCanvas=function(){this.highlightCanvas=this.createCanvas(this.map.foregroundContainer);this.highlightContext=this.highlightCanvas.getContext("2d");this.highlightCanvas.width=this.map.container.width();this.highlightCanvas.height=this.map.container.height()};ia.LayerBase.prototype.removeHighlightCanvas=function(){if(this.highlightCanvas!=void 0)$j(this.highlightCanvas).remove(),this.highlightCanvas=void 0};
ia.LayerBase.prototype.addLabelCanvas=function(){this.labelCanvas=this.createCanvas(this._canvasContainer);this.labelContext=this.labelCanvas.getContext("2d");this.labelCanvas.width=this.map.container.width();this.labelCanvas.height=this.map.container.height();this._setLabelStyle()};ia.LayerBase.prototype.removeLabelCanvas=function(){if(this.labelCanvas!=void 0)$j(this.labelCanvas).remove(),this.labelCanvas=void 0};ia.LayerBase.prototype._mapEventHandler=function(){};
ia.LayerBase.prototype.createCanvas=function(a){var b=document.createElement("canvas");b.width=a.width();b.height=a.height();$j(b).css({position:"absolute",left:0,top:0});a.append($j(b));return b};ia.LayerBase.prototype.render=function(){};ia.LayerBase.prototype.clear=function(){this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};
ia.ItemEvent=function(a,b,c,d,e,f,g,h,i){ia.ItemEvent.baseConstructor.call(this,a,b);this.item=b;this.x=d;this.y=e;this.dataX=f;this.dataY=g;this.pageX=h;this.pageY=i;this.isTouchEvent=c&&c.mouseEvent.originalEvent?c.mouseEvent.originalEvent.touches!=void 0?!0:!1:!1};ia.extend(ia.Event,ia.ItemEvent);ia.ItemEvent.NONE_ITEM_CLICK="noneItemClick";ia.ItemEvent.ITEM_CLICK="itemClick";ia.ItemEvent.ITEM_MOUSE_DOWN="itemMouseDown";ia.ItemEvent.ITEM_MOUSE_UP="itemMouseUp";ia.ItemEvent.ITEM_MOUSE_MOVE="itemMouseMove";
ia.ItemEvent.ITEM_MOUSE_OVER="itemMouseOver";ia.ItemEvent.ITEM_MOUSE_OUT="itemMouseOut";ia.ItemLayer=function(){ia.ItemLayer.baseConstructor.call(this);this._data={};this._rollOverItem=void 0;this._redrawSelectionTimeout=null;this.items={};this.itemArray=[];this.doHitTest=!0;this.style={fillStyle:"#ffffff",strokeStyle:"#bbbbbb",lineWidth:"1",lineJoin:"round"};this.selectionColor="#ff0000";this.highlightColor="#00ff00";this.selectionIds=[];this.dataField="value";this.dataChanged=!1;this.tip=""};
ia.extend(ia.LayerBase,ia.ItemLayer);ia.ItemLayer.SELECTED="selected";ia.ItemLayer.ROLLOVER_SELECTED="rollOverSelected";ia.ItemLayer.ROLLOVER="rollOver";ia.ItemLayer.UNSELECTED="unselected";ia.ItemLayer.prototype.getData=function(){return this._data};ia.ItemLayer.prototype.setData=function(a){this._data=a;this.dataChanged=!0};
ia.ItemLayer.prototype._setLabelStyle=function(){var a="Verdana",b=10,c="normal",d="#ffffff",e="#333333";this.map.labelStyle&&(this.map.labelStyle.css("font-family")&&(a=this.map.labelStyle.css("font-family")),this.map.labelStyle.css("color")&&(d=ia.Color.toHex(this.map.labelStyle.css("color"))),this.map.labelStyle.css("font-weight")&&(c=this.map.labelStyle.css("font-weight")),this.map.labelStyle.css("font-size")&&(b=this.map.labelStyle.css("font-size"),b.indexOf("px")>-1&&(b=b.substring(0,b.indexOf("px"))),
b=ia.parseInt(b)),this.map.labelStyle.css("borderRightColor")&&(e=ia.Color.toHex(this.map.labelStyle.css("borderRightColor"))));this.labelContext.font=c+" "+b+"px "+a;this.labelContext.lineWidth=2;this.labelContext.strokeStyle=e;this.labelContext.fillStyle=d};ia.ItemLayer.prototype.getItem=function(a){return this.items[a]};ia.ItemLayer.prototype.clearItems=function(){for(var a in this.items)delete this.items[a]};
ia.ItemLayer.prototype._mapEventHandler=function(a){a.type==ia.MapMouseEvent.MAP_MOUSE_OVER?this.doHitTest=!0:a.type==ia.MapMouseEvent.MAP_MOUSE_OUT?(this._hitTest(a),this.doHitTest=!1):(this.doHitTest||a.isTouchEvent)&&this._hitTest(a)};
ia.ItemLayer.prototype._hitTest=function(a){if((this.showDataTips||this.interactive)&&this.getVisible()){var b=a.type;if(b==ia.MapMouseEvent.MAP_MOUSE_MOVE||b==ia.MapMouseEvent.MAP_MOUSE_DOWN){for(var b=[],c=this.itemArray.length-1;c>=0;c--){var d=this.itemArray[c];d.disabled!=!0&&this.hitItem(d,a)&&(b[b.length]=d)}if(b.length>0)b[0].size&&b.sort(function(a,b){return a.size<b.size?-1:a.size>b.size?1:0}),d=b[0],this._rollOverItem&&d!=this._rollOverItem&&this._dispatchItemEvent(a,!1,this._rollOverItem),
this._rollOverItem=d,this._dispatchItemEvent(a,!0,this._rollOverItem);else if(this._rollOverItem)this._dispatchItemEvent(a,!1,this._rollOverItem),this._rollOverItem=null}else this._rollOverItem!=null?this._dispatchItemEvent(a,!0,this._rollOverItem):b==ia.MapMouseEvent.MAP_MOUSE_CLICK&&(ia.IS_TOUCH_DEVICE||this.dispatchEvent(new ia.ItemEvent(ia.ItemEvent.NONE_ITEM_CLICK,{parent:this},a)))}};ia.ItemLayer.prototype.hitItem=function(){return!1};
ia.ItemLayer.prototype._dispatchItemEvent=function(a,b,c){var d=c.state,e=a.type,f;if(b)if(e==ia.MapMouseEvent.MAP_MOUSE_MOVE)f=d==ia.ItemLayer.ROLLOVER||d==ia.ItemLayer.ROLLOVER_SELECTED?ia.ItemEvent.ITEM_MOUSE_MOVE:ia.ItemEvent.ITEM_MOUSE_OVER;else if(e==ia.MapMouseEvent.MAP_MOUSE_CLICK)f=ia.ItemEvent.ITEM_CLICK;else if(e==ia.MapMouseEvent.MAP_MOUSE_UP)f=ia.ItemEvent.ITEM_MOUSE_UP;else if(e==ia.MapMouseEvent.MAP_MOUSE_DOWN)f=ia.ItemEvent.ITEM_MOUSE_DOWN;else if(e==ia.MapMouseEvent.MAP_MOUSE_OUT)if(d==
ia.ItemLayer.ROLLOVER)f=ia.ItemEvent.ITEM_MOUSE_OUT;else{if(d==ia.ItemLayer.ROLLOVER_SELECTED)f=ia.ItemEvent.ITEM_MOUSE_OUT}else{if(e==ia.MapMouseEvent.MAP_MOUSE_WHEEL_END)f=ia.ItemEvent.ITEM_MOUSE_OVER}else if(e==ia.MapMouseEvent.MAP_MOUSE_MOVE&&(d==ia.ItemLayer.ROLLOVER||d==ia.ItemLayer.ROLLOVER_SELECTED))f=ia.ItemEvent.ITEM_MOUSE_OUT;if(f==ia.ItemEvent.ITEM_MOUSE_OVER)if(d==ia.ItemLayer.UNSELECTED)c.state=ia.ItemLayer.ROLLOVER;else{if(d==ia.ItemLayer.SELECTED)c.state=ia.ItemLayer.ROLLOVER_SELECTED}else if(f==
ia.ItemEvent.ITEM_CLICK)c.state=d==ia.ItemLayer.ROLLOVER_SELECTED||d==ia.ItemLayer.SELECTED?ia.ItemLayer.UNSELECTED:ia.ItemLayer.ROLLOVER_SELECTED;else if(f==ia.ItemEvent.ITEM_MOUSE_OUT)if(d==ia.ItemLayer.ROLLOVER)c.state=ia.ItemLayer.UNSELECTED;else if(d==ia.ItemLayer.ROLLOVER_SELECTED)c.state=ia.ItemLayer.SELECTED;a=new ia.ItemEvent(f,c,a,a.x,a.y,a.dataX,a.dataY,a.pageX,a.pageY);this._itemEventHandler(a);f!=null&&this.dispatchEvent(a)};
ia.ItemLayer.prototype._itemEventHandler=function(a){var b=a.item;this.interactive&&(a.type==ia.ItemEvent.ITEM_MOUSE_OVER?(ia.showPointerCursor(),this.clearHighlight(),this.highlightItem(b,this.highlightContext)):a.type==ia.ItemEvent.ITEM_MOUSE_DOWN&&a.isTouchEvent&&(this.clearHighlight(),this.highlightItem(b,this.highlightContext)),a.type==ia.ItemEvent.ITEM_CLICK?(b.state==ia.ItemLayer.UNSELECTED?(this._removeFromSelection(b.id),this.renderSelection()):(this._addToSelection(b.id),this.selectItem(b)),
this.clearHighlight()):a.type==ia.ItemEvent.ITEM_MOUSE_OUT?(ia.showDefaultCursor(),this.clearHighlight()):a.type==ia.ItemEvent.ITEM_MOUSE_UP?this.clearHighlight():a.type==ia.ItemEvent.NONE_ITEM_CLICK&&this.clearSelection());this.showDataTips&&(a.type==ia.ItemEvent.ITEM_MOUSE_OVER?(ia.showPointerCursor(),this.showTip(b,a)):a.type==ia.ItemEvent.ITEM_MOUSE_DOWN?a.isTouchEvent&&this.showTip(b,a):a.type==ia.ItemEvent.ITEM_MOUSE_MOVE?a.isTouchEvent||this.showTip(b,a):a.type==ia.ItemEvent.ITEM_MOUSE_OUT?
(ia.showDefaultCursor(),a.isTouchEvent||this.hideTip()):a.type==ia.ItemEvent.ITEM_MOUSE_UP?this.hideTip():a.type==ia.ItemEvent.ITEM_CLICK&&this.hideTip())};ia.ItemLayer.prototype.tipFunction=function(a){return a.name};ia.ItemLayer.prototype.showTip=function(){};ia.ItemLayer.prototype.hideTip=function(){this.map.datatip.hide()};ia.ItemLayer.prototype._removeFromSelection=function(a){a=this.selectionIds.indexOf(a);a!=-1&&this.selectionIds.splice(a,1)};
ia.ItemLayer.prototype._addToSelection=function(a){this.selectionIds.indexOf(a)==-1&&this.selectionIds.push(a)};ia.ItemLayer.prototype.isSelected=function(a){return this.selectionIds.indexOf(a)!=-1?!0:!1};ia.ItemLayer.prototype.selectAll=function(){this.clearSelection();for(var a in this.items)this.select(a)};ia.ItemLayer.prototype.select=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.SELECTED,this._addToSelection(a),this.selectItem(b)};
ia.ItemLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,this._removeFromSelection(a),this._triggerRenderSelection()};ia.ItemLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._clearSelectionGraphics()};
ia.ItemLayer.prototype._triggerRenderSelection=function(){if(!this._redrawSelectionTimeout)this._redrawSelectionTimeout=setTimeout(function(){this.renderSelection()}.bind(this),5)};ia.ItemLayer.prototype.renderSelection=function(){this._redrawSelectionTimeout=null;this._clearSelectionGraphics();for(var a=this.selectionIds.length,b=0;b<a;b++){var c=this.items[this.selectionIds[b]];c&&this.selectItem(c)}};ia.ItemLayer.prototype.selectItem=function(){};
ia.ItemLayer.prototype.highlight=function(a){(a=this.getItem(a))&&this.highlightItem(a)};ia.ItemLayer.prototype.clearHighlight=function(){this._clearHighlightGraphics()};ia.ItemLayer.prototype.highlightItem=function(){};ia.ItemLayer.prototype.clear=function(){this.hideTip();this._rollOverItem=null;this._clearHighlightGraphics();this._clearSelectionGraphics();this._clearLayerGraphics();this._clearLabelGraphics()};ia.ItemLayer.prototype._clearCanvas=function(a,b){a&&b.clearRect(0,0,a.width,a.height)};
ia.ItemLayer.prototype._clearHighlightGraphics=function(){(this.showDataTips||this.interactive||this.highlightable)&&this._clearCanvas(this.highlightCanvas,this.highlightContext)};ia.ItemLayer.prototype._clearSelectionGraphics=function(){(this.showDataTips||this.interactive||this.highlightable)&&this._clearCanvas(this.selectionCanvas,this.selectionContext)};
ia.ItemLayer.prototype._clearLabelGraphics=function(){this.showLabels&&this.labelCanvas&&(this._clearCanvas(this.labelCanvas,this.labelContext),this._setLabelStyle())};ia.ItemLayer.prototype._clearLayerGraphics=function(){this._clearCanvas(this.canvas,this.context)};
ia.TimeLayer=function(){ia.TimeLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.dropDates=[];this.selectedDate="";this.drawLinesThroughMissingValues=!0;this.highlightSelectedDate=this.matchAxisToSelectedData=!1;this.dashWidth=12;this.gapWidthAsProportionOfDashWidth=0.3;this.dashedLineThicknessAsProportionOfSolidLine=0.6;this.associateNames={};this.dataFields=[];this.thematic=new ia.Thematic;this.thematic.setDataType(ia.Thematic.CATEGORIC);
this.thematic.setDataField("value");this._highlightMode=!1};ia.extend(ia.ItemLayer,ia.TimeLayer);ia.TimeLayer.prototype.markerSize=7;
ia.TimeLayer.prototype.update=function(){if(this.dataFields.length>0)this.update_multi();else if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){var b=this,c=a.dates.filter(function(a){return b.dropDates.indexOf(a)<0}),d=a[c[0]],e=c.length,f;for(f in d){var g=d[f],h={};h.id=g.id;h.name=g.name;h.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(h.id)!=-1)h.state=ia.ItemLayer.SELECTED;h.parent=this;
h.layer=this;this.items[g.id]=h;this.itemArray.push(h);h.childItems=[];for(var i=0;i<e;i++){var k=c[i],g=a[k][f],j=g[this.dataField];if(ia.isNumber(j)){var m={},n;for(n in g)m[n]=g[n];m.id=f+"~"+k;m.name=k;m.shape=new ia.Rectangle;m.hitArea=new ia.Rectangle;m.value=j;m.formattedValue=g[this.dataField+"_formatted"];if(this.isComparison){if(this.selectionIds.indexOf(h.id)!=-1)this.minValue=Math.min(this.minValue,j),this.maxValue=Math.max(this.maxValue,j),h.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=
Math.min(this.minValue,j),this.maxValue=Math.max(this.maxValue,j)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&h.state==ia.ItemLayer.SELECTED)this.minValue=Math.min(this.minValue,m.value),this.maxValue=Math.max(this.maxValue,m.value);h.childItems[h.childItems.length]=m}else h.childItems[h.childItems.length]={name:k,value:void 0}}}}this.dataChanged=!1}};
ia.TimeLayer.prototype.render=function(){if(this.dataFields.length>0)this.render_multi();else{this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);this.selectionContext.strokeStyle=ia.Color.toRGBA(this.selectionColor);a=this.itemArray.length;for(var b=0;b<a;b++)for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];
f.value!=void 0&&this._setItemShape(f,e,d)}if(this.highlightSelectedDate&&(a=this.getData(),a.dates)){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var g=this,b=a.dates.filter(function(a){return g.dropDates.indexOf(a)<0}),c=b.indexOf(this.selectedDate);if(c!=-1)this.map.orientation=="vertical"?(a=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,d=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(a=this.map.canvasX,c=this.map.canvasY+
c/b.length*this.map.canvasHeight,d=this.map.canvasWidth,b=this.map.canvasHeight/b.length),this.context.beginPath(),this.context.rect(a,c,d,b),this.context.fill()}this.renderSelection()}};
ia.TimeLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical"){var d=this.map.canvasX,e=this.map.canvasWidth;if(this.map.centerXAxisLabels)var f=this.map.canvasWidth/(c*2),d=this.map.canvasX+f,e=this.map.canvasWidth-f*2;d=c==1?d:d+b/(c-1)*e;b=this.map.getPixelY(a.value)}else e=this.map.canvasY,f=this.map.canvasHeight,this.map.centerYAxisLabels&&(f=this.map.canvasHeight/(c*2),e=this.map.canvasY+f,f=this.map.canvasHeight-f*2),d=this.map.getPixelX(a.value),b=c==1?e:e+b/(c-
1)*f;e=c=this.markerSize;a.shape.x=d;a.shape.y=b;a.shape.width=c;a.shape.height=e;ia.IS_TOUCH_DEVICE?e=c=30:(c*=2,e*=2);a.hitArea.x=d-c/2;a.hitArea.y=b-e/2;a.hitArea.width=c;a.hitArea.height=e};ia.TimeLayer.prototype.selectItem=function(a){var b=this.selectionIds.length;if(this.colorPalette){var b=this.colorPalette.getColors(b),c=this.selectionIds.indexOf(a.id);this.selectionContext.strokeStyle=b[c]}this._highlightMode=!1;this._drawItem(a,this.selectionContext)};
ia.TimeLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._highlightMode=!0;this._drawItem(a,this.highlightContext)};
ia.TimeLayer.prototype._drawItem=function(a,b){if(this.dataFields.length>0)this._drawItem_multi(a,b);else{var c=!0,d=a.childItems.length;b.beginPath();for(var e=0;e<d;e++){var f=a.childItems[e];f.value!=void 0?(c?b.moveTo(f.shape.x,f.shape.y):b.lineTo(f.shape.x,f.shape.y),c=!1):this.drawLinesThroughMissingValues!=!0&&(c=!0);if(this.map.animationMode&&f.name==this.selectedDate)break}b.stroke();for(e=0;e<d;e++)if(f=a.childItems[e],f.value!=void 0&&(b.beginPath(),ia.Shape.drawCircle(b,f.shape.x,f.shape.y,
f.shape.width),b.fill(),b.stroke()),this.map.animationMode&&f.name==this.selectedDate)break}};ia.TimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};ia.TimeLayer.prototype.tipFunction=void 0;
ia.TimeLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){if(this.tipFunction!=void 0)this.map.datatip.text(this.tipFunction(a,e));else if(this.tip!=""){var c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${date}").join(e.name),c=c.split("${value}").join(e.formattedValue),c=e.associateName!=void 0?c.split("${associateName}").join(e.associateLabel):c.split("${associateName}").join(""),c=e.associateLabel!=
void 0?c.split("${lineLabel}").join(e.associateLabel):c.split("${lineLabel}").join(""),f;for(f in e)c=c.split("${"+f+"}").join(e[f+"_formatted"]);this.map.datatip.text(c)}else this.map.datatip.text(a.name+" : "+e.name+" : "+e.formattedValue);b.isTouchEvent?(f=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+30)):(f=e.shape.x+e.shape.width/2-this.map.datatip.getWidth()/2,e=e.shape.y-e.shape.height/2-(this.map.datatip.getHeight()+5));this.map.datatip.position(f,e);this.map.datatip.show();
break}}};
ia.TimeLayer.prototype.update_multi=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){var b=this,c=a.dates.filter(function(a){return b.dropDates.indexOf(a)<0}),d=a[c[0]],e=c.length,f;for(f in d){var g=d[f],h={};h.id=g.id;h.name=g.name;h.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(h.id)!=-1)h.state=ia.ItemLayer.SELECTED;h.parent=this;h.layer=this;this.items[g.id]=h;this.itemArray.push(h);h.childItems=
[];for(var i=0;i<this.dataFields.length;i++)for(var k=this.dataFields[i],j=0;j<e;j++){var m=c[j],g=a[m][f],n=g[k];if(ia.isNumber(n)){var l={},o;for(o in g)l[o]=g[o];l.id=f+"~"+m+"~"+k;l.name=m;l.associateName=k;l.associateLabel=this.associateNames[k]||k;var q=this.thematic.categoricClassifier.getClass(k);if(q)l.color=q.color;l.date=m;l.shape=new ia.Rectangle;l.hitArea=new ia.Rectangle;l.value=n;l.formattedValue=g[k+"_formatted"];l.dataField=k;if(this.isComparison){if(this.selectionIds.indexOf(h.id)!=
-1)this.minValue=Math.min(this.minValue,n),this.maxValue=Math.max(this.maxValue,n),h.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,n),this.maxValue=Math.max(this.maxValue,n)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&h.state==ia.ItemLayer.SELECTED)this.minValue=Math.min(this.minValue,l.value),this.maxValue=Math.max(this.maxValue,l.value);h.childItems[h.childItems.length]=l}else h.childItems[h.childItems.length]={name:m,value:void 0,
dataField:k}}}}this.dataChanged=!1}};
ia.TimeLayer.prototype.render_multi=function(){var a=this,b=this.getData().dates.filter(function(b){return a.dropDates.indexOf(b)<0});this.clear();for(var c in this.style)this.context[c]=this.style[c],this.selectionContext[c]=this.style[c],this.highlightContext[c]=this.style[c];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);this.selectionContext.strokeStyle=ia.Color.toRGBA(this.selectionColor);for(var d=this.itemArray.length,e=0;e<d;e++){var f=this.itemArray[e];c=0;for(var g=
f.childItems.length,h=void 0,i=0;i<g;i++){var k=f.childItems[i];k.dataField!=h?(c=0,h=k.dataField):c++;k.value!=void 0&&this._setItemShape(k,c,b.length)}}if(this.highlightSelectedDate&&b&&b.length>0&&(this.context.fillStyle=ia.Color.toRGBA("#cccccc",0.2),this.context.lineWidth=0,c=b.indexOf(this.selectedDate),c!=-1))this.map.orientation=="vertical"?(d=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,e=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(d=this.map.canvasX,c=
this.map.canvasY+c/b.length*this.map.canvasHeight,e=this.map.canvasWidth,b=this.map.canvasHeight/b.length),this.context.beginPath(),this.context.rect(d,c,e,b),this.context.fill();this.renderSelection()};
ia.TimeLayer.prototype._drawItem_multi=function(a,b){if(a.childItems.length>0){var c=this.dashWidth;c+=c/(this.dataFields.length-1);var d=this.style.lineWidth,e=this,c=this.getData().dates.filter(function(a){return e.dropDates.indexOf(a)<0}).length,f=[],g,h,i=0;g=0;for(h=a.childItems.length;g<h;g+=c)f[i]=a.childItems.slice(g,g+c),i++;var k=-1,j=function(){k++;if(k<f.length){for(var a=f[k],c=0;c<a.length;c++){var g=a[c].color;if(g!=void 0)break}b.strokeStyle=g;e._highlightMode?e._drawLine_multi(a,
b,5,d*0.65,j):e._drawLine_multi(a,b,0,d,j)}};j()}};
ia.TimeLayer.prototype._drawLine_multi=function(a,b,c,d,e){var f=a.length;if(f>0){var g=!0,h,i,k=c*this.gapWidthAsProportionOfDashWidth;b.beginPath();b.lineWidth=d;for(d=0;d<f;d++){var j=a[d];j.value!=void 0?(g?b.moveTo(j.shape.x,j.shape.y):c!=0?b.dashedLine(h,i,j.shape.x,j.shape.y,c,k):b.lineTo(j.shape.x,j.shape.y),g=!1,h=j.shape.x,i=j.shape.y):this.drawLinesThroughMissingValues!=!0&&(g=!0);if(this.map.animationMode&&j.date==this.selectedDate)break}b.stroke();for(d=0;d<f;d++)if(j=a[d],j.value!=void 0&&
(b.beginPath(),ia.Shape.drawCircle(b,j.shape.x,j.shape.y,j.shape.width),b.fill(),b.stroke()),this.map.animationMode&&j.date==this.selectedDate)break;b.lineWidth=this.style.lineWidth;e.call(null)}};ia.BarLayer=function(){ia.BarLayer.baseConstructor.call(this);this._maxBarWidth=20;this._barSize=this._minBarWidthForStroke=10;this.sortDirection="ascending"};ia.extend(ia.ItemLayer,ia.BarLayer);
ia.BarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b],d=c[this.dataField];if(ia.isNumber(d)){this.minValue=Math.min(this.minValue,d);this.maxValue=Math.max(this.maxValue,d);var e={};e.id=c.id;e.name=c.name;e.color=c.color;e.value=d;e.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(e.id)!=-1)e.state=ia.ItemLayer.SELECTED;e.parent=this;e.layer=
this;e.rect=new ia.Rectangle;e.hitArea=new ia.Rectangle;this.items[b]=e;this.itemArray.push(e);if(c.upperLimit&&c.lowerLimit&&ia.isNumber(c.upperLimit)&&ia.isNumber(c.lowerLimit))e.upperLimit=c.upperLimit,e.lowerLimit=c.lowerLimit,this.maxValue=Math.max(this.maxValue,e.upperLimit),this.minValue=Math.min(this.minValue,e.lowerLimit)}}if(this.sortDirection!=void 0){var f;f=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return parseFloat(a.value)<parseFloat(b.value)?-f:parseFloat(a.value)>
parseFloat(b.value)?f:0})}this.dataChanged=!1}};
ia.BarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.orientation==
"vertical"?this.map.canvasWidth/a:this.map.canvasHeight/a;this._barSize>=this._minBarWidthForStroke?(this.selectionContext.fillStyle="rgba(0, 0, 0, 0)",this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3)):(this.selectionContext.fillStyle=ia.Color.toRGBA(this.selectionColor),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor));for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}this.context.strokeStyle=this.map.limitsColor;
this.context.lineWidth=this.map.limitsWidth;this.context.beginPath();for(b=0;b<a;b++)this._drawLimit(this.itemArray[b],this.context);this.context.stroke();this.renderSelection()};
ia.BarLayer.prototype._setItemShape=function(a,b){if(this.map.orientation=="vertical"){var c=this.itemArray.length,d,e;this.map.getBBox().getYMin()<0?(d=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),e=this.map.getPixelHeight(Math.abs(a.value))):(d=this.map.getPixelY(a.value),e=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(d=this.map.canvasY+this.map.canvasHeight,e-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));
if(a.value>this.map.getBBox().getYMax())d=this.map.canvasY,e-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());a.rect.y=d;a.rect.height=e;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth;a.rect.width=this.map.canvasWidth/c;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;if(a.upperLimit&&a.lowerLimit)a.ul={},a.ll={},a.ul.x=a.rect.x+a.rect.width/2,a.ul.y=this.map.getPixelY(a.upperLimit),a.ll.x=a.rect.x+a.rect.width/
2,a.ll.y=this.map.getPixelY(a.lowerLimit);a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else{c=this.itemArray.length;this.map.getBBox().getXMin()<0?(d=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),e=this.map.getPixelWidth(Math.abs(a.value))):(d=this.map.getPixelX(this.map.getBBox().getXMin()),e=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));
if(a.value<this.map.getBBox().getXMin())d=this.map.canvasX,e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=d;a.rect.width=e;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight;a.rect.height=this.map.canvasHeight/c;a.hitArea.x=this.map.canvasX;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth;a.hitArea.height=a.rect.height;
if(a.upperLimit&&a.lowerLimit)a.ul={},a.ll={},a.ul.x=this.map.getPixelX(a.upperLimit),a.ul.y=a.rect.y+a.rect.height/2,a.ll.x=this.map.getPixelX(a.lowerLimit),a.ll.y=a.rect.y+a.rect.height/2;a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<this._minBarWidthForStroke&&a.rect.height++}};ia.BarLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};
ia.BarLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.BarLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.BarLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=this._minBarWidthForStroke&&b.stroke()};
ia.BarLayer.prototype._drawLimit=function(a,b){a.ul&&a.ll&&(b.moveTo(a.ul.x,a.ul.y),b.lineTo(a.ll.x,a.ll.y),this._barSize>=this._minBarWidthForStroke&&(this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.ul.y),b.lineTo(a.rect.x+a.rect.width,a.ul.y),b.moveTo(a.rect.x,a.ll.y),b.lineTo(a.rect.x+a.rect.width,a.ll.y)):(b.moveTo(a.ul.x,a.rect.y),b.lineTo(a.ul.x,a.rect.y+a.rect.height),b.moveTo(a.ll.x,a.rect.y),b.lineTo(a.ll.x,a.rect.y+a.rect.height))))};
ia.BarLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.BarLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.value<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,
d);this.map.datatip.show()};ia.GridLayer=function(){ia.GridLayer.baseConstructor.call(this);this._noRows=7;this._noCols=53};ia.extend(ia.ItemLayer,ia.GridLayer);
ia.GridLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();ia.log(a);var b=[],c;for(c in a)b[b.length]=a[c];b.sort(function(a,b){return a.id-b.id});this.itemArray=[];this.clearItems();for(a=0;a<b.length;a++){var d=b[a];c=d.id;var e=d[this.dataField],f={};f.id=d.id;f.name=d.name;f.color=d.color;f.value=e;f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.rect=new ia.Rectangle;f.hitArea=
new ia.Rectangle;this.items[c]=f;this.itemArray.push(f)}this.dataChanged=!1}};
ia.GridLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";this.highlightContext.fillStyle=
ia.Color.toRGBA(this.highlightColor,0.3);for(var b=a=this.context.lineWidth=0,c=this.itemArray.length,d=0;d<c;d++){var e=this.itemArray[d];this._setItemShape(e,a,b);this._renderItem(e);a==this._noRows-1?(a=0,b++):a++}this.renderSelection()};
ia.GridLayer.prototype._setItemShape=function(a,b,c){var d=this.map.canvasWidth/this._noCols,c=this.map.canvasX+c*d,e=this.map.canvasHeight/this._noRows,b=this.map.canvasY+b*e;a.rect.width=d;a.rect.height=e;a.rect.x=c;a.rect.y=b;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height};ia.GridLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};
ia.GridLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.GridLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.GridLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();b.stroke()};ia.GridLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.GridLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.rect.y-this.map.datatip.getHeight()-5);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.PyramidLayer=function(){ia.PyramidLayer.baseConstructor.call(this);this._maxBarWidth=20;this._barSize=this._minBarWidthForStroke=10;this.sortDirection="ascending";this.gender="male"};ia.extend(ia.ItemLayer,ia.PyramidLayer);
ia.PyramidLayer.prototype.update=function(a){if(this.map){var b=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var c=0;c<b.length;c++){var d=b[c],e=d.features[0];if(e){var f=e[this.dataField];if(ia.isNumber(f))this.gender=="male"&&(f*=-1),this.minValue=Math.min(this.minValue,f),this.maxValue=Math.max(this.maxValue,f);if(a==void 0||d.date==a){var g={};g.id=e.id;g.name=e.name;g.ageGroup=d.name;g.value=ia.isNumber(f)?f:0;g.formattedValue=e[this.dataField+
"_formatted"];g.parent=this;g.layer=this;g.state=ia.ItemLayer.UNSELECTED;g.rect=new ia.Rectangle;g.hitArea=new ia.Rectangle;this.items[g.id]=g;this.itemArray.push(g)}}}this.itemArray.reverse()}};
ia.PyramidLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.canvasHeight/a;this.highlightContext.fillStyle=this._barSize>=this._minBarWidthForStroke?ia.Color.toRGBA(this.highlightColor,0.3):ia.Color.toRGBA(this.highlightColor);
for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}};
ia.PyramidLayer.prototype._setItemShape=function(a,b){var c=this.itemArray.length,d,e;this.map.getBBox().getXMin()<0?(d=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),e=this.map.getPixelWidth(Math.abs(a.value))):(d=this.map.getPixelX(this.map.getBBox().getXMin()),e=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())d=this.map.canvasX,e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>
this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=d;a.rect.width=e;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight;a.rect.height=this.map.canvasHeight/c;a.hitArea.x=this.gender=="male"?this.map.canvasX:a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth/2;a.hitArea.height=a.rect.height;a.rect.height<this._minBarWidthForStroke&&a.rect.height++};
ia.PyramidLayer.prototype._renderItem=function(a){this._drawItem(a,this.context)};ia.PyramidLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.PyramidLayer.prototype._drawItem=function(a,b){b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=this._minBarWidthForStroke&&b.stroke()};ia.PyramidLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.PyramidLayer.prototype.showTip=function(a,b){if(this.tip!=""){var c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${ageGroup}").join(a.ageGroup),c=c.split("${value}").join(a.formattedValue);this.map.datatip.text(c)}else this.map.datatip.text(a.name+" <br/> "+a.ageGroup+" <br/> "+a.formattedValue);var d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height/
2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,d);this.map.datatip.show()};ia.CountLayer=function(){ia.CountLayer.baseConstructor.call(this);this.isLegendComponent=!0};ia.extend(ia.BarLayer,ia.CountLayer);
ia.CountLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var a=this.thematic.getClasses(),b=0;b<a.length;b++){var c=a[b],d={};d.id=c.index;d.legendClass=c;d.color=c.color;d.value=c.items.length;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;d.label=c.getLabel()+" : "+d.value;d.rect=new ia.Rectangle;d.hitArea=
new ia.Rectangle;this.items[d.id]=d;this.itemArray.push(d);this.minValue=Math.min(this.minValue,d.value);this.maxValue=Math.max(this.maxValue,d.value)}if(this.sortDirection!=void 0){var e;e=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return a.value<b.value?-e:a.value>b.value?e:0})}this.dataChanged=!1}};
ia.CountLayer.prototype.showTip=function(a,b){this.map.datatip.text(a.label);var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width/2-this.map.datatip.getWidth()/2,d=a.value<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.value<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,
d);this.map.datatip.show()};ia.PieLayer=function(){ia.PieLayer.baseConstructor.call(this);this._piePadding=10;this._pieCenterY=this._pieCenterX=this._pieRadius=this._pieTotal=0;this.isLegendComponent=!0};ia.extend(ia.ItemLayer,ia.PieLayer);
ia.PieLayer.prototype.update=function(){this.itemArray=[];this.clearItems();for(var a=this.thematic.getClasses(),b=0;b<a.length;b++){var c=a[b],d={};d.id=c.index;d.legendClass=c;d.color=c.color;d.value=c.items.length;d.formattedValue=c.items.length;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;this.items[d.id]=d;this.itemArray.push(d)}};
ia.PieLayer.prototype.render=function(){this.clear();this._pieRadius=Math.min(this.map.canvasWidth,this.map.canvasHeight)/2-this._piePadding;this._pieCenterX=this.map.canvasWidth/2;this._pieCenterY=this.map.canvasHeight/2;for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+
1;this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3);this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=1.5*Math.PI;var b=0,c=this.itemArray.length;if(c==0)this.context.beginPath(),ia.Shape.drawCircle(this.context,this._pieCenterX,this._pieCenterY,this._pieRadius*2),this.context.stroke();else{for(var d=this._pieTotal=0;d<c;d++){var e=this.itemArray[d],b=parseFloat(e.value);b>0&&(this._pieTotal+=
b)}for(d=0;d<c;d++)if(e=this.itemArray[d],b=parseFloat(e.value),b>0){var f=ia.round(b/this._pieTotal*100,2);if(this.tip!=""){var g=this.tip,g=g.split("${name}").join(e.legendClass.getLabel()),g=g.split("${value}").join(e.formattedValue),g=g.split("${percentage}").join(f);e.label=g}else e.label=e.legendClass.getLabel()+" : "+f+"%";b=a+Math.PI*2*(b/this._pieTotal);e.startAngle=a;e.endAngle=b;e.angleSize=b-a;a=b;this._renderItem(e)}this.renderSelection()}};
ia.PieLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.PieLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.PieLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.PieLayer.prototype._drawItem=function(a,b){this._pieRadius>0&&(b.beginPath(),b.moveTo(this._pieCenterX,this._pieCenterY),b.arc(this._pieCenterX,this._pieCenterY,this._pieRadius,a.startAngle,a.endAngle,!1),b.lineTo(this._pieCenterX,this._pieCenterY),b.fill(),b.stroke())};ia.PieLayer.prototype.hitItem=function(a,b){return this._pointInSlice(a,b.x,b.y)};
ia.PieLayer.prototype._pointInSlice=function(a,b,c){var d=a.endAngle-a.startAngle,e=this._pieCenterX,f=this._pieCenterY;return this._pointInPoly([{x:e,y:f},{x:e+this._pieRadius*Math.cos(a.startAngle),y:f+this._pieRadius*Math.sin(a.startAngle)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/4),y:f+this._pieRadius*Math.sin(a.startAngle+d/4)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/2),y:f+this._pieRadius*Math.sin(a.startAngle+d/2)},{x:e+this._pieRadius*Math.cos(a.startAngle+d/1.5),y:f+this._pieRadius*
Math.sin(a.startAngle+d/1.5)},{x:e+this._pieRadius*Math.cos(a.startAngle+d),y:f+this._pieRadius*Math.sin(a.startAngle+d)},{x:e,y:f}],b,c)};ia.PieLayer.prototype._pointInPoly=function(a,b,c){var d,e,f=0;d=0;for(e=a.length-1;d<a.length;e=d++)a[d].y>c!=a[e].y>c&&b<(a[e].x-a[d].x)*(c-a[d].y)/(a[e].y-a[d].y)+a[d].x&&(f=!f);return f};
ia.PieLayer.prototype.showTip=function(a,b){this.map.datatip.text(a.label);var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=b.x/2,d=b.y-(this.map.datatip.getHeight()+5));this.map.datatip.position(c,d);this.map.datatip.show()};ia.AdvancedPieLayer=function(){ia.AdvancedPieLayer.baseConstructor.call(this)};ia.extend(ia.PieLayer,ia.AdvancedPieLayer);
ia.AdvancedPieLayer.prototype.update=function(){this.itemArray=[];this.clearItems();var a=this.getData();if(a&&this.itemId)if(a.dates)for(var b=a.dates.length,c=0;c<b;c++){var d=a.dates[c],e=a[d][this.itemId];if(e&&(this.itemName=e.name,d=this.thematic.getClass(d))){var f={};f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.id=d.index;f.legendClass=d;f.value=e.value;f.formattedValue=e.value_formatted;f.label=d.getLabel()+
" : "+f.value;f.color=d.color;this.items[f.id]=f;this.itemArray.push(f)}}else if(e=a[this.itemId]){this.itemName=e.name;a=this.thematic.getClasses();for(c=0;c<a.length;c++){d=a[c];b=d.value;f={};f.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(f.id)!=-1)f.state=ia.ItemLayer.SELECTED;f.parent=this;f.layer=this;f.id=d.index;f.legendClass=d;f.value=e[b];f.formattedValue=e[b+"_formatted"];f.label=d.getLabel()+" : "+f.value;f.color=d.color;this.items[f.id]=f;this.itemArray.push(f)}}};
ia.BoxLayer=function(){ia.BoxLayer.baseConstructor.call(this);this._maxBarWidth=20;this._minBarWidthForStroke=2;this._barSize=10;this.sortDirection="ascending"};ia.extend(ia.ItemLayer,ia.BoxLayer);
ia.BoxLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b];if(ia.isNumber(c[this.medianField])){var d={};d.id=c.id;d.name=c.name;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;d.color=c.color;d.rect=new ia.Rectangle;d.hitArea=new ia.Rectangle;this.items[b]=d;this.itemArray.push(d);
d.median=c[this.medianField];d.largestObservation=c[this.largestObservationField];d.upperQuartile=c[this.upperQuartileField];d.lowerQuartile=c[this.lowerQuartileField];d.smallestObservation=c[this.smallestObservationField];this.maxValue=Math.max(this.maxValue,d.largestObservation);this.minValue=Math.min(this.minValue,d.smallestObservation)}}if(this.sortDirection!=void 0){var e;e=this.sortDirection=="ascending"?1:-1;this.itemArray.sort(function(a,b){return a.median<b.median?-e:a.median>b.median?e:
0})}this.dataChanged=!1}};
ia.BoxLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.selectionContext.strokeStyle=this.selectionColor;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.itemArray.length;this._barSize=this.map.orientation==
"vertical"?this.map.canvasWidth/a:this.map.canvasHeight/a;this._barSize>=this._minBarWidthForStroke?(this.selectionContext.fillStyle="rgba(0, 0, 0, 0)",this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.3)):(this.highlightContext.fillStyle=ia.Color.toRGBA(this.selectionColor),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor));for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c,b);this._renderItem(c)}this.renderSelection()};
ia.BoxLayer.prototype._setItemShape=function(a,b){if(this.map.orientation=="vertical"){var c=this.itemArray.length;a.rect.y=this.map.getPixelY(a.upperQuartile);a.rect.height=this.map.getPixelY(a.lowerQuartile)-a.rect.y;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth;a.rect.width=this.map.canvasWidth/c;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;a.uq={};a.uq.x=a.rect.x+a.rect.width/2;a.uq.y=this.map.getPixelY(a.largestObservation);
a.lq={};a.lq.x=a.rect.x+a.rect.width/2;a.lq.y=this.map.getPixelY(a.smallestObservation);a.m={};a.m.x=a.rect.x+a.rect.width/2;a.m.y=this.map.getPixelY(a.median);a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else c=this.itemArray.length,a.rect.x=this.map.getPixelX(a.lowerQuartile),a.rect.width=this.map.getPixelX(a.upperQuartile)-a.rect.x,a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight,
a.rect.height=this.map.canvasHeight/c,a.hitArea.x=this.map.canvasX,a.hitArea.y=a.rect.y,a.hitArea.width=this.map.canvasWidth,a.hitArea.height=a.rect.height,a.uq={},a.uq.x=this.map.getPixelX(a.largestObservation),a.uq.y=a.rect.y+a.rect.height/2,a.lq={},a.lq.x=this.map.getPixelX(a.smallestObservation),a.lq.y=a.rect.y+a.rect.height/2,a.m={},a.m.x=this.map.getPixelX(a.median),a.m.y=a.rect.y+a.rect.height/2,a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):
a.rect.height<this._minBarWidthForStroke&&a.rect.height++};ia.BoxLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.BoxLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.BoxLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};
ia.BoxLayer.prototype._drawItem=function(a,b){b.beginPath();b.moveTo(a.uq.x,a.uq.y);b.lineTo(a.lq.x,a.lq.y);this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.uq.y),b.lineTo(a.rect.x+a.rect.width,a.uq.y),b.moveTo(a.rect.x,a.lq.y),b.lineTo(a.rect.x+a.rect.width,a.lq.y)):(b.moveTo(a.uq.x,a.rect.y),b.lineTo(a.uq.x,a.rect.y+a.rect.height),b.moveTo(a.lq.x,a.rect.y),b.lineTo(a.lq.x,a.rect.y+a.rect.height));b.stroke();b.beginPath();b.rect(a.rect.x,a.rect.y,a.rect.width,a.rect.height);b.fill();this._barSize>=
this._minBarWidthForStroke&&b.stroke();b.beginPath();this.map.orientation=="vertical"?(b.moveTo(a.rect.x,a.m.y),b.lineTo(a.rect.x+a.rect.width,a.m.y)):(b.moveTo(a.m.x,a.rect.y),b.lineTo(a.m.x,a.rect.y+a.rect.height));b.stroke()};ia.BoxLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)};
ia.BoxLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=a.rect.x+a.rect.width,d=a.median<0?a.rect.y+a.rect.height+5:a.rect.y-this.map.datatip.getHeight()-5):(c=a.median<0?a.rect.x-(this.map.datatip.getWidth()+5):a.rect.x+a.rect.width+5,d=a.rect.y+a.rect.height);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.TimeBarLayer=function(){ia.TimeBarLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this.dropDates=[];this._renderTimeout=null;this.selectedDate="";this.colorBarsByCategory=this.matchAxisToSelectedData=this.highlightSelectedDate=!1;this._numericDates=[];this.colorPalette=new ia.ColorPalette};ia.extend(ia.ItemLayer,ia.TimeBarLayer);
ia.TimeBarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){for(var b=this,c=[],d=0;d<a.type.length;d++){var e=a.dates[d];a.type[d]!=ia.Thematic.CATEGORIC&&c.push(e)}this._numericDates=c.filter(function(a){return b.dropDates.indexOf(a)<0});if(this._numericDates.length>0){var c=a[this._numericDates[0]],f=this._numericDates.length,g;for(g in c){var h=c[g],i={};i.id=h.id;
i.name=h.name;i.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(i.id)!=-1)i.state=ia.ItemLayer.SELECTED;i.parent=this;i.layer=this;if(this.isComparison&&(d=this.thematic.getClass(i.id)))i.color=d.color;this.items[h.id]=i;this.itemArray.push(i);i.childItems=[];for(d=0;d<f;d++){var e=this._numericDates[d],h=a[e][g],k=h[this.dataField];if(ia.isNumber(k)){var j={},m;for(m in h)j[m]=h[m];j.id=g+"~"+e;j.name=e;j.rect=new ia.Rectangle;j.hitArea=new ia.Rectangle;j.value=k;j.formattedValue=h[this.dataField+
"_formatted"];if(this.isComparison){if(this.selectionIds.indexOf(i.id)!=-1)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k),i.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&i.state==ia.ItemLayer.SELECTED)this.minValue=Math.min(this.minValue,j.value),this.maxValue=Math.max(this.maxValue,j.value);i.childItems[i.childItems.length]=
j}else i.childItems[i.childItems.length]={name:e,value:void 0}}}}}this.dataChanged=!1}};
ia.TimeBarLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.getData();if(this._numericDates.length>0){a=this._numericDates.length;this._maxBarWidth=this.map.orientation==
"vertical"?this.map.canvasWidth/a*0.7:this.map.canvasHeight/a*0.7;this._barSize=this._maxBarWidth/this.selectionIds.length;if(this.highlightSelectedDate){var b=this._numericDates,c=b.indexOf(this.selectedDate);if(c!=-1){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var d,e;this.map.orientation=="vertical"?(d=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,e=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(d=this.map.canvasX,c=
this.map.canvasY+c/b.length*this.map.canvasHeight,e=this.map.canvasWidth,b=this.map.canvasHeight/b.length);this.context.beginPath();this.context.rect(d,c,e,b);this.context.fill()}}var f=this.itemArray.length;for(d=0;d<f;d++){b=this.itemArray[d];c=b.childItems.length;for(e=0;e<c;e++){var g=b.childItems[e];g.value!=void 0&&this._setItemShape(g,e,c)}}a=this.colorPalette.getColors(this.colorBarsByCategory?a:this.selectionIds.length);for(d=0;d<this.selectionIds.length;d++)if(b=this.items[this.selectionIds[d]]){if(!this.colorBarsByCategory)b.color=
a[d];c=b.childItems.length;for(e=0;e<c;e++){g=b.childItems[e];if(this.colorBarsByCategory)g.color=a[e];g.value!=void 0&&this._setItemShape(g,e,c,d)}this._renderItem(b)}}};
ia.TimeBarLayer.prototype._setItemShape=function(a,b,c,d){if(this.map.orientation=="vertical"){var e,f;this.map.getBBox().getYMin()<0?(e=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value))):(e=this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(e=this.map.canvasY+this.map.canvasHeight,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));
if(a.value>this.map.getBBox().getYMax())e=this.map.canvasY,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());a.rect.y=e;a.rect.height=f;a.rect.width=this._barSize;e=(this.map.canvasWidth/c-this._maxBarWidth)/2;a.rect.x=this.map.canvasX+b/c*this.map.canvasWidth+e+d*a.rect.width;a.hitArea.x=a.rect.x;a.hitArea.y=this.map.canvasY;a.hitArea.width=a.rect.width;a.hitArea.height=this.map.canvasHeight;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=
this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++}else{this.map.getBBox().getXMin()<0?(e=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),f=this.map.getPixelWidth(Math.abs(a.value))):(e=this.map.getPixelX(this.map.getBBox().getXMin()),f=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())e=this.map.canvasX,f-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&
(f-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));a.rect.x=e;a.rect.width=f;a.rect.height=this._barSize;e=(this.map.canvasHeight/c-this._maxBarWidth)/2;a.rect.y=this.map.canvasY+b/c*this.map.canvasHeight+e+d*a.rect.height;a.hitArea.x=this.map.canvasX;a.hitArea.y=a.rect.y;a.hitArea.width=this.map.canvasWidth;a.hitArea.height=a.rect.height;a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<
this._minBarWidthForStroke&&a.rect.height++}};ia.TimeBarLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.TimeBarLayer.prototype.selectItem=function(){this._triggerRender()};ia.TimeBarLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};
ia.TimeBarLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};ia.TimeBarLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};
ia.TimeBarLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0){var e=!1;if(this.map.orientation=="vertical"){var f=this.map.canvasX+this.map.canvasWidth/b*c,g=this.map.canvasX+this.map.canvasWidth/b*(c+1),h=d.rect.y;d.value<0&&(h+=d.rect.height);var i=h;d.value>=this.map.getBBox().getYMin()&&d.value<=this.map.getBBox().getYMax()&&(e=!0)}else f=d.rect.x+d.rect.width,d.value<0&&(f-=d.rect.width),g=f,h=this.map.canvasY+this.map.canvasHeight/
b*c,i=this.map.canvasY+this.map.canvasHeight/b*(c+1),d.value>=this.map.getBBox().getXMin()&&d.value<=this.map.getBBox().getXMax()&&(e=!0);e&&(this.highlightContext.beginPath(),this.highlightContext.moveTo(f,h),this.highlightContext.lineTo(g,i),this.highlightContext.stroke());this.highlightContext.beginPath();this.map.orientation=="vertical"?this.highlightContext.rect(f,d.rect.y,g-f,d.rect.height):this.highlightContext.rect(d.rect.x,h,d.rect.width,i-h);this.highlightContext.fill()}}};
ia.TimeBarLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0){if(this.colorBarsByCategory)b.fillStyle=e.color;b.beginPath();b.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height);b.fill();if(this.map.animationMode&&e.name==this.selectedDate)break}}};
ia.TimeBarLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};ia.TimeBarLayer.prototype.tipFunction=void 0;
ia.TimeBarLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){if(this.tipFunction!=void 0)this.map.datatip.text(this.tipFunction(a,e));else if(this.tip!=""){var c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${date}").join(e.name),c=c.split("${label}").join(e.name),c=c.split("${value}").join(e.formattedValue),f;for(f in e)c=c.split("${"+f+"}").join(e[f+"_formatted"]);this.map.datatip.text(c)}else this.map.datatip.text(a.name+
" : "+e.name+" : "+e.formattedValue);b.isTouchEvent?(f=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(f=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(f=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(f,e);this.map.datatip.show();break}}};
ia.PlotLayer=function(){ia.PlotLayer.baseConstructor.call(this);this._xData={};this._yData={};this.style={fillStyle:"#ffffff",strokeStyle:"#888888",lineWidth:"2",lineJoin:"round"};this.yDataField=this.xDataField="value";this.correlationInfo={};this.showCorrelationLine=!1;this.pointSize=6};ia.extend(ia.ItemLayer,ia.PlotLayer);ia.PlotLayer.prototype.getXData=function(){return this._xData};ia.PlotLayer.prototype.setXData=function(a){this._xData=a;this.dataChanged=!0};
ia.PlotLayer.prototype.getYData=function(){return this._yData};ia.PlotLayer.prototype.setYData=function(a){this._yData=a;this.dataChanged=!0};ia.PlotLayer.prototype.getColorData=function(){return this._colorData};ia.PlotLayer.prototype.setColorData=function(a){this._colorData=a;this.dataChanged=!0};ia.PlotLayer.prototype.getSizeData=function(){return this._sizeData};ia.PlotLayer.prototype.setSizeData=function(a){this._sizeData=a;this.dataChanged=!0};
ia.PlotLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.itemArray=[];this.clearItems();this.xMinValue=Infinity;this.xMaxValue=-Infinity;this.yMinValue=Infinity;this.yMaxValue=-Infinity;var a=0,b=0,c=0,d=0,e=0,f=c=c=0,g=0,h;for(h in this._xData){var c=this._xData[h],i=c[this.xDataField],k=this._yData[h][this.yDataField];if(ia.isNumber(i)&&ia.isNumber(k)){var i=parseFloat(i),k=parseFloat(k),j={};j.id=c.id;j.name=c.name;j.xValue=i;j.yValue=k;j.color=this._colorData!=void 0?this._colorData[h].color:
c.color;j.symbolSize=this._sizeData!=void 0?this._sizeData[h].symbolSize:this.pointSize;j.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(j.id)!=-1)j.state=ia.ItemLayer.SELECTED;j.parent=this;j.layer=this;j.shape=new ia.Rectangle;j.hitArea=new ia.Rectangle;this.items[h]=j;this.itemArray.push(j);c=i*i;a+=i;b+=c;c=k*k;d+=k;e+=c;c=i*k;f+=c;g++;if(this.isComparison){if(this.selectionIds.indexOf(j.id)!=-1)this.xMinValue=Math.min(this.xMinValue,i),this.xMaxValue=Math.max(this.xMaxValue,i),this.yMinValue=
Math.min(this.yMinValue,k),this.yMaxValue=Math.max(this.yMaxValue,k),j.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.xMinValue=Math.min(this.xMinValue,i),this.xMaxValue=Math.max(this.xMaxValue,i),this.yMinValue=Math.min(this.yMinValue,k),this.yMaxValue=Math.max(this.yMaxValue,k)}else this.xMinValue=Math.min(this.xMinValue,i),this.xMaxValue=Math.max(this.xMaxValue,i),this.yMinValue=Math.min(this.yMinValue,k),this.yMaxValue=Math.max(this.yMaxValue,k)}}e=(f/g-a*(d/Math.pow(g,2)))/Math.sqrt((b/
g-Math.pow(a/g,2))*(e/g-Math.pow(d/g,2)));h=(a*d-g*f)/(Math.pow(a,2)-g*b);a=(a*f-d*b)/(Math.pow(a,2)-g*b);this.correlationInfo.correlationCoeff=e;this.correlationInfo.rSquare=Math.pow(e,2);this.correlationInfo.gradient=h;this.correlationInfo.intercept=a;this._sizeData!=void 0&&this.itemArray.sort(function(a,b){return a.symbolSize<b.symbolSize?1:a.symbolSize>b.symbolSize?-1:0});this.dataChanged=!1}};
ia.PlotLayer.prototype.render=function(){this.clear();if(this.showCorrelationLine){this.context.save();this.context.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight);this.context.clip();this.context.strokeStyle=ia.Color.toRGBA(this.selectionColor,0.3);this.context.lineWidth=2;var a=this.map.getPixelX(this.map.getBBox().getXMin()),b=this.map.getPixelX(this.map.getBBox().getXMax()),c=this.map.getPixelY(this.map.getBBox().getXMin()*this.correlationInfo.gradient+this.correlationInfo.intercept),
d=this.map.getPixelY(this.map.getBBox().getXMax()*this.correlationInfo.gradient+this.correlationInfo.intercept);this.context.beginPath();this.context.moveTo(a,c);this.context.lineTo(b,d);this.context.stroke();this.context.restore()}for(var e in this.style)this.context[e]=this.style[e],this.selectionContext[e]=this.style[e],this.highlightContext[e]=this.style[e];this.highlightContext.strokeStyle=this.highlightColor;this.selectionContext.strokeStyle=this.selectionColor;this.highlightContext.fillStyle=
"rgba(0, 0, 0, 0)";this.selectionContext.fillStyle="rgba(0, 0, 0, 0)";a=this.itemArray.length;for(b=0;b<a;b++)c=this.itemArray[b],this._setItemShape(c),this._renderItem(c);this.renderSelection()};
ia.PlotLayer.prototype._setItemShape=function(a){var b=this.map.getPixelX(a.xValue),c=this.map.getPixelY(a.yValue),d=a.symbolSize,e=a.symbolSize;a.shape.x=b;a.shape.y=c;a.shape.width=d;a.shape.height=e;d=Math.max(15,d);e=Math.max(15,e);ia.IS_TOUCH_DEVICE&&(d=Math.max(30,d),e=Math.max(30,e));a.hitArea.x=b-d/2;a.hitArea.y=c-e/2;a.hitArea.width=d;a.hitArea.height=e};
ia.PlotLayer.prototype._renderItem=function(a){if(this._colorData!=void 0)this.context.fillStyle=a.color,this.context.strokeStyle="#CCCCCC",this.context.lineWidth=1;this._drawItem(a,this.context,a.symbolSize)};ia.PlotLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext,a.symbolSize)};
ia.PlotLayer.prototype.highlightItem=function(a){if(a.xValue>=this.map.getBBox().getXMin()&&a.xValue<=this.map.getBBox().getXMax()&&a.yValue>=this.map.getBBox().getYMin()&&a.yValue<=this.map.getBBox().getYMax()){this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.3);var b=this.map.getPixelX(this.map.getBBox().getXMin()),c=this.map.getPixelX(this.map.getBBox().getXMax()),d=this.map.getPixelY(this.map.getBBox().getYMin()),e=this.map.getPixelY(this.map.getBBox().getYMax());this.highlightContext.beginPath();
this.highlightContext.moveTo(a.shape.x,d);this.highlightContext.lineTo(a.shape.x,e);this.highlightContext.moveTo(b,a.shape.y);this.highlightContext.lineTo(c,a.shape.y);this.highlightContext.stroke();this.highlightContext.strokeStyle=this.highlightColor;this._drawItem(a,this.highlightContext,a.symbolSize)}};
ia.PlotLayer.prototype._drawItem=function(a,b,c){a.xValue>=this.map.getBBox().getXMin()&&a.xValue<=this.map.getBBox().getXMax()&&a.yValue>=this.map.getBBox().getYMin()&&a.yValue<=this.map.getBBox().getYMax()&&(b.beginPath(),ia.Shape.drawCircle(b,a.shape.x,a.shape.y,c),b.fill(),b.stroke())};ia.PlotLayer.prototype.hitItem=function(a,b){return a.hitArea.intersects(b.x,b.y)?!0:!1};
ia.PlotLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=a.shape.x+a.shape.width/2,d=a.shape.y-a.shape.height/2-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};
ia.PlotLayer.prototype._getCorrelation=function(){var a=0,b=0,c=0,d=0,e=0,f=c=0,g=0,h=0,i;for(i in xData){var f=xData[i][xDataField],k=yData[i][yDataField];ia.isNumber(f)&&ia.isNumber(k)&&(c=f*f,a+=f,b+=c,c=k*k,d+=k,e+=c,f*=k,g+=f,h++)}e=(g/h-a*(d/Math.pow(h,2)))/Math.sqrt((b/h-Math.pow(a/h,2))*(e/h-Math.pow(d/h,2)));e=Math.round(e*100)/100;i=(a*d-h*g)/(Math.pow(a,2)-h*b);a=(a*g-d*b)/(Math.pow(a,2)-h*b);a=Math.round(a*100)/100;b={};b.correlationCoeff=e;b.rSquare=Math.pow(e,2);b.gradient=i;b.intercept=
a;ia.log("[coefficient="+b.correlationCoeff+",rSquare="+b.rSquare+",gradient="+b.gradient+",intercept="+b.intercept+"]");return b};ia.LineLayer=function(){ia.LineLayer.baseConstructor.call(this);this._xData=[];this._yData=[];this.style={fillStyle:"#ffffff",strokeStyle:"#888888",lineWidth:"2",lineJoin:"round"};this.connectMissingValues=!1};ia.extend(ia.ItemLayer,ia.LineLayer);ia.LineLayer.prototype.getXData=function(){return this._xData};
ia.LineLayer.prototype.setXData=function(a){this._xData=a;this.dataChanged=!0};ia.LineLayer.prototype.getYData=function(){return this._yData};ia.LineLayer.prototype.setYData=function(a){this._yData=a;this.dataChanged=!0};
ia.LineLayer.prototype.update=function(){if(this.map&&this.dataChanged){this.itemArray=[];this.clearItems();this.xMinValue=Infinity;this.xMaxValue=-Infinity;this.yMinValue=Infinity;this.yMaxValue=-Infinity;var a={id:"myLineId",name:"myLineName"};a.state=ia.ItemLayer.UNSELECTED;a.parent=this;a.layer=this;this.items[a.id]=a;this.itemArray.push(a);this.dataChanged=!1}};
ia.LineLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++)this._renderItem(this.itemArray[b])};
ia.LineLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext)};ia.LineLayer.prototype._renderItem=function(a){ia.IS_IE_TEN||(this.context.beginPath(),this.context.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.context.clip());this._drawItem(a,this.context)};
ia.LineLayer.prototype._drawItem=function(a,b){b.beginPath();for(var c=this._xData.length,d=!1,e=0;e<c;e++){var f=this._xData[e],g=this._yData[e];ia.isNumber(f)&&ia.isNumber(g)&&(f=this.map.getPixelX(f),g=this.map.getPixelY(g),d==!1?(d=!0,b.moveTo(f,g)):b.lineTo(f,g))}b.stroke()};ia.LineLayer.prototype.hitItem=function(a,b){return this._pointInLine(b.x,b.y)};
ia.LineLayer.prototype._pointInLine=function(a,b){for(var c=new ia.Rectangle(a-4,b-4,8,8),d=this._xData.length,e=0;e<d-1;e++){var f=this.map.getPixelX(this._xData[e]),g=this.map.getPixelY(this._yData[e]),h=this.map.getPixelX(this._xData[e+1]),i=this.map.getPixelY(this._yData[e+1]);if(c.intersectsLine({x:f,y:g},{x:h,y:i}))return!0}return!1};
ia.LineLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):(c=b.x+10,d=b.y-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};
ia.StackedTimeLayer=function(){ia.StackedTimeLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this.dropDates=[];this._renderTimeout=null;this.selectedDate="";this.matchAxisToSelectedData=this.highlightSelectedDate=!1};ia.extend(ia.ItemLayer,ia.StackedTimeLayer);
ia.StackedTimeLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(a.dates){var b=this,c=a.dates.filter(function(a){return b.dropDates.indexOf(a)<0}),d=a[c[0]],e=c.length,f;for(f in d){var g=d[f],h={};h.id=g.id;h.name=g.name;h.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(h.id)!=-1)h.state=ia.ItemLayer.SELECTED;h.parent=this;h.layer=this;this.items[g.id]=h;this.itemArray.push(h);
h.childItems=[];for(var i=0;i<e;i++){for(var k=0,j=c[i],g=a[j][f],m=0;m<this.dataFields.length;m++){var n=this.dataFields[m],l=g[n],o={};o.id=f+"~"+j;o.name=n;o.date=j;o.rect=new ia.Rectangle;o.hitArea=new ia.Rectangle;o.dateIndex=i;o.stackIndex=m;if(this.legendClasses)for(var q=0;q<this.legendClasses.length;q++){var p=this.legendClasses[q];if(p.value==n){o.name=p.getLabel();o.color=p.color;break}}o.value=ia.isNumber(l)&&l>=0?parseFloat(l):0;o.formattedValue=g[n+"_formatted"];h.childItems[h.childItems.length]=
o;k+=parseFloat(o.value)}if(k!=0)if(this.isComparison){if(this.selectionIds.indexOf(h.id)!=-1)this.maxValue=Math.max(this.maxValue,k),h.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.maxValue=Math.max(this.maxValue,k)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&h.state==ia.ItemLayer.SELECTED)this.maxValue=Math.max(this.maxValue,k)}}}this.dataChanged=!1}};
ia.StackedTimeLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.getData();if(a.dates){var b=this,c=a.dates.filter(function(a){return b.dropDates.indexOf(a)<0});a=c.length;
this._maxBarWidth=this.map.orientation=="vertical"?this.map.canvasWidth/a*0.7:this.map.canvasHeight/a*0.7;this._barSize=this._maxBarWidth/this.selectionIds.length;if(this.highlightSelectedDate){var d=c.indexOf(this.selectedDate);if(d!=-1){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var e,f;this.map.orientation=="vertical"?(e=this.map.canvasX+d/c.length*this.map.canvasWidth,d=this.map.canvasY,f=this.map.canvasWidth/c.length,c=this.map.canvasHeight):(e=
this.map.canvasX,d=this.map.canvasY+d/c.length*this.map.canvasHeight,f=this.map.canvasWidth,c=this.map.canvasHeight/c.length);this.context.beginPath();this.context.rect(e,d,f,c);this.context.fill()}}var g=this.itemArray.length;for(e=0;e<g;e++){c=this.itemArray[e];d=c.childItems.length;for(f=0;f<d;f++){var h=c.childItems[f];h.value!=void 0&&this._setItemShape(h)}}g=this.selectionIds.length;for(e=0;e<g;e++)if(c=this.items[this.selectionIds[e]]){d=c.childItems.length;for(f=0;f<d;f++)h=c.childItems[f],
h.value!=void 0&&this._setItemShape(h,e,a);this._renderItem(c)}}};
ia.StackedTimeLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical")if(a.stackIndex==0?this._stackValue=a.value:this._stackValue+=a.value,this._stackValue-a.value>=this.map.getBBox().getYMax())a.rect.x=0,a.rect.y=0,a.rect.width=0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0;else{var d=this.map.getPixelY(this._stackValue),e=this.map.getPixelHeight(a.value);if(this._stackValue>this.map.getBBox().getYMax())d=this.map.canvasY,e-=this.map.getPixelHeight(this._stackValue-
this.map.getBBox().getYMax());a.rect.y=d;a.rect.height=e;a.rect.width=this._barSize;d=(this.map.canvasWidth/c-this._maxBarWidth)/2;a.rect.x=this.map.canvasX+a.dateIndex/c*this.map.canvasWidth+d+b*a.rect.width;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height}else{if(a.stackIndex==0)this._stackValue=
0;this._stackValue>=this.map.getBBox().getXMax()?(a.rect.x=0,a.rect.y=0,a.rect.width=0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0):(d=this.map.getPixelX(this._stackValue),e=this.map.getPixelWidth(a.value),this._stackValue+a.value>this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(this._stackValue+a.value-this.map.getBBox().getXMax())),a.rect.x=d,a.rect.width=e,a.rect.height=this._barSize,d=(this.map.canvasHeight/c-this._maxBarWidth)/2,a.rect.y=this.map.canvasY+
a.dateIndex/c*this.map.canvasHeight+d+b*a.rect.height,a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<this._minBarWidthForStroke&&a.rect.height++,a.hitArea.x=a.rect.x,a.hitArea.y=a.rect.y,a.hitArea.width=a.rect.width,a.hitArea.height=a.rect.height,this._stackValue+=a.value)}};ia.StackedTimeLayer.prototype._renderItem=function(a){this._drawItem(a,this.context)};ia.StackedTimeLayer.prototype.selectItem=function(){this._triggerRender()};
ia.StackedTimeLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};ia.StackedTimeLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};
ia.StackedTimeLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};
ia.StackedTimeLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0,d=0;d<b;d++){var e=a.childItems[d];if(e.value!=void 0&&e.value!=0&&(this.highlightContext.fillStyle=e.color,this.highlightContext.beginPath(),this.highlightContext.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),this.highlightContext.stroke(),this.map.animationMode&&e.date==this.selectedDate&&c++,c==this.dataFields.length))break}};
ia.StackedTimeLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0,e=0;e<c;e++){var f=a.childItems[e];if(f.value!=void 0&&f.value!=0&&(b.fillStyle=f.color,b.beginPath(),b.rect(f.rect.x,f.rect.y,f.rect.width,f.rect.height),b.fill(),this.map.animationMode&&f.date==this.selectedDate&&d++,d==this.dataFields.length))break}};
ia.StackedTimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.StackedTimeLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${feature-name}").join(a.name),c=c.split("${date}").join(e.date),c=c.split("${associate-name}").join(e.name),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" ("+e.date+") <br/> "+e.name+" : "+e.formattedValue);b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/
2,e=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(c=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};
ia.StackedBarLayer=function(){ia.StackedBarLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this._renderTimeout=null;this.matchAxisToSelectedData=!1};ia.extend(ia.ItemLayer,ia.StackedBarLayer);
ia.StackedBarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b],d={};d.id=c.id;d.name=c.name;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;this.items[c.id]=d;this.itemArray.push(d);d.childItems=[];for(var e=0,f=0;f<this.dataFields.length;f++){var g=this.dataFields[f],h=c[g],
i={};i.id=b+"~"+g;i.name=g;i.rect=new ia.Rectangle;i.hitArea=new ia.Rectangle;i.stackIndex=f;if(this.legendClasses)for(var k=0;k<this.legendClasses.length;k++){var j=this.legendClasses[k];if(j.value==g){i.name=j.getLabel();i.color=j.color;break}}i.value=ia.isNumber(h)&&h>=0?parseFloat(h):0;i.formattedValue=c[g+"_formatted"];d.childItems[d.childItems.length]=i;e+=parseFloat(i.value)}if(e!=0)if(this.isComparison){if(this.selectionIds.indexOf(d.id)!=-1)this.maxValue=Math.max(this.maxValue,e),d.state=
ia.ItemLayer.SELECTED;if(this.displayAll)this.maxValue=Math.max(this.maxValue,e)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&d.state==ia.ItemLayer.SELECTED)this.maxValue=Math.max(this.maxValue,e)}this.dataChanged=!1}};
ia.StackedBarLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;a=this.selectionIds.length;this._barSize=this._maxBarWidth=this.map.orientation=="vertical"?this.map.canvasWidth/
a*0.7:this.map.canvasHeight/a*0.7;for(var b=this.itemArray.length,c=0;c<b;c++)for(var d=this.itemArray[c],e=d.childItems.length,f=0;f<e;f++){var g=d.childItems[f];g.value!=void 0&&this._setItemShape(g)}for(c=0;c<a;c++)if(d=this.items[this.selectionIds[c]]){e=d.childItems.length;for(f=0;f<e;f++)g=d.childItems[f],g.value!=void 0&&this._setItemShape(g,c,a);this._renderItem(d)}};
ia.StackedBarLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical")if(a.stackIndex==0?this._stackValue=a.value:this._stackValue+=a.value,this._stackValue-a.value>=this.map.getBBox().getYMax())a.rect.x=0,a.rect.y=0,a.rect.width=0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0;else{var d=this.map.getPixelY(this._stackValue),e=this.map.getPixelHeight(a.value);if(this._stackValue>this.map.getBBox().getYMax())d=this.map.canvasY,e-=this.map.getPixelHeight(this._stackValue-
this.map.getBBox().getYMax());a.rect.y=d;a.rect.height=e;a.rect.width=this._barSize;c=this.map.canvasWidth/c;a.rect.x=this.map.canvasX+b*c+(c-a.rect.width)/2;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height}else{if(a.stackIndex==0)this._stackValue=0;this._stackValue>=this.map.getBBox().getXMax()?
(a.rect.x=0,a.rect.y=0,a.rect.width=0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0):(d=this.map.getPixelX(this._stackValue),e=this.map.getPixelWidth(a.value),this._stackValue+a.value>this.map.getBBox().getXMax()&&(e-=this.map.getPixelWidth(this._stackValue+a.value-this.map.getBBox().getXMax())),a.rect.x=d,a.rect.width=e,a.rect.height=this._barSize,c=this.map.canvasHeight/c,a.rect.y=this.map.canvasY+b*c+(c-a.rect.height)/2,a.rect.height>this._maxBarWidth?(a.rect.y+=
(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<this._minBarWidthForStroke&&a.rect.height++,a.hitArea.x=a.rect.x,a.hitArea.y=a.rect.y,a.hitArea.width=a.rect.width,a.hitArea.height=a.rect.height,this._stackValue+=a.value)}};ia.StackedBarLayer.prototype._renderItem=function(a){this._drawItem(a,this.context)};ia.StackedBarLayer.prototype.selectItem=function(){this._triggerRender()};
ia.StackedBarLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};ia.StackedBarLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};
ia.StackedBarLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};ia.StackedBarLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0&&d.value!=0)this.highlightContext.fillStyle=d.color,this.highlightContext.beginPath(),this.highlightContext.rect(d.rect.x,d.rect.y,d.rect.width,d.rect.height),this.highlightContext.stroke()}};
ia.StackedBarLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.value!=0)b.fillStyle=e.color,b.beginPath(),b.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),b.fill()}};ia.StackedBarLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.StackedBarLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${feature-name}").join(a.name),c=c.split("${date}").join(e.date),c=c.split("${associate-name}").join(e.name),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" ("+e.date+") <br/> "+e.name+" : "+e.formattedValue);b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/
2,e=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(c=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};
ia.StackedFeaturesLayer=function(){ia.StackedFeaturesLayer.baseConstructor.call(this);this._minBarWidthForStroke=10;this.dropDates=[];this._renderTimeout=null;this.selectedDate="";this.highlightSelectedDate=!1;this._numericDates=[];this.colorPalette=new ia.ColorPalette;this._stackValues=[]};ia.extend(ia.ItemLayer,ia.StackedFeaturesLayer);
ia.StackedFeaturesLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this._stackValues=[];this.minValue=0;this.maxValue=100;if(a.dates){for(var b=this,c=[],d=0;d<a.type.length;d++){var e=a.dates[d];a.type[d]!=ia.Thematic.CATEGORIC&&c.push(e)}this._numericDates=c.filter(function(a){return b.dropDates.indexOf(a)<0});if(this._numericDates.length>0){var c=a[this._numericDates[0]],f=this._numericDates.length,g;for(g in c){var h=c[g],
i={};i.id=h.id;i.name=h.name;i.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(i.id)!=-1)i.state=ia.ItemLayer.SELECTED;i.parent=this;i.layer=this;this.items[h.id]=i;this.itemArray.push(i);i.childItems=[];for(d=0;d<f;d++){var e=this._numericDates[d],h=a[e][g],k=h[this.dataField];if(ia.isNumber(k)){var j={},m;for(m in h)j[m]=h[m];j.id=g+"~"+e;j.name=e;j.rect=new ia.Rectangle;j.hitArea=new ia.Rectangle;j.value=k;j.formattedValue=h[this.dataField+"_formatted"];j.dateIndex=d;if(i.state==ia.ItemLayer.SELECTED)e=
this._stackValues[d],e!=void 0?e+=j.value:e=j.value,this._stackValues[d]=e,this.maxValue=Math.max.apply(Math,this._stackValues);i.childItems[i.childItems.length]=j}else i.childItems[i.childItems.length]={name:e,value:void 0}}}}}this.dataChanged=!1}};
ia.StackedFeaturesLayer.prototype.render=function(){this._renderTimeout=null;this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1;this.getData();if(this._numericDates.length>0){a=this._numericDates.length;this._barSize=this._maxBarWidth=
this.map.orientation=="vertical"?this.map.canvasWidth/a*0.7:this.map.canvasHeight/a*0.7;if(this.highlightSelectedDate){var b=this._numericDates,c=b.indexOf(this.selectedDate);if(c!=-1){this.context.fillStyle=ia.Color.toRGBA(this.selectionColor,0.07);this.context.lineWidth=0;var d;this.map.orientation=="vertical"?(a=this.map.canvasX+c/b.length*this.map.canvasWidth,c=this.map.canvasY,d=this.map.canvasWidth/b.length,b=this.map.canvasHeight):(a=this.map.canvasX,c=this.map.canvasY+c/b.length*this.map.canvasHeight,
d=this.map.canvasWidth,b=this.map.canvasHeight/b.length);this.context.beginPath();this.context.rect(a,c,d,b);this.context.fill()}}this._stackValues=[];a=this.selectionIds.length;b=this.colorPalette.getColors(a);for(c=0;c<a;c++)if(d=this.items[this.selectionIds[c]]){d.color=b[c];for(var e=d.childItems.length,f=0;f<e;f++){var g=d.childItems[f];g.value!=void 0&&this._setItemShape(g,f,e)}this._renderItem(d)}}};
ia.StackedFeaturesLayer.prototype._setItemShape=function(a,b,c){if(this.map.orientation=="vertical"){var d=this._stackValues[b];d!=void 0?d+=a.value:d=a.value;this._stackValues[b]=d;if(d-a.value>=this.map.getBBox().getYMax())a.rect.x=0,a.rect.y=0,a.rect.width=0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0;else{var e=this.map.getPixelY(d),f=this.map.getPixelHeight(a.value);if(d>this.map.getBBox().getYMax())e=this.map.canvasY,f-=this.map.getPixelHeight(d-this.map.getBBox().getYMax());
a.rect.y=e;a.rect.height=f;a.rect.width=this._barSize;c=this.map.canvasWidth/c;a.rect.x=this.map.canvasX+b*c+(c-a.rect.width)/2;a.rect.width>this._maxBarWidth?(a.rect.x+=(a.rect.width-this._maxBarWidth)/2,a.rect.width=this._maxBarWidth):a.rect.width<this._minBarWidthForStroke&&a.rect.width++;a.hitArea.x=a.rect.x;a.hitArea.y=a.rect.y;a.hitArea.width=a.rect.width;a.hitArea.height=a.rect.height}}else d=this._stackValues[b],d==void 0&&(d=0),d>=this.map.getBBox().getXMax()?(a.rect.x=0,a.rect.y=0,a.rect.width=
0,a.rect.height=0,a.hitArea.x=0,a.hitArea.y=0,a.hitArea.width=0,a.hitArea.height=0):(e=this.map.getPixelX(d),f=this.map.getPixelWidth(a.value),d+a.value>this.map.getBBox().getXMax()&&(f-=this.map.getPixelWidth(d+a.value-this.map.getBBox().getXMax())),a.rect.x=e,a.rect.width=f,a.rect.height=this._barSize,c=this.map.canvasHeight/c,a.rect.y=this.map.canvasY+b*c+(c-a.rect.height)/2,a.rect.height>this._maxBarWidth?(a.rect.y+=(a.rect.height-this._maxBarWidth)/2,a.rect.height=this._maxBarWidth):a.rect.height<
this._minBarWidthForStroke&&a.rect.height++,a.hitArea.x=a.rect.x,a.hitArea.y=a.rect.y,a.hitArea.width=a.rect.width,a.hitArea.height=a.rect.height,this._stackValues[b]=d+a.value)};ia.StackedFeaturesLayer.prototype._renderItem=function(a){this.context.fillStyle=a.color;this._drawItem(a,this.context)};ia.StackedFeaturesLayer.prototype.selectItem=function(){this._triggerRender()};
ia.StackedFeaturesLayer.prototype.unselect=function(a){var b=this.getItem(a);if(b)b.state=ia.ItemLayer.UNSELECTED,a=this.selectionIds.indexOf(a),a!=-1&&this.selectionIds.splice(a,1);this._triggerRender()};ia.StackedFeaturesLayer.prototype.clearSelection=function(){this.selectionIds=[];for(var a in this.items){var b=this.items[a];if(b)b.state=ia.ItemLayer.UNSELECTED}this._triggerRender()};
ia.StackedFeaturesLayer.prototype._triggerRender=function(){if(!this._renderTimeout){var a=this;this._renderTimeout=setTimeout(function(){a.render()},5)}};
ia.StackedFeaturesLayer.prototype.highlightItem=function(a){for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0&&d.value!=0&&(this.highlightContext.fillStyle=d.color,this.highlightContext.beginPath(),this.highlightContext.rect(d.rect.x,d.rect.y,d.rect.width,d.rect.height),this.highlightContext.stroke(),this.map.animationMode&&d.name==this.selectedDate))break}};
ia.StackedFeaturesLayer.prototype._drawItem=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.value!=0&&(b.fillStyle=e.color,b.beginPath(),b.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),b.fill(),this.map.animationMode&&e.name==this.selectedDate))break}};
ia.StackedFeaturesLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id))for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.StackedFeaturesLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y)){if(this.tip!=""){var c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${date}").join(e.name),c=c.split("${label}").join(e.name),c=c.split("${value}").join(e.formattedValue),f;for(f in e)c=c.split("${"+f+"}").join(e[f+"_formatted"]);this.map.datatip.text(c)}else this.map.datatip.text(a.name+" : "+e.name+" : "+e.formattedValue);
b.isTouchEvent?(f=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(f=e.rect.x+e.rect.width/2-this.map.datatip.getWidth()/2,e=e.value<0?e.rect.y+e.rect.height+5:e.rect.y-this.map.datatip.getHeight()-5):(f=e.value<0?e.rect.x-(this.map.datatip.getWidth()+5):e.rect.x+e.rect.width+5,e=e.rect.y+e.rect.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(f,e);this.map.datatip.show();break}}};
ia.ComparisonLineLayer=function(){ia.ComparisonLineLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.displayAll=!1};ia.extend(ia.ItemLayer,ia.ComparisonLineLayer);
ia.ComparisonLineLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;for(var b in a){var c=a[b],d=c[this.dataField];if(ia.isNumber(d)){var e={};e.id=c.id;e.name=c.name;e.color=c.color;e.value=c[this.dataField];e.shape=new ia.Rectangle;e.hitArea=new ia.Rectangle;e.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(e.id)!=-1)this.minValue=Math.min(this.minValue,d),this.maxValue=
Math.max(this.maxValue,d),e.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,d),this.maxValue=Math.max(this.maxValue,d);e.parent=this;e.layer=this;this.items[b]=e;this.itemArray.push(e)}}this.dataChanged=!1}};
ia.ComparisonLineLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c);this.displayAll&&this._renderItem(c)}this.displayAll||this.renderSelection()};
ia.ComparisonLineLayer.prototype._setItemShape=function(a){this.map.orientation=="vertical"?(a.shape.x=this.map.canvasX,a.shape.y=this.map.getPixelY(a.value),a.shape.width=this.map.canvasWidth,a.shape.height=0,a.hitArea.x=a.shape.x,a.hitArea.y=a.shape.y-1,a.hitArea.width=a.shape.width,a.hitArea.height=2):(a.shape.x=this.map.getPixelX(a.value),a.shape.y=this.map.canvasY,a.shape.width=0,a.shape.height=this.map.canvasHeight,a.hitArea.x=a.shape.x-1,a.hitArea.y=a.shape.y,a.hitArea.width=2,a.hitArea.height=
a.shape.height)};ia.ComparisonLineLayer.prototype.clearSelection=function(){};ia.ComparisonLineLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonLineLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};
ia.ComparisonLineLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext)};
ia.ComparisonLineLayer.prototype._drawItem=function(a,b){b.beginPath();this.map.orientation=="vertical"?(b.moveTo(a.shape.x,a.shape.y),b.lineTo(a.shape.x+a.shape.width,a.shape.y)):(b.moveTo(a.shape.x,a.shape.y),b.lineTo(a.shape.x,a.shape.y+a.shape.height));b.stroke()};ia.ComparisonLineLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)||this.displayAll?a.hitArea.intersects(b.x,b.y):!1};
ia.ComparisonLineLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.map.orientation=="vertical"?(c=b.x-this.map.datatip.getWidth()/2,d=a.shape.y-this.map.datatip.getHeight()-5):(c=a.shape.x+a.shape.width+5,d=b.y-this.map.datatip.getHeight()/2);this.map.datatip.position(c,d);this.map.datatip.show()};
ia.ComparisonTimeLayer=function(){ia.ComparisonTimeLayer.baseConstructor.call(this);this.isComparison=!0;this.displayAll=!1;this.selectedDate=""};ia.extend(ia.TimeLayer,ia.ComparisonTimeLayer);
ia.ComparisonTimeLayer.prototype.render=function(){if(this.dataFields.length>0)this.render_multi();else{this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}this.displayAll&&
this._renderItem(c)}this.renderSelection()}};ia.ComparisonTimeLayer.prototype.clearSelection=function(){};ia.ComparisonTimeLayer.prototype._renderItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.context.strokeStyle=b.color}this._drawItem(a,this.context)};ia.ComparisonTimeLayer.prototype.selectItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.selectionContext.strokeStyle=b.color}this._highlightMode=!1;this._drawItem(a,this.selectionContext)};
ia.ComparisonTimeLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.ComparisonTimeLayer.prototype.render_multi=function(){var a=this.getData();this.clear();for(var b in this.style)this.context[b]=this.style[b],this.highlightContext[b]=this.style[b],this.selectionContext[b]=this.style[b];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);b=this.itemArray.length;for(var c=0;c<b;c++){for(var d=this.itemArray[c],e=0,f=d.childItems.length,g,h=0;h<f;h++){var i=d.childItems[h];i.dataField!=g?(e=0,g=i.dataField):e++;i.value!=void 0&&this._setItemShape(i,
e,a.dates.length)}this.displayAll&&this._renderItem(d)}this.renderSelection()};ia.ComparisonTimeBarLayer=function(){ia.ComparisonTimeBarLayer.baseConstructor.call(this);this.isComparison=!0;this.displayAll=!1;this.selectedDate=""};ia.extend(ia.TimeBarLayer,ia.ComparisonTimeBarLayer);
ia.ComparisonTimeBarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this.highlightContext.lineWidth=parseFloat(this.style.lineWidth)+1.5;this.selectionContext.lineWidth=parseFloat(this.style.lineWidth)+1.5;this.context.lineWidth=
parseFloat(this.style.lineWidth)+1.5;a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonTimeBarLayer.prototype._setItemShape=function(a,b,c){var d=4;ia.IS_TOUCH_DEVICE&&(d=8);if(this.map.orientation=="vertical"){var e,f;this.map.getBBox().getYMin()<0?(e=a.value<0?this.map.getPixelY(0):this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value))):(e=this.map.getPixelY(a.value),f=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMin()));a.value<this.map.getBBox().getYMin()&&(e=this.map.canvasY+this.map.canvasHeight,f-=this.map.getPixelHeight(Math.abs(a.value)-
this.map.getBBox().getYMin()));if(a.value>this.map.getBBox().getYMax())e=this.map.canvasY,f-=this.map.getPixelHeight(Math.abs(a.value)-this.map.getBBox().getYMax());var g=this.map.canvasWidth/c,b=this.map.canvasX+g*b;a.rect.y=e;a.rect.height=f;a.rect.width=g;a.rect.x=b;a.hitArea.x=a.rect.x;a.hitArea.y=a.value>0?e-d:e+f-d;a.hitArea.width=a.rect.width;a.hitArea.height=d*2}else{this.map.getBBox().getXMin()<0?(e=a.value<0?this.map.getPixelX(a.value):this.map.getPixelX(0),g=this.map.getPixelWidth(Math.abs(a.value))):
(e=this.map.getPixelX(this.map.getBBox().getXMin()),g=this.map.getPixelWidth(Math.abs(a.value)-this.map.getBBox().getXMin()));if(a.value<this.map.getBBox().getXMin())e=this.map.canvasX,g-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMin()));a.value>this.map.getBBox().getXMax()&&(g-=this.map.getPixelWidth(Math.abs(a.value)-Math.abs(this.map.getBBox().getXMax())));f=this.map.canvasHeight/c;b=this.map.canvasY+f*b;a.rect.x=e;a.rect.width=g;a.rect.height=f;a.rect.y=b;a.hitArea.x=
a.value<0?e-d:e+g-d;a.hitArea.y=a.rect.y;a.hitArea.width=d*2;a.hitArea.height=a.rect.height}};ia.ComparisonTimeBarLayer.prototype.clearSelection=function(){};ia.ComparisonTimeBarLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonTimeBarLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};
ia.ComparisonTimeBarLayer.prototype.highlightItem=function(a){this.highlightContext.strokeStyle=ia.Color.toRGBA(a.color,0.8);this.highlightContext.fillStyle=ia.Color.toRGBA(a.color,0.1);for(var b=a.childItems.length,c=0;c<b;c++){var d=a.childItems[c];if(d.value!=void 0){var e=!1;if(this.map.orientation=="vertical"){var f=this.map.canvasX+this.map.canvasWidth/b*c,g=this.map.canvasX+this.map.canvasWidth/b*(c+1),h=d.rect.y;d.value<0&&(h+=d.rect.height);var i=h;d.value>=this.map.getBBox().getYMin()&&
d.value<=this.map.getBBox().getYMax()&&(e=!0)}else f=d.rect.x+d.rect.width,d.value<0&&(f-=d.rect.width),g=f,h=this.map.canvasY+this.map.canvasHeight/b*c,i=this.map.canvasY+this.map.canvasHeight/b*(c+1),d.value>=this.map.getBBox().getXMin()&&d.value<=this.map.getBBox().getXMax()&&(e=!0);e&&(this.highlightContext.beginPath(),this.highlightContext.moveTo(f,h),this.highlightContext.lineTo(g,i),this.highlightContext.stroke());this.highlightContext.beginPath();this.map.orientation=="vertical"?this.highlightContext.rect(f,
d.rect.y,g-f,d.rect.height):this.highlightContext.rect(d.rect.x,h,d.rect.width,i-h);this.highlightContext.fill()}}};
ia.ComparisonTimeBarLayer.prototype._drawItem=function(a,b){var c=a.childItems.length;b.beginPath();for(var d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0){if(this.map.orientation=="vertical"){var f=e.rect.x,g=e.rect.x+e.rect.width,h=e.rect.y;e.value<0&&(h+=e.rect.height);var i=h}else f=e.rect.x+e.rect.width,e.value<0&&(f-=e.rect.width),g=f,h=e.rect.y,i=e.rect.y+e.rect.height;b.moveTo(f,h);b.lineTo(g,i);if(this.map.animationMode&&e.name==this.selectedDate)break}}b.stroke()};
ia.ComparisonTimeBarLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};ia.ComparisonPlotLayer=function(){ia.ComparisonPlotLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.displayAll=!1;this.isComparison=!0};ia.extend(ia.PlotLayer,ia.ComparisonPlotLayer);
ia.ComparisonPlotLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=this.highlightColor;this.selectionContext.strokeStyle=this.selectionColor;a=this.itemArray.length;for(var b=0;b<a;b++){var c=this.itemArray[b];this._setItemShape(c);this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonPlotLayer.prototype._setItemShape=function(a){var b=this.map.getPixelX(a.xValue),c=this.map.getPixelY(a.yValue),d=10,e=10;a.shape.x=b;a.shape.y=c;a.shape.width=d;a.shape.height=e;d=Math.max(15,d);e=Math.max(15,e);ia.IS_TOUCH_DEVICE&&(d=Math.max(30,d),e=Math.max(30,e));a.hitArea.x=b-d/2;a.hitArea.y=c-e/2;a.hitArea.width=d;a.hitArea.height=e};ia.ComparisonPlotLayer.prototype.clearSelection=function(){};
ia.ComparisonPlotLayer.prototype._renderItem=function(a){this.context.strokeStyle=a.color;this._drawItem(a,this.context)};ia.ComparisonPlotLayer.prototype.selectItem=function(a){this.selectionContext.strokeStyle=a.color;this._drawItem(a,this.selectionContext)};ia.ComparisonPlotLayer.prototype._drawItem=function(a,b){b.beginPath();ia.Shape.drawCircle(b,a.shape.x,a.shape.y,a.symbolSize);b.fill();b.stroke()};
ia.ComparisonPlotLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)||this.displayAll?a.hitArea.intersects(b.x,b.y):!1};ia.ComparisonPyramidLayer=function(){ia.ComparisonPyramidLayer.baseConstructor.call(this);this.style={fillStyle:"#ffffff",strokeStyle:"#ff0000",lineWidth:"2",lineJoin:"round"};this.sortDirection="ascending";this.gender="male";this.displayAll=!1};ia.extend(ia.ItemLayer,ia.ComparisonPyramidLayer);
ia.ComparisonPyramidLayer.prototype.update=function(a){if(this.map){var b=this.getData();this.itemArray=[];this.clearItems();this.minValue=Infinity;this.maxValue=-Infinity;if(b[0])for(var c=b[0].features,d=0;d<c.length;d++){var e=c[d],f=0,g={};g.id=e.id;g.name=e.name;g.state=ia.ItemLayer.UNSELECTED;g.parent=this;g.layer=this;this.items[g.id]=g;this.itemArray.push(g);g.childItems=[];for(e=0;e<b.length;e++){var h=b[e],i=h.features[d];if(i){var k=i[this.dataField];if(ia.isNumber(k)){this.gender=="male"&&
(k*=-1);if(this.selectionIds.indexOf(g.id)!=-1)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k),g.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k)}if(a==void 0||h.date==a){if(ia.isNumber(k)){var j={};j.id=g.id+"~"+h.name;j.name=h.name;j.ageGroup=h.name;j.shape=new ia.Rectangle;j.hitArea=new ia.Rectangle;j.value=k;j.index=f;j.formattedValue=i[this.dataField+"_formatted"];g.childItems[g.childItems.length]=
j}f++}}}g.nChildItems=f;g.childItems.reverse()}}};ia.ComparisonPyramidLayer.prototype.clearSelection=function(){};
ia.ComparisonPyramidLayer.prototype.render=function(){this.clear();ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=
this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e],g=c.nChildItems-1-f.index;f!=void 0&&this._setItemShape(f,g,c.nChildItems)}this.displayAll&&this._renderItem(c)}this.renderSelection()};
ia.ComparisonPyramidLayer.prototype._setItemShape=function(a,b,c){var d=this.map.canvasHeight/c,c=this.map.getPixelX(a.value),b=this.map.canvasY+d/2+d*b,e=d=10;a.shape.x=c;a.shape.y=b;a.shape.width=d;a.shape.height=e;ia.IS_TOUCH_DEVICE&&(e=d=30);a.hitArea.x=c-d/2;a.hitArea.y=b-e/2;a.hitArea.width=d;a.hitArea.height=e};ia.ComparisonPyramidLayer.prototype._renderItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.context.strokeStyle=b.color}this._drawItem(a,this.context)};
ia.ComparisonPyramidLayer.prototype.selectItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.selectionContext.strokeStyle=b.color}this._drawItem(a,this.selectionContext)};ia.ComparisonPyramidLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),this.highlightContext.rect(this.map.canvasX,this.map.canvasY,this.map.canvasWidth,this.map.canvasHeight),this.highlightContext.clip());this._drawItem(a,this.highlightContext,!0)};
ia.ComparisonPyramidLayer.prototype._drawSpline=function(a,b){for(var c=[],d=a.childItems.length,e=0;e<d-2;e++)c=c.concat(this._getControlPoints(a.childItems[e].shape.x,a.childItems[e].shape.y,a.childItems[e+1].shape.x,a.childItems[e+1].shape.y,a.childItems[e+2].shape.x,a.childItems[e+2].shape.y,0.3));for(e=1;e<d-2;e++)b.beginPath(),b.moveTo(a.childItems[e].shape.x,a.childItems[e].shape.y),b.bezierCurveTo(c[4*e-2],c[4*e-1],c[4*e],c[4*e+1],a.childItems[e+1].shape.x,a.childItems[e+1].shape.y),b.stroke();
d>0&&(b.beginPath(),b.moveTo(a.childItems[0].shape.x,a.childItems[0].shape.y),b.quadraticCurveTo(c[0],c[1],a.childItems[1].shape.x,a.childItems[1].shape.y),b.stroke(),b.beginPath(),b.moveTo(a.childItems[d-1].shape.x,a.childItems[d-1].shape.y),b.quadraticCurveTo(c[4*d-10],c[4*d-9],a.childItems[d-2].shape.x,a.childItems[d-2].shape.y),b.stroke())};
ia.ComparisonPyramidLayer.prototype._getControlPoints=function(a,b,c,d,e,f,g){var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),h=g*h/(h+Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)));g-=h;return[c+h*(a-e),d+h*(b-f),c-g*(a-e),d-g*(b-f)]};ia.ComparisonPyramidLayer.prototype._drawItem=function(a,b,c){this._drawSpline(a,b);if(c==!0)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];e!=void 0&&(b.beginPath(),ia.Shape.drawCircle(b,e.shape.x,e.shape.y,5),b.fill(),b.stroke())}};
ia.ComparisonPyramidLayer.prototype.hitItem=function(a,b){if(this.isSelected(a.id)||this.displayAll)for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}return!1};
ia.ComparisonPyramidLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e!=void 0&&e.hitArea.intersects(b.x,b.y)){this.tip!=""?(c=this.tip,c=c.split("${name}").join(a.name),c=c.split("${ageGroup}").join(e.ageGroup),c=c.split("${value}").join(e.formattedValue),this.map.datatip.text(c)):this.map.datatip.text(a.name+" <br/> "+e.ageGroup+" <br/> "+e.formattedValue);b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+
30)):(c=e.value<0?e.shape.x-(this.map.datatip.getWidth()+5):e.shape.x+e.shape.width+5,e=e.shape.y+e.shape.height/2-this.map.datatip.getHeight()/2);this.map.datatip.position(c,e);this.map.datatip.show();break}}};ia.RadarLayer=function(){ia.RadarLayer.baseConstructor.call(this)};ia.extend(ia.TimeLayer,ia.RadarLayer);
ia.RadarLayer.prototype.update=function(){if(this.map&&this.dataChanged){var a=this.getData();if(a&&(this.itemArray=[],this.clearItems(),this.minValue=Infinity,this.maxValue=-Infinity,a.features))for(var b=0;b<a.features.length;b++){var c=a.features[b],d={};d.id=c.id;d.name=c.name;d.state=ia.ItemLayer.UNSELECTED;if(this.selectionIds.indexOf(d.id)!=-1)d.state=ia.ItemLayer.SELECTED;d.parent=this;d.layer=this;this.items[c.id]=d;this.itemArray.push(d);d.childItems=[];for(var e=0;e<c.themes.length;e++)for(var f=
c.themes[e],g=0;g<f.indicators.length;g++){var h=f.indicators[g];if(h.date==this.selectedDate||this.selectedDate==void 0){var i=void 0;if(this.dataField=="value")i=h;else for(var k=0;k<h.associates.length;k++){var j=h.associates[k];if(j.name==this.dataField){i=j;break}}if(i&&i.type!="categoric")if(k=i.value,ia.isNumber(k)){j={};j.id=h.id;j.name=h.name;j.themeName=f.name;j.shape=new ia.Rectangle;j.hitArea=new ia.Rectangle;j.value=k;j.formattedValue=i.formattedValue;if(this.isComparison){if(this.selectionIds.indexOf(d.id)!=
-1)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k),d.state=ia.ItemLayer.SELECTED;if(this.displayAll)this.minValue=Math.min(this.minValue,k),this.maxValue=Math.max(this.maxValue,k)}else if(this.matchAxisToSelectedData==!1||this.matchAxisToSelectedData==!0&&d.state==ia.ItemLayer.SELECTED)this.minValue=Math.min(this.minValue,j.value),this.maxValue=Math.max(this.maxValue,j.value);d.childItems[d.childItems.length]=j}else d.childItems[d.childItems.length]={name:h.name,value:void 0}}}}this.dataChanged=
!1}};
ia.RadarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.selectionContext[a]=this.style[a],this.highlightContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);this.selectionContext.strokeStyle=ia.Color.toRGBA(this.selectionColor);a=this.itemArray.length;for(var b=0;b<a;b++)for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,e,d)}this.renderSelection()};
ia.RadarLayer.prototype._setItemShape=function(a,b,c){var d=this.map.getBBox(),c=Math.PI*2*(1/c),b=1.5*Math.PI+c*b,d=this.map.radarRadius*((a.value-d.getYMin())/(d.getYMax()-d.getYMin())),e=this.map.radarCenterX+d*Math.cos(b),f=this.map.radarCenterY+d*Math.sin(b),g=this.markerSize,h=this.markerSize;a.shape.startAngle=b;a.shape.endAngle=b+c;a.shape.radius=d;a.shape.x=e;a.shape.y=f;a.shape.width=g;a.shape.height=h;ia.IS_TOUCH_DEVICE?h=g=30:(g*=2,h*=2);g=Math.max(g,10);h=Math.max(h,10);a.hitArea.x=e-
g/2;a.hitArea.y=f-h/2;a.hitArea.width=g;a.hitArea.height=h};ia.RadarLayer.prototype.highlightItem=function(a){ia.IS_IE_TEN||(this.highlightContext.beginPath(),ia.Shape.drawCircle(this.highlightContext,this.map.radarCenterX,this.map.radarCenterY,this.map.radarRadius*2),this.highlightContext.clip());this._highlightMode=!0;this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);this._drawItem(a,this.highlightContext)};
ia.RadarLayer.prototype.selectItem=function(a){ia.IS_IE_TEN||(this.selectionContext.beginPath(),ia.Shape.drawCircle(this.selectionContext,this.map.radarCenterX,this.map.radarCenterY,this.map.radarRadius*2),this.selectionContext.clip());var b=this.selectionIds.length;this.selectionContext.fillStyle=ia.Color.toRGBA(this.selectionColor,0.2);if(this.colorPalette){var b=this.colorPalette.getColors(b),c=this.selectionIds.indexOf(a.id);this.selectionContext.strokeStyle=b[c];this.selectionContext.fillStyle=
ia.Color.toRGBA(b[c],0.2)}this._highlightMode=!1;this._drawItem(a,this.selectionContext)};ia.RadarLayer.prototype._drawItem=function(a,b){this.map.type=="radar"?this._drawLine(a,b):this._drawSegment(a,b)};
ia.RadarLayer.prototype._drawLine=function(a,b){var c=!0,d=a.childItems.length;b.beginPath();for(var e=0;e<d;e++){var f=a.childItems[e];f.value!=void 0?(c?b.moveTo(f.shape.x,f.shape.y):b.lineTo(f.shape.x,f.shape.y),c=!1):this.drawLinesThroughMissingValues!=!0&&(c=!0)}b.closePath();b.fill();b.stroke();b.fillStyle=this.style.fillStyle;for(e=0;e<d;e++)f=a.childItems[e],f.value!=void 0&&(b.beginPath(),ia.Shape.drawCircle(b,f.shape.x,f.shape.y,f.shape.width),b.fill(),b.stroke())};
ia.RadarLayer.prototype._drawSegment=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];e.value!=void 0&&(b.beginPath(),b.moveTo(this.map.radarCenterX,this.map.radarCenterY),b.lineTo(e.shape.x,e.shape.y),b.arc(this.map.radarCenterX,this.map.radarCenterY,e.shape.radius,e.shape.startAngle,e.shape.endAngle,!1),b.closePath(),b.fill(),b.beginPath(),b.arc(this.map.radarCenterX,this.map.radarCenterY,e.shape.radius,e.shape.startAngle,e.shape.endAngle,!1),b.stroke())}};
ia.RadarLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)?this.map.type=="radar"?this._hitPoint(a,b):this._hitSegment(a,b):!1};ia.RadarLayer.prototype._hitPoint=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&e.hitArea.intersects(b.x,b.y))return!0}};ia.RadarLayer.prototype._hitSegment=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&this._pointInSlice(e,b.x,b.y))return!0}};
ia.RadarLayer.prototype._pointInSlice=function(a,b,c){var d=a.shape.endAngle-a.shape.startAngle,e=this.map.radarCenterX,f=this.map.radarCenterY;return this._pointInPoly([{x:e,y:f},{x:e+a.shape.radius*Math.cos(a.shape.startAngle),y:f+a.shape.radius*Math.sin(a.shape.startAngle)},{x:e+a.shape.radius*Math.cos(a.shape.startAngle+d/4),y:f+a.shape.radius*Math.sin(a.shape.startAngle+d/4)},{x:e+a.shape.radius*Math.cos(a.shape.startAngle+d/2),y:f+a.shape.radius*Math.sin(a.shape.startAngle+d/2)},{x:e+a.shape.radius*
Math.cos(a.shape.startAngle+d/1.5),y:f+a.shape.radius*Math.sin(a.shape.startAngle+d/1.5)},{x:e+a.shape.radius*Math.cos(a.shape.startAngle+d),y:f+a.shape.radius*Math.sin(a.shape.startAngle+d)},{x:e,y:f}],b,c)};ia.RadarLayer.prototype._pointInPoly=function(a,b,c){var d,e,f=0;d=0;for(e=a.length-1;d<a.length;e=d++)a[d].y>c!=a[e].y>c&&b<(a[e].x-a[d].x)*(c-a[d].y)/(a[e].y-a[d].y)+a[d].x&&(f=!f);return f};
ia.RadarLayer.prototype.showTip=function(a,b){for(var c=a.childItems.length,d=0;d<c;d++){var e=a.childItems[d];if(e.value!=void 0&&(this.map.type=="radar"&&e.hitArea.intersects(b.x,b.y)||this.map.type=="rose"&&this._pointInSlice(e,b.x,b.y))){this.tipFunction!=void 0?this.map.datatip.text(this.tipFunction(a,e)):this.tip!=""?(c=this.tip,c=c.split("${featureName}").join(a.name),c=c.split("${themeName}").join(e.themeName),c=c.split("${indicatorName}").join(e.name),c=c.split("${value}").join(e.formattedValue),
this.map.datatip.text(c)):this.map.datatip.text(a.name+" : "+e.name+" : "+e.formattedValue);b.isTouchEvent?(c=b.x-this.map.datatip.getWidth()/2,e=b.y-(this.map.datatip.getHeight()+30)):(c=e.shape.x+e.shape.width/2-this.map.datatip.getWidth()/2,e=e.shape.y-e.shape.height/2-(this.map.datatip.getHeight()+5));this.map.datatip.position(c,e);this.map.datatip.show();break}}};ia.ComparisonRadarLayer=function(){ia.ComparisonRadarLayer.baseConstructor.call(this);this.isComparison=!0;this.displayAll=!1};
ia.extend(ia.RadarLayer,ia.ComparisonRadarLayer);
ia.ComparisonRadarLayer.prototype.render=function(){this.clear();for(var a in this.style)this.context[a]=this.style[a],this.highlightContext[a]=this.style[a],this.selectionContext[a]=this.style[a];this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor);this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,0.1);a=this.itemArray.length;for(var b=0;b<a;b++){for(var c=this.itemArray[b],d=c.childItems.length,e=0;e<d;e++){var f=c.childItems[e];f.value!=void 0&&this._setItemShape(f,
e,d)}this.displayAll&&this._renderItem(c)}this.renderSelection()};ia.ComparisonRadarLayer.prototype.clearSelection=function(){};ia.ComparisonRadarLayer.prototype._renderItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.context.strokeStyle=b.color}this._drawItem(a,this.context)};
ia.ComparisonRadarLayer.prototype.selectItem=function(a){if(this.thematic){var b=this.thematic.getClass(a.id);if(b)this.selectionContext.strokeStyle=b.color,this.selectionContext.fillStyle=ia.Color.toRGBA(b.color,0.2)}this._highlightMode=!1;this._drawItem(a,this.selectionContext)};ia.ComparisonRadarLayer.prototype.hitItem=function(a,b){return this.isSelected(a.id)||this.displayAll?this.map.type=="radar"?this._hitPoint(a,b):this._hitSegment(a,b):!1};
ia.MapMouseEvent=function(a,b,c,d,e,f,g,h,i,k,j){ia.MapMouseEvent.baseConstructor.call(this,b,c,f,g,a);this.x2=h;this.y2=i;this.dataX=d;this.dataY=e;this.map=a;this.pageX=k;this.pageY=j;this.isTouchEvent=b&&b.originalEvent?b.originalEvent.touches!=void 0?!0:!1:!1};ia.extend(ia.MouseEvent,ia.MapMouseEvent);ia.MapMouseEvent.MAP_PINCH_DOWN="mapPinchDown";ia.MapMouseEvent.MAP_PINCH_MOVE="mapPinchMove";ia.MapMouseEvent.MAP_PINCH_UP="mapPinchUp";ia.MapMouseEvent.MAP_MOUSE_CLICK="mapMouseClick";
ia.MapMouseEvent.MAP_MOUSE_DOWN="mapMouseDown";ia.MapMouseEvent.MAP_MOUSE_UP="mapMouseUp";ia.MapMouseEvent.MAP_MOUSE_MOVE="mapMouseMove";ia.MapMouseEvent.MAP_MOUSE_OVER="mapMouseOver";ia.MapMouseEvent.MAP_MOUSE_OUT="mapMouseOut";ia.MapMouseEvent.MAP_MOUSE_WHEEL="mapMouseWheel";ia.MapMouseEvent.MAP_MOUSE_WHEEL_END="mapMouseWheelEnd";ia.MapMouseEvent.MAP_MOUSE_DRAG="mapMouseDrag";ia.MapMouseEvent.MAP_MOUSE_DRAG_UP="mapMouseDragUp";
ia.Map=function(a){ia.Map.baseConstructor.call(this,a);this._bitmapMode=!1;this._mouseDownPixels=this._mouseDownCoords=this._imageDataBBox=void 0;this._doZoom=this._doPan=!1;this._userDefinedRect=void 0;this._doZoomWheel=!1;this._pinchCentreY=this._pinchCentreX=this._pinchDistance=this._wheelTimeout=void 0;this.container.addClass("ia-map");this.maintainAspectRatio=!0;this.controller=new ia.MapController(this);this.isDraggable=!0;var b=this;b.addEventListener(ia.Event.MAP_READY,function(){b.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,
b._bBoxChangeHandler.bind(b));b.addEventListener(ia.BBoxEvent.BBOX_SCALE,b._bBoxChangeHandler.bind(b))});this.markerLayer=new ia.MarkerLayer;this.markerLayer.setMap(this,this.foregroundContainer);this.markerLayer.setVisible(!0)};ia.extend(ia.CanvasBase,ia.Map);
ia.Map.prototype.useNavigation=function(a){a&&(this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_MOVE,this._onMouseMove.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DOWN,this._onMouseDown.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DRAG,this._onMouseDrag.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_DRAG_UP,this._onMouseDragUp.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_UP,this._onMouseUp.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OVER,
this._onMouseOver.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_OUT,this._onMouseOut.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_MOUSE_WHEEL,this._onMouseWheel.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_DOWN,this._onPinchDown.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_MOVE,this._onPinchMove.bind(this)),this.addEventListener(ia.MapMouseEvent.MAP_PINCH_UP,this._onPinchUp.bind(this)))};
ia.Map.prototype._bBoxChangeHandler=function(){this._bitmapMode?this._drawBitmap():this.render()};ia.Map.prototype.render=function(){this.mapContainer.css({"-moz-transform":"matrix(1, 0, 0, 1, 0, 0)","-webkit-transform":"matrix(1, 0, 0, 1, 0, 0)","-o-transform":"matrix(1, 0, 0, 1, 0, 0)",msTransform:"matrix(1, 0, 0, 1, 0, 0)",transform:"matrix(1, 0, 0, 1, 0, 0)"});for(var a=this.getLayers(),b=0;b<a.length;b++)a[b].render();this.markerLayer.render()};
ia.Map.prototype._drawBitmap=function(){var a=this.getPixelRect(this._imageDataBBox),b,c,d,e,f;this._doPan?(c=b=0,e=d=1,f=a.x,a=a.y):(b=this.mouseX,c=this.mouseY,d=this._imageDataBBox.getWidth()/this.bBox.getWidth(),e=this._imageDataBBox.getHeight()/this.bBox.getHeight(),a=f=0);this.mapContainer.css({"transform-origin":b+"px "+c+"px",msTransformOrigin:b+"px "+c+"px","-moz-transform-origin":b+"px "+c+"px","-webkit-transform-origin":b+"px "+c+"px","-o-transform-origin":b+"px "+c+"px","-moz-transform":"matrix("+
d+", 0, 0, "+e+", "+f+", "+a+")","-webkit-transform":"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")","-o-transform":"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")",msTransform:"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")",transform:"matrix("+d+", 0, 0, "+e+", "+f+", "+a+")"})};ia.Map.prototype._initBitmap=function(){this.datatip.hide();this._bitmapMode=!0;this._imageDataBBox=this.getBBox()};
ia.Map.prototype._drawRect=function(a,b,c){for(var d in c)a[d]=c[d];a.beginPath();a.rect(b.x,b.y,b.width,b.height);a.fill();a.stroke()};ia.Map.prototype._drawBBox=function(a,b,c){b=this.getPixelRect(b);this._drawRect(a,b,c)};ia.Map.prototype.zoomToFeatureWithId=function(a,b){for(var c=b||this.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e)if(f==a)return this.zoomToFeature(e[f]),!0}return!1};
ia.Map.prototype.zoomToFeatureWithName=function(a,b){for(var c=b||this.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e){var g=e[f];if(g.name==a)return this.zoomToFeature(g),!0}}return!1};
ia.Map.prototype.zoomToFeature=function(a){if(a.bBox&&a.bBox.getXMin()!=Infinity){var b=a.bBox.clone(),c=b.getWidth()*0.2,d=b.getHeight()*0.2,e=b.getXCenter(),f=b.getYCenter();b.setWidth(b.getWidth()+c*2);b.setHeight(b.getHeight()+d*2);b.setXCenter(e);b.setYCenter(f);this.maxZoom!=-1&&Math.min(b.getWidth(),b.getHeight())<this.maxZoom&&(e=b.getXCenter(),f=b.getYCenter(),b.setWidth(this.maxZoom),b.setHeight(this.maxZoom),b.setXCenter(e),b.setYCenter(f));a.layer.geometry=="point"?this.controller.centerOnCoords(b.getXCenter(),
b.getYCenter()):this.controller.zoomToBBox(b)}};
ia.Map.prototype.zoomToFeatures=function(a,b){if(a.length>0)if(a.length==1)this.zoomToFeatureWithId(a[0],b);else{for(var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=b||this.getLayers(),h=0;h<g.length;h++){var i=g[h].items;if(i!=void 0)for(var k=0;k<a.length;k++){var j=i[a[k]];j&&j.bBox&&(c=j.bBox.getXMin()<c?j.bBox.getXMin():c,d=j.bBox.getYMin()<d?j.bBox.getYMin():d,e=j.bBox.getXMax()>e?j.bBox.getXMax():e,f=j.bBox.getYMax()>f?j.bBox.getYMax():f)}}c!=Infinity&&d!=Infinity&&e!=Infinity&&f!=Infinity&&
(c=(new ia.BoundingBox(c,d,e,f)).addMargin(),this.maxZoom!=-1&&Math.min(c.getWidth(),c.getHeight())<this.maxZoom&&(ia.log("adjust it"),cx=c.getXCenter(),cy=c.getYCenter(),c.setWidth(this.maxZoom),c.setHeight(this.maxZoom),c.setXCenter(cx),c.setYCenter(cy)),this.controller.zoomToBBox(c))}};
ia.Map.prototype.centerOnFeature=function(a){for(var b=this.getLayers(),c=0;c<b.length;c++){var d=b[c].items,e;for(e in d)if(e==a)return a=d[e].bBox,this.controller.centerOnCoords(a.getXCenter(),a.getYCenter()),!0}return!1};ia.Map.prototype.zoomToLayer=function(a){this.controller.zoomToBBox(a.bBox.addMargin())};ia.Map.prototype._onMouseOver=function(){this._doZoomWheel=!0};ia.Map.prototype._onMouseOut=function(){this.datatip.hide();this._doZoomWheel=!1};
ia.Map.prototype._onMouseDown=function(){ia.disableTextSelection($j("body"));this._mouseDownCoords=this.mouseCoords();this._mouseDownPixels=new ia.Point(this.mouseX,this.mouseY);this._doZoom=this._doPan=!1;this._doPan=!0};ia.Map.prototype._onMouseUp=function(){this._doZoom=this._doPan=!1;ia.enableTextSelection($j("body"));if(this._bitmapMode)this._pinchDistance=void 0,this._bitmapMode=!1,this.render()};ia.Map.prototype._onMouseMove=function(){};
ia.Map.prototype._onMouseDrag=function(){var a=this.mouseCoords(),b=new ia.Point(this.mouseX,this.mouseY);if(this._doPan)this.datatip.hide(),this._bitmapMode==!1&&this._initBitmap(),ia.showMoveCursor(),a=this._mouseDownCoords.subtract(a),this.controller.translate(a.x,a.y);else if(this._doZoom)this._userDefinedRect=new ia.Rectangle(Math.min(this._mouseDownPixels.x,b.x),Math.min(this._mouseDownPixels.y,b.y),Math.abs(this._mouseDownPixels.x-b.x),Math.abs(this._mouseDownPixels.y-b.y)),this._drawRect(this.context,
this._userDefinedRect,{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"#CCCCCC",lineWidth:"0.5"})};ia.Map.prototype._onMouseDragUp=function(){var a=this.mouseCoords();this._pinchDistance=void 0;this._bitmapMode=!1;this._doZoom?this._userDefinedRect.width>5&&this._userDefinedRect.height>5&&this.controller.zoomToPointExtent(this._mouseDownCoords,a):this.render();ia.showDefaultCursor();this._doZoom=this._doPan=!1;ia.enableTextSelection($j("body"))};
ia.Map.prototype._onPinchDown=function(a){this._doZoom=this._doPan=!1;a=this._getPinchInfo(a);this._pinchDistance=a.distance;this._pinchCentreX=a.centreX;this._pinchCentreY=a.centreY};ia.Map.prototype._onPinchMove=function(a){this.datatip.hide();this._bitmapMode==!1&&this._initBitmap();a=this._getPinchInfo(a);this.mouseX=this._pinchCentreX;this.mouseY=this._pinchCentreY;this._pinchDistance!=void 0&&this.controller.zoomOnCursor(this._pinchDistance/a.distance);this._pinchDistance=a.distance};
ia.Map.prototype._onPinchUp=function(){this._pinchDistance=void 0;this._bitmapMode=!1;this.render()};ia.Map.prototype._getPinchInfo=function(a){var b=Math.min(a.x,a.x2),c=Math.min(a.y,a.y2),d=Math.max(a.x,a.x2),a=Math.max(a.y,a.y2),e=d-b,f=a-c;return{x1:b,y1:c,x2:d,y2:a,distanceX:e,distanceX:f,distance:Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),centreX:(b+d)/2,centreY:(c+a)/2}};
ia.Map.prototype._onMouseWheel=function(a){if(this._doZoomWheel)this.datatip.hide(),this._bitmapMode==!1&&this._initBitmap(),this.controller.zoomOnCursor(a.delta>0?1/1.4:1.4),clearTimeout(this._wheelTimeout),this._wheelTimeout=setTimeout(function(){clearTimeout(this._wheelTimeout);this._bitmapMode=!1;this.render();this.dispatchEvent(new ia.MapMouseEvent(this,a,ia.MapMouseEvent.MAP_MOUSE_WHEEL_END,this.mouseX,this.mouseY))}.bind(this),250)};
ia.GoogleMap=function(a,b,c,d,e,f,g){function h(){r==!1&&(i()?l.controller.zoomFull():l.commitChanges())}function i(){var a=o.getProjection(),b=m.gMap.getBounds(),c=b.getNorthEast();return b.getSouthWest().lng()>=c.lng()?!0:a.getWorldWidth()<=m.container.width()?!0:!1}function k(){var a=m.gMap.getBounds(),b;hw1=j(q);hw2=j(a);if(Math.floor(hw1.x)==0)b=0;else if(Math.floor(hw1.y)==0)b=0;else{b=hw2.x/hw1.x;var c=hw2.y/hw1.y;b=b<c?b:c;b=b<1?0:Math.floor(Math.log(b)/Math.log(2))}b>0&&p?m.gMap.setZoom(m.gMap.getZoom()+
b):(b=a.getNorthEast(),a=a.getSouthWest(),a=n.project(a.lng(),a.lat(),!0),b=n.project(b.lng(),b.lat(),!0),m.bBox.setXMin(a.x),m.bBox.setYMin(a.y),m.bBox.setXMax(b.x),m.bBox.setYMax(b.y),m.commitChanges());p=!1}function j(a){var b=o.getProjection(),c=b.fromLatLngToContainerPixel(a.getSouthWest()),a=b.fromLatLngToContainerPixel(a.getNorthEast());return new google.maps.Point(Math.abs(c.y-a.y),Math.abs(c.x-a.x))}ia.GoogleMap.baseConstructor.call(this);var m=this,n=new ia.GoogleMercatorProjection,l,o,
q,p=!1,r=!1,t=-1,s=-1;this.addMapOverlay=function(a){function b(){this.setMap(m.gMap)}l=a;l.embeddedInGoogleMaps=!0;l.isDraggable=!1;l.addEventListener(ia.Event.MAP_RESIZE,h);var c=m.controller.defaultBBox,a=n.unproject(c.getXMin(),c.getYMin(),!0),c=n.unproject(c.getXMax(),c.getYMax(),!0),a=new google.maps.LatLng(a.latitude,a.longitude),c=new google.maps.LatLng(c.latitude,c.longitude);m.defaultBounds=new google.maps.LatLngBounds(a,c);b.prototype=new google.maps.OverlayView;b.prototype.onAdd=function(){this.getPanes().overlayImage.appendChild(l.container.get(0))};
b.prototype.draw=function(){};b.prototype.onRemove=function(){l.container.parentNode.removeChild(l.container)};o=new b;var f=-1;google.maps.event.addListener(m.gMap,"zoom_changed",function(){var a=m.gMap.getZoom(),b=!0;d!=-1&&a<d&&(b=!1);e!=-1&&a>e&&(b=!1);a==f&&(b=!1);b&&(r=!0,f!=-1&&l.clear(),f=a)});google.maps.event.addListener(m.gMap,"idle",function(){l.clear();var a=o.getProjection();if(i()){var b=m.defaultBounds.getSouthWest(),c=m.defaultBounds.getNorthEast(),d=a.fromLatLngToDivPixel(b),c=a.fromLatLngToDivPixel(c),
e=Math.abs(c.x-d.x),f=Math.abs(d.y-c.y),d=d.x,g=c.y;if(m.controller.defaultBBox.getWidth()>=4E7)e=a.getWorldWidth(),a=a.fromLatLngToContainerPixel(b).x,b=m.container.width()/2,a>b&&(d-=e);l.container.css({left:d+"px",top:g+"px",width:e+"px",height:f+"px"})}else e=m.gMap.getBounds(),b=e.getSouthWest(),c=e.getNorthEast(),d=a.fromLatLngToDivPixel(b).x,g=a.fromLatLngToDivPixel(c).y,e=m.container.width(),f=m.container.height(),l.container.css({left:d+"px",top:g+"px",width:e+"px",height:f+"px"}),a=n.project(b.lng(),
b.lat(),!0),b=n.project(c.lng(),c.lat(),!0),l.getBBox().setXMin(a.x),l.getBBox().setYMin(a.y),l.getBBox().setXMax(b.x),l.getBBox().setYMax(b.y);Math.round(e)==Math.round(t)&&Math.round(f)==Math.round(s)&&l.render();t=e;s=f;r=!1});google.maps.event.addListener(m.gMap,"dragstart",function(){l.startDrag()});google.maps.event.addListener(m.gMap,"dragend",function(){l.endDrag()})};var u=google.maps.MapTypeId.ROADMAP;this.setMapType=function(a){if(a=="greyscale")u=f;else if(a=="off")u=g;else if(a=="normal")u=
google.maps.MapTypeId.ROADMAP;else if(a=="satellite")u=google.maps.MapTypeId.SATELLITE;else if(a=="hybrid")u=google.maps.MapTypeId.HYBRID;else if(a=="physical")u=google.maps.MapTypeId.TERRAIN};this.setBBox=function(a){if(m.gMap){a.equals(m.controller.defaultBBox)&&(p=!0);a.getXMin()<-2E7&&(a.setXMin(-2E7),m.adjustY(a));a.getXMax()>2E7&&(a.setXMax(2E7),m.adjustY(a));var b=n.unproject(a.getXMin(),a.getYMin(),!0),a=n.unproject(a.getXMax(),a.getYMax(),!0),b=new google.maps.LatLng(b.latitude,b.longitude),
a=new google.maps.LatLng(a.latitude,a.longitude);q=new google.maps.LatLngBounds(b,a);m.gMap.fitBounds(q)}};this.zoomToFeatureWithId=function(a){for(var b=l.getLayers(),c=0;c<b.length;c++){var d=b[c].items,e;for(e in d)if(e==a)return m.zoomToFeature(d[e]),!0}return!1};this.zoomToFeatureWithName=function(a,b){for(var c=b||l.getLayers(),d=0;d<c.length;d++){var e=c[d].items,f;for(f in e){var g=e[f];if(g.name==a)return m.zoomToFeature(g),!0}}return!1};this.zoomToFeature=function(a){a.bBox&&a.bBox.getXMin()!=
Infinity&&m.controller.zoomToBBox(a.bBox)};this.zoomToFeatures=function(a,b){for(var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=b||this.getLayers(),h=0;h<g.length;h++)for(var i=g[h].items,j=0;j<a.length;j++){var k=i[a[j]];k&&k.bBox&&(c=k.bBox.getXMin()<c?k.bBox.getXMin():c,d=k.bBox.getYMin()<d?k.bBox.getYMin():d,e=k.bBox.getXMax()>e?k.bBox.getXMax():e,f=k.bBox.getYMax()>f?k.bBox.getYMax():f)}c!=Infinity&&d!=Infinity&&e!=Infinity&&f!=Infinity&&(c=new ia.BoundingBox(c,d,e,f),m.controller.zoomToBBox(c))};
this.centerOnFeature=function(a){return this.zoomToFeature(a)};(function(){m.id=a;m.apiKey=c;m.setMapType(b);var h=new google.maps.StyledMapType([{featureType:"all",stylers:[{saturation:-80}]}],{name:f}),i=new google.maps.StyledMapType([{stylers:[{visibility:"off"}]}],{name:g}),j={panControl:!1,zoomControl:!1,streetViewControl:!1,overviewMapControl:!0,disableDoubleClickZoom:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,
google.maps.MapTypeId.TERRAIN,f,g]}};if(d!=-1)j.minZoom=d;if(e!=-1)j.maxZoom=e;m.container=$j("<div id='"+a+"' class='ia-map'>");m.mapContainer=$j("<div id='"+a+"-map-container'>");m.container.append(m.mapContainer);m.controller=new ia.MapController(m);var l;m.container.resize(function(){clearTimeout(l);l=setTimeout(function(){clearTimeout(l);var b=m.container.width(),c=m.container.height();if(m.mapContainer.width()!=b||m.mapContainer.height()!=c){m.mapContainer.width(b);m.mapContainer.height(c);
m.canvasWidth=b;m.canvasHeight=c;m.commitChanges();if(m.gMap==void 0)m.gMap=new google.maps.Map(document.getElementById(a+"-map-container"),j),google.maps.event.addListener(m.gMap,"bounds_changed",k),m.gMap.mapTypes.set(f,h),m.gMap.mapTypes.set(g,i),m.gMap.setMapTypeId(u),b=new ia.Event(ia.Event.MAP_READY,m),m.dispatchEvent(b);google.maps.event.trigger(m.gMap,"resize")}},500)})})()};ia.extend(ia.CartesianSpace,ia.GoogleMap);ia.MapController=function(a){this._map=a};
ia.MapController.prototype.panN=function(){this.pan(0)};ia.MapController.prototype.panNE=function(){this.pan(45)};ia.MapController.prototype.panE=function(){this.pan(90)};ia.MapController.prototype.panSE=function(){this.pan(135)};ia.MapController.prototype.panS=function(){this.pan(180)};ia.MapController.prototype.panSW=function(){this.pan(225)};ia.MapController.prototype.panW=function(){this.pan(270)};ia.MapController.prototype.panNW=function(){this.pan(315)};
ia.MapController.prototype.pan=function(a,b){b==null&&(b=0.5);var c=Math.abs(b),c=a>=45&&a<=135||a>=225&&a<=315?this._map.getBBox().getWidth()*c:this._map.getBBox().getHeight()*c;this.panDistance(a,c)};ia.MapController.prototype.panDistance=function(a,b){if(a>=0&&a<=360){var c=a*(Math.PI/180);this.translate(Math.sin(c)*b,Math.cos(c)*b)}};ia.MapController.prototype.centerOnCursor=function(){this.centerOnPoint(this._map.mouseCoords())};
ia.MapController.prototype.centerOnPoint=function(a){this.centerOnCoords(a.x,a.y)};ia.MapController.prototype.centerOnCoords=function(a,b){var c=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,d=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2;this.translate(a-c,b-d)};
ia.MapController.prototype.translate=function(a,b){var c=this._map.getBBox().getXMin()+a,d=this._map.getBBox().getYMin()+b,e=this._map.getBBox().getWidth(),f=this._map.getBBox().getHeight();this.resetBBox(c,d,e,f)};ia.MapController.prototype.zoomIn=function(){this.zoomOnCenter(0.5)};ia.MapController.prototype.zoomOut=function(){this.zoomOnCenter(2)};
ia.MapController.prototype.zoomOnCenter=function(a){a==null&&(a=0.5);var b=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,c=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2;this.zoomOnCoords(b,c,a)};ia.MapController.prototype.zoomInOnCursor=function(){this.zoomOnPoint(this._map.mouseCoords(),0.5)};ia.MapController.prototype.zoomOutOnCursor=function(){this.zoomOnPoint(this._map.mouseCoords(),2)};
ia.MapController.prototype.zoomOnCursor=function(a){a==null&&(a=0.5);this.zoomOnPoint(this._map.mouseCoords(),a)};ia.MapController.prototype.zoomOnPoint=function(a,b){b==null&&(b=0.5);this.zoomOnCoords(a.x,a.y,b)};
ia.MapController.prototype.zoomOnCoords=function(a,b,c){c==null&&(c=0.5);var d=Math.abs(c),c=this._map.getBBox().getWidth()*d;d*=this._map.getBBox().getHeight();a-=(a-this._map.getBBox().getXMin())/this._map.getBBox().getWidth()*c;b-=(b-this._map.getBBox().getYMin())/this._map.getBBox().getHeight()*d;this.resetBBox(a,b,c,d)};ia.MapController.prototype.zoomToPointExtent=function(a,b){this.resetBBox(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.abs(a.x-b.x),Math.abs(a.y-b.y))};
ia.MapController.prototype.zoomToExtent=function(a){var b=this._map.getBBox().getXMin()+this._map.getBBox().getWidth()/2,c=this._map.getBBox().getYMin()+this._map.getBBox().getHeight()/2,d=a.width,a=a.height;this.resetBBox(b-d/2,c-a/2,d,a)};ia.MapController.prototype.changeBBox=function(a,b,c,d){a=this._map.getBBox().getXMin()+a;b=this._map.getBBox().getYMin()+b;c=this._map.getBBox().getXMax()+c;d=this._map.getBBox().getYMax()+d;this.resetBBox(a,b,c-a,d-b)};
ia.MapController.prototype.zoomToRect=function(a){a.width>5&&a.height>5&&this.zoomToBBox(this.getDataBBox(a))};ia.MapController.prototype.zoomFull=function(){this.zoomToBBox(this.defaultBBox)};ia.MapController.prototype.zoomToBBox=function(a){a&&this._map.setBBox(a)};ia.MapController.prototype.resetBBox=function(a,b,c,d){this.zoomToBBox(new ia.BoundingBox(a,b,a+c,b+d))};
ia.FeatureLayer=function(a){ia.FeatureLayer.baseConstructor.call(this);this.renderDisabledFeatures=!0;this.dataLabel="";this.minLabelExtent=-Infinity;this.maxLabelExtent=Infinity;this.symbolSize=15;this.iconPath="";this.eval=!0;this.uid="";this.symbol=ia.Shape.CIRCLE;this.highlightOpacity=this.selectionOpacity=0.3;this.labelFunction=void 0;this.labelPosition="top-right";this.displayLabelsOnly=!1;if(a!=null)this.source=a};ia.extend(ia.ItemLayer,ia.FeatureLayer);
ia.FeatureLayer.prototype.loadSource=function(a){var b=this;ia.File.load({url:b.source,dataType:"json",onSuccess:function(c){b.parseData(c);b.isLoaded=!0;b.render();c=new ia.Event(ia.Event.LAYER_READY,b);b.dispatchEvent(c);a!=void 0&&a.call(null)}})};
ia.FeatureLayer.prototype.parseData=function(a){this.items={};this.itemArray=[];if(a.e!=void 0)this.eval=!1;if(a.uid!=void 0)this.uid=a.uid;for(var b=a.boundingBox.split(" "),c=new ia.BoundingBox(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),b=c.getXMin(),d=c.getYMin(),e=c.getWidth(),c=c.getHeight(),f=parseFloat(a.pixelWidth),g=parseFloat(a.pixelHeight),h=Infinity,i=Infinity,k=-Infinity,j=-Infinity,m=a.features.length,n=0;n<m;n++){var l=a.features[n],o={};o.state=ia.ItemLayer.UNSELECTED;
o.layer=this;o.id=l.d;o.name=l.n;o.parent=this;o.symbolSize=this.symbolSize;if(this.geometry=="line")o.symbolSize=this.style.lineWidth;if(this.geometry=="polygon"||this.geometry=="line"){for(var q=Infinity,p=Infinity,r=-Infinity,t=-Infinity,s=l.p.length,u=[],v=0;v<s;v++){for(var w=l.p[v],x=w.length-1,y=[],B=0,C=0,A=0;A<x;A+=2){var D={};B+=w[A];C+=w[A+1];D.x=b+B/f*e;D.y=d+C/g*c;y.push(D);q=D.x<q?D.x:q;p=D.y<p?D.y:p;r=D.x>r?D.x:r;t=D.y>t?D.y:t}u.push(y)}o.shapes=u;l=this._getLargestItemShape(o);o.centerOfGravity=
this._getCenterOfGravity(l)}else D={},D.x=b+l.p[0]/f*e,D.y=d+l.p[1]/g*c,q=D.x,p=D.y,r=D.x,t=D.y,o.shapes=[D];o.bBox=new ia.BoundingBox(q,p,r,t);o.size=Math.max(o.bBox.getWidth(),o.bBox.getHeight());this.items[o.id]=o;this.itemArray.push(o);h=q<h?q:h;i=p<i?p:i;k=r>k?r:k;j=t>j?t:j}this.bBox=new ia.BoundingBox(h,i,k,j);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};
ia.FeatureLayer.prototype._getLargestItemShape=function(a){for(var b=a.shapes.length,c=0,d=a.shapes[0],e=0;e<b;e++){var f=a.shapes[e],g=this._getArea(f);g>c&&(c=g,d=f)}return d};ia.FeatureLayer.prototype._getArea=function(a){for(var b=0,c=a.length,d=c-1,e,f=0;f<c;d=f++)e=a[f],d=a[d],b+=e.x*d.y,b-=e.y*d.x;b/=2;return b};
ia.FeatureLayer.prototype._getCenterOfGravity=function(a){var b=a.length,c=0,d=0,e;e=b-1;for(var f,g,h=0;h<b;e=h++)f=a[h],g=a[e],e=f.x*g.y-g.x*f.y,c+=(f.x+g.x)*e,d+=(f.y+g.y)*e;e=this._getArea(a)*6;return{x:c/e,y:d/e}};ia.FeatureLayer.prototype.render=function(){this.map&&this.getVisible()&&this.isLoaded&&(this.clear(),this.draw())};
ia.FeatureLayer.prototype.draw=function(){if(this.map&&this.getVisible()&&this.isLoaded){for(var a in this.style)if(this.context[a]=this.style[a],this.interactive||this.highlightable)this.selectionContext&&(this.selectionContext[a]=this.style[a]),this.highlightContext&&(this.highlightContext[a]=this.style[a]);if(this.interactive||this.highlightable){if(this.selectionContext)this.selectionContext.strokeStyle=this.selectionColor,this.selectionContext.fillStyle=ia.Color.toRGBA(this.selectionColor,this.selectionOpacity),
this.selectionContext.lineWidth=Math.max(2,parseFloat(this.style.lineWidth)+1.5);if(this.highlightContext)this.highlightContext.strokeStyle=ia.Color.toRGBA(this.highlightColor,0.8),this.highlightContext.fillStyle=ia.Color.toRGBA(this.highlightColor,this.highlightOpacity),this.highlightContext.lineWidth=Math.max(2,parseFloat(this.style.lineWidth)+1.5)}a=this.getData();var b=this.map.getBBox(),c=!1,d=Math.min(b.getWidth(),b.getHeight()),e=Math.max(b.getWidth(),b.getHeight());d>=this.minLabelExtent&&
e<=this.maxLabelExtent&&(c=!0);d=this.itemArray.length;for(e=0;e<d;e++){var f=this.itemArray[e];if(this.dataChanged){var g=a[f.id];if(g){f.name=g.name;f.disabled=!1;var h=ia.Color.a(this.style.fillStyle);if(g.color)f.color=ia.Color.toRGBA(g.color,h);f.symbolSize=g.symbolSize}else f.disabled=!0,f.color=this.style.fillStyle,f.symbolSize=0}this.geometry!="point"&&f.bBox&&f.bBox.intersects(b)&&(this.renderItem(f),this.showLabels&&c&&this.renderItemLabel(f))}this.geometry=="point"&&(this.thematic&&this.thematic.heatmap?
this._drawHeatmap(a,b,c):this._drawPoints(a,b,c));if(this.dataChanged)this.dataChanged=!1;this.renderSelection()}};ia.FeatureLayer.prototype._drawPoints=function(a,b,c){this.itemArray.sort(function(a,b){return a.symbolSize<b.symbolSize?1:a.symbolSize>b.symbolSize?-1:0});for(var a=this.itemArray.length,d=0;d<a;d++){var e=this.itemArray[d];if(e.bBox&&e.bBox.intersects(b)&&(e.symbolSize>0||this.displayLabelsOnly))this.renderItem(e),this.showLabels&&c&&this.renderItemLabel(e)}};
ia.FeatureLayer.prototype._drawHeatmap=function(a,b,c){if(typeof h337!=="undefined"){if(this._heatmap==void 0)this._heatmap=h337.create({canvas:this.canvas});var d=this.symbolSize/2,b=this.thematic.heatmapradius;b!=void 0&&ia.isNumber(b)&&(d=this.map.getPixelWidth(b),d=Math.max(d,1),d=Math.min(d,this.map.canvasWidth));for(var b=Infinity,e=-Infinity,f=[],g=this.itemArray.length,h=0;h<g;h++){for(var i=this.itemArray[h],k=a[i.id],j=i.shapes.length,m=0;m<j;m++)if(k!=void 0){var n=i.shapes[m],l=this.map.getPixelX(n.x),
n=this.map.getPixelY(n.y),o=k[this.dataField];ia.isNumber(o)&&(b=Math.min(b,o),e=Math.max(e,o),f.push({x:l,y:n,value:o,radius:d}))}this.showLabels&&c&&this.renderItemLabel(i)}a=this.thematic.numericClassifier.colorPalette.getColorList();g=a.length;c={};for(h=0;h<g;h++)pos=h/(g-1),c[pos]=a[h];this._heatmap._renderer.setDimensions(this.map.canvasWidth,this.map.canvasHeight);this._heatmap.configure({gradient:c});this._heatmap.setData({max:e,min:b,data:f})}};
ia.FeatureLayer.prototype.selectItem=function(a){this._drawItem(a,this.selectionContext)};ia.FeatureLayer.prototype.highlightItem=function(a){this._drawItem(a,this.highlightContext)};ia.FeatureLayer.prototype.renderItem=function(a){if((a!=void 0&&this.renderDisabledFeatures==!0||a.disabled==!1)&&!this.displayLabelsOnly){if(a.color&&(this.context.fillStyle=a.color,this.geometry=="line"))this.context.strokeStyle=a.color;this._drawItem(a,this.context)}};
ia.FeatureLayer.prototype._drawItem=function(a,b){if(a!=void 0&&this.getVisible()&&b&&!this.displayLabelsOnly){b.beginPath();var c=a.shapes.length;if(this.geometry=="polygon")for(var d=0;d<c;d++){var e=a.shapes[d],f=e.length;b.moveTo(this.map.getPixelX(e[0].x),this.map.getPixelY(e[0].y));for(var g=1;g<f;g++)b.lineTo(this.map.getPixelX(e[g].x),this.map.getPixelY(e[g].y))}else if(this.geometry=="point")for(d=0;d<c;d++)e=a.shapes[d],f=this.map.getPixelX(e.x),e=this.map.getPixelY(e.y),this.thematic&&
this.thematic.heatmap?ia.Shape.draw(this.symbol,b,f,e,15):this.icon!=void 0?b.drawImage(this.icon,f-this.icon.width/2,e-this.icon.height/2,this.icon.width,this.icon.height):this.type=="contextual-layer"?ia.Shape.draw(this.symbol,b,f,e,this.symbolSize):(a.symbolSize>0||this.displayLabelsOnly)&&ia.Shape.draw(this.symbol,b,f,e,a.symbolSize);else if(this.geometry=="line"&&(a.symbolSize>0||this.displayLabelsOnly)){for(d=0;d<c;d++){e=a.shapes[d];f=e.length;b.moveTo(this.map.getPixelX(e[0].x),this.map.getPixelY(e[0].y));
for(g=1;g<f;g++)b.lineTo(this.map.getPixelX(e[g].x),this.map.getPixelY(e[g].y))}b.lineWidth=a.symbolSize}this.geometry!="line"&&b.fill();b.stroke()}};
ia.FeatureLayer.prototype.renderItemLabel=function(a){this.labelCanvas==void 0&&this.addLabelCanvas();var b=a.name;this.labelFunction!=void 0&&(b=this.labelFunction.call(null,a));var c,d;if(this.geometry=="polygon")a.centerOfGravity?(c=this.map.getPixelX(a.centerOfGravity.x),d=this.map.getPixelY(a.centerOfGravity.y)):(c=this.map.getPixelX(a.bBox.getXCenter()),d=this.map.getPixelY(a.bBox.getYCenter())),this.labelContext.textBaseline="middle",this.labelContext.textAlign="center";else{c=this.map.getPixelX(a.bBox.getXCenter());
d=this.map.getPixelY(a.bBox.getYCenter());a=a.symbolSize;if(this.type=="contextual-layer")a=this.symbolSize;if(this.icon)a=this.icon.width;this.labelPosition.indexOf("left")!=-1?(this.labelContext.textAlign="right",c-=a/2):this.labelPosition.indexOf("right")!=-1?(this.labelContext.textAlign="left",c+=a/2):this.labelContext.textAlign="center";this.labelPosition.indexOf("top")!=-1?(this.labelContext.textBaseline="bottom",d-=a/2):this.labelPosition.indexOf("bottom")!=-1?(this.labelContext.textBaseline=
"top",d+=a/2):this.labelContext.textBaseline="middle";this.labelPosition=="left"&&(c-=5);this.labelPosition=="right"&&(c+=5)}this.labelContext.strokeText(b,c,d);this.labelContext.fillText(b,c,d)};
ia.FeatureLayer.prototype.hitItem=function(a,b){var c=b.dataX,d=b.dataY;if(this.geometry=="point")for(var e=a.shapes,f,g=0;g<e.length;g++){if(f=e[g],f=this.thematic&&this.thematic.heatmap?this._pointInRect(15,15,f,c,d):this.iconPath!=""?this._pointInRect(this.icon.width,this.icon.height,f,c,d):this._pointInRect(a.symbolSize,a.symbolSize,f,c,d))return!0}else if(this.geometry=="polygon"){if(a.bBox)if(c<a.bBox.left()||c>a.bBox.right())return!1;else if(d>a.bBox.top()||d<a.bBox.bottom())return!1;e=a.shapes;
for(g=0;g<e.length;g++)if(f=this._pointInPoly(e[g],c,d))return!0}else if(this.geometry=="line"){if(a.bBox)if(c<a.bBox.left()||c>a.bBox.right())return!1;else if(d>a.bBox.top()||d<a.bBox.bottom())return!1;c=a.shapes;for(g=0;g<c.length;g++)if(f=this._pointInLine(c[g],b.x,b.y))return!0}return!1};
ia.FeatureLayer.prototype._pointInLine=function(a,b,c){for(var b=new ia.Rectangle(b-4,c-4,8,8),c=a.length,d=0;d<c-1;d++){var e=this.map.getPixelX(a[d].x),f=this.map.getPixelY(a[d].y),g=this.map.getPixelX(a[d+1].x),h=this.map.getPixelY(a[d+1].y);if(b.intersectsLine({x:e,y:f},{x:g,y:h}))return!0}return!1};ia.FeatureLayer.prototype._pointInPoly=function(a,b,c){var d,e,f=0;d=0;for(e=a.length-1;d<a.length;e=d++)a[d].y>c!=a[e].y>c&&b<(a[e].x-a[d].x)*(c-a[d].y)/(a[e].y-a[d].y)+a[d].x&&(f=!f);return f};
ia.FeatureLayer.prototype._pointInRect=function(a,b,c,d,e){var f=c.x,c=c.y,a=this.map.getDataWidth(a),b=this.map.getDataHeight(b);return d>=f-a/2&&d<=f+a/2&&e>=c-b/2&&e<=c+b/2?!0:!1};
ia.FeatureLayer.prototype.showTip=function(a,b){this.map.datatip.text(this.tipFunction(a));var c,d;ia.IS_TOUCH_DEVICE?(c=b.x-this.map.datatip.getWidth()/2,d=b.y-(this.map.datatip.getHeight()+30)):this.geometry=="point"?(c=this.map.getPixelX(a.bBox.getXCenter())+a.symbolSize/2,d=this.map.getPixelY(a.bBox.getYCenter())-a.symbolSize/2-this.map.datatip.getHeight()):(c=b.x+10,d=b.y-this.map.datatip.getHeight());this.map.datatip.position(c,d);this.map.datatip.show()};
ia.ImageLayer=function(){ia.ImageLayer.baseConstructor.call(this,"");$j.support.cors=!0;this.version=this.srs=this.layers=this.params=this.url="";this.opacity=1;this._items=[]};ia.extend(ia.LayerBase,ia.ImageLayer);ia.ImageLayer.prototype._items=[];ia.ImageLayer.prototype._renderTimeout=void 0;
ia.ImageLayer.prototype.render=function(){var a=this;if(a.map&&a.getVisible())a.clear(),a.draw(a.context),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(function(){var b=a.map.getBBox(),c=!0;if(a._items.length>0){var d=a._items[a._items.length-1];b.equals(d.bbox)&&(c=!1)}if(c){for(;a._items.length>10;)a._items.shift();d={};d.img=new Image;d.bbox=b.clone();d.img.onload=function(){a._items[a._items.length]=d;a.clear();a.draw(a.context)};a.exportable?(b=new XMLHttpRequest,b.onload=
function(){if(this.status==200){for(var a=new Uint8Array(this.response),b=a.length,c=Array(b);b--;)c[b]=String.fromCharCode(a[b]);a=c.join("");a=window.btoa(a);d.img.src="data:image/png;base64,"+a}},b.onerror=function(){a.exportable=!1;a.render()},c=a.getUrl(d.bbox,a.map.canvasWidth,a.map.canvasHeight),b.open("GET",ia.getDomainSafeUrl(c),!0),b.responseType="arraybuffer",b.send()):(c=a.getUrl(d.bbox,a.map.canvasWidth,a.map.canvasHeight),d.img.src=ia.getDomainSafeUrl(c))}},100)};
ia.ImageLayer.prototype.draw=function(a){try{if(this._items.length>0){var b=this._items[this._items.length-1],c=this.map.getPixelRect(b.bbox);a.save();a.globalAlpha=this.opacity;a.drawImage(b.img,c.x,c.y,c.width,c.height);a.restore()}}catch(d){ia.log(d)}};ia.ImageLayer.prototype.getUrl=function(){};ia.TileLayer=function(a){ia.TileLayer.baseConstructor.call(this);this._tileCache=[];this.path="./";this.minExtent=-Infinity;this.maxExtent=Infinity;if(a!=null)this.source=a};ia.extend(ia.LayerBase,ia.TileLayer);
ia.TileLayer.prototype.render=function(){if(this.map&&this.getVisible()&&this.isLoaded){this.clear();var a=this.map.getBBox(),a=Math.min(a.getWidth(),a.getHeight());if(a>this.minExtent&&a<this.maxExtent)for(var a=this.map.getBBox(),b=this._tileCache.length,c=0;c<b;c++){var d=this._tileCache[c];d.bBox.intersects(a)&&this._renderTile(d)}}};
ia.TileLayer.prototype._renderTile=function(a){if(a.image){var b=this.map.getPixelRect(a.bBox);this.context.drawImage(a.image,b.x,b.y,b.width,b.height)}else{var c=this,d=new Image;d.onload=function(){a.image=d;c._renderTile(a)};d.src=a.path}};ia.TileLayer.prototype.loadSource=function(){var a=this;ia.File.load({url:a.source,dataType:"json",onSuccess:function(b){a.parseData(b);a.isLoaded=!0;a.render();b=new ia.Event(ia.Event.LAYER_READY,a);a.dispatchEvent(b)}})};
ia.TileLayer.prototype.parseData=function(a){this.path.indexOf("/",this.path.length-1)==-1&&(this.path+="/");var b=ia.File.getFileDirectory(this.source)+this.path,c=a.boundingBox.split(" "),d=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),e=parseFloat(a.pixelWidth),f=parseFloat(a.pixelHeight),g=a.tileWidth/e*d.getWidth(),h=a.tileHeight/f*d.getHeight(),i=this;$j.each(a.tiles,function(c,j){var m=d.getXMin()+j.x/e*d.getWidth(),n=m+g,l=d.getYMax()-j.y/f*d.getHeight(),
o=l-h,q={};q.id=j.id;q.bBox=new ia.BoundingBox(m,o,n,l);q.path=b+q.id+"."+a.tileExtension;i._tileCache[i._tileCache.length]=q})};
ia.WebTileLayer=function(a){ia.WebTileLayer.baseConstructor.call(this);this._tileCache=[];this._noTiles=0;this._tileInfo={rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},
{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,
scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]};this._fullExtent={xmin:-2.0037507067161843E7,ymin:-1.9971868880408604E7,xmax:2.0037507067161843E7,ymax:1.99718688804085E7};if(a.indexOf("MapServer")!=
-1){var b=this;ia.FeatureServiceReader.getInfo(a,ia.accessToken,function(a,d){b.token=d;b._tileInfo=a.tileInfo;b._fullExtent=a.fullExtent;b.isLoaded=!0;b.render()})}else this.isLoaded=!0};ia.extend(ia.LayerBase,ia.WebTileLayer);ia.WebTileLayer.prototype._noTiles=0;ia.WebTileLayer.prototype._tileCache=[];ia.WebTileLayer.prototype._renderTimeout=void 0;
ia.WebTileLayer.prototype.render=function(){var a=this;if(a.map&&a.getVisible()&&a.isLoaded){var b=window.location.protocol=="file:"?"http:":window.location.protocol;a.clear();a.draw(a.context);clearTimeout(a._renderTimeout);a._renderTimeout=setTimeout(function(){for(var c=a.map.getDataWidth(1),d=a._tileInfo.lods,e=d[0],f=Math.abs(c-e.resolution),g=0;g<d.length;g++){var h=Math.abs(c-d[g].resolution);h<f&&(f=h,e=d[g])}var c=e.resolution*a._tileInfo.rows,d=e.resolution*a._tileInfo.cols,f=a._tileInfo.origin,
i=a.map.getBBox(),g=Math.max(i.getXMin(),a._fullExtent.xmin),h=Math.min(i.getYMax(),a._fullExtent.ymax),k=Math.min(i.getXMax(),a._fullExtent.xmax),i=Math.max(i.getYMin(),a._fullExtent.ymin),g=Math.floor((g-f.x)/c),h=Math.floor((f.y-h)/d),k=Math.floor((k-f.x)/c),i=Math.floor((f.y-i)/d);g<0&&(g=0);h<0&&(h=0);a._noTiles=(k+1-g)*(i+1-h);var j=0,m=[];a.url.indexOf("OpenStreetMap")!=-1?m=["a","b","c"]:a.url.indexOf("MapQuest")!=-1&&(m=["1","2","3","4"]);for(a._tileCache=[];g<=k;g++)for(var n=h;n<=i;n++){var l=
{},o=f.x+g*c,q=f.y-n*d,p=o+c,r=q-d;l.url=a.url.indexOf("OpenStreetMap")!=-1?b+"//"+m[j]+".tile.openstreetmap.org/"+e.level+"/"+g+"/"+n+".png":a.url.indexOf("MapQuestSat")!=-1?b+"//otile"+m[j]+".mqcdn.com/tiles/1.0.0/sat/"+e.level+"/"+g+"/"+n+".png":a.url.indexOf("MapQuestOsm")!=-1?b+"//otile"+m[j]+".mqcdn.com/tiles/1.0.0/osm/"+e.level+"/"+g+"/"+n+".png":a.url+"/tile/"+e.level+"/"+n+"/"+g;a.token!=void 0&&(l.url+="?token="+a.token);l.bBox=new ia.BoundingBox(o,r,p,q);a._loadTile(l);j++;j>=m.length&&
(j=0)}},100)}};ia.WebTileLayer.prototype.draw=function(){for(var a=0;a<this._tileCache.length;a++)this._drawTile(this._tileCache[a])};ia.WebTileLayer.prototype._drawTile=function(a){if(a.img){this.context.save();this.context.globalAlpha=this.opacity;var b=this.map.getPixelRect(a.bBox);this.context.drawImage(a.img,b.x,b.y,b.width,b.height);this.context.restore()}};
ia.WebTileLayer.prototype._loadTile=function(a){var b=this,c=new Image;c.onload=function(){a.img=this;b._tileCache.push(a);b._drawTile(a);b._tileCache.length>=b._noTiles&&(b.clear(),b.draw(b.context))};if(b.exportable){var d=new XMLHttpRequest;d.onload=function(){if(this.status==200){for(var a=new Uint8Array(this.response),d=a.length,g=Array(d);d--;)g[d]=String.fromCharCode(a[d]);a=g.join("");a=window.btoa(a);c.src="data:image/png;base64,"+a}else b._noTiles--,b._tileCache.length>=b._noTiles&&(b.clear(),
b.draw(b.context))};d.onerror=function(){b.exportable=!1;b.render()};d.open("GET",ia.getDomainSafeUrl(a.url),!0);d.responseType="arraybuffer";d.send()}else c.src=ia.getDomainSafeUrl(a.url)};ia.AGSLayer=function(){ia.AGSLayer.baseConstructor.call(this)};ia.extend(ia.ImageLayer,ia.AGSLayer);
ia.AGSLayer.prototype.getUrl=function(a,b,c){var d=this.url;this.url.indexOf("?")==-1&&(d+="?");this.url.charAt(this.url.length-1)!="&"&&this.url.charAt(this.url.length-1)!="?"&&(d+="&");d+="bbox="+a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax();this.params.toLowerCase().indexOf("f=")<0&&(d+="&f=image");this.params.toLowerCase().indexOf("layers=")<0&&(d+="&layers="+this.layers);this.params.toLowerCase().indexOf("bboxsr=")<0&&(d+="&bboxSR="+this.srs);this.params.toLowerCase().indexOf("imagesr=")<
0&&(d+="&imageSR="+this.srs);this.params.toLowerCase().indexOf("format=")<0&&(d+="&format=jpg");this.params.toLowerCase().indexOf("size=")<0&&(d+="&size="+Math.round(b)+","+Math.round(c));this.params.indexOf("&")!=0&&(d+="&");d+=this.params;return d};
ia.FeatureServiceLayer=function(a){ia.FeatureServiceLayer.baseConstructor.call(this,a);this._firstRender=!0;this._renderQueue=this._rendering=!1;this._maxRecordCount=Infinity;this.nameField=this.idField=this._objectIdField="";this.srs=102100;this.esriGeometryType=""};ia.extend(ia.FeatureLayer,ia.FeatureServiceLayer);
ia.FeatureServiceLayer.prototype.loadSource=function(a){var b=this;b.eval=!1;ia.FeatureServiceReader.getInfo(b.source,ia.accessToken,function(c,d){b.token=d;b.esriGeometryType=c.geometryType;b._objectIdField=c.objectIdField;if(b._objectIdField==void 0)for(var e in c.fields)if(c.fields[e].type=="esriFieldTypeOID"){b._objectIdField=c.fields[e].name;break}b._maxRecordCount=Infinity;if(c.maxRecordCount!=void 0)b._maxRecordCount=ia.parseInt(c.maxRecordCount);b.items={};b.itemArray=[];b.fieldNames=[];for(e in c.fields)b.fieldNames.push(c.fields[e].name);
if(b.geometry=="line")b.symbolSize=b.style.lineWidth;e=[];e[e.length]=b._objectIdField;if(b.idField!=b._objectIdField)e[e.length]=b.idField;if(b.nameField!=b._objectIdField&&b.nameField!=b.idField)e[e.length]=b.nameField;e=ia.FeatureServiceReader.buildQuery(b.source,e);b.objectIds!=void 0&&(e=e+"&objectIds="+b.objectIds);b._buildFeatures(e,function(){a&&a.call(null);if(b.isLoaded==!1){b.isLoaded=!0;b.render();var c=new ia.Event(ia.Event.LAYER_READY,b);b.dispatchEvent(c)}})})};
ia.FeatureServiceLayer.prototype._buildFeatures=function(a,b){var c=this;ia.FeatureServiceReader.sendQuery(a,c.token,function(a){for(var e=a.length,f=0;f<e;f++){var g=a[f],h={};h.objectId=String(g.attributes[c._objectIdField]);h.id=String(g.attributes[c.idField]);h.name=String(g.attributes[c.nameField]);h.parent=c;h.state=ia.ItemLayer.UNSELECTED;h.layer=c;h.symbolSize=c.symbolSize;h.shapes=[];h.id.indexOf("#")!=0&&(c.items[h.id]=h,c.itemArray.push(h))}b&&b.call(null)})};
ia.FeatureServiceLayer.prototype.render=function(){if(this.map&&this.getVisible()&&this.isLoaded)this._rendering==!1?(this._rendering=!0,this._updateItems(function(){this._rendering=!1;if(this._renderQueue)this._renderQueue=!1,this.render()}.bind(this))):(this._firstRender&&(this.clear(),this.draw()),this._renderQueue=!0)};
ia.FeatureServiceLayer.prototype._updateItems=function(a){if(this.map&&this.getVisible()){var b=Infinity,c=Infinity,d=-Infinity,e=-Infinity;this.clear();this.draw();var f=[];f[f.length]=this._objectIdField;if(this.idField!=this._objectIdField)f[f.length]=this.idField;if(this.nameField!=this._objectIdField&&this.nameField!=this.idField)f[f.length]=this.nameField;for(var g=this.map.getDataWidth(1),h=[],i=[],k=[],j=this.map.getBBox(),m=0,n=[],l=[],o=this.itemArray.length,q=0;q<o;q++){var p=this.itemArray[q];
if(p.bBox==void 0)l[l.length]=p,k[k.length]=p,n[n.length]=p.objectId,m++;else if(p.bBox.intersects(j)&&(l[l.length]=p,k[k.length]=p,p.maxAllowableOffset>g))n[n.length]=p.objectId,m++;p.bBox!=void 0&&(b=p.bBox.getXMin()<b?p.bBox.getXMin():b,c=p.bBox.getYMin()<c?p.bBox.getYMin():c,d=p.bBox.getXMax()>d?p.bBox.getXMax():d,e=p.bBox.getYMax()>e?p.bBox.getYMax():e);if(m==this._maxRecordCount||q==o-1&&n.length>0)h[h.length]=n,i[i.length]=l,m=0,n=[],l=[]}this.bBox=new ia.BoundingBox(b,c,d,e);if(h.length>0){var r=
h.length,t=0,s=this,u=function(b){s._firstRender&&t==0&&s.clear();s.parseData(b,g);s._firstRender&&s._renderItems(i[t]);t++;s._renderQueue==!0?a.call(null):t==r?(s._firstRender||(s.clear(),s._renderItems(k)),s.renderSelection(),s._firstRender=!1,a.call(null)):ia.FeatureServiceReader.getFeatureGeometry(s.source,s.token,h[t],f,s.srs,g,u)};ia.FeatureServiceReader.getFeatureGeometry(s.source,s.token,h[t],f,s.srs,g,u)}else this.renderSelection(),a.call(null)}};
ia.FeatureServiceLayer.prototype.parseData=function(a,b){var c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g="rings";this.geometry=="line"&&(g="paths");for(var h=a.length,i=0;i<h;i++){var k=a[i],j=this.items[String(k.attributes[this.idField])];if(j){j.maxAllowableOffset=b;if(this.geometry=="polygon"||this.geometry=="line"){var m=Infinity,n=Infinity,l=-Infinity,o=-Infinity;if(k.geometry){for(var q=k.geometry[g].length,p=[],r=0;r<q;r++){for(var t=k.geometry[g][r],s=t.length,u=[],v=0;v<s;v++){var w=
t[v],x={};x.x=w[0];x.y=w[1];u.push(x);m=x.x<m?x.x:m;n=x.y<n?x.y:n;l=x.x>l?x.x:l;o=x.y>o?x.y:o}p.push(u)}j.shapes=p;k=this._getLargestItemShape(j);j.centerOfGravity=this._getCenterOfGravity(k)}}else if(this.esriGeometryType=="esriGeometryPoint"){if(k.geometry)x={},x.x=k.geometry.x,x.y=k.geometry.y,m=x.x,n=x.y,l=x.x,o=x.y,j.shapes=[x]}else if(s=k.geometry.points.length,p=[],k.geometry){for(r=0;r<s;r++)w=k.geometry.points[r],x={},x.x=w[0],x.y=w[1],m=x.x,n=x.y,l=x.x,o=x.y,p.push(u);j.shapes=p}j.bBox=
new ia.BoundingBox(m,n,l,o);c=m<c?m:c;d=n<d?n:d;e=l>e?l:e;f=o>f?o:f;j.size=Math.max(j.bBox.getWidth(),j.bBox.getHeight())}}this.bBox=new ia.BoundingBox(c,d,e,f);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};
ia.FeatureServiceLayer.prototype._renderItems=function(a){a==void 0&&(a=this.itemArray.concat());for(var b=a.length,c=0;c<b;c++){var d=a[c];if(this.geometry!="point"||this.geometry=="point"&&d.symbolSize>0||this.geometry=="point"&&this.displayLabelsOnly)this.renderItem(d),this.showLabels&&this.renderItemLabel(d)}};ia.GeoJsonLayer=function(a){ia.GeoJsonLayer.baseConstructor.call(this,a);this.idField="OBJECTID";this.nameField="NAME"};ia.extend(ia.FeatureLayer,ia.GeoJsonLayer);
ia.GeoJsonLayer.prototype.parseData=function(a){a==void 0?a=this.data:this.data=a;this.items={};this.itemArray=[];this.fieldNames=[];this.eval=!1;for(var b=Infinity,c=Infinity,d=-Infinity,e=-Infinity,f=0;f<a.features.length;f++){var g=a.features[f];if(f<20)for(var h in g.properties)this.fieldNames.indexOf(h)==-1&&this.fieldNames.push(h);var i={};i.state=ia.FeatureLayer.UNSELECTED;i.layer=this;i.id=String(g.properties[this.idField]);i.name=String(g.properties[this.nameField]);if(g.properties[this.idField]==
void 0)for(h in g.properties){i.id=g.properties[h];break}if(g.properties[this.nameField]==void 0)for(h in g.properties){i.name=g.properties[h];break}i.parent=this;i.symbolSize=this.symbolSize;i.shapes=[];if(this.geometry=="line")i.symbolSize=this.style.lineWidth;var k=Infinity,j=Infinity,m=-Infinity,n=-Infinity;if(g.geometry.type=="Point"){var l={};l.x=g.geometry.coordinates[0];l.y=g.geometry.coordinates[1];k=l.x;j=l.y;m=l.x;n=l.y;i.shapes=[l]}else if(g.geometry.type=="LineString"||g.geometry.type==
"MultiPoint"){for(var o=g.geometry.coordinates,q=[],p=0;p<o.length;p++){var r=o[p],l={};l.x=r[0];l.y=r[1];q.push(l);k=l.x<k?l.x:k;j=l.y<j?l.y:j;m=l.x>m?l.x:m;n=l.y>n?l.y:n}i.shapes.push(q)}else if(g.geometry.type=="Polygon"||g.geometry.type=="MultiLineString")for(var t=g.geometry.coordinates,p=0;p<t.length;p++){q=[];o=t[p];g.geometry.type=="Polygon"&&p>0&&o.reverse();for(var s=0;s<o.length;s++)r=o[s],l={},l.x=r[0],l.y=r[1],q.push(l),k=l.x<k?l.x:k,j=l.y<j?l.y:j,m=l.x>m?l.x:m,n=l.y>n?l.y:n;i.shapes.push(q)}else if(g.geometry.type==
"MultiPolygon")for(var u=g.geometry.coordinates,v=0;v<u.length;v++){t=u[v];for(p=0;p<t.length;p++){q=[];o=t[p];p>0&&o.reverse();for(s=0;s<o.length;s++)r=o[s],l={},l.x=r[0],l.y=r[1],q.push(l),k=l.x<k?l.x:k,j=l.y<j?l.y:j,m=l.x>m?l.x:m,n=l.y>n?l.y:n;i.shapes.push(q)}}if(g.geometry.type!="Point")g=this._getLargestItemShape(i),i.centerOfGravity=this._getCenterOfGravity(g);i.bBox=new ia.BoundingBox(k,j,m,n);i.size=Math.max(i.bBox.getWidth(),i.bBox.getHeight());this.items[i.id]=i;this.itemArray.push(i);
b=k<b?k:b;c=j<c?j:c;d=m>d?m:d;e=n>e?n:e}this.bBox=new ia.BoundingBox(b,c,d,e);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};ia.WMSLayer=function(){ia.WMSLayer.baseConstructor.call(this);this.requiresAxisSwitch=!1};ia.extend(ia.ImageLayer,ia.WMSLayer);
ia.WMSLayer.prototype.getUrl=function(a,b,c){var d=this.url;this.url.indexOf("?")==-1&&(d+="?");this.url.charAt(this.url.length-1)!="&"&&this.url.charAt(this.url.length-1)!="?"&&(d+="&");d+=this.requiresAxisSwitch==!0?"request=GetMap&bbox="+a.getYMin()+","+a.getXMin()+","+a.getYMax()+","+a.getXMax():"request=GetMap&bbox="+a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax();this.params.toLowerCase().indexOf("layers=")<0&&(d+="&layers="+this.layers);this.params.toLowerCase().indexOf("srs=")<
0&&(d+="&srs="+this.srs);this.params.toLowerCase().indexOf("crs=")<0&&(d+="&crs="+this.srs);this.params.toLowerCase().indexOf("width=")<0&&(d+="&width="+Math.round(b));this.params.toLowerCase().indexOf("height=")<0&&(d+="&height="+Math.round(c));this.params.toLowerCase().indexOf("version=")<0&&(d+="&version="+this.version);this.params.toLowerCase().indexOf("format=")<0&&(d+="&format=image/jpeg");this.params.toLowerCase().indexOf("exceptions=")<0&&(d+="&exceptions=application/vnd.ogc.se_blank");this.params.toLowerCase().indexOf("service=")<
0&&(d+="&service=WMS");this.params.toLowerCase().indexOf("styles=")<0&&(d+="&styles=");this.params.indexOf("&")!=0&&(d+="&");d+=this.params;return d};ia.MarkerLayer=function(){ia.MarkerLayer.baseConstructor.call(this);this._markers=[]};ia.extend(ia.LayerBase,ia.MarkerLayer);ia.MarkerLayer.prototype.addMarker=function(a,b,c){var d={};d.icon=a;d.x=b;d.y=c;this._markers[this._markers.length]=d};ia.MarkerLayer.prototype.clearMarkers=function(){this._markers=[];this.clear()};
ia.MarkerLayer.prototype.render=function(){this.clear();for(var a=0;a<this._markers.length;a++){var b=this._markers[a],c=this.map.getPixelX(b.x)-b.icon.width/2,d=this.map.getPixelY(b.y)-b.icon.height;this.context.drawImage(b.icon,c,d)}};ia.GeoRSSLayer=function(a){ia.GeoRSSLayer.baseConstructor.call(this,a);this._mp=new ia.GoogleMercatorProjection;this._layerMinY=this._layerMinX=Infinity;this._layerMaxY=this._layerMaxX=-Infinity;$j.support.cors=!0};ia.extend(ia.FeatureLayer,ia.GeoRSSLayer);
ia.GeoRSSLayer.prototype.loadSource=function(){var a=this;$j.ajax({url:document.location.protocol+"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=10&callback=?&q="+encodeURIComponent(a.source),dataType:"json",success:function(b){a.parseData(b.responseData.xmlString);a.isLoaded=!0;a.render();b=new ia.Event(ia.Event.LAYER_READY,a);a.dispatchEvent(b)}})};
ia.GeoRSSLayer.prototype.parseData=function(a){a=$j(a);this.items={};this.itemArray=[];var b=this,c=a.find("item");$j.each(c,function(a,c){b._toFeature(c)});c=a.find("atom\\:entry, entry");$j.each(c,function(a,c){b._toFeature(c)});this.bBox=new ia.BoundingBox(this._layerMinX,this._layerMinY,this._layerMaxX,this._layerMaxY);if(this.iconPath!="")this.icon=new Image,this.icon.onload=function(){},this.icon.src=this.iconPath};
ia.GeoRSSLayer.prototype._toFeature=function(a){var b={};b.state=ia.ItemLayer.UNSELECTED;b.layer=this;b.id=$j(a).find("guid").text();b.name=$j(a).find("title").text();b.description=$j(a).find("description").text();b.parent=this;b.symbolSize=this.symbolSize;a=this._toPoint(a);minX=a.x;minY=a.y;maxX=a.x;maxY=a.y;b.shapes=[a];b.bBox=new ia.BoundingBox(minX,minY,maxX,maxY);b.size=Math.max(b.bBox.getWidth(),b.bBox.getHeight());this.items[b.id]=b;this.itemArray.push(b);this._layerMinX=minX<this._layerMinX?
minX:this._layerMinX;this._layerMinY=minY<this._layerMinY?minY:this._layerMinY;this._layerMaxX=maxX>this._layerMaxX?maxX:this._layerMaxX;this._layerMaxY=maxY>this._layerMaxY?maxY:this._layerMaxY};
ia.GeoRSSLayer.prototype._toPoint=function(a){var b={x:0,y:0},c=$j(a).find("geo\\:long, long"),d=$j(a).find("geo\\:lat, lat");if(c.length>0&&d.length>0)return b.x=parseFloat($j(c).text()),b.y=parseFloat($j(d).text()),b=this._mp.project(b.x,b.y,!0);c=$j(a).find("georss\\:point, point");if(c.length>0)return a=jQuery.trim($j(c).text()).split(" "),b.x=parseFloat(a[0]),b.y=parseFloat(a[1]),b=this._mp.project(b.x,b.y,!0);a=$j(a).find("gml\\:pos, pos");if(a.length>0)a=jQuery.trim($j(a).text()).split(" "),
b.x=parseFloat(a[0]),b.y=parseFloat(a[1]),b=this._mp.project(b.x,b.y,!0);return b};ia.GoogleMercatorProjection=function(){this._originLon=this._originLat=0;this._ellipsoid={};this._ellipsoid.id="WGS_84";this._ellipsoid.semiMajorAxis=6378137;this._ellipsoid.inverseFlattening=298.257223563;this._checkEllipsoid()};
ia.GoogleMercatorProjection.prototype._checkEllipsoid=function(){this._ellipsoid.semiMinorAxis==void 0&&(this._ellipsoid.semiMinorAxis=this._ellipsoid.semiMajorAxis-this._ellipsoid.semiMajorAxis/this._ellipsoid.inverseFlattening);if(this._ellipsoid.eccentricity==void 0){var a=(this._ellipsoid.semiMajorAxis-this._ellipsoid.semiMinorAxis)/this._ellipsoid.semiMajorAxis;this._ellipsoid.eccentricity=Math.sqrt(2*a-a*a)}};
ia.GoogleMercatorProjection.prototype.project=function(a,b){var c={},d=Math.PI*(b/180),e=this._ellipsoid.semiMajorAxis;c.x=e*(Math.PI*(a/180)-Math.PI*(this._originLon/180));c.y=e*Math.log(Math.tan(Math.PI/4+d/2));return c};ia.GoogleMercatorProjection.prototype.unproject=function(a,b){var c={},d=this._ellipsoid.semiMajorAxis,e=Math.PI/2-2*Math.atan(Math.pow(Math.E,(0-b)/d));c.longitude=(a/d+Math.PI*(this._originLon/180))*180/Math.PI;c.latitude=e*180/Math.PI;return c};
ia.ColorPalette=function(a){this._colors=[];this.id="";this.matchColorsToValues={};a!=void 0?this.setColorList(a):this.setColorList(ia.ColorPalette.CATEGORY_COLORS)};ia.ColorPalette.NUMERIC_COLORS=["#9EDAE5","#74a9cf","#023858"];ia.ColorPalette.CATEGORY_COLORS=["#B4371F","#FFBB78","#2CA02C","#98DF8A","#D62728","#FF9896","#9467BD","#C5B0D5","#8C564B","#C49C94","#E377C2","#F7B6D2","#7F7F7F","#C7C7C7","#BCBD22","#DBDB8D","#17BECF","#9EDAE5","#AEC7E8","#9EDAE5"];
ia.ColorPalette.prototype.getColorList=function(){return this._colors};ia.ColorPalette.prototype.setColorList=function(a){this._colors=a};ia.ColorPalette.prototype.addColor=function(a){this._colors.push(a)};ia.ColorPalette.prototype.getColorAtIndex=function(a){return this._colors[a%this._colors.length]};ia.ColorPalette.prototype.setColorAtIndex=function(a,b){this._colors[a]=b};
ia.ColorPalette.prototype.getMatchingColors=function(a){for(var b=a.length,c=Array(b),d=this.getColors(b),e=0;e<b;e++){var f=ia.Color.toHex(d[e]),g;for(g in this.matchColorsToValues)for(var h=0;h<b;h++)a[h]==g&&ia.Color.toHex(this.matchColorsToValues[g])==f&&(d[e]=ia.Color.getRandomColor())}for(e=f=0;e<b;e++)this.matchColorsToValues[a[e]]!=void 0?c[e]=this.matchColorsToValues[a[e]]:(c[e]=d[f],f++);return c};
ia.ColorPalette.prototype.getColors=function(a){for(var b=Array(a),c=0,d,e=0;e<a;e++)e<this._colors.length?d=this._colors[e]:(c<ia.ColorPalette.CATEGORY_COLORS.length?d=ia.ColorPalette.CATEGORY_COLORS[c]:(d=ia.Color.getRandomColor(),ia.ColorPalette.CATEGORY_COLORS[ia.ColorPalette.CATEGORY_COLORS.length]=d),c++),b[e]=d;return b};
ia.ColorPalette.prototype.getInterpolatedColors=function(a){if(a==1)return[this._colors[0]];else if(a==2)return[this.getColor(0),this.getColor(1)];else{for(var b=Array(a),c=1/(a-1),d=0,e=0;e<a;e++)b[e]=e==0?this.getColor(0):e==a-1?this.getColor(1):this.getColor(d),d+=parseFloat(c);return b}};
ia.ColorPalette.prototype.getColor=function(a){var b=this._colors.length-1;if(b<=0||a<=0)return this._colors[0];else if(a>=1)return this._colors[b];else{for(var c,d=1/b,e=0,f=0;f<b;f++){var g=e,h=g+d;if(a>=g&&a<=h){c=ia.Color.getInterpolatedColor(this._colors[f],this._colors[f+1],(a-g)/(h-g));break}e+=parseFloat(d)}return c}};ia.SizePalette=function(a,b){this.maxSize=this.minSize=15;this.useSqrRoot=!1;if(a!=null)this.minSize=a;if(b!=null)this.maxSize=b};
ia.SizePalette.prototype.getInterpolatedSizes=function(a){var b=[];if(a==1)return[this.minSize];for(var c=0;c<a;c++)b.push(this.getSize(c/(a-1)));return b};ia.SizePalette.prototype.getSize=function(a){if(a==null)return this.minSize;this.useSqrRoot&&(a=Math.sqrt(a));return this.minSize+a*(this.maxSize-this.minSize)};
ia.BreaksCalculator=function(a){this._stats=new ia.Statistics;this._data=[];this._functions={};this.sdSize=1;this.errorMessage="Legend error defaulting to equal interval.";this.addFunction(ia.Thematic.CONTINUOUS,ia.Thematic.CONTINUOUS);this.addFunction(ia.Thematic.EQUAL_INTERVAL,ia.Thematic.EQUAL_INTERVAL);this.addFunction(ia.Thematic.QUANTILE,ia.Thematic.QUANTILE);this.addFunction(ia.Thematic.NATURAL,ia.Thematic.NATURAL);this.addFunction(ia.Thematic.STANDARD_DEVIATION,ia.Thematic.STANDARD_DEVIATION);
a!=void 0&&this.setData(a)};ia.BreaksCalculator.prototype.addFunction=function(a,b){this._functions[a]=b};ia.BreaksCalculator.prototype.getStats=function(){return this._stats};ia.BreaksCalculator.prototype.getData=function(){return this._data};ia.BreaksCalculator.prototype.setData=function(a){this._data=a;this._stats.setData(a)};
ia.BreaksCalculator.prototype.getBreaks=function(a,b){a==null&&(a=5);b==null&&(b="equalInterval");var c;try{if(this._stats.range==0&&b!="customClassifier")c=[this._stats.minValue];else{var d=this._functions[b];d!=void 0&&(c=d==ia.Thematic.CONTINUOUS?this.continuous(a):d==ia.Thematic.EQUAL_INTERVAL?this.equalIntervals(a):d==ia.Thematic.QUANTILE?this.quantiles(a):d==ia.Thematic.NATURAL?this.natural(a):d==ia.Thematic.STANDARD_DEVIATION?this.standardDeviation(a):d.call(null,a))}}catch(e){c=this.equalIntervals(a)}c&&
(c=c.filter(function(a,b,c){return b==c.indexOf(a)}).concat());return c};ia.BreaksCalculator.prototype.continuous=function(){return this._stats.range>0?this._stats.unique:null};ia.BreaksCalculator.prototype.equalIntervals=function(a){a==null&&(a=5);if(this._stats.range>0){var b=a+1,c=Array(b),d=this._stats.range/a;c[0]=this._stats.minValue;for(var e=1;e<a;e++)c[e]=parseFloat(this._stats.minValue)+e*d;c[b-1]=this._stats.maxValue;return c}else return null};
ia.BreaksCalculator.prototype.quantiles=function(a){a==null&&(a=5);for(var b=!1,c=this._quantileFunc(a,this._stats.sorted),d=c.length,e=0;e<d-1;e++)if(c[e]>=c[e+1]){b=!0;break}for(;b;)if(c=this._quantileFunc(a,this._stats.unique),d=c.length,d==1)b=!1;else for(e=0;e<d-1;e++)if(c[e]>=c[e+1]){a--;b=!0;break}else b=!1;return c};
ia.BreaksCalculator.prototype._quantileFunc=function(a,b){if(this._stats.range>0){if(this._stats.unique.length<a)a=this._stats.unique.length;var c=a+1,d=Array(c),e=1/a;d[0]=this._stats.minValue;for(var f=1;f<a;f++){var g=ia.round(e*f,2);d[f]=this._stats.getPercentile(g,b)}d[c-1]=this._stats.maxValue;return d}else return null};
ia.BreaksCalculator.prototype.natural=function(a){a==null&&(a=5);if(this._stats.range>0){var b=this._stats.unique.length;if(this._stats.unique.length<a)a=this._stats.unique.length;for(var c=Array(b+1),d=Array(b+1),e=1;e<=b;e++){c[e]=Array(a+1);d[e]=Array(a+1);for(var f=1;f<=a;f++)f==1?(c[e][f]=1,d[e][f]=0):d[e][f]=Infinity}for(var g,h,i,k,j,m,e=2;e<=b;e++){k=i=h=g=0;for(var n=1;n<=e;n++)if(j=e-n+1,g=this._stats.unique[j-1],h++,i+=parseFloat(g),f=i/h,f*=f,g*=g,k+=parseFloat(g),g=k/h-f,m=j-1,m!=0)for(f=
2;f<=a;f++)d[e][f]>=d[m][f-1]+g&&(c[e][f]=j,d[e][f]=d[m][f-1]+g);c[e][1]=1;d[e][1]=g}e=b;d=Array(a);d[a-1]=b-1;for(f=a;f>=2;f--)j=c[e][f]-2,d[f-2]=j,e=c[e][f]-1;a=[];a[0]=this._stats.minValue;for(e=0;e<=d.length-2;e++)a[a.length]=this._stats.unique[d[e]];a[a.length]=this._stats.maxValue;return a}else return null};
ia.BreaksCalculator.prototype.standardDeviation=function(){if(this._stats.range>0){var a,b=Array(5),c=Math.ceil(b.length/2),d=this._stats.mean,e=this._stats.standardDeviation*this.sdSize;b[0]=-Infinity;for(var f=1;f<=5;f++)a=f==c?d:d+e*(f-c),b[f]=a;b[b.length]=Infinity;return b}else return null};
ia.Thematic=function(a){ia.Thematic.baseConstructor.call(this);this._data={};this._dataField="value";this._dataType="numeric";this._dataChanged=!0;this.colorField=void 0;this.symbol=ia.Shape.SQUARE;this.noDataValue="No Data";this.numericClassifier=new ia.NumericClassifier;this.categoricClassifier=new ia.CategoricClassifier;a!=void 0&&this.setData(a)};ia.extend(ia.EventDispatcher,ia.Thematic);ia.Thematic.CONTINUOUS="continuous";ia.Thematic.EQUAL_INTERVAL="equalInterval";ia.Thematic.QUANTILE="quantile";
ia.Thematic.NATURAL="natural";ia.Thematic.STANDARD_DEVIATION="standardDeviation";ia.Thematic.NUMERIC="numeric";ia.Thematic.CATEGORIC="categoric";ia.Thematic.prototype.heatmap=!1;ia.Thematic.prototype.getData=function(){return this._data};ia.Thematic.prototype.setData=function(a){this._data=a;this._dataChanged=!0};ia.Thematic.prototype.getDataField=function(){return this._dataField};ia.Thematic.prototype.setDataField=function(a){this._dataField=a;this._dataChanged=!0};
ia.Thematic.prototype.getDataType=function(){return this._dataType};ia.Thematic.prototype.setDataType=function(a){this._dataType=a;this._dataChanged=!0};ia.Thematic.prototype.getClasses=function(){return this.numericClassifier.getClasses().concat(this.categoricClassifier.getClasses())};ia.Thematic.prototype.getClass=function(a){return this._dataType==ia.Thematic.CATEGORIC?this.categoricClassifier.getClass(a):ia.isNumber(a)?this.numericClassifier.getClass(a):this.categoricClassifier.getClass(a)};
ia.Thematic.prototype._updateTimeout=null;ia.Thematic.prototype.commitChanges=function(){this._commitChanges()};
ia.Thematic.prototype._commitChanges=function(){this._updateTimeout=null;if(this._dataChanged){var a=[],b=[],c,d,e;for(e in this._data)c=this._data[e],d=c[this._dataField],this.colorField!=void 0&&b.push(c[this.colorField]),this._dataType==ia.Thematic.CATEGORIC?b.push(d):ia.isNumber(d)?a.push(d):this.colorField==void 0&&b.push(d);this.numericClassifier.setData(a);this.categoricClassifier.setData(b)}this.categoricClassifier.noDataValue=this.noDataValue;this.numericClassifier.commitChanges();this.categoricClassifier.commitChanges();
for(var a=this.getClasses(),b=a.length,f,g=0;g<b;g++)if(f=a[g],f.symbol=this.symbol,f.index=g,f.getLabel()==this.noDataValue&&f.symbol!=ia.Shape.LINE&&f.symbol!=ia.Shape.SQUARE)f.size=0;if(this.colorField!=void 0){c=this.numericClassifier.getClasses();for(g=0;g<c.length;g++)f=c[g],f.color="rgba(255, 255, 255, 0.5)"}for(e in this._data){c=this._data[e];d=c[this._dataField];for(g=0;g<b;g++)if(f=a[g],f.contains(d)){c.color=f.color;c.symbolSize=f.size;c.legendClass=f;f.items.push(c);break}if(this.colorField!=
void 0){var h=this.categoricClassifier.getClasses();d=c[this.colorField];for(g=0;g<h.length;g++)if(f=h[g],f.contains(d))c.color=f.color}}this.dispatchEvent(new ia.Event(ia.Event.THEME_CHANGED,this))};
ia.NumericClassifier=function(a){this._breaks=[];this._classes=[];this._adjustedNoClasses=0;this._calculator=new ia.BreaksCalculator;this._data=[];this.formatter=new ia.Formatter;this.colorPalette=new ia.ColorPalette;this.sizePalette=new ia.SizePalette;this.classificationName=ia.Thematic.EQUAL_INTERVAL;this.labels=[];this.sdLabels=["> 2 SD below mean","1 - 2 SD below mean","0 - 1 SD below mean","0 - 1 SD above mean","1 - 2 SD above mean","> 2 SD above mean"];this.noClasses=5;this.minRule=ia.RangeClass.GREATER_THAN_OR_EQUAL_TO;
this.maxRule=ia.RangeClass.LESS_THAN_OR_EQUAL_TO;a!=void 0&&this.setData(a)};ia.NumericClassifier.prototype.getData=function(){return this._data};ia.NumericClassifier.prototype.setData=function(a){this._data=a;this._calculator.setData(this._data)};ia.NumericClassifier.prototype.getBreaks=function(){return this._breaks};ia.NumericClassifier.prototype.getLabels=function(){for(var a=[],b=0;b<this._classes.length;b++)a[b]=this._classes[b].getLabel();return a};
ia.NumericClassifier.prototype.getCalculator=function(){return this._calculator};ia.NumericClassifier.prototype.getClasses=function(){return this._classes};ia.NumericClassifier.prototype.commitChanges=function(){this._buildClasses();this._buildPalettes()};ia.NumericClassifier.prototype.getClass=function(a){for(var b=0;b<this._classes.length;b++){var c=this._classes[b];if(c.contains(a))return c}return null};
ia.NumericClassifier.prototype._buildClasses=function(a){var b,c=!1,d;this._classes=[];this._breaks=this._calculator.getBreaks(this.noClasses,this.classificationName);if(this._breaks!=null)if(d=a!=void 0?a:this.precision!=void 0?this.precision:ia.getPrecision(this._breaks),a=this.classificationName==ia.Thematic.CONTINUOUS?this._breaks.length:this._breaks.length==1?1:this._breaks.length-1,this._breaks.length==1)b=new ia.NumberClass(this._breaks[0]),b.formatter=this.formatter,this._classes.push(b);
else for(var e=0;e<a;e++)if(this.classificationName==ia.Thematic.CONTINUOUS)b=new ia.NumberClass(this._breaks[e]),b.formatter=this.formatter,this._classes.push(b);else{var f=this._breaks[e],g=this._breaks[e+1];b=new ia.RangeClass(f,g);b.minRule=this.minRule;b.maxRule=this.maxRule;b.formatter=this.formatter;this._classes.push(b);if(this.labels.length>e)b.setLabel(this.labels[e]);else if(this.classificationName==ia.Thematic.STANDARD_DEVIATION&&this.sdLabels.length>e)b.setLabel(this.sdLabels[e]);else if(f=
this.formatter.format(f,d),g=this.formatter.format(g,d),this.minRule==ia.RangeClass.GREATER_THAN_OR_EQUAL_TO&&this.maxRule==ia.RangeClass.LESS_THAN_OR_EQUAL_TO&&e!=0&&(f=this.formatter.format(this._adjustBreak(f),d)),this.formatter.unformat(f)>this.formatter.unformat(g)){c=!0;break}else f==g?b.setLabel(f):b.setLabel(f+" - "+g)}else this._breaks=[],this._classes=[],a=0;this._adjustedNoClasses=a;c&&this._buildClasses(d+1)};
ia.NumericClassifier.prototype._adjustBreak=function(a){var b=this.formatter.unformat(a);if(a.indexOf(this.formatter.decimalSeparatorTo)>-1){for(var a=a.length-a.toString().indexOf(this.formatter.decimalSeparatorTo)-1,c="0.",d=0;d<a;d++)c+=d==a-1?"1":"0";b=parseFloat(b)+parseFloat(c)}else b=parseFloat(b)+1;return b};
ia.NumericClassifier.prototype._buildPalettes=function(){var a,b;if(this.classificationName==ia.Thematic.CONTINUOUS){var c=this._breaks.length,d=this._breaks[c-1]-this._breaks[0];a=[];this.sizePalette.useSqrRoot=!0;b=[];for(var e=0;e<c;e++){var f=(this._breaks[e]-this._breaks[0])/d;ia.isNumber(f)||(f=0);a.push(this.colorPalette.getColor(f));b.push(this.sizePalette.getSize(f))}}else a=this.colorPalette.getInterpolatedColors(this._adjustedNoClasses),this.sizePalette.useSqrRoot=!1,b=this.sizePalette.getInterpolatedSizes(this._adjustedNoClasses);
for(e=0;e<this._classes.length;e++)c=this._classes[e],c.color=a[e],c.size=b[e]};ia.CategoricClassifier=function(a){this._uniqueValues=[];this._classes=[];this._data=[];this.formatter=new ia.Formatter;this.colorPalette=new ia.ColorPalette;this.colorPalette.setColorList(ia.ColorPalette.CATEGORY_COLORS);this.symbolSize=10;this.noClasses=0;this.labels=[];this.breaks=[];this.uniqueValues=[];a!=void 0&&this.setData(a)};ia.CategoricClassifier.prototype.getData=function(){return this._data};
ia.CategoricClassifier.prototype.setData=function(a){this._data=a;this._uniqueValues=this.breaks.length>0?this.breaks.concat():this._getUniqueValues(this._data)};ia.CategoricClassifier.prototype.getClasses=function(){return this._classes};
ia.CategoricClassifier.prototype.commitChanges=function(){this._buildClasses();this._buildPalettes();for(var a=0;a<this._classes.length;a++){var b=this._classes[a];if(this.colorPalette.matchColorsToValues[b.value]==void 0)this.colorPalette.matchColorsToValues[b.value]=b.color}};ia.CategoricClassifier.prototype.getClass=function(a){for(var b=0;b<this._classes.length;b++){var c=this._classes[b];if(c.contains(a))return c}return null};
ia.CategoricClassifier.prototype._getUniqueValues=function(a){var b=[];if(a.length>0){a=a.concat();a.sort();for(var c,d=0,e=a.length,f=0;f<e;f++){var g=a[f];g!=c&&(b.push(g),d=0);c=g;d++}}return b};
ia.CategoricClassifier.prototype._buildClasses=function(){this._classes=[];if(this.noClasses!=this._uniqueValues.length)this.noClasses=this._uniqueValues.length;for(var a=0,b=0;b<this.noClasses;b++){var c=new ia.CategoricClass(this._uniqueValues[b]);this.labels.length>a&&c.value!=this.noDataValue&&(c.setLabel(this.labels[a]),a++);c.formatter=this.formatter;this._classes.push(c)}};
ia.CategoricClassifier.prototype._buildPalettes=function(){if(this._uniqueValues.length>0){if(this.customColorsDefined)for(var a=this.colorPalette.getColorList(),b=0,c=0;c<this._uniqueValues.length;c++){var d=this._uniqueValues[c];a.length>b&&d!=this.noDataValue&&(this.colorPalette.matchColorsToValues[d]=a[b],b++)}this.customColorsDefined=!1;a=this.colorPalette.getMatchingColors(this._uniqueValues);for(c=0;c<this._classes.length;c++)b=this._classes[c],b.color=a[c],b.size=this.symbolSize}};
ia.LegendClass=function(a,b,c){this.formatter=new ia.Formatter;this.color="#FFFFFF";this.size=15;this.items=[];this.symbol=ia.Shape.SQUARE;this.index=0;if(a!=null)this.value=a;if(b!=null)this.color=b;if(c!=null)this.size=c};ia.NumberClass=function(a,b,c){ia.NumberClass.baseConstructor.call(this,a,b,c);this._label=void 0};ia.extend(ia.LegendClass,ia.NumberClass);ia.NumberClass.prototype.getLabel=function(){return this._label!=void 0?this._label:this.formatter.format(this.value)};
ia.NumberClass.prototype.setLabel=function(a){this._label=a};ia.NumberClass.prototype.contains=function(a){return parseFloat(a)==parseFloat(this.value)?!0:!1};ia.RangeClass=function(a,b,c,d){ia.RangeClass.baseConstructor.call(this,NaN,c,d);this._range=this._label=void 0;this.minValue=a;this.maxValue=b;this.minRule=ia.RangeClass.GREATER_THAN_OR_EQUAL_TO;this.maxRule=ia.RangeClass.LESS_THAN_OR_EQUAL_TO};ia.extend(ia.LegendClass,ia.RangeClass);ia.RangeClass.LESS_THAN="lessThan";
ia.RangeClass.LESS_THAN_OR_EQUAL_TO="lessThanOrEqual";ia.RangeClass.GREATER_THAN="greaterThan";ia.RangeClass.GREATER_THAN_OR_EQUAL_TO="greaterThanOrEqual";ia.RangeClass.prototype.getLabel=function(){if(this._label!=void 0)return this._label;else{var a=this.formatter.format(this.minValue),b=this.formatter.format(this.maxValue);return a+" - "+b}};ia.RangeClass.prototype.setLabel=function(a){this._label=a};ia.RangeClass.prototype.getRange=function(){return maxValue-minValue};
ia.RangeClass.prototype.contains=function(a){if(ia.isNumber(a)){if(this.minRule==ia.RangeClass.GREATER_THAN){if(!(parseFloat(a)>this.minValue))return!1}else if(!(parseFloat(a)>=this.minValue))return!1;if(this.maxRule==ia.RangeClass.LESS_THAN){if(!(parseFloat(a)<this.maxValue))return!1}else if(!(parseFloat(a)<=this.maxValue))return!1;return!0}else return!1};ia.CategoricClass=function(a,b,c){ia.CategoricClass.baseConstructor.call(this,a,b,c);this._label=void 0};ia.extend(ia.LegendClass,ia.CategoricClass);
ia.CategoricClass.prototype.getLabel=function(){return this._label!=void 0?this._label:this.formatter.formatText(this.value)};ia.CategoricClass.prototype.setLabel=function(a){this._label=a};ia.CategoricClass.prototype.contains=function(a){return a==this.value?!0:!1};
ia.ComponentFactory=function(a,b,c){this._config=a;this._report=b;this._componentGroups=c;this._dataGroups=[];this._factories={};for(a=0;a<this._componentGroups.length;a++){var d=c[a];this.buildInteractionGroups(b,d.dataGroup,d.interactionGroup,d.comparisonInteractionGroup);this._dataGroups[a]=d.dataGroup}};ia.ComponentFactory.prototype.update=function(a,b){var a=this._getParentComponentId(a),c=this._factories[a];c!=void 0?c.update(function(){b.call(null,a)}):b.call(null,a)};
ia.ComponentFactory.prototype.render=function(a,b){var a=this._getParentComponentId(a),c=this._factories[a];c!=void 0?c.render(function(){b.call(null,a)}):b.call(null,a)};ia.ComponentFactory.registerRuntimeFactory=function(a,b){ia.ComponentFactory._runtimeFactories[a]=b};ia.ComponentFactory._runtimeFactories={};
ia.ComponentFactory.prototype.build=function(a,b){var c=this,d=this._config.getComponent(a);if(d){var e=this._getSuffix(a),f=this._getType(a),g=e-1;e==""&&(g=0);e=this._componentGroups[g];if(e!=void 0){var h;f=="legend"?h=new ia.LegendFactory(d,this._report,e):f=="featureLegend"?h=new ia.FeatureLegendFactory(d,this._report,e):f=="areaBreakdownBarChart"?h=new ia.AreaBreakdownBarChartFactory(d,this._report,e):f=="areaBreakdownLineChart"?h=new ia.AreaBreakdownLineChartFactory(d,this._report,e):f=="areaBreakdownPieChart"?
h=new ia.AreaBreakdownPieChartFactory(d,this._report,e):f=="barChart"?h=new ia.BarChartFactory(d,this._report,e):f=="gridChart"?h=new ia.GridChartFactory(d,this._report,e):f=="boxAndWhisker"?h=new ia.BoxAndWhiskerFactory(d,this._report,e):f=="timeSeries"?h=new ia.TimeSeriesFactory(d,this._report,e):f=="discreteTimeSeries"?h=new ia.DiscreteTimeSeriesFactory(d,this._report,e):f=="stackedTimeSeries"?h=new ia.StackedTimeSeriesFactory(d,this._report,e):f=="stackedFeaturesTimeSeries"?h=new ia.StackedFeaturesFactory(d,
this._report,e):f=="stackedBarChart"?h=new ia.StackedBarFactory(d,this._report,e):f=="pyramidChart"?h=new ia.PyramidChartFactory(d,this._report,e):f=="timeControl"?h=new ia.TimeControlFactory(d,this._report,e):f=="featureCard"?h=new ia.FeatureCardFactory(d,this._report,e):f=="metadata"?h=new ia.MetadataFactory(d,this._report,e):f=="textbox"?h=new ia.TextBoxFactory(d,this._report,e):f=="statsbox"?h=new ia.StatsBoxFactory(d,this._report,e):f=="advancedPieChart"?h=new ia.AdvancedPieChartFactory(d,this._report,
e):f=="pieChart"?h=new ia.PieChartFactory(d,this._report,e):f=="dataExplorer"?h=new ia.DataExplorerFactory(d,this._report,e):f=="geogExplorer"?h=new ia.GeogExplorerFactory(d,this._report,e):f=="filterExplorer"?h=new ia.FilterExplorerFactory(d,this._report,e):f=="menuBar"?h=new ia.MenuBarFactory(d,this._report,e):f=="spineChart"?h=new ia.AreaProfileFactory(d,this._report,e):f=="radarChart"?h=new ia.RadarFactory(d,this._report,e):f=="map"?h=new ia.MapFactory(d,this._report,e):f=="scatterPlot"?h=new ia.ScatterPlotFactory(d,
this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):f=="table"?this._config.template==ia.DOUBLE_GEOG_REPORT||this._config.template==ia.DOUBLE_BASELAYER_REPORT?(g=this._dataGroups[g],h=new ia.DataTableFactory(d,this._report,[g],e.interactionGroup,e.comparisonInteractionGroup)):h=new ia.DataTableFactory(d,this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):f=="comparisonTable"?this._config.template==ia.DOUBLE_GEOG_REPORT||this._config.template==
ia.DOUBLE_BASELAYER_REPORT?(g=this._dataGroups[g],h=new ia.ComparisonTableFactory(d,this._report,[g],e.interactionGroup,e.comparisonInteractionGroup)):h=new ia.ComparisonTableFactory(d,this._report,this._dataGroups,e.interactionGroup,e.comparisonInteractionGroup):f&&ia.ComponentFactory._runtimeFactories[f]&&(h=new ia.ComponentFactory._runtimeFactories[f](d,this._report,e));h!=void 0?(this._factories[d.id]=h,f=="map"&&(this._config.template==ia.DOUBLE_BASELAYER_REPORT||this._config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)?
h.build(function(){h.update(function(){h.render(function(){factory2=new ia.MapFactory(void 0,c._report,c._componentGroups[1]);factory2.build(function(){factory2.update(function(){factory2.render(function(){b.call(null,a)})})})})})}):h.build(function(){h.update(function(){h.render(function(){b.call(null,a)})})})):(h=this._factories[this._getParentComponentId(a)])?h.build(function(){h.update(function(){h.render(function(){b.call(null,a)})})}):b.call(null,a)}else b.call(null,a)}else b.call(null,a)};
ia.ComponentFactory.prototype.buildComponents=function(a){function b(){f++;f==e?a.call(null):c.build(d[f].id,b)}var c=this,d=c._config.getComponents(),e=d.length,f=0;e>0?c.build(d[0].id,b):a.call(null)};ia.ComponentFactory.prototype.renderComponents=function(a){function b(){f++;f==e?a.call(null):c.render(d[f].id,b)}var c=this,d=c._config.getComponents(),e=d.length,f=0;e>0?c.render(d[0].id,b):a.call(null)};
ia.ComponentFactory.prototype.updateComponents=function(a){function b(){f++;f==e?a.call(null):c.update(d[f].id,b)}var c=this,d=c._config.getComponents(),e=d.length,f=0;e>0?c.update(d[0].id,b):a.call(null)};
ia.ComponentFactory.prototype._getParentComponentId=function(a){var b=a;a.indexOf("areaBreakdownPieLegend")!=-1&&(b=a.replace("areaBreakdownPieLegend","areaBreakdownPieChart"));a.indexOf("pyramidLegend")!=-1&&(b=a.replace("pyramidLegend","pyramidChart"));a.indexOf("profileLegend")!=-1&&(b=a.replace("profileLegend","spineChart"));a.indexOf("stackedLegend")!=-1&&(b=this._factories.stackedTimeSeries!=void 0?a.replace("stackedLegend","stackedTimeSeries"):a.replace("stackedLegend","stackedBarChart"));
return b};ia.ComponentFactory.prototype._getSuffix=function(a){var b=a.slice(-1);ia.isNumber(b)||(b="");a.indexOf("_")!=-1&&(b=a.slice(-3).charAt(0),ia.isNumber(b)||(b=""));return b};ia.ComponentFactory.prototype._getType=function(a){var b=a,c=a.slice(-1);ia.isNumber(c)&&(b=b.substring(0,b.length-1));a.indexOf("_")!=-1&&(b=a,c=a.slice(-3).charAt(0),b=ia.isNumber(c)?b.substring(0,b.length-3):b.substring(0,b.length-2));return b};
ia.ChartFactory=function(a,b,c){var d=c.interactionGroup,e=c.dataGroup,f=c.comparisonInteractionGroup;this.buildChart=function(c,e,i){c.formatter=b.locale.formatter;b.addComponent(a.id,c);if(e)e.setVisible(!0),e.interactive=!0,c.addLayer(e),d.addComponent(e);if(i)i.setVisible(!0),i.interactive=!0,c.addLayer(i),f.addComponent(i)};this.updateChart=function(c,d,f){var k=e.indicator;c.orientation=a.getProperty("orientation");c.fixedMinValue=k.getProperty(a.getProperty("minChartValue"));c.fixedMaxValue=
k.getProperty(a.getProperty("maxChartValue"));c.fixedMinValue!=void 0&&c.fixedMaxValue!=void 0?c.useTightLabels=!0:a.getProperty("useFixedValues")?(c.useTightLabels=!0,c.fixedMinValue=a.getProperty("fixedMinValue"),c.fixedMaxValue=a.getProperty("fixedMaxValue")):c.useTightLabels=a.getProperty("useTightLabels");k=a.getProperty("xAxisTitle");c.xAxisTitle=k?b.textSubstitution.formatMessage(k):void 0;k=a.getProperty("yAxisTitle");c.yAxisTitle=k?b.textSubstitution.formatMessage(k):void 0;if(d&&(d.highlightColor=
b.highlightColor,d.selectionColor=b.selectionColor,d.dataField=c.id.indexOf("timeSeries")!=-1?a.getProperty("data"):a.getProperty("data")||"value",d.tip=a.getProperty("tip"),a.getProperty("matchAxisToSelectedData")!=void 0))d.matchAxisToSelectedData=a.getProperty("matchAxisToSelectedData");if(f&&(f.highlightColor=b.highlightColor,f.selectionColor=b.selectionColor,f.dataField=a.getProperty("data")||"value",f.tip=a.getProperty("tip"),f.displayAll=a.getProperty("showComparison"),a.getProperty("matchAxisToSelectedData")!=
void 0))f.matchAxisToSelectedData=a.getProperty("matchAxisToSelectedData")};this.build=function(b){b!=void 0&&b.call(null,a.id)};this.update=function(b){b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.LegendFactory=function(a,b,c){function d(){var a=g.indicator.getProperty(b.config.getProperty("customBreaksKey"+g.suffix));if(g.thematic.heatmap==!0)n.showLegendTypePanel=!1,n.showPalettePanel=!0,n.showSizePanel=!1;else if(a)n.showLegendTypePanel=!1,n.showLegendTools=!1,n.showPalettePanel=!0,n.showSizePanel=!1;else{a=b.config.getProperty("showLegendTypePanel");a==void 0&&(a=!0);var c=b.config.getProperty("showLegendTools");c==void 0&&(c=!0);var d=b.config.getProperty("showPalettePanel");d==void 0&&
(d=!0);var e=b.config.getProperty("showSizePanel");e==void 0&&(e=!0);n.showLegendTypePanel=a;n.showLegendTools=c;n.showPalettePanel=d;n.showSizePanel=e}n.render()}var e=this,f=c.interactionGroup,g=c.dataGroup;g.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){e.update();e.render()});g.addEventListener(ia.Event.THEMATIC_CHANGED,function(){e.update();e.render()});var h=b.getWidget(a.id);h.settingsFunction=function(b){a.getProperty("showLegendEditorButton")==!0&&d();iaToggleCallout(a.id+"-callout",
b)};h.exportFunction=function(a){iaExportPanel(h,a)};var i,k,j,m,n;this.build=function(c){h.content.empty();i=new ia.DiscreteLegend(a.id+"-discrete");if(b.config.template==ia.SPINE_REPORT||b.config.template==ia.ELECTION_REPORT)i.interactive=!1;i.thematic=g.thematic;f.addComponent(i);k=new ia.GradientLegend(a.id+"-gradient");k.thematic=g.thematic;f.addComponent(k);j=new ia.LayerList(a.id);j.discreteLegend=i;j.gradientLegend=k;h.append(j.container);b.addComponent(a.id,j);m=new ia.CalloutBox(a.id+"-callout",
"left-right");m.popup(!0);b.addCallout(m);n=new ia.LegendEditor(g.thematic,b.config,g.legendSettings);m.container.append(n.container);c!=void 0&&c.call(null,a.id)};this.update=function(c){i.highlightColor=b.highlightColor;i.selectionColor=b.selectionColor;k.highlightColor=b.highlightColor;k.selectionColor=b.selectionColor;a.getProperty("showLegendEditorButton")==!0?(d(),h.hasSettings(!0)):h.hasSettings(!1);n.render();j.mapData=g.mapData;i.style=g.mapData.baseLayer.style;c!=void 0&&c.call(null,a.id)};
this.render=function(b){var c=g.indicator,d=g.thematic,e=c.getDataType(d.getDataField());j.render();e!=ia.Thematic.CATEGORIC&&d.numericClassifier.classificationName==ia.Thematic.CONTINUOUS?(k.precision=c.precision,k.show(),k.render(),i.renderCategoric()):(k.hide(),i.render());b!=void 0&&b.call(null,a.id)}};
ia.FeatureLegendFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanel(g,a)};var h;this.build=function(c){g.content.empty();h=new ia.FeatureLegend(a.id);g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.highlightColor=b.highlightColor;h.selectionColor=b.selectionColor;if(a.getProperty("layout"))h.layout=
a.getProperty("layout");var d=a.getProperty("colorSchemeId");h.colorPalette=b.config.getMapPalette().getColorScheme(d);h.geography=f.geography;h.clearSelection();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.AreaBreakdownBarChartFactory=function(a,b,c){ia.AreaBreakdownBarChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup,c=c.comparisonInteractionGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){j.dataChanged=!0;d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,i,!1,a)};var h=[],i,k,j,m=function(){k.dataChanged=!0;d.render()};
this.build=function(b){g.content.empty();i=new ia.TimeBarChart(a.id);i.wrapXAxisLabels=!0;k=new ia.TimeBarLayer;j=new ia.ComparisonTimeBarLayer;j.thematic=f.comparisonThematic;d.buildChart(i,k,j);k.interactive=!1;i.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(i.container)};this.update=function(c){d.updateChart(i,k,j);i.drawBarsFromZero=a.getProperty("drawBarsFromZero");a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,
m,this):e.removeListener(this);var g=!1;a.getProperty("colorBarsByCategory")!=void 0&&(g=a.getProperty("colorBarsByCategory"));k.colorBarsByCategory=g;if(b.config.getComponent("featureLegend"+f.suffix)&&!g)g=b.config.getComponent("featureLegend"+f.suffix),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g);else if(b.config.getComponent("featureLegend")&&!g)g=b.config.getComponent("featureLegend"),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g);
else if(a.getProperty("colorSchemeId"))k.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var o=f.theme,g=f.indicator;h=[];if(a.getProperty("datasource")=="associate"){var q=a.getProperty("ignoreAssociateIds"),p=g.getAssociates();if(q)for(o=0;o<p.length;o++){for(var r=p[o],t=!0,s=0;s<q.length;s++)if(r.id==q[s]){t=!1;break}if(t&&r.type!=ia.Thematic.CATEGORIC)h[h.length]=r.id}else for(o=0;o<p.length;o++)if(r=p[o],r.type!=ia.Thematic.CATEGORIC)h[h.length]=r.id;q=g.getAssociateData(h);
k.setData(q);q=g.getAssociateComparisonData(h);j.setData(q);if(g=a.getProperty("associateLabels"))for(o=q=0;o<h.length;o++)q<g.length&&(h[o]=g[q],q++)}else if(g.date!=void 0){q=o.getDataForDate(g.date);k.setData(q);q=o.getComparisonDataForDate(g.date);j.setData(q);q=o.getIndicators();for(o=0;o<q.length;o++)if(p=q[o],p.date==g.date&&p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.name}else{q=o.getData();k.setData(q);q=o.getComparisonData();j.setData(q);q=o.getIndicators();for(o=0;o<q.length;o++)if(p=q[o],
p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.name}if(h.length>0)i.orientation=a.getProperty("orientation"),i.orientation=="vertical"?(i.xAxisLabels=h,i.yAxisLabels=void 0):(i.xAxisLabels=void 0,i.yAxisLabels=h);c!=void 0&&c.call(null,a.id)};this.render=function(b){h.length>0?(g.text(""),i.show(),i.render()):(i.hide(),g.text(a.getProperty("notAvailableText")));b&&(b.call(null,a.id),b=void 0);b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.AreaBreakdownBarChartFactory);
ia.AreaBreakdownLineChartFactory=function(a,b,c){ia.AreaBreakdownLineChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup,c=c.comparisonInteractionGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){j.dataChanged=!0;d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,i,!1,a)};var h=[],i,k,j,m=function(){k.dataChanged=!0;
d.render()};this.build=function(b){g.content.empty();i=new ia.TimeChart(a.id);i.wrapXAxisLabels=!0;k=new ia.TimeLayer;j=new ia.ComparisonTimeLayer;j.thematic=f.comparisonThematic;d.buildChart(i,k,j);i.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(i.container)};this.update=function(c){d.updateChart(i,k,j);a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,m,this):e.removeListener(this);if(b.config.getComponent("featureLegend"+
f.suffix)){var g=b.config.getComponent("featureLegend"+f.suffix),g=g.getProperty("colorSchemeId");k.colorPalette=b.config.getMapPalette().getColorScheme(g)}else if(b.config.getComponent("featureLegend"))g=b.config.getComponent("featureLegend"),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g);else if(a.getProperty("colorSchemeId"))k.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var o=f.theme,g=f.indicator;h=[];if(a.getProperty("datasource")==
"associate"){var q=a.getProperty("ignoreAssociateIds");if(q)for(var p=g.getAssociates(),o=0;o<p.length;o++){for(var r=p[o],t=!0,s=0;s<q.length;s++)if(r.id==q[s]){t=!1;break}if(t&&r.type!=ia.Thematic.CATEGORIC)h[h.length]=r.id}else{p=g.getAssociates();for(o=0;o<p.length;o++)if(r=p[o],r.type!=ia.Thematic.CATEGORIC)h[h.length]=r.id}q=g.getAssociateData(h);k.setData(q);q=g.getAssociateComparisonData(h);j.setData(q);(g=a.getProperty("associateLabels"))&&(h=g)}else if(g.date!=void 0){q=o.getDataForDate(g.date);
k.setData(q);q=o.getComparisonDataForDate(g.date);j.setData(q);q=o.getIndicators();for(o=0;o<q.length;o++)if(p=q[o],p.date==g.date&&p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.name}else{q=o.getData();k.setData(q);q=o.getComparisonData();j.setData(q);q=o.getIndicators();for(o=0;o<q.length;o++)if(p=q[o],p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.name}if(h.length>0)i.orientation=a.getProperty("orientation"),i.orientation=="vertical"?(i.xAxisLabels=h,i.yAxisLabels=void 0):(i.xAxisLabels=void 0,i.yAxisLabels=
h);c!=void 0&&c.call(null,a.id)};this.render=function(b){h.length>0?(g.text(""),i.show(),i.render()):(i.hide(),g.text(a.getProperty("notAvailableText")));b&&(b.call(null,a.id),b=void 0);b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.AreaBreakdownLineChartFactory);
ia.AreaBreakdownPieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanel(g,a)};var h=[],i,k,j;this.build=function(c){var d=b.config.getComponent("areaBreakdownPieLegend"+f.suffix);if(d&&k==void 0)k=new ia.DiscreteLegend(d.id),k.container.addClass("ia-profile-legend"),k.interactive=!1,j=b.getWidget(d.id),j.append(k.container),b.addComponent(d.id,
k),j.exportFunction=function(a){iaExportPanel(j,a)};i==void 0?(g.content.empty(),i=new ia.AreaBreakdownPieComponent(a.id,a.getProperty("layout")),i.tip=a.getProperty("tip"),i.title1=a.getProperty("title1"),i.title2=a.getProperty("title2"),i.build(function(){c!=void 0&&c.call(null,a.id)}),g.append(i.container),b.addComponent(a.id,i),e.addComponent(i)):c!=void 0&&c.call(null,a.id)};this.update=function(c){var d=b.config.getComponent("areaBreakdownPieLegend"+f.suffix);if(k&&d&&d.getProperty("layout"))k.layout=
d.getProperty("layout");i.highlightColor=b.highlightColor;i.selectionColor=b.selectionColor;i.layout=a.getProperty("layout");i.tip=a.getProperty("tip");i.title1=a.getProperty("title1");i.title2=a.getProperty("title2");i.thematic.categoricClassifier.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));var e=f.theme,g=f.indicator;h=[];d={};if(a.getProperty("datasource")=="associate"){i.setData(f.indicatorData);var j=a.getProperty("ignoreAssociateIds");if(j){g=g.getAssociates();
for(e=0;e<g.length;e++){for(var p=g[e],r=!0,t=0;t<j.length;t++)if(p.id==j[t]){r=!1;break}if(r&&p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.id,d[p.id]={value:p.id}}}else{g=g.getAssociates();for(e=0;e<g.length;e++)if(p=g[e],p.type!=ia.Thematic.CATEGORIC)d[p.id]={value:p.id},h[h.length]=p.id}if(e=a.getProperty("associateLabels"))i.thematic.categoricClassifier.labels=e}else if(g.date!=void 0){j=e.getDataForDate(g.date);i.setData(j);j=e.getIndicators();for(e=0;e<j.length;e++)if(p=j[e],p.date==g.date&&
p.type!=ia.Thematic.CATEGORIC)d[p.name]={value:p.name},h[h.length]=p.name}else{j=e.getData();i.setData(j);j=e.getIndicators();for(e=0;e<j.length;e++)if(p=j[e],p.type!=ia.Thematic.CATEGORIC)h[h.length]=p.name,d[p.name]={value:p.name}}i.thematic.categoricClassifier.breaks=h;i.thematic.setData(d);i.thematic.commitChanges();if(k)k.thematic=i.thematic;i.build(function(){c!=void 0&&c.call(null,a.id)})};this.render=function(b){h.length>0?(g.text(""),i.show(),i.render(),k&&(j.text(""),k.show(),k.render())):
(i.hide(),g.text(a.getProperty("notAvailableText")),k&&(k.hide(),j.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};
ia.BarChartFactory=function(a,b,c){ia.BarChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(a){g.isVisible?iaExportPanelWithChart(f,g,!1,a):k.isVisible&&iaExportPanelWithChart(f,k,!1,a)};var g,h,i,k,j;this.build=function(b){f.content.empty();
k=new ia.BarChart("countChart"+e.suffix);j=new ia.CountLayer;j.thematic=e.thematic;d.buildChart(k,j);g=new ia.BarChart(a.id);h=new ia.BarLayer;h.tipFunction=function(b){return ia.tipFunction(b,a.id)};i=new ia.ComparisonLineLayer;i.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h,i);var c=0;g.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&(c++,c==2&&b.call(null,a.id))});k.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&(c++,c==2&&b.call(null,a.id))});f.append(g.container);
f.append(k.container)};this.update=function(b){var c=e.indicator.getDataType(a.getProperty("data"));d.updateChart(k,j);k.drawBarsFromZero=a.getProperty("drawBarsFromZero");j.sortDirection=a.getProperty("sortDirection");d.updateChart(g,h,i);g.drawBarsFromZero=a.getProperty("drawBarsFromZero");h.errorBarColor=a.getProperty("errorBarColor");h.sortDirection=a.getProperty("sortDirection");c==ia.Thematic.CATEGORIC?j.setData(e.indicatorData):(h.setData(e.indicatorData),i.setData(e.comparisonData));b!=void 0&&
b.call(null,a.id)};this.render=function(b){e.indicator.getDataType(h.dataField)==ia.Thematic.CATEGORIC?(g.hide(),f.text(""),k.container.css({visibility:"visible"}),k.show(),k.render()):(k.hide(),k.container.css({visibility:"hidden"}),f.text(""),g.show(),g.render());b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.BarChartFactory);
ia.GridChartFactory=function(a,b,c){ia.GridChartFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(a){g.isVisible&&iaExportPanelWithChart(f,chart,!1,a)};var g,h;this.build=function(b){f.content.empty();g=new ia.GridChart(a.id);h=new ia.GridLayer;h.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h);g.addEventListener(ia.Event.MAP_READY,
function(){b!=void 0&&b.call(null,a.id)});f.append(g.container)};this.update=function(b){d.updateChart(g,h);h.setData(e.indicatorData);b!=void 0&&b.call(null,a.id)};this.render=function(b){g.render();b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.GridChartFactory);
ia.BoxAndWhiskerFactory=function(a,b,c){ia.BoxAndWhiskerFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.dataGroup,c=c.comparisonInteractionGroup;e.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id);f.exportFunction=function(a){iaExportPanelWithChart(f,g,!1,a)};var g,h,i;this.build=function(b){f.content.empty();g=new ia.BoxChart(a.id);h=new ia.BoxLayer;
h.tipFunction=function(b){return ia.tipFunction(b,a.id)};i=new ia.ComparisonLineLayer;i.tipFunction=function(b){return ia.tipFunction(b,a.id)};d.buildChart(g,h,i);g.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});f.append(g.container)};this.update=function(b){d.updateChart(g,h,i);h.sortDirection=a.getProperty("sortDirection");h.largestObservationField=a.getProperty("largestObservationField");h.upperQuartileField=a.getProperty("upperQuartileField");h.medianField=a.getProperty("medianField");
h.lowerQuartileField=a.getProperty("lowerQuartileField");h.smallestObservationField=a.getProperty("smallestObservationField");h.setData(e.indicatorData);i.setData(e.comparisonData);a.getProperty("showComparison")&&i.selectAll();b!=void 0&&b.call(null,a.id)};this.render=function(b){var c=e.indicator.getDataType(h.dataField);c==ia.Thematic.CATEGORIC||c==!1?(g.hide(),f.text(a.getProperty("notAvailableText"))):(g.show(),f.text(""),g.render());b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.BoxAndWhiskerFactory);
ia.TimeSeriesFactory=function(a,b,c){function d(){var c=g.indicator;m=[];var d=b.config.getComponent("timeSeriesLineLegend"+g.suffix);if(n&&d&&d.getProperty("layout"))n.layout=d.getProperty("layout");d=k.thematic.categoricClassifier;d.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));d.colorPalette.matchColorsToValues={};var e={},h=[];m=[];if(k.dataField!=void 0)m[m.length]=k.dataField,h[h.length]="value",e.value={value:"value"};var i=a.getProperty("ignoreAssociateIds");
if(i)for(var l=c.getAssociates(),c=0;c<l.length;c++){for(var o=l[c],w=!0,x=0;x<i.length;x++)if(o.id==i[x]){w=!1;break}if(w&&o.type!=ia.Thematic.CATEGORIC)m[m.length]=o.id,h[h.length]=o.id,e[o.id]={value:o.id}}else{l=c.getAssociates();for(c=0;c<l.length;c++)if(o=l[c],o.type!=ia.Thematic.CATEGORIC)m[m.length]=o.id,h[h.length]=o.id,e[o.id]={value:o.id}}k.dataFields=m;j.dataFields=m;i=a.getProperty("associateLabels");if(i!=void 0){l={};for(c=0;c<m.length;c++)i.length>c&&(l[m[c]]=i[c]);k.associateNames=
l;j.associateNames=l;d.labels=i}d.breaks=h;k.thematic.setData(e);k.thematic.commitChanges();if(n){e=k.selectionColor;if(b.config.getComponent("featureLegend"+g.suffix)||b.config.getComponent("featureLegend"))e=f.selectionMode=="single"?k.colorPalette.getColorAtIndex(0):k.highlightColor;h=[];for(c=0;c<m.length;c++){l=new ia.CategoricClass(m[c]);l.color=e;if(o=d.getClass(m[c]))l.color=o.color;l.size=k.style.lineWidth;l.symbol=ia.Shape.LINE;l.value=m[c];i&&i.length>c&&l.setLabel(i[c]);h[h.length]=l}n.legendClasses=
h}}ia.TimeSeriesFactory.baseConstructor.call(this,a,b,c);var e=this,f=c.interactionGroup,g=c.dataGroup,c=c.comparisonInteractionGroup;g.addEventListener(ia.DataEvent.DATA_CHANGED,function(){e.update();e.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){e.update();e.render()});var h=b.getWidget(a.id);h.exportFunction=function(a){iaExportPanelWithChart(h,i,!1,a)};var i,k,j,m,n,l,o=function(){k.dataChanged=!0;e.render()};this.build=function(c){var d=b.config.getComponent("timeSeriesLineLegend"+
g.suffix);if(d&&n==void 0)n=new ia.ProfileLegend(d.id),l=b.getWidget(d.id),l.append(n.container),b.addComponent(d.id,n),l.exportFunction=function(a){ia.getDataUrl(l.content,function(b){iaExportDataUrl(b,a)})};h.content.empty();i=new ia.TimeChart(a.id);i.wrapXAxisLabels=!0;k=new ia.TimeLayer;j=new ia.ComparisonTimeLayer;j.thematic=g.comparisonThematic;e.buildChart(i,k,j);i.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)});h.append(i.container)};this.update=function(c){e.updateChart(i,
k,j);var h=g.theme,l=g.indicator,m=l.getDataType(k.dataField),h=h.getIndicatorDates(l.id);if(m!=ia.Thematic.CATEGORIC&&h!=void 0&&h.length>0){var n=a.getProperty("dropDates"),m=h.concat();n!=void 0&&n.length>0&&(m=h.filter(function(a){return n.indexOf(a)<0}));i.orientation=="vertical"?(i.xAxisLabels=m,i.yAxisLabels=void 0):(i.xAxisLabels=void 0,i.yAxisLabels=m);if(n!=void 0&&n.length>0)k.dropDates=n.concat();k.drawLinesThroughMissingValues=a.getProperty("drawLinesThroughMissingValues");k.highlightSelectedDate=
a.getProperty("highlightSelectedDate");a.getProperty("matchAxisToSelectedData")?f.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,o,this):f.removeListener(this);if(b.config.getComponent("featureLegend"+g.suffix))m=b.config.getComponent("featureLegend"+g.suffix),m=m.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(m);else if(b.config.getComponent("featureLegend"))m=b.config.getComponent("featureLegend"),m=m.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(m);
a.getProperty("showAssociate")==!0?d():(k.dataFields=[],j.dataFields=[]);j.drawLinesThroughMissingValues=a.getProperty("drawLinesThroughMissingValues");k.selectedDate=l.date;k.setData(g.themeData);j.selectedDate=l.date;j.setData(g.comparisonThemeData)}c!=void 0&&c.call(null,a.id)};this.render=function(b){var c=g.theme,d=g.indicator,e=d.getDataType(k.dataField),c=c.getIndicatorDates(d.id);e!=ia.Thematic.CATEGORIC&&c!=void 0&&c.length>0?(h.text(""),i.show(),i.render(),n&&(l.text(""),n.show(),n.render())):
(i.hide(),h.text(a.getProperty("notAvailableText")),n&&(n.hide(),l.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.TimeSeriesFactory);
ia.DiscreteTimeSeriesFactory=function(a,b,c){ia.DiscreteTimeSeriesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup,c=c.comparisonInteractionGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,h,!1,a)};var h,i,k,j=function(){i.dataChanged=!0;d.render()};this.build=
function(b){g.content.empty();h=new ia.TimeBarChart(a.id);i=new ia.TimeBarLayer;k=new ia.ComparisonTimeBarLayer;k.thematic=f.comparisonThematic;d.buildChart(h,i,k);i.interactive=!1;h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(h.container)};this.update=function(c){d.updateChart(h,i,k);var g=f.theme,l=f.indicator,o=l.getDataType(i.dataField),g=g.getIndicatorDates(l.id);if(o!=ia.Thematic.CATEGORIC&&g!=void 0&&g.length>0){var q=a.getProperty("dropDates"),o=
g.concat();q!=void 0&&q.length>0&&(o=g.filter(function(a){return q.indexOf(a)<0}));h.drawBarsFromZero=a.getProperty("drawBarsFromZero");h.orientation=="vertical"?(h.xAxisLabels=o,h.yAxisLabels=void 0):(h.xAxisLabels=void 0,h.yAxisLabels=o);if(q!=void 0&&q.length>0)i.dropDates=q.concat();i.highlightSelectedDate=a.getProperty("highlightSelectedDate");a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,j,this):e.removeListener(this);if(b.config.getComponent("featureLegend"+
f.suffix))o=b.config.getComponent("featureLegend"+f.suffix),o=o.getProperty("colorSchemeId"),i.colorPalette=b.config.getMapPalette().getColorScheme(o);else if(b.config.getComponent("featureLegend"))o=b.config.getComponent("featureLegend"),o=o.getProperty("colorSchemeId"),i.colorPalette=b.config.getMapPalette().getColorScheme(o);else if(a.getProperty("colorSchemeId"))i.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));i.selectedDate=l.date;i.setData(f.themeData);
k.selectedDate=l.date;k.setData(f.comparisonThemeData)}c!=void 0&&c.call(null,a.id)};this.render=function(b){var c=f.theme,d=f.indicator,e=d.getDataType(i.dataField),c=c.getIndicatorDates(d.id);e!=ia.Thematic.CATEGORIC&&c!=void 0&&c.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.DiscreteTimeSeriesFactory);
ia.StackedTimeSeriesFactory=function(a,b,c){ia.StackedTimeSeriesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,h,!1,a)};var h,i,k,j,m,n,l=function(){if(k)k.dataChanged=!0;i.dataChanged=!0;d.render()};this.build=function(c){var j=b.config.getComponent("stackedLegend"+f.suffix);if(j&&m==void 0)m=new ia.ProfileLegend(j.id),
n=b.getWidget(j.id),n.append(m.container),b.addComponent(j.id,m),n.exportFunction=function(a){iaExportPanel(n,a)};if(h==void 0){g.content.empty();h=new ia.StackedTimeChart(a.id);h.drawBarsFromZero=!0;h.wrapXAxisLabels=!0;i=new ia.StackedTimeLayer;if(a.getProperty("lineData")!=void 0)k=new ia.TimeLayer,k.thematic=f.comparisonThematic;d.buildChart(h,i);i.interactive=!1;if(k)k.setVisible(!0),k.interactive=!0,h.addLayer(k),e.addComponent(k);h.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&
c.call(null,a.id)});g.append(h.container)}else c!=void 0&&c.call(null,a.id)};this.update=function(c){var g=b.config.getComponent("stackedLegend"+f.suffix);if(m&&g&&g.getProperty("layout"))m.layout=g.getProperty("layout");d.updateChart(h,i);if(k){k.highlightColor=b.highlightColor;k.selectionColor=b.selectionColor;k.dataField=a.getProperty("lineData");k.tip="${name} (${date}): ${value}";if(a.getProperty("matchAxisToSelectedData")!=void 0)k.matchAxisToSelectedData=a.getProperty("matchAxisToSelectedData");
if(b.config.getComponent("featureLegend"+f.suffix))g=b.config.getComponent("featureLegend"+f.suffix),g=g.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(g)}if(a.getProperty("highlightSelectedDate")!=void 0)i.highlightSelectedDate=a.getProperty("highlightSelectedDate");a.getProperty("matchAxisToSelectedData")?e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,l,this):e.removeListener(this);var g=a.getProperty("colorSchemeId"),n=b.config.getMapPalette().getColorScheme(g),
r=f.theme,g=f.indicator;j=[];var t=a.getProperty("ignoreAssociateIds");if(t)for(var s=g.getAssociates(),u=0;u<s.length;u++){for(var v=s[u],w=!0,x=0;x<t.length;x++)if(v.id==t[x]){w=!1;break}if(w&&v.type!=ia.Thematic.CATEGORIC)j[j.length]=v.id}else{s=g.getAssociates();for(u=0;u<s.length;u++)if(v=s[u],v.type!=ia.Thematic.CATEGORIC)j[j.length]=v.id}i.dataFields=j;t=a.getProperty("associateLabels");s=[];for(u=0;u<j.length;u++)v=new ia.CategoricClass(j[u]),v.color=n.getColorAtIndex(u),v.symbol=ia.Shape.SQUARE,
v.size=10,v.value=j[u],t&&t.length>u&&v.setLabel(t[u]),s[s.length]=v;i.legendClasses=s;if(m)m.legendClasses=s;n=r.getIndicatorDates(g.id);if(n!=void 0&&n.length>0){var y=a.getProperty("dropDates"),r=n.concat();y!=void 0&&y.length>0&&(r=n.filter(function(a){return y.indexOf(a)<0}));h.orientation=="vertical"?(h.yAxisLabels=void 0,h.xAxisLabels=r):(h.yAxisLabels=r,h.xAxisLabels=void 0);if(y!=void 0&&y.length>0)i.dropDates=y.concat()}i.selectedDate=g.date;i.setData(f.themeData);if(k)k.selectedDate=g.date,
k.setData(f.themeData);c!=void 0&&c.call(null,a.id)};this.render=function(b){f.indicator.date!=void 0&&j.length>0?(g.text(""),h.show(),h.render(),m&&(n.text(""),m.show(),m.render())):(h.hide(),g.text(a.getProperty("notAvailableText")),m&&(m.hide(),n.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.StackedTimeSeriesFactory);
ia.StackedBarFactory=function(a,b,c){ia.StackedBarFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,h,!1,a)};var h,i,k,j,m,n=function(){d.render()};this.build=function(c){var e=b.config.getComponent("stackedLegend"+f.suffix);if(e&&j==void 0)j=new ia.ProfileLegend(e.id),m=b.getWidget(e.id),m.append(j.container),
b.addComponent(e.id,j),m.exportFunction=function(a){iaExportPanel(m,a)};h==void 0?(g.content.empty(),h=new ia.StackedTimeChart(a.id),h.drawBarsFromZero=!0,h.wrapXAxisLabels=!0,i=new ia.StackedBarLayer,d.buildChart(h,i),i.interactive=!1,h.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)}),g.append(h.container)):c!=void 0&&c.call(null,a.id)};this.update=function(c){var g=b.config.getComponent("stackedLegend"+f.suffix);if(j&&g&&g.getProperty("layout"))j.layout=g.getProperty("layout");
d.updateChart(h,i);e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,n,this);var g=a.getProperty("colorSchemeId"),g=b.config.getMapPalette().getColorScheme(g),m=f.indicator;k=[];var p=a.getProperty("ignoreAssociateIds");if(p)for(var r=m.getAssociates(),m=0;m<r.length;m++){for(var t=r[m],s=!0,u=0;u<p.length;u++)if(t.id==p[u]){s=!1;break}if(s&&t.type!=ia.Thematic.CATEGORIC)k[k.length]=t.id}else{r=m.getAssociates();for(m=0;m<r.length;m++)if(t=r[m],t.type!=ia.Thematic.CATEGORIC)k[k.length]=t.id}i.dataFields=
k;p=a.getProperty("associateLabels");r=[];for(m=0;m<k.length;m++)t=new ia.CategoricClass(k[m]),t.color=g.getColorAtIndex(m),t.symbol=ia.Shape.SQUARE,t.size=10,t.value=k[m],p&&p.length>m&&t.setLabel(p[m]),r[r.length]=t;i.legendClasses=r;if(j)j.legendClasses=r;i.setData(f.indicatorData);c!=void 0&&c.call(null,a.id)};this.render=function(b){if(a.getProperty("matchAxisToSelectedData"))i.dataChanged=!0;for(var c=e.getSelection(),d=[],n=0;n<c.length;n++){var r=c[n],t=f.geography.getFeature(r).name;if(d.indexOf(t)==
-1)d[d.length]=f.geography.getFeature(r).name}d.length==0&&(d[0]="_");h.orientation=="vertical"?(h.yAxisLabels=void 0,h.xAxisLabels=d):(h.yAxisLabels=d,h.xAxisLabels=void 0);k.length>0?(g.text(""),h.show(),h.render(),j&&(m.text(""),j.show(),j.render())):(h.hide(),g.text(a.getProperty("notAvailableText")),j&&(j.hide(),m.text(a.getProperty("notAvailableText"))));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.StackedBarFactory);
ia.StackedFeaturesFactory=function(a,b,c){ia.StackedFeaturesFactory.baseConstructor.call(this,a,b,c);var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,h,!1,a)};var h,i,k=function(){i.dataChanged=!0;d.render()};this.build=function(b){g.content.empty();h=new ia.StackedTimeChart(a.id);i=new ia.StackedFeaturesLayer;d.buildChart(h,i);i.interactive=!1;
h.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});g.append(h.container)};this.update=function(c){d.updateChart(h,i);var g=f.theme,n=f.indicator,l=n.getDataType(i.dataField),g=g.getIndicatorDates(n.id);if(l!=ia.Thematic.CATEGORIC&&g!=void 0&&g.length>0){var o=a.getProperty("dropDates"),l=g.concat();o!=void 0&&o.length>0&&(l=g.filter(function(a){return o.indexOf(a)<0}));h.drawBarsFromZero=a.getProperty("drawBarsFromZero");h.orientation=="vertical"?(h.xAxisLabels=l,h.yAxisLabels=
void 0):(h.xAxisLabels=void 0,h.yAxisLabels=l);if(o!=void 0&&o.length>0)i.dropDates=o.concat();i.highlightSelectedDate=a.getProperty("highlightSelectedDate");e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,k,this);if(b.config.getComponent("featureLegend"+f.suffix))l=b.config.getComponent("featureLegend"+f.suffix),l=l.getProperty("colorSchemeId"),i.colorPalette=b.config.getMapPalette().getColorScheme(l);else if(b.config.getComponent("featureLegend"))l=b.config.getComponent("featureLegend"),
l=l.getProperty("colorSchemeId"),i.colorPalette=b.config.getMapPalette().getColorScheme(l);else if(a.getProperty("colorSchemeId"))i.colorPalette=b.config.getMapPalette().getColorScheme(a.getProperty("colorSchemeId"));i.selectedDate=n.date;i.setData(f.themeData)}c!=void 0&&c.call(null,a.id)};this.render=function(b){var c=f.theme,d=f.indicator,e=d.getDataType(i.dataField),c=c.getIndicatorDates(d.id);e!=ia.Thematic.CATEGORIC&&c!=void 0&&c.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));
b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.StackedFeaturesFactory);
ia.PyramidChartFactory=function(a,b,c){function d(){var a=i.geography;l.geography=a;for(var b=a.getComparisonFeatures(),c=[],d=0;d<b.length;d++)c.push(b[d].id);a=a.getProfileData(c);a.themes.length>0&&p.setData(a.themes[0].indicators);a.themes.length>1&&u.setData(a.themes[1].indicators)}function e(){for(var a=l.getLayers(),b=0;b<a.length;b++)k.removeComponent(a[b]);l.removeLayers();t=[];o=[];v=[];r=[];q=new ia.PyramidLayer;q.setVisible(!0);q.interactive=!0;l.addLayer(q);o[o.length]=q;s=new ia.PyramidLayer;
s.gender="female";s.setVisible(!0);s.interactive=!0;l.addLayer(s);t[t.length]=s;p=new ia.ComparisonPyramidLayer;p.setVisible(!0);p.interactive=!0;p.thematic=i.comparisonThematic;l.addLayer(p);k.addComponent(p);u=new ia.ComparisonPyramidLayer;u.gender="female";u.setVisible(!0);u.interactive=!0;u.thematic=i.comparisonThematic;l.addLayer(u);k.addComponent(u)}function f(){clearTimeout(w);w=setTimeout(function(){var a=h.getSelection();if(a.length>0)for(var a=i.geography.getProfileData([a[0]]),b=0;b<o.length;b++)a.themes.length>
0&&o[b].setData(a.themes[0].indicators),a.themes.length>1&&t[b].setData(a.themes[1].indicators);else for(b=0;b<o.length;b++)o[b].setData({}),t[b].setData({});g.render()},250)}var g=this,h=c.interactionGroup,i=c.dataGroup,k=c.comparisonInteractionGroup;i.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d();g.render()});i.addEventListener(ia.DataEvent.DATA_CHANGED,function(){g.update();g.render()});h.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){f()});k.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,
function(){f()});var j=b.getWidget(a.id);j.exportFunction=function(a){l.isVisible&&iaExportPanelWithChart(j,l,!1,a)};var m,n,l,o,q,p,r,t,s,u,v;this.build=function(c){if((m=b.config.getComponent("pyramidLegend"+i.suffix))&&n==void 0){n=new ia.ProfileLegend(m.id);var f=b.getWidget(m.id);f.append(n.container);b.addComponent(m.id,n);f.exportFunction=function(a){iaExportPanel(f,a)}}if(l==void 0){j.content.empty();l=new ia.PyramidChart(a.id);l.formatter=b.locale.formatter;j.append(l.container);e();if(b.url.params["select"+
i.suffix])for(var g=b.url.params["select"+i.suffix].toString().split(","),g=i.geography.getProfileData([g[g.length-1]]),h=0;h<o.length;h++)g.themes.length>0&&o[h].setData(g.themes[0].indicators),g.themes.length>1&&t[h].setData(g.themes[1].indicators);b.addComponent(a.id,l);d();l.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)})}else c!=void 0&&c.call(null,a.id)};this.update=function(c){var d=a.getProperties(),e=0,g;for(g in d){var h="line_value_";if(g.indexOf(h)!=-1){var h=
g.substring(g.lastIndexOf("_")+1,g.length),j=a.getProperty("line_value_"+h),h=a.getProperty("line_color_"+h),m;r.length>e?m=r[e]:(m=new ia.ComparisonPyramidLayer,r[r.length]=m,o[o.length]=m);m.dataField=j;m.setVisible(!0);m.interactive=!0;m.displayAll=!0;m.tip=a.getProperty("tip");l.addLayer(m);m.style.strokeStyle=h;v.length>e?m=v[e]:(m=new ia.ComparisonPyramidLayer,v[v.length]=m,t[t.length]=m);m.gender="female";m.dataField=j;m.setVisible(!0);m.interactive=!0;m.displayAll=!0;m.tip=a.getProperty("tip");
l.addLayer(m);m.style.strokeStyle=h;e++}}for(d=e;d<r.length;d++)m=r[d],m.setVisible(!1),m.interactive=!1,m.displayAll=!1,m=v[d],m.setVisible(!1),m.interactive=!1,m.displayAll=!1;d=b.config.getComponent("pyramidLegend"+i.suffix);if(n&&d&&d.getProperty("layout"))n.layout=d.getProperty("layout");e=[];j=a.getProperty("maleLabel");m=new ia.CategoricClass(j);m.color=a.getProperty("maleColor");m.symbol=ia.Shape.SQUARE;m.size=12;m.value=j;e[e.length]=m;j=a.getProperty("femaleLabel");m=new ia.CategoricClass(j);
m.color=a.getProperty("femaleColor");m.symbol=ia.Shape.SQUARE;m.size=12;m.value=j;e[e.length]=m;d=a.getProperties();for(g in d)if(h="line_value_",g.indexOf(h)!=-1&&(h=g.substring(g.lastIndexOf("_")+1,g.length),m=a.getProperty("line_value_"+h),j=a.getProperty("line_label_"+h),h=a.getProperty("line_color_"+h),m!=void 0))m=new ia.CategoricClass(j),m.color=h,m.symbol=ia.Shape.HORIZONTAL_LINE,m.size=12,m.value=j,e[e.length]=m;if(n)n.legendClasses=e,n.render();l.orientation="horizontal";l.drawBarsFromZero=
a.getProperty("drawBarsFromZero");l.showYAxisLabels=a.getProperty("showYAxisLabels");q.dataField=a.getProperty("data")||"value";q.tip=a.getProperty("tip");q.style.fillStyle=ia.Color.toRGBA(a.getProperty("maleColor"),0.8);q.style.strokeStyle=a.getProperty("maleColor");s.dataField=a.getProperty("data")||"value";s.tip=a.getProperty("tip");s.style.fillStyle=ia.Color.toRGBA(a.getProperty("femaleColor"),0.8);s.style.strokeStyle=a.getProperty("femaleColor");p.dataField=a.getProperty("data")||"value";p.displayAll=
a.getProperty("showComparison");p.tip=a.getProperty("tip");p.highlightColor=b.highlightColor;p.selectionColor=b.selectionColor;u.dataField=a.getProperty("data")||"value";u.tip=a.getProperty("tip");u.displayAll=a.getProperty("showComparison");u.highlightColor=b.highlightColor;u.selectionColor=b.selectionColor;for(d=0;d<o.length;d++)o[d].highlightColor=b.highlightColor,o[d].selectionColor=b.selectionColor,t[d].highlightColor=b.highlightColor,t[d].selectionColor=b.selectionColor;g=i.indicator;(d=g.getProperty(a.getProperty("maxChartValue")))?
(l.useTightLabels=!0,l.fixedMaxValue=d):a.getProperty("useFixedValues")?(l.useTightLabels=!0,l.fixedMaxValue=a.getProperty("fixedMaxValue")):l.useTightLabels=a.getProperty("useTightLabels");d=a.getProperty("xAxisTitle");l.xAxisTitle=d?b.textSubstitution.formatMessage(d):void 0;d=a.getProperty("yAxisTitle");l.yAxisTitle=d?b.textSubstitution.formatMessage(d):void 0;d=i.geography.getThemes()[0];l.yAxisLabels=d.getIndicatorNames().reverse();l.date=g.date;p.update(l.date);u.update(l.date);g=k.getSelection();
g.length>0&&k.setSelection(g);f();c!=void 0&&c.call(null,a.id)};this.render=function(b){l.render();b!=void 0&&b.call(null,a.id)};var w=null};
ia.TimeControlFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.TimeControl(a.id,e,function(a){if(b.getComponent("timeSeries"+e.suffix))b.getComponent("timeSeries"+e.suffix).animationMode=a;if(b.getComponent("discreteTimeSeries"+e.suffix))b.getComponent("discreteTimeSeries"+e.suffix).animationMode=a;if(b.getComponent("stackedTimeSeries"+e.suffix))b.getComponent("stackedTimeSeries"+
e.suffix).animationMode=a;if(b.getComponent("stackedFeaturesTimeSeries"+e.suffix))b.getComponent("stackedFeaturesTimeSeries"+e.suffix).animationMode=a});f.append(g.container);b.addComponent(a.id,g);g.dropDates=a.getProperty("dropDates");g.setData(e.indicator);c!=void 0&&c.call(null,a.id)};this.update=function(b){g.delay=a.getProperty("delay");g.dropDates=a.getProperty("dropDates");b!=void 0&&b.call(null,a.id)};this.render=function(b){e.indicator.date==void 0?(g.container.hide(),f.text(a.getProperty("notAvailableText"))):
(g.container.show(),f.text(""));b!=void 0&&b.call(null,a.id)}};
ia.FeatureCardFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id),h,i;this.build=function(c){g.content.empty();h=new ia.FeatureCard(a.id);g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.noDataValue=b.config.getProperty("noDataValue");h.displayMode=a.getProperty("displayMode");h.dataOrder=a.getProperty("dataOrder");
h.displaySelectedDateOnly=a.getProperty("displaySelectedDateOnly");h.displayFeatureHeader=a.getProperty("displayFeatureHeader");h.displayThemeHeader=a.getProperty("displayThemeHeader");if(a.getProperty("ignoreThemeIds")!=void 0)h.ignoreThemeIds=a.getProperty("ignoreThemeIds");if(a.getProperty("ignoreIndicatorIds")!=void 0)h.ignoreIndicatorIds=a.getProperty("ignoreIndicatorIds");h.geography=f.geography;h.indicator=f.indicator;i!=a.getProperty("snippet")?(i=a.getProperty("snippet"),h.setSnippet(i,function(){c!=
void 0&&c.call(null,a.id)})):c!=void 0&&c.call(null,a.id)};this.render=function(b){h.render();b!=void 0&&b.call(null,a.id)}};
ia.MetadataFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.Metadata(a.id);f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(b){var c=e.indicator,d=a.getProperty("metadataKey");c.getProperty(d)?g.setHtml(c.getProperty(d)):g.setHtml("");b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,
a.id)}};
ia.StatsBoxFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.Metadata(a.id);f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(c){var d=e.indicator;if(d.getDataType(e.thematic.getDataField())!=ia.Thematic.CATEGORIC){var f=a.getProperty("ndecimal");f==-1&&(f=d.precision||2,f==void 0&&(f=2));var d=b.locale.formatter,j=
e.thematic.numericClassifier.getCalculator().getStats();b.textSubstitution.setVariable("sum"+e.suffix,d.format(j.sum,f));b.textSubstitution.setVariable("count"+e.suffix,d.format(j.count,f));b.textSubstitution.setVariable("mean"+e.suffix,d.format(j.mean,f));b.textSubstitution.setVariable("median"+e.suffix,d.format(j.median,f));b.textSubstitution.setVariable("minValue"+e.suffix,d.format(j.minValue,f));b.textSubstitution.setVariable("maxValue"+e.suffix,d.format(j.maxValue,f));b.textSubstitution.setVariable("range"+
e.suffix,d.format(j.range,f));b.textSubstitution.setVariable("lowerQuartile"+e.suffix,d.format(j.lowerQuartile,f));b.textSubstitution.setVariable("upperQuartile"+e.suffix,d.format(j.upperQuartile,f));b.textSubstitution.setVariable("interquartileRange"+e.suffix,d.format(j.interquartileRange,f));b.textSubstitution.setVariable("variance"+e.suffix,d.format(j.variance,f));b.textSubstitution.setVariable("standardDeviation"+e.suffix,d.format(j.standardDeviation,f));b.updateDynamicText(b.textSubstitution)}f=
b.textSubstitution.formatMessage(a.getProperty("text"));g.setHtml(f);c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.AdvancedPieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var g=b.getWidget(a.id),h,i;this.build=function(c){g.content.empty();h=new ia.AdvancedPieComponent(a.id,a.getProperty("layout"));h.build();g.append(h.container);e.addComponent(h);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.highlightColor=b.highlightColor;h.selectionColor=b.selectionColor;h.tip=a.getProperty("tip");
h.title1=a.getProperty("title1");h.title2=a.getProperty("title2");var e=a.getProperty("colorSchemeId");h.thematic.categoricClassifier.colorPalette=b.config.getMapPalette().getColorScheme(e);var g=f.theme,n=f.indicator,e={};i=[];if(a.getProperty("datasource")=="associate"){h.setData(d.indicatorData);var l=a.getProperty("ignoreAssociateIds");if(l){n=n.getAssociates();for(g=0;g<n.length;g++){for(var o=n[g],q=!0,p=0;p<l.length;p++)if(o.id==l[p]){q=!1;break}if(q&&o.type!=ia.Thematic.CATEGORIC)i[i.length]=
o.id,e[o.id]={value:o.id}}}else{n=n.getAssociates();for(g=0;g<n.length;g++)if(o=n[g],o.type!=ia.Thematic.CATEGORIC)e[o.id]={value:o.id},i[i.length]=o.id}if(g=a.getProperty("associateLabels"))h.thematic.categoricClassifier.labels=g}else if(n.date!=void 0){l=g.getDataForDate(n.date);h.setData(l);l=g.getIndicators();for(g=0;g<l.length;g++)if(o=l[g],o.date==n.date&&o.type!=ia.Thematic.CATEGORIC)e[o.name]={value:o.name},i[i.length]=o.name}else{l=g.getData();h.setData(l);l=g.getIndicators();for(g=0;g<l.length;g++)if(o=
l[g],o.type!=ia.Thematic.CATEGORIC)i[i.length]=o.name,e[o.name]={value:o.name}}h.thematic.categoricClassifier.breaks=i;h.thematic.setData(e);h.thematic.commitChanges();c!=void 0&&c.call(null,a.id)};this.render=function(b){i.length>0?(g.text(""),h.show(),h.render()):(h.hide(),g.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};
ia.PieChartFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup;f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update();d.render()});f.addEventListener(ia.Event.THEMATIC_CHANGED,function(){d.update();d.render()});var g=b.getWidget(a.id);g.exportFunction=function(a){iaExportPanelWithChart(g,h,!1,a)};var h,i;this.build=function(c){g.content.empty();h=new ia.PieChart(a.id);g.append(h.container);b.addComponent(a.id,h);i=new ia.PieLayer;i.thematic=f.thematic;i.setVisible(!0);
i.interactive=!0;h.addLayer(i);e.addComponent(i);h.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)})};this.update=function(c){i.highlightColor=b.highlightColor;i.selectionColor=b.selectionColor;i.tip=a.getProperty("tip");c!=void 0&&c.call(null,a.id)};this.render=function(b){f.thematic.numericClassifier.classificationName==ia.Thematic.CONTINUOUS||f.thematic.colorField!=void 0?(h.hide(),g.text(a.getProperty("notAvailableText"))):(g.text(""),h.show(),h.render());b!=void 0&&
b.call(null,a.id)}};
ia.DataTableFactory=function(a,b,c,d){function e(){k||(k=setTimeout(function(){g.update()},250))}function f(){j||(j=setTimeout(function(){g.render()},250))}for(var g=this,h=0;h<c.length;h++){var i=c[h];i.addEventListener(ia.DataEvent.DATA_CHANGED,function(){e()});i.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()})}var k=null,j=null,m=b.getWidget(a.id);m.exportFunction=function(a){var b=n.exportData();iaExportCSV(b,a)};var n,l,o;this.build=function(e){m.content.empty();n=new ia.Table(a.id);
if(b.url.params.stickToTop!=void 0){var f=b.url.params.stickToTop.toString().split(",");n.stickToTop(f)}m.append(n.container);d.addComponent(n);b.addComponent(a.id,n);n.addEventListener(ia.ItemEvent.ITEM_CLICK,function(){if(l){var a=b.getComponent("activeMap"+i.suffix);b.config.template==ia.BUBBLE_PLOT_REPORT&&(a=b.getComponent("activeMap"));if(a){var e=d.getSelection();e.length>0?a.zoomToFeatures(e,[c[0].mapData.baseLayer]):a.controller.zoomFull()}}});o=new ia.TableTools(c[0],d);o.filterFunction=
function(){d.getSelection().length>0?c[0].setFilteredFeatures(d.getSelection()):c[0].getFilteredFeatures().length>0&&c[0].clearFilter()};o.clearFunction=function(){d.clearSelection();var a=b.getComponent("activeMap"+i.suffix);a&&a.controller.zoomFull()};e!=void 0&&e.call(null,a.id)};this.update=function(d){k=null;l=a.getProperty("zoomOnSelection");n.highlightColor=b.highlightColor;n.selectionColor=b.selectionColor;n.showLegendColor=a.getProperty("showLegendColor");n.allowUserSorting=a.getProperty("allowUserSorting");
if(o)o.clearButtonText=a.getProperty("clearButtonText"),o.filterButtonText=a.getProperty("filterButtonText"),(o.clearButtonText==void 0||o.clearButtonText=="")&&(o.filterButtonText==void 0||o.filterButtonText=="")?o.container.remove():m.appendToFooter(o.container),o.render();a.customColumns=c[0].indicator.customColumns;for(var e=[],f=0;f<c.length;f++){var g=c[f];e[f]=g.indicator}n.columns=a.getColumnsForIndicators(e,b.textSubstitution);n.setData(c[0].indicatorData);for(f=1;f<c.length;f++)g=c[f],n["data"+
(f+1)]=g.indicatorData;d!=void 0&&d.call(null,a.id)};this.render=function(b){j=null;n.render();b!=void 0&&(a.getProperty("sortColumnName")!=""&&n.sort(a.getProperty("sortColumnName"),a.getProperty("sortDirection")),b.call(null,a.id))}};
ia.ComparisonTableFactory=function(a,b,c,d,e){function f(){k||(k=setTimeout(function(){h.update()},250))}function g(){j||(j=setTimeout(function(){h.render()},250))}for(var h=this,d=0;d<c.length;d++){var i=c[d];i.addEventListener(ia.DataEvent.DATA_CHANGED,function(){f()});i.addEventListener(ia.Event.THEMATIC_CHANGED,function(){g()})}var k=null,j=null,m=b.getWidget(a.id),m=b.getWidget(a.id);m.exportFunction=function(a){var b=n.exportData();iaExportCSV(b,a)};var n;this.build=function(d){m.content.empty();
n=new ia.ComparisonTable(a.id);n.thematic=c[0].comparisonThematic;m.append(n.container);e.addComponent(n);b.addComponent(a.id,n);n.addEventListener(ia.ItemEvent.ITEM_CLICK,function(){if(a.getProperty("linkToMap")){var c=b.getComponent("activeMap"+i.suffix);if(c){var d=e.getSelection().map(function(a){return a.indexOf("#")==0?a.substr(1):a});d.length>0?c.zoomToFeatures(d):c.controller.zoomFull()}}});d!=void 0&&d.call(null,a.id)};this.update=function(d){n.highlightColor=b.highlightColor;n.selectionColor=
b.selectionColor;n.showLegendColor=a.getProperty("showLegendColor");n.allowUserSorting=a.getProperty("allowUserSorting");var e=a.getProperty("colorSchemeId");c[0].comparisonThematic.categoricClassifier.colorPalette=b.config.getMapPalette().getColorScheme(e);c[0].comparisonThematic.commitChanges();k=null;a.customColumns=c[0].indicator.customColumns;for(var e=[],f=0;f<c.length;f++){var g=c[f];e[f]=g.indicator}n.columns=a.getColumnsForIndicators(e,b.textSubstitution);n.setData(c[0].comparisonData);for(f=
1;f<c.length;f++)g=c[f],n["data"+(f+1)]=g.comparisonData;d!=void 0&&d.call(null,a.id)};this.render=function(b){j=null;n.render();b!=void 0&&(a.getProperty("sortColumnName")!=""&&n.sort(a.getProperty("sortColumnName"),a.getProperty("sortDirection")),b.call(null,a.id))}};
ia.DataExplorerFactory=function(a,b,c){function d(){var a=f.indicator;i&&a.date!=void 0?h.showItem(a.geography.id+"~"+a.id+"~"+a.date):h.showItem(a.geography.id+"~"+a.id)}var e=this,f=c.dataGroup;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){e.update()});f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d();h.hideOnSelection&&g.hide()});var g=b.getWidget(a.id),h,i,k;this.build=function(c){g.content.empty();h=new ia.DataExplorer(a.id,function(b){var c=b.split("~"),b=c[0],d=c[1],c=c[2];
if(c==void 0)c=f.indicator.date;if(a.getProperty("showDates")==!1){var e=a.getProperty("loadMostRecentDate");e!=void 0&&e==!0&&(c=void 0)}f.setData(b,d,c)});g.append(h.container);b.addComponent(a.id,h);c!=void 0&&c.call(null,a.id)};this.update=function(c){h.closeBranchesOnSelection=a.getProperty("closeBranchesOnSelection");h.hideOnSelection=a.getProperty("hideOnSelection");i=a.getProperty("showDates");k=a.getProperty("reverseDates");k==void 0&&(k=!0);var e=f.geography;b.config.getComponent("geogExplorer")!=
void 0||b.config.template==ia.DOUBLE_GEOG_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT||b.config.template==ia.DOUBLE_PLOT_REPORT||b.config.template==ia.BUBBLE_PLOT_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW?(h.data(e.getDataTree(i,k)),h.build(e.id)):b.data.getGeographies().length>1?(h.data(b.data.getDataTree(i,k)),h.build()):(h.data(e.getDataTree(i,k)),h.build(e.id));d();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.GeogExplorerFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update()});e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){g.hideOnSelection&&f.hide()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.DataExplorer(a.id,function(a){e.setData(a,e.indicator.id,e.indicator.date)});f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(c){g.hideOnSelection=a.getProperty("hideOnSelection");
g.data(b.data.getGeographyTree());g.build();c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.FilterExplorerFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){d.update()});e.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(){e.getFilteredFeatures().length==0&&g.clearSelection();g.hideOnSelection&&f.hide()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.DataExplorer(a.id,function(a){var a=a.split("~"),b=a[0],c=a[1];a.length>2?g.filterType=="combined"?e.removeFilter(b,c):e.clearFilter():g.filterType==
"combined"?e.appendFilter(b,c):e.setFilter(b,c)});g.isFilterExplorer=!0;f.append(g.container);b.addComponent(a.id,g);c!=void 0&&c.call(null,a.id)};this.update=function(b){g.closeBranchesOnSelection=a.getProperty("closeBranchesOnSelection");g.hideOnSelection=a.getProperty("hideOnSelection");if(a.getProperty("filterType"))g.filterType=a.getProperty("filterType");g.data(e.geography.getFilterTree());g.build();b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.MenuBarFactory=function(a,b){var c=b.getWidget(a.id),d;this.build=function(e){c.content.empty();d=new ia.MenuBar(a.id,a);c.content.empty();c.append(d.container);b.addComponent(a.id,d);e!=void 0&&e.call(null,a.id)};this.update=function(b){d.render(a);b!=void 0&&b.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.ScatterPlotFactory=function(a,b,c,d,e){function f(){clearTimeout(m);m=setTimeout(function(){g.update();g.render()},250)}var g=this,h,i,k,j;c.length==1?(k=c[0],j=c[0]):c.length==2?(k=c[0],j=c[1]):c.length==3?(h=c[0],k=c[1],j=c[2]):c.length==4&&(h=c[0],i=c[1],k=c[2],j=c[3]);h&&h.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});i&&i.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});k.addEventListener(ia.Event.THEMATIC_CHANGED,function(){f()});j.addEventListener(ia.Event.THEMATIC_CHANGED,
function(){f()});e.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){f()});var m=null,n=b.getWidget(a.id);n.exportFunction=function(a){iaExportPanelWithChart(n,l,!1,a)};var l,o,q,p,r;this.build=function(c){n.content.empty();l=new ia.Plot(a.id);l.formatter=b.locale.formatter;n.append(l.container);b.addComponent(a.id,l);o=new ia.PlotLayer;o.setVisible(!0);o.interactive=!0;o.tipFunction=function(b){return ia.tipFunction(b,a.id)};l.addLayer(o);d.addComponent(o);q=new ia.ComparisonPlotLayer;
q.setVisible(!0);q.interactive=!0;q.tipFunction=function(b){return ia.tipFunction(b,a.id)};l.addLayer(q);e.addComponent(q);r=[];for(var f=1;f<6;f++){var g=a.getProperty("line_xfield_"+f),h=a.getProperty("line_yfield_"+f);if(g!=void 0&&h!=void 0)g=new ia.LineLayer,g.setVisible(!0),g.interactive=!0,l.addLayer(g),r.push(g)}if(a.getProperty("sizeData")!=void 0)p=new ia.Thematic,p.setDataField(a.getProperty("sizeData")),p.classificationName=ia.Thematic.CONTINUOUS,f=p.numericClassifier.sizePalette,f.minSize=
a.getProperty("minBubbleSize"),f.maxSize=a.getProperty("maxBubbleSize"),p.categoricClassifier.symbolSize=8;l.addEventListener(ia.Event.MAP_READY,function(){c!=void 0&&c.call(null,a.id)})};this.update=function(c){clearTimeout(m);o.highlightColor=b.highlightColor;o.selectionColor=b.selectionColor;q.highlightColor=b.highlightColor;q.selectionColor=b.selectionColor;for(var d=0;d<r.length;d++){var e=d+1,f=r[d];f.highlightColor=b.highlightColor;f.selectionColor=b.selectionColor;f.highlightColor=b.highlightColor;
f.selectionColor=b.selectionColor;f.style.strokeStyle=a.getProperty("line_color_"+e);(function(){var b=a.getProperty("line_label_"+e);f.tipFunction=function(){return b}})()}if(a.getProperty("sizeData")!=void 0){var g=p.numericClassifier.sizePalette;p.setDataField(a.getProperty("sizeData"));g.minSize=a.getProperty("minBubbleSize");g.maxSize=a.getProperty("maxBubbleSize")}o.pointSize=a.getProperty("minBubbleSize")||a.getProperty("pointSize");o.xDataField=a.getProperty("xData");o.yDataField=a.getProperty("yData");
o.showCorrelationLine=a.getProperty("showCorrelationLine");q.pointSize=a.getProperty("minBubbleSize")||a.getProperty("pointSize");q.xDataField=a.getProperty("xData");q.yDataField=a.getProperty("yData");q.displayAll=a.getProperty("showComparison");var x;if(i)x=i.indicator;var g=k.indicator,y=j.indicator,B;i&&a.getProperty("sizeData")!=void 0&&(B=i.getFilteredFeatures().length>0?x.getData(i.getFilteredFeatures()):x.getData(),p.setData(B),p.commitChanges());d=g.getDataType(o.xDataField);x=y.getDataType(o.yDataField);
if(d==ia.Thematic.CATEGORIC||x==ia.Thematic.CATEGORIC)l.hide(),n.text(a.getProperty("notAvailableText"));else{l.fixedMinValueX=g.getProperty(a.getProperty("minChartValueX"));l.fixedMaxValueX=g.getProperty(a.getProperty("maxChartValueX"));l.fixedMinValueY=y.getProperty(a.getProperty("minChartValueY"));l.fixedMaxValueY=y.getProperty(a.getProperty("maxChartValueY"));l.fixedMinValueX!=void 0&&l.fixedMaxValueX!=void 0&&l.fixedMinValueY!=void 0&&l.fixedMaxValueY!=void 0?l.useTightLabels=!0:a.getProperty("useFixedValues")?
(l.useTightLabels=!0,l.fixedMinValueX=a.getProperty("fixedMinValueX"),l.fixedMaxValueX=a.getProperty("fixedMaxValueX"),l.fixedMinValueY=a.getProperty("fixedMinValueY"),l.fixedMaxValueY=a.getProperty("fixedMaxValueY")):l.useTightLabels=a.getProperty("useTightLabels");if(d=a.getProperty("xAxisTitle"))l.xAxisTitle=b.textSubstitution.formatMessage(d);if(d=a.getProperty("yAxisTitle"))l.yAxisTitle=b.textSubstitution.formatMessage(d);l.show();n.text("");o.setXData(k.indicatorData);o.setYData(j.indicatorData);
h&&o.setColorData(h.indicatorData);B&&a.getProperty("sizeData")!=void 0&&o.setSizeData(B);q.setXData(k.comparisonData);q.setYData(j.comparisonData);h&&q.setColorData(h.comparisonData);B=[];x=[];for(d=1;d<6;d++){var C=a.getProperty("line_xfield_"+d),A=a.getProperty("line_yfield_"+d);C!=void 0&&A!=void 0&&(B.push(C),x.push(A))}C=l.getLayers();for(d=0;d<B.length;d++){var f=C[d+2],D=g.getProperty(B[d]),A=y.getProperty(x[d]);if(D!=void 0&&A!=void 0){var D=D.split(","),G=[];if(ia.isNumber(A))for(var J=
0;J<D.length;J++)G.push(A);else G=A.split(",");f.setXData(D);f.setYData(G)}}}c!=void 0&&c.call(null,a.id)};this.render=function(c){l.render();var d=k.indicator.precision||2,e=b.locale.formatter,f=o.correlationInfo;b.textSubstitution.setVariable("correlationCoeff",e.format(f.correlationCoeff,d));b.textSubstitution.setVariable("rSquare",e.format(f.rSquare,d));b.textSubstitution.setVariable("gradient",e.format(f.gradient,d));b.textSubstitution.setVariable("intercept",e.format(f.intercept,d));b.updateDynamicText(b.textSubstitution);
c!=void 0&&c.call(null,a.id)}};
ia.AreaProfileFactory=function(a,b,c){var d=this,e=c.interactionGroup,f=c.dataGroup,g=c.comparisonInteractionGroup,h=!0;f.addEventListener(ia.DataEvent.GEOG_CHANGED,function(){h=!0;j.geography=f.geography});f.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var i=b.getWidget(a.id),k,j;this.build=function(c){var d=b.config.getComponent("profileLegend"+f.suffix);if(d&&k==void 0){k=new ia.ProfileLegend(d.id);var h=b.getWidget(d.id);h.append(k.container);b.addComponent(d.id,k);h.exportFunction=
function(a){iaExportPanel(h,a)}}if(j==void 0){i.content.empty();d=a.getProperty("useMouseClick");d==void 0&&(d=!0);j=new ia.Profile(a.id,d,function(a){b.config.template!=ia.ELECTION_REPORT&&(a=a.split("~"),f.setData(f.geography.id,a[0],a[1]))});j.geography=f.geography;if(d=b.getComponent("featureLegend"))j.colorPalette=d.colorPalette;j.comparisonThematic=f.comparisonThematic;j.formatter=b.locale.formatter;i.append(j.container);e.addComponent(j);g.addComponent(j);b.addComponent(a.id,j)}c!=void 0&&
c.call(null,a.id)};this.update=function(c){var d=b.config.getComponent("profileLegend"+f.suffix);if(k&&d&&d.getProperty("layout"))k.layout=d.getProperty("layout");var d=a.getProperties(),e=[],g=[],i;for(i in d){var p="symbol_shape_";if(i.indexOf(p)!=-1){var p=i.substring(i.lastIndexOf("_")+1,i.length),r={};r.value=a.getProperty("symbol_value_"+p);if(r.value!=void 0)r.shape=a.getProperty("symbol_shape_"+p),r.color=a.getProperty("symbol_color_"+p),r.size=a.getProperty("symbol_size_"+p),r.label=a.getProperty("symbol_label_"+
p),g[g.length]=r,p=new ia.CategoricClass(r.label),p.color=r.color,p.symbol=r.shape,p.size=r.size,p.value=r.label,e[e.length]=p}}j.symbols=g;g=[];for(i in d)if(p="target_shape_",i.indexOf(p)!=-1&&(p=i.substring(i.lastIndexOf("_")+1,i.length),r={},r.data=a.getProperty("target_data_"+p),r.data!=void 0))r.shape=a.getProperty("target_shape_"+p),r.color=a.getProperty("target_color_"+p),r.size=a.getProperty("target_size_"+p),r.label=a.getProperty("target_label_"+p),g[g.length]=r,p=new ia.CategoricClass(r.label),
p.color=r.color,p.symbol=r.shape,p.size=r.size,p.value=r.label,e[e.length]=p;j.targets=g;p={};p.data=a.getProperty("barData");p.color=a.getProperty("barColor")||"#ff00ff";p.shape=a.getProperty("barShape");p.symbolValue=a.getProperty("symbolValue");p.height=a.getProperty("barHeight");p.minValue=a.getProperty("minValue");p.midValue=a.getProperty("midValue");p.maxValue=a.getProperty("maxValue");p.breaksData=a.getProperty("breakData");p.breaksFlip=a.getProperty("breakFlipData");j.bar=p;j.displayMode=
a.getProperty("displayMode");j.displayDatesInProfile=a.getProperty("displayDatesInProfile");if(a.getProperty("includeMinMaxColumns")!=void 0)j.includeMinMaxColumns=a.getProperty("includeMinMaxColumns");j.useMouseClick=a.getProperty("useMouseClick");g=[];for(i in d)if(p="break_color_",i.indexOf(p)!=-1&&(p=i.substring(i.lastIndexOf("_")+1,i.length),r={},r.label=a.getProperty("break_label_"+p),r.label!=void 0))r.color=a.getProperty("break_color_"+p),g[g.length]=r,p=new ia.CategoricClass(r.label),p.color=
r.color,p.symbol=ia.Shape.SQUARE,p.size=10,p.value=r.label,e[e.length]=p;j.breaks=g;if(k)k.legendClasses=e,k.render();i=f.indicator;j.columns=a.getColumnsForIndicator(i,b.textSubstitution);j.indicator=i;j.render();h&&(i=a.getProperty("expandedThemeIds"),i!=void 0&&j.expandThemes(i),h=!1);c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.MapFactory=function(a,b,c){function d(){if(a==void 0)g();else{for(var c=q.getLayers(),d=0;d<c.length;d++){var f=c[d];i.removeComponent(f)}q.removeLayers();for(d=0;d<o.baseLayers.length;d++){f=o.baseLayers[d];f.dataLabel=b.config.getComponent(a.id).getProperty("tip");if(!f.displayLabelsOnly)f.interactive=!0;f.tipFunction=function(b){return ia.tipFunction(b,a.id)};f.dataField=k.thematic.getDataField();f.highlightColor=b.highlightColor;f.selectionColor=b.selectionColor;f.highlightOpacity=b.highlightOpacity;
f.selectionOpacity=b.selectionOpacity;i.addComponent(f)}if((d=b.config.getComponent("comparisonTable"+k.suffix))&&d.getProperty("linkToMap"))for(d=0;d<o.noneBaseLayers.length;d++)if(f=o.noneBaseLayers[d],f.geometry!="image")f.highlightable=!0,f.highlightColor=b.highlightColor,f.selectionColor=b.selectionColor,f.highlightOpacity=0,f.selectionOpacity=0,j.addComponent(f);var c=o.layers.length,l=!1;if(o.maintainLayerOrder)for(d=c-1;d>=0;d--)f=o.layers[d],(b.config.template==ia.DOUBLE_BASELAYER_REPORT||
b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)&&f.type=="base-layer"?l||(l=!0,q.addLayer(f)):q.addLayer(f);else for(d=0;d<c;d++)f=o.layers[d],(b.config.template==ia.DOUBLE_BASELAYER_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)&&f.type=="base-layer"?l||(l=!0,q.addLayer(f)):q.addLayer(f);q.controller.defaultBBox=o.mapBBox;o.useGoogleMaps?q.render():w?q.controller.zoomToBBox(w):q.controller.zoomFull();w=void 0;c=o.imageLayers;if(c.length>0)for(d=0;d<c.length;d++)f=c[d],f.type=="ags-layer"&&
f.addEventListener(ia.Event.LAYER_VISIBLE_CHANGED,e);n&&(n=!1,h.update(),h.render())}}function e(){a&&f(function(b){var c=a.getProperty("copyrightText");c==void 0&&(c="");c==""&&b==""?(s&&(s.hide(),v=!1),t.hide(),t.empty(),q.setCopyright(" ")):(c!=""&&b!=""?(t.html(c+" "+b),q.setCopyright(c+" "+b)):c!=""?(t.html(c),q.setCopyright(c)):(t.html(b),q.setCopyright(b)),s&&(b!=""?(s.show(),v=!0):(s.hide(),v=!1)),t.show())})}function f(a){var b,c=o.imageLayers;c.length>0&&(c=c[0],c.type=="ags-layer"&&c.getVisible()&&
(b=c));b!=void 0?(c=u[b.id],c!=void 0?a.call(null,c):(c=ia.getDomainSafeUrl(b.url),c.indexOf("MapServer")!=-1?ia.FeatureServiceReader.getInfo(c,ia.accessToken,function(c){c.error==void 0?(!x&&c.documentInfo&&c.documentInfo.Author=="Esri"&&(s=$j('<div id="esri-logo" class="ia-esri-logo"><img src="'+ia.IAS_PATH+'esri-logo.png"></div>'),q.addLogo(ia.IAS_PATH+"esri-logo.png"),m.append(s),x=v=!0),u[b.id]=c.copyrightText):c.copyrightText="";a.call(null,c.copyrightText)}):a.call(null,""))):a.call(null,"")}
function g(){q=b.getComponent("map");r=b.getComponent("activeMap");o.noneBaseLayers=[];if(o.baseLayers.length>1){var a=o.baseLayers[1];a.dataField=k.thematic.getDataField();a.highlightColor=b.highlightColor;a.selectionColor=b.selectionColor;a.highlightOpacity=b.highlightOpacity;a.selectionOpacity=b.selectionOpacity;if(!a.displayLabelsOnly)a.interactive=!0;a.dataLabel=b.config.getComponent("map").getProperty("tip"+k.suffix);a.tipFunction=function(a){return ia.tipFunction(a,"map",k.suffix)};b.config.template==
ia.DOUBLE_BASELAYER_REPORT&&i.addComponent(a);if(b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW)a.selectable=!1;q.addLayer(a)}}var h=this,i=c.interactionGroup,k=c.dataGroup,j=c.comparisonInteractionGroup;k.mapData.addEventListener(ia.DataEvent.MAP_DATA_CHANGED,function(){d()});k.addEventListener(ia.Event.THEMATIC_CHANGED,function(){l?n=!0:(h.update(),o.baseLayer.render())});k.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(a){var c=b.config.getProperty("zoomOnFilter");if(c==void 0||c==
!0)a.filterFeatures.length>0?b.config.template==ia.DOUBLE_BASELAYER_REPORT||b.config.template==ia.DOUBLE_BASELAYER_REPORT_NEW?r.zoomToFeatures(a.filterFeatures,[o.baseLayers[0]]):r.zoomToFeatures(a.filterFeatures,[o.baseLayer]):r.controller.zoomFull()});var m,n=!1,l=!1,o,q,p,r,t,s,u={},v=!1,w;b.url.params["bbox"+k.suffix]&&(c=b.url.params["bbox"+k.suffix].split(","),w=new ia.BoundingBox(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])));var x=!1;this.build=function(c){o=k.mapData;
if(a==void 0)g(),c!=void 0&&c.call(null,a?a.id:"map");else{l=!0;m=b.getWidget(a.id);m.exportFunction=function(a){iaExportPanelWithChart(m,q,v,a)};m.content.empty();q=new ia.Map(a.id);b.addComponent(a.id,q);var e=function(){var a=q.getBBox();b.url.params["bbox"+k.suffix]=a.getXMin()+","+a.getYMin()+","+a.getXMax()+","+a.getYMax()};q.addEventListener(ia.BBoxEvent.BBOX_TRANSLATE,e);q.addEventListener(ia.BBoxEvent.BBOX_SCALE,e);var e=a.getProperty("minZoomAllowed"),f=a.getProperty("maxZoomAllowed");if(o.useGoogleMaps)r=
p=new ia.GoogleMap(a.id,o.googleMapType,o.googleApiKey,e,f,a.getProperty("googleGreyscaleText"),a.getProperty("googleOffText")),p.addEventListener(ia.Event.MAP_READY,function(){o.mapBBox.getXMin()<-2E7&&o.mapBBox.setXMin(-2E7);o.mapBBox.getXMax()>2E7&&o.mapBBox.setXMax(2E7);p.controller.defaultBBox=o.mapBBox;w?p.controller.zoomToBBox(w):p.controller.zoomFull();p.addMapOverlay(q)}),b.addComponent("gMap"+k.suffix,p);else{if(e!=-1)q.minZoom=e;if(f!=-1)q.maxZoom=f;q.useNavigation(!0);r=q}q.addEventListener(ia.Event.MAP_READY,
function(){d();l=!1;c!=void 0&&c.call(null,a.id)});b.addComponent("activeMap"+k.suffix,r);m.append(r.container);t=$j('<div id="map-copyright" class="ia-map-copyright"></div>');var h=!1;t.on("click",function(){(h=!h)?t.addClass("ia-map-copyright-expand"):t.removeClass("ia-map-copyright-expand")});m.append(t);b.evaluation&&b.displayEvaluationMessage(m);e=a.getProperty("includeSearchTool");e==void 0&&(e=!1);if(e&&k.suffix==""){var f=window.location.protocol=="file:"?"http:":window.location.protocol,
j=document.createElement("script");j.type="text/javascript";j.src=f+"//code.jquery.com/ui/1.9.2/jquery-ui.js";document.body.appendChild(j)}e=new ia.MapTools(r,k,i,o.useGoogleMaps,e);e.clearButtonText=a.getProperty("clearButtonText");e.filterButtonText=a.getProperty("filterButtonText");e.filterFunction=function(){i.getSelection().length>0?k.setFilteredFeatures(i.getSelection()):k.getFilteredFeatures().length>0&&k.clearFilter()};e.clearFunction=function(){i.clearSelection()};m.append(e.container);b.addComponent("mapTools"+
k.suffix,e);e.render()}};this.update=function(c){for(var d=0;d<o.baseLayers.length;d++){var f=o.baseLayers[d];f.dataField=k.thematic.getDataField();f.highlightColor=b.highlightColor;f.selectionColor=b.selectionColor;f.highlightOpacity=b.highlightOpacity;f.selectionOpacity=b.selectionOpacity}if(a)d=a.getProperty("minZoomAllowed"),f=a.getProperty("maxZoomAllowed"),q.minZoom=d!=-1?d:void 0,q.maxZoom=f!=-1?f:void 0;if((d=b.config.getComponent("comparisonTable"+k.suffix))&&d.getProperty("linkToMap"))for(d=
0;d<o.noneBaseLayers.length;d++)f=o.noneBaseLayers[d],f.geometry!="image"?(f.highlightable=!0,f.highlightColor=b.highlightColor,f.selectionColor=b.selectionColor,f.highlightOpacity=0,f.selectionOpacity=0):f.highlightable=!1;e();o.baseLayer.setData(k.indicatorData);c!=void 0&&c.call(null,a?a.id:"map")};this.render=function(b){q.render();b!=void 0&&b.call(null,a?a.id:"map")}};
ia.TextBoxFactory=function(a,b,c){var d=this,e=c.dataGroup;e.addEventListener(ia.DataEvent.DATA_CHANGED,function(){d.update()});var f=b.getWidget(a.id),g;this.build=function(c){f.content.empty();g=new ia.TextBox(a.id);f.append(g.container);b.addComponent(a.id,textbox);c!=void 0&&c.call(null,a.id)};this.update=function(c){var d="",f=a.getProperty("propertyKey");f!=void 0?(d=e.indicator.getProperty(f),d=d!=void 0?d:""):a.getProperty("text")&&(d=b.textSubstitution.formatMessage(a.getProperty("text")));
g.setHtml(d);c!=void 0&&c.call(null,a.id)};this.render=function(b){b!=void 0&&b.call(null,a.id)}};
ia.RadarFactory=function(a,b,c){function d(a,b,c){var d;if(k.dataField=="value")d=b;else for(var e=0;e<b.features[0].associates.length;e++){var f=b.features[0].associates[e];if(f.name==k.dataField){d=f;break}}d&&d.type!="categoric"&&(m++,c==void 0?i.xAxisLabels.push(""):(a=(c+"").split("${themeName}").join(a.name),a=a.split("${indicatorName}").join(b.name),a=a.split("${date}").join(b.date),i.xAxisLabels.push(a)))}ia.RadarFactory.baseConstructor.call(this,a,b,c);var e=this,f=c.interactionGroup,g=c.dataGroup,
c=c.comparisonInteractionGroup;g.addEventListener(ia.DataEvent.DATA_CHANGED,function(){e.update();e.render()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){e.update();e.render()});var h=b.getWidget(a.id);h.exportFunction=function(a){iaExportPanelWithChart(h,i,!1,a)};var i,k,j,m,n=function(){k.dataChanged=!0;e.render()};this.build=function(b){h.content.empty();i=new ia.RadarChart(a.id);k=new ia.RadarLayer;j=new ia.ComparisonRadarLayer;j.thematic=g.comparisonThematic;e.buildChart(i,
k,j);i.addEventListener(ia.Event.MAP_READY,function(){b!=void 0&&b.call(null,a.id)});h.append(i.container)};this.update=function(c){e.updateChart(i,k,j);var h=a.getProperty("displayMode");i.radarPadding=a.getProperty("radarPadding");i.startAxisFromZero=a.getProperty("startAxisFromZero");i.type=a.getProperty("chartType");var q=a.getProperty("chartLabels");i.xAxisLabels=[];m=0;if(h=="All themes"){var p=g.geography.getIndicatorData(null,g.indicator.date);$j.each(p.themes,function(a,b){$j.each(b.indicators,
function(a,c){d(b,c,q)})})}else if(h=="Selected theme only"){var r=g.theme.getIndicatorData(null,g.indicator.date);$j.each(r.indicators,function(a,b){d(r,b,q)})}k.selectedDate=g.indicator.date;k.markerSize=a.getProperty("markerSize");a.getProperty("matchAxisToSelectedData")?f.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,n,this):f.removeListener(this);if(b.config.getComponent("featureLegend"+g.suffix))p=b.config.getComponent("featureLegend"+g.suffix),p=p.getProperty("colorSchemeId"),k.colorPalette=
b.config.getMapPalette().getColorScheme(p);else if(b.config.getComponent("featureLegend"))p=b.config.getComponent("featureLegend"),p=p.getProperty("colorSchemeId"),k.colorPalette=b.config.getMapPalette().getColorScheme(p);var t;h=="All themes"?t=g.geography.getFeatureData(null,g.indicator.date):h=="Selected theme only"&&(t=g.geography.getFeatureData(null,g.indicator.date,g.theme.id));k.setData(t);j.selectedDate=g.indicator.date;j.setData(g.comparisonThemeData);j.markerSize=a.getProperty("markerSize");
t=g.geography.getComparisonFeatures();if(t.length>0){for(var p=[],s=0;s<t.length;s++)p.push(t[s].id);var u;h=="All themes"?u=g.geography.getFeatureData(p,g.indicator.date):h=="Selected theme only"&&(u=g.geography.getFeatureData(p,g.indicator.date,g.theme.id));j.setData(u)}c!=void 0&&c.call(null,a.id)};this.render=function(b){m>2?(h.text(""),i.show(),i.render()):(i.hide(),h.text(a.getProperty("notAvailableText")));b!=void 0&&b.call(null,a.id)}};ia.extend(ia.ChartFactory,ia.RadarFactory);
ia.ComponentFactory.prototype.buildInteractionGroups=function(a,b,c,d){function e(c){if(c.length>0){var d=b.geography.getFeature(c[0]);d&&a.textSubstitution.setVariable("selectedFeature"+b.suffix,d.name);a.url.params["select"+b.suffix]=c.join(",")}else a.textSubstitution.setVariable("selectedFeature"+b.suffix,""),a.url.params["select"+b.suffix]="";a.updateDynamicText(a.textSubstitution)}a.addComponent("interactionGroup"+b.suffix,c);a.addComponent("comparisonInteractionGroup"+b.suffix,d);b.addEventListener(ia.DataEvent.GEOG_CHANGED,
function(){c.clearSelection();d.clearSelection()});b.addEventListener(ia.FilterEvent.FILTER_CHANGED,function(){c.clearSelection()});c.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){e(c.getSelection())});d.addEventListener(ia.InteractionEvent.SELECTION_CHANGED,function(){var c=d.getSelection();a.url.params["comparisonSelect"+b.suffix]=c.length>0?c.join(","):""});if(a.url.params["select"+b.suffix]){var f=a.url.params["select"+b.suffix].toString().split(",");e(f)}};
